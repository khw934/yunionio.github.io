"use strict";(self.webpackChunkdocs_new=self.webpackChunkdocs_new||[]).push([[7357],{39032:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>u,frontMatter:()=>s,metadata:()=>c,toc:()=>l});var t=o(85893),i=o(11151);const s={sidebar_position:2,edition:"ce"},r="Quick Installation via Docker Compose",c={id:"getting-started/cmp/quickstart-docker-compose",title:"Quick Installation via Docker Compose",description:"Use Docker Compose to rapidly deploy the Cloudpods CMP multi-cloud management version",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/getting-started/cmp/quickstart-docker-compose.md",sourceDirName:"getting-started/cmp",slug:"/getting-started/cmp/quickstart-docker-compose",permalink:"/v3.10/en/docs/getting-started/cmp/quickstart-docker-compose",draft:!1,unlisted:!1,editUrl:"https://github.com/yunionio/website/tree/master/docs/getting-started/cmp/quickstart-docker-compose.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,edition:"ce"},sidebar:"tutorialSidebar",previous:{title:"Quick Installation via Ocboot",permalink:"/v3.10/en/docs/getting-started/cmp/quickstart-ocboot"},next:{title:"Installation on Kubernetes",permalink:"/v3.10/en/docs/getting-started/cmp/quickstart-k8s-helm"}},a={},l=[{value:"Requirements",id:"requirements",level:2},{value:"Environment Preparation",id:"environment-preparation",level:2},{value:"Machine Configuration Requirements",id:"machine-configuration-requirements",level:3},{value:"Installing and Configuring Docker",id:"installing-and-configuring-docker",level:3},{value:"Running Cloudpods CMP",id:"running-cloudpods-cmp",level:2},{value:"Operational Instructions",id:"operational-instructions",level:2},{value:"1. Run services in the background",id:"1-run-services-in-the-background",level:3},{value:"2. Log in to the climc command line container",id:"2-log-in-to-the-climc-command-line-container",level:3},{value:"3. Check service configuration and persistent data",id:"3-check-service-configuration-and-persistent-data",level:3},{value:"4. Delete all containers",id:"4-delete-all-containers",level:3},{value:"Common problems",id:"common-problems",level:2},{value:"1. The docker service does not open iptables and the bridge, causing the container network to fail to be created",id:"1-the-docker-service-does-not-open-iptables-and-the-bridge-causing-the-container-network-to-fail-to-be-created",level:3},{value:"2. How is the docker-compose.yml file generated with many services?",id:"2-how-is-the-docker-composeyml-file-generated-with-many-services",level:3},{value:"3. How to upgrade the service?",id:"3-how-to-upgrade-the-service",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"quick-installation-via-docker-compose",children:"Quick Installation via Docker Compose"}),"\n",(0,t.jsxs)(n.p,{children:["Use ",(0,t.jsx)(n.a,{href:"https://docs.docker.com/compose/",children:"Docker Compose"})," to rapidly deploy the Cloudpods CMP multi-cloud management version"]}),"\n",(0,t.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,t.jsxs)(n.admonition,{title:"Note",type:"tip",children:[(0,t.jsx)(n.p,{children:"This method deploys the Cloudpods multi-cloud management version through Docker Compose, in an All in One environment where all multi-cloud management services run in containers on a single node."}),(0,t.jsx)(n.p,{children:"This deployment method only applies to the use of multi-cloud management features, such as managing public clouds (AWS, Alibaba Cloud, Tencent Cloud, etc.) or other private clouds (ZStack, OpenStack, etc.), and cannot be used for built-in private cloud-related features (because built-in private clouds require the installation and configuration of various virtualization software such as QEMU and Openvswitch on the nodes)."}),(0,t.jsxs)(n.p,{children:["In addition, VMware cannot currently be managed using Docker Compose because disk management for VMware currently depends on the kernel nbd module, which cannot be loaded inside docker compose. If you need to manage VMware, use the ",(0,t.jsx)(n.a,{href:"./quickstart-ocboot",children:"Quick Installation via Ocboot"})," method to deploy."]}),(0,t.jsxs)(n.p,{children:["If you need to use the built-in private cloud, use the ",(0,t.jsx)(n.a,{href:"../onpremise/",children:"Private cloud"})," deployment method."]})]}),"\n",(0,t.jsx)(n.h2,{id:"environment-preparation",children:"Environment Preparation"}),"\n",(0,t.jsx)(n.h3,{id:"machine-configuration-requirements",children:"Machine Configuration Requirements"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Minimum configuration requirements: 4 core CPUs, 8GiB memory, 100GiB storage"}),"\n",(0,t.jsxs)(n.li,{children:["docker version: ce-23.0.2","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"It is recommended to install the latest version of CE, as the new version already includes the docker-compose plugin."}),"\n",(0,t.jsx)(n.li,{children:"Docker needs to enable container networks and iptables."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"installing-and-configuring-docker",children:"Installing and Configuring Docker"}),"\n",(0,t.jsx)(n.admonition,{title:"Note",type:"tip",children:(0,t.jsx)(n.p,{children:"If your environment has already installed a newer version of Docker, you can skip this step."})}),"\n",(0,t.jsxs)(n.p,{children:["Here, CentOS 7 is used to install Docker as an example. If it is another distribution, please refer to the official document for installation: ",(0,t.jsx)(n.a,{href:"https://docs.docker.com/engine/install/",children:"Install Docker Engine"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"For Chinese users, installing docker-ce can use Aliyun's repository, with the following steps:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Install necessary system tools\n$ sudo yum install -y yum-utils device-mapper-persistent-data lvm2\n\n# Add software source information\n$ sudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n\n# Update and install docker-ce and compose plugins\n$ sudo yum makecache fast\n$ sudo yum -y install docker-ce docker-ce-cli docker-compose-plugin\n\n# Enable Docker service\n$ sudo systemctl enable --now docker\n"})}),"\n",(0,t.jsx)(n.h2,{id:"running-cloudpods-cmp",children:"Running Cloudpods CMP"}),"\n",(0,t.jsxs)(n.p,{children:["After the Docker Compose environment is ready, you can use the docker-compose.yml configuration file in ",(0,t.jsx)(n.a,{href:"https://github.com/yunionio/ocboot",children:"https://github.com/yunionio/ocboot"})," to start the service, as follows:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Download the OCBoot tool to the local environment\n$ git clone -b release/3.10 https://github.com/yunionio/ocboot && cd ./ocboot\n\n# Enter the compose directory\n$ cd compose\n$ ls -alh docker-compose.yml\n\n# Start services\n$ docker compose up\n"})}),"\n",(0,t.jsxs)(n.p,{children:["After the services are started, you can log in to ",(0,t.jsx)(n.em,{children:(0,t.jsx)(n.a,{href:"https://localhost",children:"https://localhost"})})," to access the front-end service. The default login user and password are admin and admin@123, respectively."]}),"\n",(0,t.jsx)(n.h2,{id:"operational-instructions",children:"Operational Instructions"}),"\n",(0,t.jsx)(n.h3,{id:"1-run-services-in-the-background",children:"1. Run services in the background"}),"\n",(0,t.jsx)(n.p,{children:"Use the '-d / --detach' parameter to run all services in the background, as follows:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Run all services in the background\n$ docker compose up -d\n\n# After the service is put in the background, you can use the 'logs' instruction to view the output log\n$ docker compose logs -f\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-log-in-to-the-climc-command-line-container",children:"2. Log in to the climc command line container"}),"\n",(0,t.jsx)(n.p,{children:"If you need to operate on the platform using command-line tools, log in to the container using the following method:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"$ docker exec -ti compose-climc-1 bash\n```Welcome to Cloud Shell :-) You may execute `climc` and other command tools in this shell.\nPlease exec 'climc' to get started\n\n# Source authentication information\nbash-5.1# source /etc/yunion/rcadmin\nbash-5.1# climc user-list\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-check-service-configuration-and-persistent-data",children:"3. Check service configuration and persistent data"}),"\n",(0,t.jsxs)(n.p,{children:["All persistent data for services is stored under the directory ",(0,t.jsx)(n.em,{children:"ocboot/compose/data"}),", and all configurations are auto-generated and generally don't need manual modification. The directories are explained below:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"$ tree data\ndata\n\u251c\u2500\u2500 etc\n\u2502\xa0\xa0 \u251c\u2500\u2500 nginx\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 conf.d\n\u2502\xa0\xa0 \u2502\xa0\xa0     \u2514\u2500\u2500 default.conf    # Front-end nginx configuration\n\u2502\xa0\xa0 \u2514\u2500\u2500 yunion\n\u2502\xa0\xa0     \u251c\u2500\u2500 *.conf  # Configuration for various cloudpod services\n\u2502\xa0\xa0     \u251c\u2500\u2500 pki     # Certificate directory\n\u2502\xa0\xa0     \u251c\u2500\u2500 rcadmin     # Command-line authentication information\n\u251c\u2500\u2500 opt\n\u2502\xa0\xa0 \u2514\u2500\u2500 cloud\n\u2502\xa0\xa0     \u2514\u2500\u2500 workspace\n\u2502\xa0\xa0         \u2514\u2500\u2500 data\n\u2502\xa0\xa0             \u2514\u2500\u2500 glance # The image directory for the image service storage\n\u2514\u2500\u2500 var\n    \u2514\u2500\u2500 lib\n        \u251c\u2500\u2500 influxdb    # The directory for persisting InfluxDB data\n        \u2514\u2500\u2500 mysql       # The directory for persisting MySQL database data\n"})}),"\n",(0,t.jsx)(n.h3,{id:"4-delete-all-containers",children:"4. Delete all containers"}),"\n",(0,t.jsxs)(n.p,{children:["All persistent data for services is stored under the directory ",(0,t.jsx)(n.em,{children:"ocboot/compose/data"}),", and removing containers will not result in data loss. Simply restart using ",(0,t.jsx)(n.em,{children:"docker compose up"})," the next time. The operation is shown below:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Remove the service\n$ docker compose down\n"})}),"\n",(0,t.jsx)(n.h2,{id:"common-problems",children:"Common problems"}),"\n",(0,t.jsx)(n.h3,{id:"1-the-docker-service-does-not-open-iptables-and-the-bridge-causing-the-container-network-to-fail-to-be-created",children:"1. The docker service does not open iptables and the bridge, causing the container network to fail to be created"}),"\n",(0,t.jsxs)(n.p,{children:['By default, iptables is turned on when starting the docker service. If "bridge: none" and "iptables: false" are set in ',(0,t.jsx)(n.em,{children:"/etc/docker/daemon.json"}),", docker compose functionality will not work."]}),"\n",(0,t.jsxs)(n.p,{children:["Before running ",(0,t.jsx)(n.code,{children:"docker compose"}),", make sure that the bridge and iptables functions are turned on."]}),"\n",(0,t.jsx)(n.h3,{id:"2-how-is-the-docker-composeyml-file-generated-with-many-services",children:"2. How is the docker-compose.yml file generated with many services?"}),"\n",(0,t.jsxs)(n.p,{children:["The Cloudpods CMP multi-cloud management version includes various services. Manually writing each compose configuration would be very complex, so the ",(0,t.jsx)(n.em,{children:"generate-compose.py"})," script is used in ocboot to generate the ",(0,t.jsx)(n.code,{children:"docker-compose.yml"})," file. The following command can be used to generate the compose configuration file:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"$ python3 generate-compose.py > compose/docker-compose.yml\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-how-to-upgrade-the-service",children:"3. How to upgrade the service?"}),"\n",(0,t.jsxs)(n.p,{children:["Upgrading via docker compose is very convenient, just update the ",(0,t.jsx)(n.code,{children:"docker-compose.yml"})," configuration file."]}),"\n",(0,t.jsxs)(n.p,{children:["For example, if ",(0,t.jsx)(n.em,{children:"ocboot/compose/docker-compose.yml"})," has been updated, simply pull the latest code using ",(0,t.jsx)(n.code,{children:"git pull"}),", and then restart. The steps are as follows:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Update with git pull\n$ cd ocboot\n$ git pull\n\n# Restart the compose service\n$ cd compose\n$ docker compose down\n$ docker compose up -d\n"})})]})}function u(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},11151:(e,n,o)=>{o.d(n,{Z:()=>c,a:()=>r});var t=o(67294);const i={},s=t.createContext(i);function r(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);
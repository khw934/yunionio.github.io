"use strict";(self.webpackChunkdocs_new=self.webpackChunkdocs_new||[]).push([[7653],{15114:(n,e,s)=>{s.d(e,{Ay:()=>c,RM:()=>i});var t=s(74848),o=s(28453),d=s(89389);const i=[...d.RM,{value:"\u9ad8\u53ef\u7528\u96c6\u7fa4 ntp \u4e00\u81f4\u6027",id:"\u9ad8\u53ef\u7528\u96c6\u7fa4-ntp-\u4e00\u81f4\u6027",level:2}];function r(n){const e={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.Ay,{}),"\n",(0,t.jsx)(e.p,{children:"\u5047\u8bbe\u51c6\u5907\u597d\u4e86 3 \u53f0 CentOS7 \u673a\u5668\uff0c\u4ee5\u53ca 1 \u53f0 Mariadb/MySQL \u7684\u673a\u5668\uff0c\u89c4\u5212\u5982\u4e0b\uff1a"}),"\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"role"}),(0,t.jsx)(e.th,{children:"ip"}),(0,t.jsx)(e.th,{children:"interface"}),(0,t.jsx)(e.th,{children:"note"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"k8s primary"}),(0,t.jsx)(e.td,{children:"10.127.90.101"}),(0,t.jsx)(e.td,{children:"eth0"}),(0,t.jsx)(e.td,{children:"\u7b2c1\u4e2a\u63a7\u5236\u8282\u70b9"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"k8s master 1"}),(0,t.jsx)(e.td,{children:"10.127.90.102"}),(0,t.jsx)(e.td,{children:"eth0"}),(0,t.jsx)(e.td,{children:"\u7b2c2\u4e2a\u63a7\u5236\u8282\u70b9"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"k8s master 2"}),(0,t.jsx)(e.td,{children:"10.127.90.103"}),(0,t.jsx)(e.td,{children:"eth0"}),(0,t.jsx)(e.td,{children:"\u7b2c3\u4e2a\u63a7\u5236\u8282\u70b9"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"k8s VIP"}),(0,t.jsx)(e.td,{children:"10.127.190.10"}),(0,t.jsx)(e.td,{children:"-"}),(0,t.jsx)(e.td,{children:"keepalived \u4f7f\u7528\u7684 vip \uff0c\u4f1a\u4f18\u5148\u7ed1\u5b9a\u5728 3 \u4e2a\u63a7\u5236\u8282\u70b9\u4e2d\u7684\u7b2c\u4e00\u4e2a"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"DB"}),(0,t.jsx)(e.td,{children:"10.127.190.11"}),(0,t.jsx)(e.td,{children:"-"}),(0,t.jsx)(e.td,{children:'\u6570\u636e\u5e93\u72ec\u7acb\u8282\u70b9 pswd="0neC1oudDB#",  port=3306'})]})]})]}),"\n",(0,t.jsx)(e.p,{children:"\u5176\u4e2d DB \u7684\u90e8\u7f72\u76ee\u524d\u662f\u4e0d\u5f52 ocboot \u90e8\u7f72\u5de5\u5177\u7ba1\u7406\u7684\uff0c\u9700\u8981\u63d0\u524d\u624b\u52a8\u90e8\u7f72\u3002 \u5efa\u8bae\u4f7f\u7528 MariaDB \u6570\u636e\u5e93\uff0c\u4e0d\u8981\u4f7f\u7528 MySQL 5.6\u53ca\u4ee5\u4e0b\u7248\u672c\uff0c\u9632\u6b62\u51fa\u73b0\u7d22\u5f15\u957f\u5ea6 bug\uff1a Index column size too large. The maximum column size is 767 bytes. \u7684\u95ee\u9898\u3002\u5404\u53d1\u884c\u7248\u5bf9\u5e94 MariaDB \u7248\u672c\u5982\u4e0b\uff1a"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Centos 7.6-7.9  Minimal(X86_64\u548cARM64) \u9ed8\u8ba4\u5b89\u88c5MariaDB 5.5.68"}),"\n",(0,t.jsx)(e.li,{children:"Debian 10-11(X86_64\u548cARM64) \u9ed8\u8ba4\u5b89\u88c5MariaDB 10.3.1"}),"\n",(0,t.jsx)(e.li,{children:"Kylin V10 sp2(X86_64\u548cARM64) \u9ed8\u8ba4\u5b89\u88c5MariaDB 10.3.4"}),"\n"]}),"\n",(0,t.jsxs)(e.p,{children:["\u53e6\u5916\u9ad8\u53ef\u7528\u7684\u6570\u636e\u5e93\u90e8\u7f72\u4e5f\u53ef\u4ee5\u53c2\u8003\u6587\u6863\uff1a",(0,t.jsx)(e.a,{href:"../../operations/databases/db-ha",children:"\u90e8\u7f72 Mariadb HA \u73af\u5883"})," \u3002"]}),"\n",(0,t.jsx)(e.h2,{id:"\u9ad8\u53ef\u7528\u96c6\u7fa4-ntp-\u4e00\u81f4\u6027",children:"\u9ad8\u53ef\u7528\u96c6\u7fa4 ntp \u4e00\u81f4\u6027"}),"\n",(0,t.jsx)(e.p,{children:"\u8bf7\u5728\u5b89\u88c5\u4e4b\u524d\uff0c\u786e\u4fdd\u5404\u4e2a\u5f85\u90e8\u7f72\u8282\u70b9\u7684\u65f6\u95f4\u4e00\u81f4\uff0c\u5426\u5219\u4f1a\u51fa\u73b0\u5728\u7b7e\u53d1\u8bc1\u4e66\u6b65\u9aa4\u5931\u8d25\u3002"}),"\n",(0,t.jsx)(e.p,{children:"\u5982\u679c\u662f\u8054\u7f51\u5b89\u88c5\uff0c\u53ef\u4ee5\u53c2\u8003\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u786e\u4fdd\u96c6\u7fa4\u5185\u6bcf\u53f0\u670d\u52a1\u5668\u90fd\u4e0e\u4e92\u8054\u7f51\u65f6\u95f4\u4fdd\u6301\u4e00\u81f4\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# \u60a8\u53ef\u4ee5\u9009\u62e9\u66f4\u65b9\u4fbf\u3001\u53ef\u8fbe\u7684\u6388\u65f6\u670d\u52a1\u5668\n# \u5982\u679c\u63d0\u793a\u6ca1\u6709ntpdate \u547d\u4ee4\uff0c\u8bf7\u4f7f\u7528 os \u5bf9\u5e94\u7684\u5305\u7ba1\u7406\u5668\u81ea\u884c\u5b89\u88c5\n# \u4f8b\u5982\u5728centos \u4e0a\uff1a yum install -y ntp && systemctl enable ntpd --now\n$ ntpdate -u edu.ntp.org.cn && hwclock -w && ntpdate -u -q edu.ntp.org.cn\n"})})]})}function c(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(r,{...n})}):r(n)}},928:(n,e,s)=>{s.d(e,{Ay:()=>r,RM:()=>d});var t=s(74848),o=s(28453);const d=[];function i(n){const e={a:"a",code:"code",p:"p",pre:"pre",...(0,o.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.p,{children:"3\u4e2a\u63a7\u5236\u8282\u70b9\u90fd\u4f1a\u8fd0\u884c kube-apiserver, etcd \u8fd9\u4e9b\u5173\u952e\u670d\u52a1\uff0c\u5982\u679c\u9047\u5230\u67d0\u4e00\u4e2a\u8282\u70b9\u9047\u5230 etcd \u6570\u636e\u4e0d\u4e00\u81f4\uff0c\u53ef\u4ee5\u5c06\u8be5\u8282\u70b9 reset \u540e\u91cd\u65b0\u52a0\u5165\u96c6\u7fa4\uff0c\u6b65\u9aa4\u5982\u4e0b\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# \u5230\u5176\u4ed6\u6b63\u5e38\u7684\u63a7\u5236\u8282\u70b9\u521b\u5efa join token\n$ export KUBECONFIG=/etc/kubernetes/admin.conf\n$ ocadm token create --description \"ocadm-playbook-node-joining-token\" --ttl 90m\n2fmpbx.7zikd8sp5uhaxrjr\n\n# \u83b7\u53d6\u63a7\u5236\u8282\u70b9\u8ba4\u8bc1\n$ /opt/yunion/bin/ocadm init phase upload-certs | grep -v upload-certs\n6150f8da2dcdf3a8a730f407ddce9f1cb9f24b15ffa4e4b3680e16ed40201cf0\n\n##########  \u6ce8\u610f\u4e0b\u9762\u7684\u547d\u4ee4\u9700\u8981\u767b\u9646\u5230\u9700\u8981\u91cd\u65b0\u52a0\u5165\u7684\u8282\u70b9\u6267\u884c  ###########\n# \u5982\u679c\u8be5\u8282\u70b9\u66fe\u7ecf\u4f5c\u4e3a\u8ba1\u7b97\u8282\u70b9\u52a0\u5165\u8fc7\u4e91\u5e73\u53f0\n# \u9700\u8981\u5907\u4efd\u5f53\u524d\u5bbf\u4e3b\u673a /etc/yunion/host.conf \u914d\u7f6e\n[your-reset-node] $ cp /etc/yunion/host.conf /etc/yunion/host.conf.manual.bk\n\n# \u767b\u9646\u5230\u9700\u8981\u91cd\u65b0 reset \u52a0\u5165\u7684\u8282\u70b9\uff0creset \u5f53\u524d\u7684 kubernetes \u73af\u5883\n[your-reset-node] $ kubeadm reset -f\n\n# \u5047\u8bbe\u5f53\u524d\u7684\u7f51\u5361\u4e3a bond0(\u5982\u679c\u4e0d\u505a bond \uff0c\u7269\u7406\u7f51\u5361\u4e00\u822c\u4e3a eth0 \u4e4b\u7c7b\u7684\u540d\u79f0)\uff0cip \u4e3a 172.16.84.40\uff0c\u9700\u8981\u52a0\u5165\u96c6\u7fa4 172.16.84.101:6443 \u96c6\u7fa4\n[your-reset-node] $ ocadm join \\\n        --control-plane 172.16.84.101:6443 \\ # \u52a0\u5165\u7684\u76ee\u6807\u96c6\u7fa4\n        --token 2fmpbx.7zikd8sp5uhaxrjr --certificate-key 6150f8da2dcdf3a8a730f407ddce9f1cb9f24b15ffa4e4b3680e16ed40201cf0 --discovery-token-unsafe-skip-ca-verification \\ # \u52a0\u5165\u8ba4\u8bc1\u4fe1\u606f\n        --apiserver-advertise-address 172.16.84.40 --node-ip 172.16.84.40 \\ # \u8be5\u8282\u70b9 ip\n        --as-onecloud-controller \\ # \u4f5c\u4e3a cloudpods \u63a7\u5236\u8282\u70b9\n        --enable-host-agent \\ # \u4f5c\u4e3a cloudpods \u8ba1\u7b97\u8282\u70b9\n        --host-networks 'bond0/br0/172.16.84.40' \\ # \u8ba1\u7b97\u8282\u70b9\u7684\u6865\u63a5\u7f51\u7edc\uff0c\u610f\u601d\u521b\u5efa br0 \u7f51\u6865\uff0c\u5e76\u628a bond0 \u52a0\u5165\u8fdb\u6765\uff0c\u7ed9 br0 \u7f51\u6865\u914d\u7f6e ip 172.16.84.40\n        --high-availability-vip 172.16.84.101 --keepalived-version-tag v2.0.25 # keepalived \u7684 vip \uff0c\u4fdd\u8bc1 kube-apiserver \u7684\u9ad8\u53ef\u7528\u6027\n\n# \u7b49\u5f85\u52a0\u5165\u5b8c\u6210\u540e\uff0c\u8fd8\u539f /etc/yunion/host.conf.manual.bk \u914d\u7f6e\n[your-reset-node] $ cp /etc/yunion/host.conf.manual.bk /etc/yunion/host.conf\n\n# \u91cd\u542f host \u670d\u52a1\n$ kubectl get pods -n onecloud -o wide | grep host | grep $your-reset-node\n$ kubectl delete pods -n onecloud default-host-xxxx\n"})}),"\n",(0,t.jsxs)(e.p,{children:["\u4ee5\u4e0a\u624b\u52a8\u7684\u6b65\u9aa4\u53c2\u8003\u4e86 ocboot join master-node \u7684\u903b\u8f91\uff0c\u53ef\u53c2\u8003 ",(0,t.jsx)(e.a,{href:"https://github.com/yunionio/ocboot/blob/master/onecloud/roles/master-node/tasks/main.yml",children:"https://github.com/yunionio/ocboot/blob/master/onecloud/roles/master-node/tasks/main.yml"})," \u3002"]})]})}function r(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(i,{...n})}):i(n)}},89389:(n,e,s)=>{s.d(e,{Ay:()=>r,RM:()=>d});var t=s(74848),o=s(28453);const d=[{value:"\u64cd\u4f5c\u7cfb\u7edf:",id:"\u64cd\u4f5c\u7cfb\u7edf",level:3}];function i(n){const e={admonition:"admonition",h3:"h3",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.h3,{id:"\u64cd\u4f5c\u7cfb\u7edf",children:"\u64cd\u4f5c\u7cfb\u7edf:"}),"\n",(0,t.jsx)(e.p,{children:"\u6839\u636e CPU \u67b6\u6784\u4e0d\u540c\uff0c\u652f\u6301\u7684\u53d1\u884c\u7248\u4e5f\u4e0d\u4e00\u6837\uff0c\u76ee\u524d\u652f\u6301\u7684\u53d1\u884c\u7248\u60c5\u51b5\u5982\u4e0b\uff1a"}),"\n",(0,t.jsx)(e.p,{children:"\u6ce8\uff1a3.11\u30013.10\u7b49\uff0c\u8868\u793a\u53d1\u884c\u7248 Release/3.11\u3001Release/3.10\u3002\u5176\u4f59\u540c\u7406\u3002"}),"\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{}),(0,t.jsx)(e.th,{children:"3.11"}),(0,t.jsx)(e.th,{children:"3.10"}),(0,t.jsx)(e.th,{children:"3.9"}),(0,t.jsx)(e.th,{children:"3.8"}),(0,t.jsx)(e.th,{children:"3.7"}),(0,t.jsx)(e.th,{children:"3.6"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"CentOS 7 2009 x86_64+aarch64"}),(0,t.jsx)(e.td,{children:"\u2705"}),(0,t.jsx)(e.td,{children:"\u2705"}),(0,t.jsx)(e.td,{children:"\u2705"}),(0,t.jsx)(e.td,{children:"\u2705"}),(0,t.jsx)(e.td,{children:"\u2705"}),(0,t.jsx)(e.td,{children:"\u2705"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"OpenEuler 22.03 LTS Sp3 x86_64+aarch64"}),(0,t.jsx)(e.td,{children:"\u2705"}),(0,t.jsx)(e.td,{children:"\u2705"}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Debian 10 x86_64+aarch64"}),(0,t.jsx)(e.td,{children:"\u2705"}),(0,t.jsx)(e.td,{children:"\u2705"}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Debian 11 x86_64+aarch64"}),(0,t.jsx)(e.td,{children:"\u2705"}),(0,t.jsx)(e.td,{children:"\u2705"}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Ubuntu 22.04 x86_64+aarch64"}),(0,t.jsx)(e.td,{children:"\u2705"}),(0,t.jsx)(e.td,{children:"\u2705"}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"CentOS  Stream8 x86_64"}),(0,t.jsx)(e.td,{children:"\u2705"}),(0,t.jsx)(e.td,{children:"\u2705"}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Rocky Linux 8.9 x86_64"}),(0,t.jsx)(e.td,{children:"\u2705"}),(0,t.jsx)(e.td,{children:"\u2705"}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"OpencloudOS 8.8 x86_64"}),(0,t.jsx)(e.td,{children:"\u2705"}),(0,t.jsx)(e.td,{children:"\u2705"}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"AlmaLinux 8.9 x86_64"}),(0,t.jsx)(e.td,{children:"\u2705"}),(0,t.jsx)(e.td,{children:"\u2705"}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"AnolisOS 8.8 x86_64"}),(0,t.jsx)(e.td,{children:"\u2705"}),(0,t.jsx)(e.td,{children:"\u2705"}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{})]})]})]}),"\n",(0,t.jsx)(e.admonition,{title:"\u6ce8\u610f\u4e8b\u9879\uff1a",type:"tip",children:(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u64cd\u4f5c\u7cfb\u7edf\u9700\u8981\u662f\u5e72\u51c0\u7684\u7248\u672c\uff0c\u56e0\u4e3a\u90e8\u7f72\u5de5\u5177\u4f1a\u91cd\u5934\u642d\u5efa\u6307\u5b9a\u7248\u672c\u7684 kubernetes \u96c6\u7fa4\uff0c\u6240\u4ee5\u786e\u4fdd\u7cfb\u7edf\u6ca1\u6709\u5b89\u88c5 kubernetes, docker \u7b49\u5bb9\u5668\u7ba1\u7406\u5de5\u5177\uff0c\u5426\u5219\u4f1a\u51fa\u73b0\u51b2\u7a81\u5bfc\u81f4\u5b89\u88c5\u5f02\u5e38\u3002"}),"\n",(0,t.jsx)(e.li,{children:"\u6700\u4f4e\u914d\u7f6e\u8981\u6c42: CPU 4\u6838, \u5185\u5b58 8GiB, \u5b58\u50a8 100GiB\u3002"}),"\n",(0,t.jsxs)(e.li,{children:["\u865a\u62df\u673a\u548c\u670d\u52a1\u4f7f\u7528\u7684\u5b58\u50a8\u8def\u5f84\u90fd\u5728 ",(0,t.jsx)(e.strong,{children:"/opt"})," \u76ee\u5f55\u4e0b\uff0c\u6240\u4ee5\u7406\u60f3\u73af\u5883\u4e0b\u5efa\u8bae\u5355\u72ec\u7ed9 ",(0,t.jsx)(e.strong,{children:"/opt"})," \u76ee\u5f55\u8bbe\u7f6e\u6302\u8f7d\u70b9\u3002","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u6bd4\u5982\u628a /dev/sdb1 \u5355\u72ec\u5206\u533a\u505a ext4 \u7136\u540e\u901a\u8fc7 /etc/fstab \u6302\u8f7d\u5230 /opt \u76ee\u5f55\u3002"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.li,{children:"\u5728Debian\u5bb6\u65cf\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e0a\uff08\u4f8b\u5982 Debian \u548c Ubuntu\uff09\u9996\u6b21\u90e8\u7f72 ocboot \u7684\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u68c0\u6d4b\u5e76\u66f4\u65b0 GRUB \u542f\u52a8\u9009\u9879\uff0c\u4ee5\u4fbf k8s \u80fd\u591f\u6b63\u5e38\u8fd0\u884c\uff0c\u56e0\u6b64\u90e8\u7f72\u8fc7\u7a0b\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u91cd\u542f\u3002\u91cd\u542f\u4e4b\u540e\uff0c\u8bf7\u91cd\u65b0\u6267\u884cocboot\u7684\u90e8\u7f72\u5373\u53ef\u3002"}),"\n"]})})]})}function r(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(i,{...n})}):i(n)}},41859:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>x,contentTitle:()=>a,default:()=>u,frontMatter:()=>l,metadata:()=>h,toc:()=>j});var t=s(74848),o=s(28453),d=s(15114),i=s(41571),r=s(88229),c=s(928);const l={sidebar_position:2,edition:"ce"},a="\u9ad8\u53ef\u7528\u5b89\u88c5",h={id:"getting-started/onpremise/ha-ce",title:"\u9ad8\u53ef\u7528\u5b89\u88c5",description:"\u4f7f\u7528 ocboot \u90e8\u7f72\u5de5\u5177\u9ad8\u53ef\u7528\u5b89\u88c5 Cloudpods \u670d\u52a1\uff0c\u66f4\u7b26\u5408\u751f\u4ea7\u73af\u5883\u7684\u90e8\u7f72\u9700\u6c42\u3002",source:"@site/docs/getting-started/onpremise/ha-ce.md",sourceDirName:"getting-started/onpremise",slug:"/getting-started/onpremise/ha-ce",permalink:"/v3.10/docs/getting-started/onpremise/ha-ce",draft:!1,unlisted:!1,editUrl:"https://github.com/yunionio/website/tree/master/docs/getting-started/onpremise/ha-ce.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,edition:"ce"},sidebar:"tutorialSidebar",previous:{title:"Ocboot \u5feb\u901f\u5b89\u88c5",permalink:"/v3.10/docs/getting-started/onpremise/quickstart-virt"},next:{title:"\u6dfb\u52a0\u8ba1\u7b97\u8282\u70b9",permalink:"/v3.10/docs/getting-started/onpremise/host"}},x={},j=[{value:"\u73af\u5883\u51c6\u5907",id:"\u73af\u5883\u51c6\u5907",level:2},...d.RM,{value:"\u5f00\u59cb\u5b89\u88c5",id:"\u5f00\u59cb\u5b89\u88c5",level:2},{value:"\u4e0b\u8f7d ocboot",id:"\u4e0b\u8f7d-ocboot",level:3},{value:"\u7f16\u5199\u90e8\u7f72\u914d\u7f6e",id:"\u7f16\u5199\u90e8\u7f72\u914d\u7f6e",level:3},{value:"\u5f00\u59cb\u90e8\u7f72",id:"\u5f00\u59cb\u90e8\u7f72",level:3},{value:"\u5e38\u89c1\u95ee\u9898",id:"\u5e38\u89c1\u95ee\u9898",level:2},{value:"1. \u5982\u4f55\u624b\u52a8\u91cd\u65b0\u6dfb\u52a0\u63a7\u5236\u63a7\u5236\u8282\u70b9\uff1f",id:"1-\u5982\u4f55\u624b\u52a8\u91cd\u65b0\u6dfb\u52a0\u63a7\u5236\u63a7\u5236\u8282\u70b9",level:3},...c.RM];function p(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,o.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.h1,{id:"\u9ad8\u53ef\u7528\u5b89\u88c5",children:"\u9ad8\u53ef\u7528\u5b89\u88c5"}),"\n",(0,t.jsxs)(e.p,{children:["\u4f7f\u7528 ",(0,t.jsx)(e.a,{href:"https://github.com/yunionio/ocboot",children:"ocboot"})," \u90e8\u7f72\u5de5\u5177\u9ad8\u53ef\u7528\u5b89\u88c5 Cloudpods \u670d\u52a1\uff0c\u66f4\u7b26\u5408\u751f\u4ea7\u73af\u5883\u7684\u90e8\u7f72\u9700\u6c42\u3002"]}),"\n",(0,t.jsx)(e.h2,{id:"\u73af\u5883\u51c6\u5907",children:"\u73af\u5883\u51c6\u5907"}),"\n","\n",(0,t.jsx)(d.Ay,{}),"\n",(0,t.jsx)(e.h2,{id:"\u5f00\u59cb\u5b89\u88c5",children:"\u5f00\u59cb\u5b89\u88c5"}),"\n",(0,t.jsx)(e.h3,{id:"\u4e0b\u8f7d-ocboot",children:"\u4e0b\u8f7d ocboot"}),"\n","\n",(0,t.jsx)(i.A,{}),"\n",(0,t.jsx)(e.h3,{id:"\u7f16\u5199\u90e8\u7f72\u914d\u7f6e",children:"\u7f16\u5199\u90e8\u7f72\u914d\u7f6e"}),"\n","\n",(0,t.jsx)(r.A,{productVersion:"Edge"}),"\n",(0,t.jsx)(e.h3,{id:"\u5f00\u59cb\u90e8\u7f72",children:"\u5f00\u59cb\u90e8\u7f72"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"$ ./ocboot.py install ./config-k8s-ha.yml\n"})}),"\n",(0,t.jsxs)(e.p,{children:["\u7b49\u5f85\u90e8\u7f72\u5b8c\u6210\u540e\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u6d4f\u89c8\u5668\u8bbf\u95ee ",(0,t.jsx)(e.a,{href:"https://10.127.190.10",children:"https://10.127.190.10"})," (VIP), \u8f93\u5165\u7528\u6237\u540d ",(0,t.jsx)(e.code,{children:"admin"})," \u548c\u5bc6\u7801 ",(0,t.jsx)(e.code,{children:"admin@123"}),"\uff0c\u8fdb\u5165\u524d\u7aef\u3002"]}),"\n",(0,t.jsxs)(e.p,{children:["\u53e6\u5916\u90e8\u7f72\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u7ed9\u5df2\u6709\u96c6\u7fa4\u6dfb\u52a0\u8282\u70b9\uff0c\u53c2\u8003\u6587\u6863\uff1a",(0,t.jsx)(e.a,{href:"./host",children:"\u6dfb\u52a0\u8ba1\u7b97\u8282\u70b9"}),"\uff0c\u6ce8\u610f\u8fd9\u91cc\u6dfb\u52a0\u8282\u70b9\u7684\u63a7\u5236\u8282\u70b9 ip \u4e0d\u8981\u7528 vip \uff0c\u53ea\u80fd\u7528\u7b2c1\u4e2a\u63a7\u5236\u8282\u70b9\u7684\u5b9e\u9645 ip \uff0c\u56e0\u4e3a vip \u6709\u53ef\u80fd\u6f02\u79fb\u5230\u5176\u4ed6\u8282\u70b9\u4e0a\uff0c\u4f46\u901a\u5e38\u53ea\u6709\u7b2c1\u4e2a\u8282\u70b9\u914d\u7f6e\u4e86 ssh \u514d\u5bc6\u767b\u9646\u767b\u9646\u5176\u4ed6\u8282\u70b9\u7684\u6743\u9650\uff0c\u7528\u5176\u4ed6\u63a7\u5236\u8282\u70b9\u4f1a\u5bfc\u81f4 ssh \u767b\u9646\u4e0d\u4e0a\u3002"]}),"\n",(0,t.jsx)(e.h2,{id:"\u5e38\u89c1\u95ee\u9898",children:"\u5e38\u89c1\u95ee\u9898"}),"\n",(0,t.jsx)(e.h3,{id:"1-\u5982\u4f55\u624b\u52a8\u91cd\u65b0\u6dfb\u52a0\u63a7\u5236\u63a7\u5236\u8282\u70b9",children:"1. \u5982\u4f55\u624b\u52a8\u91cd\u65b0\u6dfb\u52a0\u63a7\u5236\u63a7\u5236\u8282\u70b9\uff1f"}),"\n","\n",(0,t.jsx)(c.Ay,{})]})}function u(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(p,{...n})}):p(n)}},41571:(n,e,s)=>{s.d(e,{A:()=>r});var t=s(14902),o=s(21312),d=s(28541),i=s(74848);function r(){const n=(0,o.T)({id:"OcbootClone.downloadComment",message:"# \u4e0b\u8f7d ocboot \u5de5\u5177\u5230\u672c\u5730",description:"locally download comment"}),e=(0,d.c)("release_branch");return(0,i.jsx)("div",{children:(0,i.jsx)(t.A,{language:"bash",children:n+`\n$ git clone -b ${e} https://github.com/yunionio/ocboot && cd ./ocboot`})})}},88229:(n,e,s)=>{s.d(e,{A:()=>r});var t=s(14902),o=s(44586),d=s(21312),i=s(74848);function r(n){n.productVersion;const e=function(n){const{siteConfig:e}=(0,o.A)();let s=()=>"CMP"===n?"false":"true";const t=(0,d.T)({id:"ocbootConfigHA.primaryMasterNodeComment",message:"primary_master_node \u8868\u793a\u8fd0\u884c k8s \u548c Cloudpods \u670d\u52a1\u7684\u8282\u70b9"}),i=(0,d.T)({id:"ocbootConfigHA.asHost",message:"\u8be5\u8282\u70b9\u4f5c\u4e3a Cloudpods \u79c1\u6709\u4e91\u8ba1\u7b97\u8282\u70b9\uff0c\u5982\u679c\u4e0d\u60f3\u8ba9\u63a7\u5236\u8282\u70b9\u4f5c\u4e3a\u8ba1\u7b97\u8282\u70b9\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u4e3a false"}),r=(0,d.T)({id:"ocbootConfigHA.asHostOnVM",message:"\u865a\u62df\u673a\u53ef\u4f5c\u4e3a Cloudpods \u5185\u7f6e\u79c1\u6709\u4e91\u8ba1\u7b97\u8282\u70b9\uff08\u9ed8\u8ba4\u4e3a false\uff09\u3002\u5f00\u542f\u6b64\u9879\u65f6\uff0c\u8bf7\u786e\u4fdd as_host: true"}),c=(0,d.T)({id:"ocbootConfigHA.productVersion",message:"\u4ea7\u54c1\u7248\u672c\uff0c\u4ece [Edge, CMP, FullStack] \u9009\u62e9\u4e00\u4e2a\uff0cFullStack \u4f1a\u5b89\u88c5\u878d\u5408\u4e91\uff0cCMP \u5b89\u88c5\u591a\u4e91\u7ba1\u7406\u7248\u672c\uff0cEdge \u5b89\u88c5\u79c1\u6709\u4e91"}),l=(0,d.T)({id:"ocbootConfigHA.imageRepository",message:"\u670d\u52a1\u5bf9\u5e94\u7684\u955c\u50cf\u4ed3\u5e93\uff0c\u5982\u679c\u5f85\u90e8\u7f72\u7684\u673a\u5668\u4e0d\u5728\u4e2d\u56fd\u5927\u9646\uff0c\u53ef\u4ee5\u7528 dockerhub \u7684\u955c\u50cf\u4ed3\u5e93\uff1adocker.io/yunion"}),a=(0,d.T)({id:"ocbootConfigHA.enableHA",message:"\u542f\u7528\u9ad8\u53ef\u7528\u6a21\u5f0f"}),h=(0,d.T)({id:"ocbootConfigHA.hostNetwork",message:"\u8ba1\u7b97\u8282\u70b9\u9ed8\u8ba4\u7f51\u6865 br0 \u5bf9\u5e94\u7684\u7f51\u5361"});return`# ${t}\nprimary_master_node:\n  # ssh login IP\n  hostname: $PRIMARY_IP\n  # ${(0,d.T)({message:"\u4e0d\u4f7f\u7528\u672c\u5730\u767b\u5f55\u65b9\u5f0f"})}\n  use_local: false\n  # ssh login user\n  user: root\n  # cloudpods version\n  onecloud_version: "${e.customFields.release_version}"\n  # mariadb connection address\n  db_host: "$DB_IP"\n  # mariadb user\n  db_user: "$DB_USER"\n  # mariadb password\n  db_password: "$DB_PSWD"\n  # mariadb port\n  db_port: "$DB_PORT"\n  # ${(0,d.T)({message:"\u8282\u70b9\u670d\u52a1\u76d1\u542c\u7684\u5730\u5740\uff0c\u591a\u7f51\u5361\u65f6\u53ef\u4ee5\u6307\u5b9a\u5bf9\u5e94\u7f51\u5361\u7684\u5730\u5740"})}\n  node_ip: "$PRIMARY_IP"\n  # ${(0,d.T)({message:"\u5bf9\u5e94 Kubernetes calico \u63d2\u4ef6\u9ed8\u8ba4\u7f51\u5361\u9009\u62e9\u89c4\u5219"})}\n  ip_autodetection_method: "can-reach=$PRIMARY_IP"\n  # ${(0,d.T)({id:"ocbootConfigHA.controlPlaneHostHint",message:"K8s \u63a7\u5236\u8282\u70b9\u7684 IP\uff0c\u5bf9\u5e94keepalived \u76d1\u542c\u7684 VIP"})}\n  controlplane_host: $K8S_VIP\n  # ${(0,d.T)({id:"ocbootConfigHA.controlPlanePortHint",message:"K8s \u63a7\u5236\u8282\u70b9 apiserver \u76d1\u542c\u7684\u7aef\u53e3"})}\n  controlplane_port: "6443"\n  # ${i}\n  as_host: ${s()}\n  # ${r}\n  as_host_on_vm: ${s()}\n  # ${c}\n  product_version: '${n}'\n  # ${l}\n  image_repository: registry.cn-beijing.aliyuncs.com/yunion\n  # ${a}\n  high_availability: true\n  # ${(0,d.T)({id:"ocbootConfigHA.enableMinio",message:"\u4f7f\u7528 minio \u4f5c\u4e3a\u540e\u7aef\u865a\u62df\u673a\u955c\u50cf\u5b58\u50a8"})}\n  enable_minio: true\n  ha_using_local_registry: false\n  # ${h}\n  host_networks: "$PRIMARY_INTERFACE/br0/$PRIMARY_IP"\n\nmaster_nodes:\n  # ${(0,d.T)({id:"ocbootConfigHA.joinControlNodeVIP",message:"\u52a0\u5165\u63a7\u5236\u8282\u70b9\u7684 k8s vip"})}\n  controlplane_host: $K8S_VIP\n  # ${(0,d.T)({id:"ocbootConfigHA.joinControlNodePort",message:"\u52a0\u5165\u63a7\u5236\u8282\u70b9\u7684 K8s apiserver \u7aef\u53e3"})}\n  controlplane_port: "6443"\n  # ${(0,d.T)({id:"ocbootConfigHA.asController",message:"\u4f5c\u4e3a K8s \u548c Cloudpods \u63a7\u5236\u8282\u70b9"})}\n  as_controller: true\n  # ${i}\n  as_host: ${s()}\n  # ${r}\n  as_host_on_vm: ${s()}\n  # ${(0,d.T)({id:"ocbootConfigHA.syncNtpFromPrimaryNode",message:"\u4ece primary \u8282\u70b9\u540c\u6b65 ntp \u65f6\u95f4"})}\n  ntpd_server: "$PRIMARY_IP"\n  # ${a}\n  high_availability: true\n  hosts:\n  - user: root\n    hostname: "$MASTER_1_IP"\n    # ${h}\n    host_networks: "$MASTER_1_INTERFACE/br0/$MASTER_1_IP"\n  - user: root\n    hostname: "$MASTER_2_IP"\n    # ${h}\n    host_networks: "$MASTER_2_INTERFACE/br0/$MASTER_2_IP"`}(n.productVersion);return(0,i.jsx)("div",{children:(0,i.jsx)(t.A,{language:"bash",children:`# ${(0,d.T)({id:"ocbootConfigHA.initShellVars",message:"\u8bbe\u7f6e shell \u73af\u5883\u53d8\u91cf"})}\nDB_IP="10.127.190.11"\nDB_PORT=3306\nDB_PSWD="0neC1oudDB#"\nDB_USER=root\n\nK8S_VIP=10.127.190.10\nPRIMARY_INTERFACE="eth0"\nPRIMARY_IP=10.127.90.101\n\nMASTER_1_INTERFACE="eth0"\nMASTER_1_IP=10.127.90.102\nMASTER_2_INTERFACE="eth0"\nMASTER_2_IP=10.127.90.103\n\n# ${(0,d.T)({id:"ocbootConfigHA.generateConfigYAML",message:"\u751f\u6210 yaml \u90e8\u7f72\u914d\u7f6e\u6587\u4ef6"})}\ncat > config-k8s-ha.yml <<EOF\n${e}\nEOF`})})}},28541:(n,e,s)=>{s.d(e,{c:()=>o});var t=s(44586);function o(n){const{siteConfig:e}=(0,t.A)();return e.customFields[n]}},67332:(n,e,s)=>{s.d(e,{A:()=>d});s(96540);var t=s(52830),o=s(74848);function d(n){const e={...n};return e?.code?.length>2&&(e.code=e.code.split("\n").map((n=>n.length>2&&"$ "===n.substring(0,2)?n.substring(2):n)).join("\n")),(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(t.A,{...e})})}}}]);
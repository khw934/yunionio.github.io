"use strict";(self.webpackChunkdocs_new=self.webpackChunkdocs_new||[]).push([[4612],{12722:(e,o,t)=>{t.r(o),t.d(o,{assets:()=>d,contentTitle:()=>r,default:()=>u,frontMatter:()=>s,metadata:()=>l,toc:()=>c});var i=t(85893),n=t(11151);const s={sidebar_position:18},r="host-image \u670d\u52a1\u7f16\u8bd1",l={id:"development/host_image",title:"host-image \u670d\u52a1\u7f16\u8bd1",description:"host-image \u670d\u52a1\u662f cloudpods \u8fdc\u7a0b\u6302\u8f7d\u78c1\u76d8\u7684\u7ec4\u4ef6\uff0c\u4f9d\u8d56\u57fa\u4e8e qemu \u7f16\u8bd1\u7684 libqemuio \u5e93\uff0c\u672c\u6587\u4ecb\u7ecd\u5982\u4f55\u7f16\u8bd1 host-image\u3002",source:"@site/docs/development/host_image.md",sourceDirName:"development",slug:"/development/host_image",permalink:"/v3.10/docs/development/host_image",draft:!1,unlisted:!1,editUrl:"https://github.com/yunionio/website/tree/master/docs/development/host_image.md",tags:[],version:"current",sidebarPosition:18,frontMatter:{sidebar_position:18},sidebar:"tutorialSidebar",previous:{title:"Webhook",permalink:"/v3.10/docs/development/webhook"},next:{title:"\u76d1\u63a7",permalink:"/v3.10/docs/development/monitor/"}},d={},c=[];function a(e){const o={code:"code",h1:"h1",p:"p",pre:"pre",...(0,n.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.h1,{id:"host-image-\u670d\u52a1\u7f16\u8bd1",children:"host-image \u670d\u52a1\u7f16\u8bd1"}),"\n",(0,i.jsx)(o.p,{children:"host-image \u670d\u52a1\u662f cloudpods \u8fdc\u7a0b\u6302\u8f7d\u78c1\u76d8\u7684\u7ec4\u4ef6\uff0c\u4f9d\u8d56\u57fa\u4e8e qemu \u7f16\u8bd1\u7684 libqemuio \u5e93\uff0c\u672c\u6587\u4ecb\u7ecd\u5982\u4f55\u7f16\u8bd1 host-image\u3002"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-sh",children:"$ git clone -b stable-2.12 https://gitlab.com/qemu-project/qemu.git\n$ wget https://raw.githubusercontent.com/yunionio/qemu/stable-2.12/0001-libqemuio-support-libqemuio-on-release-2.12.patch\n$ cd qemu && mkdir src && mv ./* src/\n$ git apply ../0001-libqemuio-support-libqemuio-on-release-2.12.patch\n\n# \u8fd9\u91cc /root/go/src/yunion.io/x/cloudpods \u4e3a\u672c\u5730 cloudpods \u8def\u5f84\uff0c\u9700\u66ff\u6362\u6210\u672c\u5730\u76f8\u5e94\u7684 cloudpods \u8def\u5f84\n$ docker run --network host -v $(pwd):/root/qemu -v /root/go/src/yunion.io/x/cloudpods:/go/src/yunion.io/x/cloudpods -it golang:1.18.10-buster\n\n# \u5bb9\u5668\u5185\uff1a\n$ sed -i 's|http://deb.debian.org|http://mirrors.aliyun.com|g' /etc/apt/sources.list\n$ apt-get update\n$ apt-get install -y gcc make git vim python pkg-config flex bison libpixman-1-dev libudev-dev libaio-dev libcurl4-openssl-dev zlib1g-dev libglib2.0-dev libusb-1.0-0-dev libusbredirparser-dev libusbredirhost-dev libcapstone-dev libcephfs-dev librbd-dev librados-dev libspice-server-dev libspice-protocol-dev\n$ cd /root/qemu/src\n$ ./configure --target-list=$(uname -m)-softmmu --enable-libusb --extra-ldflags=-lrt --enable-spice --enable-rbd\n# \u7f16\u8bd1 libqemuio.a\n$ make libqemuio.a\n\n$ apt install -y file gnutls-bin libgnutls30 libgnutls28-dev\n$ cd /go/src/yunion.io/x/cloudpods\n# \u7f16\u8bd1 host-image\n$ git config --global --add safe.directory /go/src/yunion.io/x/cloudpods\n$ LIBQEMUIO_PATH=/root/qemu make cmd/host-image\n$ ./scripts/bundle_libraries.sh _output/bin/bundles/host-image _output/bin/host-image\n"})}),"\n",(0,i.jsx)(o.p,{children:"host-image \u7f16\u8bd1\u5b8c\u6210\u540e\u5236\u4f5c docker \u955c\u50cf\uff1a"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-sh",children:"$ cd /root/go/src/yunion.io/x/cloudpods\n$ docker build -t test-host-image:v1 -f ./build/docker/Dockerfile.host-image . \n"})})]})}function u(e={}){const{wrapper:o}={...(0,n.a)(),...e.components};return o?(0,i.jsx)(o,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},11151:(e,o,t)=>{t.d(o,{Z:()=>l,a:()=>r});var i=t(67294);const n={},s=i.createContext(n);function r(e){const o=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function l(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),i.createElement(s.Provider,{value:o},e.children)}}}]);
"use strict";(self.webpackChunkdocs_new=self.webpackChunkdocs_new||[]).push([[1804],{47982:(n,e,o)=>{o.r(e),o.d(e,{assets:()=>r,contentTitle:()=>a,default:()=>p,frontMatter:()=>d,metadata:()=>c,toc:()=>s});var t=o(74848),i=o(28453),l=o(41571);const d={edition:"ce",sidebar_position:3},a="\u63a7\u5236\u8282\u70b9\u66ff\u6362\u6d41\u7a0b",c={id:"operations/ha/replace",title:"\u63a7\u5236\u8282\u70b9\u66ff\u6362\u6d41\u7a0b",description:"\u80cc\u666f",source:"@site/docs/operations/ha/replace.md",sourceDirName:"operations/ha",slug:"/operations/ha/replace",permalink:"/docs/operations/ha/replace",draft:!1,unlisted:!1,editUrl:"https://github.com/yunionio/website/tree/master/docs/operations/ha/replace.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{edition:"ce",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"\u7cfb\u7edf\u81ea\u52a8\u5907\u4efd",permalink:"/docs/operations/ha/auto-backup"},next:{title:"\u524d\u7aef\u7ec4\u4ef6\u8fd0\u7ef4",permalink:"/docs/operations/fe/"}},r={},s=[{value:"\u80cc\u666f",id:"\u80cc\u666f",level:2},{value:"\u6d4b\u8bd5\u73af\u5883",id:"\u6d4b\u8bd5\u73af\u5883",level:2},{value:"\u6d4b\u8bd5",id:"\u6d4b\u8bd5",level:2},{value:"\u76ee\u6807",id:"\u76ee\u6807",level:3},{value:"\u6b65\u9aa4",id:"\u6b65\u9aa4",level:3},{value:"1. \u9700\u8981\u786e\u8ba4\u6709\u54ea\u4e9b\u6709\u72b6\u6001\u7684 pod \u548c pvc \u8fd0\u884c\u5728\u8be5\u8282\u70b9",id:"1-\u9700\u8981\u786e\u8ba4\u6709\u54ea\u4e9b\u6709\u72b6\u6001\u7684-pod-\u548c-pvc-\u8fd0\u884c\u5728\u8be5\u8282\u70b9",level:4},{value:"2. \u63a5\u4e0b\u6765\u5c06 primary_master_node \u5173\u673a\u8e22\u51fa\u96c6\u7fa4",id:"2-\u63a5\u4e0b\u6765\u5c06-primary_master_node-\u5173\u673a\u8e22\u51fa\u96c6\u7fa4",level:4},{value:"3. \u5220\u9664\u65e7\u7684 primary_master_node \u7684 etcd endpoint",id:"3-\u5220\u9664\u65e7\u7684-primary_master_node-\u7684-etcd-endpoint",level:4},{value:"4. \u66ff\u6362\u65e7\u7684 primary_master_node \u8282\u70b9\uff0c\u52a0\u5165\u65b0\u7684 master_node",id:"4-\u66ff\u6362\u65e7\u7684-primary_master_node-\u8282\u70b9\u52a0\u5165\u65b0\u7684-master_node",level:4},{value:"5. \u6062\u590d\u6709\u72b6\u6001\u7684 pod",id:"5-\u6062\u590d\u6709\u72b6\u6001\u7684-pod",level:4}];function m(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.h1,{id:"\u63a7\u5236\u8282\u70b9\u66ff\u6362\u6d41\u7a0b",children:"\u63a7\u5236\u8282\u70b9\u66ff\u6362\u6d41\u7a0b"}),"\n",(0,t.jsx)(e.h2,{id:"\u80cc\u666f",children:"\u80cc\u666f"}),"\n",(0,t.jsx)(e.p,{children:"\u5373\u4f7f\u662f\u9ad8\u53ef\u7528\u90e8\u7f72\u7684 3 \u8282\u70b9 cloudpods over k8s \u96c6\u7fa4\uff0c\u5728\u751f\u4ea7\u73af\u5883\u53ef\u80fd\u4f1a\u51fa\u73b0\u4efb\u610f 1 \u4e2a\u8282\u70b9\u6302\u6389\u7684\u60c5\u51b5\u3002\n\u4e00\u4e9b\u666e\u901a\u7684\u6545\u969c\uff0c\u6bd4\u5982\u66f4\u6362\u5185\u5b58\uff0cCPU \u4e4b\u7c7b\u53ef\u4ee5\u89e3\u51b3\u7684\u95ee\u9898\uff0c\u53ef\u4ee5\u4e34\u65f6\u5173\u673a\uff0c\u6062\u590d\u540e\u518d\u91cd\u542f\u8282\u70b9\u89e3\u51b3\u3002"}),"\n",(0,t.jsx)(e.p,{children:"\u4f46\u5982\u679c\u53d1\u751f\u786c\u76d8\u4e4b\u7c7b\u7684\u6545\u969c\uff0c\u6bd4\u5982\u6570\u636e\u65e0\u6cd5\u6062\u590d\u7684\u60c5\u51b5\uff0c\u9700\u8981\u628a\u8be5\u8282\u70b9\u5220\u9664\u518d\u91cd\u65b0\u52a0\u5165\u65b0\u7684\u8282\u70b9\uff0c\u63a5\u4e0b\u6765\u63cf\u8ff0\u8be5\u6b65\u9aa4\u4ee5\u53ca\u6ce8\u610f\u4e8b\u9879\u3002"}),"\n",(0,t.jsx)(e.h2,{id:"\u6d4b\u8bd5\u73af\u5883",children:"\u6d4b\u8bd5\u73af\u5883"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["k8s_vip: 10.127.100.102","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u4f7f\u7528 staticpods keepalived \u8fd0\u884c\u5728 3 \u4e2a master \u8282\u70b9\u4e0a"}),"\n",(0,t.jsx)(e.li,{children:"\u7531 kubelet \u76f4\u63a5\u542f\u52a8\uff0c\u8def\u5f84\uff1a/etc/kubernetes/manifests/keepalived.yaml"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.li,{children:"primary_master_node \u7b2c1\u4e2a\u521d\u59cb\u5316\u7684\u63a7\u5236\u8282\u70b9:\nip: 10.127.100.234"}),"\n",(0,t.jsx)(e.li,{children:"master_node_1 \u7b2c2\u4e2a\u52a0\u5165\u63a7\u5236\u8282\u70b9:\nip: 10.127.100.229"}),"\n",(0,t.jsx)(e.li,{children:"master_node_2 \u7b2c3\u4e2a\u52a0\u5165\u7684\u63a7\u5236\u8282\u70b9:\nip: 10.127.100.226"}),"\n",(0,t.jsx)(e.li,{children:"\u6570\u636e\u5e93: \u6570\u636e\u5e93\u90e8\u7f72\u5728\u96c6\u7fa4\u4e4b\u5916\uff0c\u4e0d\u5728 3 \u4e2a\u8282\u70b9\u4e4b\u4e0a"}),"\n",(0,t.jsxs)(e.li,{children:["CSI: \u4f7f\u7528 local-path","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"local-path \u7684 CSI \u4f1a\u5f3a\u7ed1\u5b9a pod \u5230\u6307\u5b9a\u7684 node\uff0c\u8fd9\u91cc\u9700\u8981\u7279\u522b\u6ce8\u610f"}),"\n",(0,t.jsxs)(e.li,{children:["\u5982\u679c\u6302\u6389\u7684\u8282\u70b9\u6709\u5bf9\u5e94 local-path \u7684 pvc \u7ed1\u5b9a\u5728\u4e0a\u9762\uff0c\u4f7f\u7528\u8be5 pvc \u7684 pod \u5c31\u6ca1\u529e\u6cd5\u6f02\u79fb\u5230\u5176\u5b83 Ready \u7684 node \uff0c\u8fd9\u79cd pod \u53eb\u6709\u72b6\u6001\u7684 pod\uff0c\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4 ",(0,t.jsx)(e.code,{children:"kubectl get pvc -A | grep local-path"})," \u5c31\u53ef\u4ee5\u770b\u5230\u6240\u6709\u7684 local-path pvc"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"$ kubectl get nodes -o wide\nNAME                   STATUS   ROLES    AGE    VERSION    INTERNAL-IP      EXTERNAL-IP   OS-IMAGE                KERNEL-VERSION                          CONTAINER-RUNTIME\nlzx-ocboot-ha-test     Ready    master   100m   v1.15.12   10.127.100.234   <none>        CentOS Linux 7 (Core)   3.10.0-1160.6.1.el7.yn20201125.x86_64   docker://20.10.5\nlzx-ocboot-ha-test-2   Ready    master   61m    v1.15.12   10.127.100.229   <none>        CentOS Linux 7 (Core)   3.10.0-1160.6.1.el7.yn20201125.x86_64   docker://20.10.5\nlzx-ocboot-ha-test-3   Ready    master   60m    v1.15.12   10.127.100.226   <none>        CentOS Linux 7 (Core)   3.10.0-1160.6.1.el7.yn20201125.x86_64   docker://20.10.5\n"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["minio:","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u9ad8\u53ef\u7528\u90e8\u7f72\u4e0b\u4f7f\u7528 minio \u4f5c\u4e3a glance \u7684\u540e\u7aef\u5b58\u50a8"}),"\n",(0,t.jsx)(e.li,{children:"statefulset"}),"\n",(0,t.jsx)(e.li,{children:"\u4f7f\u7528 local-path CSI \u4f5c\u4e3a\u540e\u7aef\u5b58\u50a8"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"$ kubectl get pods -n onecloud-minio -o wide\nkubectl get pods -n onecloud-minio  -o wide\nNAME      READY   STATUS    RESTARTS   AGE   IP              NODE                   NOMINATED NODE   READINESS GATES\nminio-0   1/1     Running   0          46m   10.40.99.205    lzx-ocboot-ha-test     <none>           <none>\nminio-1   1/1     Running   0          46m   10.40.158.215   lzx-ocboot-ha-test-3   <none>           <none>\nminio-2   1/1     Running   0          46m   10.40.159.22    lzx-ocboot-ha-test-2   <none>           <none>\nminio-3   1/1     Running   0          46m   10.40.99.206    lzx-ocboot-ha-test     <none>           <none>\n$ kubectl get pvc -n onecloud-minio\nNAME             STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE\nexport-minio-0   Bound    pvc-297ed5e5-66c8-4855-8031-c65a0ccfa4d0   1Ti        RWO            local-path     46m\nexport-minio-1   Bound    pvc-4e8fe486-5b23-44a0-876c-df36d134957f   1Ti        RWO            local-path     46m\nexport-minio-2   Bound    pvc-389b3c61-6000-4757-9949-db53e4e53776   1Ti        RWO            local-path     46m\nexport-minio-3   Bound    pvc-3dd54509-7745-47dd-84ea-fbacfe1e2f5b   1Ti        RWO            local-path     46m\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\u6d4b\u8bd5",children:"\u6d4b\u8bd5"}),"\n",(0,t.jsx)(e.h3,{id:"\u76ee\u6807",children:"\u76ee\u6807"}),"\n",(0,t.jsx)(e.p,{children:"\u4e0b\u7ebf primary_master_node 10.127.100.234 \u8282\u70b9\uff0c\u52a0\u5165\u65b0\u7684\u8282\u70b9\u66ff\u6362\u8be5\u8282\u70b9"}),"\n",(0,t.jsx)(e.h3,{id:"\u6b65\u9aa4",children:"\u6b65\u9aa4"}),"\n",(0,t.jsx)(e.h4,{id:"1-\u9700\u8981\u786e\u8ba4\u6709\u54ea\u4e9b\u6709\u72b6\u6001\u7684-pod-\u548c-pvc-\u8fd0\u884c\u5728\u8be5\u8282\u70b9",children:"1. \u9700\u8981\u786e\u8ba4\u6709\u54ea\u4e9b\u6709\u72b6\u6001\u7684 pod \u548c pvc \u8fd0\u884c\u5728\u8be5\u8282\u70b9"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# \u6839\u636e IP \u627e\u5230\u8282\u70b9\u5728 k8s \u96c6\u7fa4\u4e2d\u7684\u540d\u79f0\n$ kubectl get nodes -o wide | grep 10.127.100.234\nlzx-ocboot-ha-test     Ready    master   4h15m   v1.15.12   10.127.100.234   <none>        CentOS Linux 7 (Core)   3.10.0-1160.6.1.el7.yn20201125.x86_64   docker://20.10.5\n\n# \u67e5\u770b\u6240\u6709\u4e3a local-path \u7684 pvc\n$ kubectl get pvc -A | grep local-path\n# onecloud-minio namespace \u7684 export-minio-x \u8d1f\u8d23\u5b58\u50a8 glance \u7684\u955c\u50cf\uff0c\u662f\u5173\u952e\u7ec4\u4ef6\nonecloud-minio        export-minio-0            Bound     pvc-297ed5e5-66c8-4855-8031-c65a0ccfa4d0   1Ti        RWO            local-path     3h11m\nonecloud-minio        export-minio-1            Bound     pvc-4e8fe486-5b23-44a0-876c-df36d134957f   1Ti        RWO            local-path     3h11m\nonecloud-minio        export-minio-2            Bound     pvc-389b3c61-6000-4757-9949-db53e4e53776   1Ti        RWO            local-path     3h11m\nonecloud-minio        export-minio-3            Bound     pvc-3dd54509-7745-47dd-84ea-fbacfe1e2f5b   1Ti        RWO            local-path     3h11m\n# onecloud-monitoring namespace \u7684 export-monitor-minio-x \u8d1f\u8d23\u5b58\u50a8\u670d\u52a1\u7684\u65e5\u5fd7\uff0c\u4e0d\u662f\u5173\u952e\u7ec4\u4ef6\nonecloud-monitoring   export-monitor-minio-0    Bound     pvc-b885605f-b5ca-40ff-b968-4d95b03e8bb8   1Ti        RWO            local-path     3h8m\nonecloud-monitoring   export-monitor-minio-1    Bound     pvc-520a8262-5dad-48aa-9a0e-0e25f850faad   1Ti        RWO            local-path     3h8m\nonecloud-monitoring   export-monitor-minio-2    Bound     pvc-6de1ff0f-3465-4a51-8124-880f1b3c6d7a   1Ti        RWO            local-path     3h8m\nonecloud-monitoring   export-monitor-minio-3    Bound     pvc-364652ca-496e-4b29-82ea-ec7e768aa8f5   1Ti        RWO            local-path     3h8m\n# onecloud namespace \u4e0b\u9762\u7684\u8fd9\u4e9b pvc \u90fd\u662f\u7cfb\u7edf\u670d\u52a1\u4f9d\u8d56\u7684\n# default-baremetal-agent \u662f\u5b58\u50a8\u7269\u7406\u673a\u7ba1\u7406\u7684\u5b58\u50a8\uff0c\u4e0d\u5f00\u542f baremetal-agent \u53ef\u4ee5\u4e0d\u7528\u7ba1\uff0c\u9ed8\u8ba4\u4e5f\u662f Pending \u5f85\u7ed1\u5b9a\u72b6\u6001\nonecloud              default-baremetal-agent   Pending                                                                        local-path     3h35m\n# default-esxi-agent \u8d1f\u8d23\u5b58 esxi-agent \u670d\u52a1\u76f8\u5173\u7684\u672c\u5730\u6570\u636e\nonecloud              default-esxi-agent        Bound     pvc-b32adfcc-96e7-45e4-b8bd-b5318c954dca   30G        RWO            local-path     3h35m\n# default-glance \u8d1f\u8d23\u5b58 glance \u670d\u52a1\u7684\u955c\u50cf\uff0c\u5728\u9ad8\u53ef\u7528\u90e8\u7f72\u73af\u5883\u4e0b\uff0cdeployment default-glance \u4e0d\u4f1a\u6302\u8f7d\u8fd9\u4e2a pvc \uff0c\u4f1a\u4f7f\u7528 onecloud-minio \u91cc\u9762\u7684 minio s3 \u5b58\u50a8\u955c\u50cf\uff0c\u53ef\u4ee5\u4e0d\u7528\u7ba1\nonecloud              default-glance            Bound     pvc-e6ee398e-2d84-46cf-9401-e94f438d87cd   100G       RWO            local-path     3h36m\n# default-influxdb \u8d1f\u8d23\u5b58\u5e73\u53f0\u7684\u76d1\u63a7\u6570\u636e\uff0c\u76d1\u63a7\u6570\u636e\u53ef\u4ee5\u5bb9\u5fcd\u4e22\u5931\uff0c\u5982\u679c\u6240\u5728\u8282\u70b9\u6302\u4e86\uff0c\u53ef\u4ee5\u5220\u6389\u91cd\u5efa\nonecloud              default-influxdb          Bound     pvc-871b9441-c56f-4bb4-8b56-868e1df1a438   20G        RWO            local-path     3h35m\n\n\n# \u67e5\u770b\u8be5\u8282\u70b9\u4e0a\u6709\u54ea\u4e9b pod\n$ kubectl get pods -A -o wide | grep onecloud | grep 'lzx-ocboot-ha-test '\nonecloud-minio        minio-0                                              1/1     Running   0          3h10m   10.40.99.205     lzx-ocboot-ha-test     <none>           <none>\nonecloud-minio        minio-3                                              1/1     Running   0          3h10m   10.40.99.206     lzx-ocboot-ha-test     <none>           <none>\nonecloud-monitoring   monitor-kube-state-metrics-6c97499758-w69tz          1/1     Running   0          3h6m    10.40.99.214     lzx-ocboot-ha-test     <none>           <none>\nonecloud-monitoring   monitor-loki-0                                       1/1     Running   0          3h6m    10.40.99.213     lzx-ocboot-ha-test     <none>           <none>\nonecloud-monitoring   monitor-minio-0                                      1/1     Running   0          3h7m    10.40.99.211     lzx-ocboot-ha-test     <none>           <none>\nonecloud-monitoring   monitor-minio-3                                      1/1     Running   0          3h7m    10.40.99.212     lzx-ocboot-ha-test     <none>           <none>\nonecloud-monitoring   monitor-monitor-stack-operator-54d8c46577-qknws      1/1     Running   0          3h6m    10.40.99.216     lzx-ocboot-ha-test     <none>           <none>\nonecloud-monitoring   monitor-promtail-4mx2s                               1/1     Running   0          3h6m    10.40.99.215     lzx-ocboot-ha-test     <none>           <none>\nonecloud              default-etcd-7brtldv78z                              1/1     Running   0          3h10m   10.40.99.207     lzx-ocboot-ha-test     <none>           <none>\nonecloud              default-glance-6fd697b7b9-nbk9t                      1/1     Running   0          3h7m    10.40.99.208     lzx-ocboot-ha-test     <none>           <none>\nonecloud              default-host-5rmg8                                   3/3     Running   7          3h34m   10.127.100.234   lzx-ocboot-ha-test     <none>           <none>\nonecloud              default-host-deployer-sf494                          1/1     Running   7          3h34m   10.40.99.202     lzx-ocboot-ha-test     <none>           <none>\nonecloud              default-host-image-s6pwq                             1/1     Running   2          3h34m   10.127.100.234   lzx-ocboot-ha-test     <none>           <none>\nonecloud              default-region-dns-2hcpv                             1/1     Running   1          3h34m   10.127.100.234   lzx-ocboot-ha-test     <none>           <none>\nonecloud              default-telegraf-5jn4x                               2/2     Running   0          3h34m   10.127.100.234   lzx-ocboot-ha-test     <none>           <none>\nonecloud              default-influxdb-6bqgq                               1/1     Running   0          3h34m   10.127.99.218    lzx-ocboot-ha-test     <none>           <none>\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u901a\u8fc7\u4e0a\u9762\u547d\u4ee4\u7684\u7ed3\u679c\uff0c\u53ef\u4ee5\u7b5b\u9009\u51fa onecloud-minio/minio-0 onecloud-minio/minio-3\uff0conecloud/default-influxdb\uff0conecloud-monitoring/monitor-minio-0,onecloud-minio/monitor-minio-3 \u8fd9\u4e9b\u6709\u72b6\u6001\u7684 pod \u5728 primary_master_node \u4e0a\u3002"}),"\n",(0,t.jsx)(e.h4,{id:"2-\u63a5\u4e0b\u6765\u5c06-primary_master_node-\u5173\u673a\u8e22\u51fa\u96c6\u7fa4",children:"2. \u63a5\u4e0b\u6765\u5c06 primary_master_node \u5173\u673a\u8e22\u51fa\u96c6\u7fa4"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:'# \u767b\u5f55\u5176\u5b83\u4e24\u4e2a master_node \u8282\u70b9\uff0c\u6bd4\u5982\uff1a10.127.100.229\n$ ssh root@10.127.100.229\n\n# \u8bbe\u7f6e KUBECONFIG \u914d\u7f6e\n[root@lzx-ocboot-ha-test-2 ~]$ export KUBECONFIG=/etc/kubernetes/admin.conf\n\n# \u67e5\u770b\u8282\u70b9\u72b6\u6001\uff0c\u53d1\u73b0 primary_master_node \u5df2\u7ecf\u53d8\u6210 NotReady\n[root@lzx-ocboot-ha-test-2 ~]$ kubectl get nodes\nNAME                   STATUS     ROLES    AGE     VERSION\nlzx-ocboot-ha-test     NotReady   master   4h37m   v1.15.12\nlzx-ocboot-ha-test-2   Ready      master   3h58m   v1.15.12\nlzx-ocboot-ha-test-3   Ready      master   3h57m   v1.15.12\n\n# \u5220\u9664 primary_master_node \u8282\u70b9\uff1alzx-ocboot-ha-test\n[root@lzx-ocboot-ha-test-2 ~]$ kubectl drain --delete-local-data --ignore-daemonsets lzx-ocboot-ha-test\nWARNING: ignoring DaemonSet-managed Pods: kube-system/calico-node-fdzql, kube-system/kube-proxy-nfxvd, kube-system/traefik-ingress-controller-jms9v, onecloud-monitoring/monitor-promtail-4mx2s, onecloud/default-host-5rmg8, onecloud/default-host-deployer-sf494, onecloud/default-host-image-s6pwq, onecloud/default-region-dns-2hcpv, onecloud/default-telegraf-5jn4x\nevicting pod "minio-0"\nevicting pod "monitor-minio-3"\nevicting pod "default-etcd-7brtldv78z"\nevicting pod "monitor-kube-state-metrics-6c97499758-w69tz"\nevicting pod "default-influxdb-85945647d5-6bqgq"\nevicting pod "default-glance-6fd697b7b9-nbk9t"\nevicting pod "minio-3"\nevicting pod "monitor-monitor-stack-operator-54d8c46577-qknws"\nevicting pod "monitor-loki-0"\nevicting pod "monitor-minio-0"\n# \u8be5\u547d\u4ee4\u4f1a\u5361\u505c\u4f4f\uff0c\u56e0\u4e3a primary_master_node \u5df2\u7ecf\u5173\u673a\u4e86\uff0c\u65e0\u6cd5\u5220\u9664 pod \uff0c\u8fd9\u4e2a\u65f6\u5019 \'Ctrl-c\' \u53d6\u6d88\u547d\u4ee4\n^C\n\n# \u4f7f\u7528 kubectl delete node \u76f4\u63a5\u5220\u9664 primary_master_node \u8282\u70b9\n$ kubectl delete node lzx-ocboot-ha-test\n\n# \u7136\u540e\u518d\u67e5\u770b\u5904\u4e8e Pending \u72b6\u6001\u7684 pod \u5168\u90e8\u90fd\u662f\u4e4b\u524d primary_master_node \u4e0a\u9762\u6709\u72b6\u6001\u7684 pod\n# \u56e0\u4e3a\u8fd9\u4e9b pod \u4f7f\u7528\u4e86 local-path \u7684 pvc \uff0c\u8fd9\u4e9b pvc \u662f\u548c\u8282\u70b9\u5f3a\u7ed1\u5b9a\u7684\uff0c\u8fd8\u5b58\u5728\u96c6\u7fa4\u4e2d\n[root@lzx-ocboot-ha-test-2 ~]$ kubectl get pods -A | grep Pending\nonecloud-minio        minio-0                                              0/1     Pending            0          61s\nonecloud-minio        minio-3                                              0/1     Pending            0          61s\nonecloud-monitoring   monitor-minio-0                                      0/1     Pending            0          61s\nonecloud-monitoring   monitor-minio-3                                      0/1     Pending            0          61s\nonecloud              default-influxdb-85945647d5-x5sv5                    0/1     Pending            0          10m\n'})}),"\n",(0,t.jsx)(e.h4,{id:"3-\u5220\u9664\u65e7\u7684-primary_master_node-\u7684-etcd-endpoint",children:"3. \u5220\u9664\u65e7\u7684 primary_master_node \u7684 etcd endpoint"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# \u67e5\u770b kube-system \u7cfb\u7edf\u4e0b\u7684 etcd pod\n[root@lzx-ocboot-ha-test-2 ~]$ kubectl get pods -n kube-system | grep etcd\netcd-lzx-ocboot-ha-test-2                      1/1     Running            1          4h52m\netcd-lzx-ocboot-ha-test-3                      1/1     Running            1          4h51m\n\n# \u8fdb\u5165 etcd-lzx-ocboot-ha-test-2 etcd pod\n[root@lzx-ocboot-ha-test-2 ~]# kubectl exec -ti -n kube-system  etcd-lzx-ocboot-ha-test-2 sh\n\n# \u4f7f\u7528 etcdctl \u67e5\u770b member list\n$ etcdctl --endpoints https://127.0.0.1:2379 --cacert /etc/kubernetes/pki/etcd/ca.crt --cert /etc/kubernetes/pki/etcd/server.crt --key /etc/kubernetes/pki/etcd/server.key member list\n# \u4f1a\u53d1\u73b0\u65e7\u7684 primary_master_node member lzx-ocboot-ha-test \u8fd8\u5728 etcd \u96c6\u7fa4\n14da7b338b44eee0, started, lzx-ocboot-ha-test, https://10.127.100.234:2380, https://10.127.100.234:2379, false\n454ae6f931376261, started, lzx-ocboot-ha-test-2, https://10.127.100.229:2380, https://10.127.100.229:2379, false\n5afd19948b9009f6, started, lzx-ocboot-ha-test-3, https://10.127.100.226:2380, https://10.127.100.226:2379, false\n\n# \u5220\u9664 lzx-ocboot-ha-test member\n$ etcdctl --endpoints https://127.0.0.1:2379 --cacert /etc/kubernetes/pki/etcd/ca.crt --cert /etc/kubernetes/pki/etcd/server.crt --key /etc/kubernetes/pki/etcd/server.key member remove 14da7b338b44eee0\n"})}),"\n",(0,t.jsx)(e.h4,{id:"4-\u66ff\u6362\u65e7\u7684-primary_master_node-\u8282\u70b9\u52a0\u5165\u65b0\u7684-master_node",children:"4. \u66ff\u6362\u65e7\u7684 primary_master_node \u8282\u70b9\uff0c\u52a0\u5165\u65b0\u7684 master_node"}),"\n",(0,t.jsx)(e.p,{children:"\u65e7\u7684 primary_master_node \u8282\u70b9\u5df2\u7ecf\u88ab\u5220\u6389\uff0c\u4f1a\u53d1\u73b0 keepalived \u7684 vip \u4e5f\u6f02\u79fb\u5230\u4e86 master_node_1 \u4e0a\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# \u67e5\u770b vip \u4e3a 10.127.100.102\n# \u5982\u679c\u8be5\u8282\u70b9\u8fd0\u884c\u4e86\u4e91\u5e73\u53f0 host \u670d\u52a1\uff0cip \u4f1a\u7ed1\u5b9a\u5230 br0 \u4e0a\n[root@lzx-ocboot-ha-test-2 ~]$ ip addr show br0\n32: br0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/ether 00:22:96:6f:6e:f1 brd ff:ff:ff:ff:ff:ff\n    inet 10.127.100.229/24 brd 10.127.100.255 scope global br0\n       valid_lft forever preferred_lft forever\n    inet 10.127.100.102/32 scope global br0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::222:96ff:fe6f:6ef1/64 scope link \n       valid_lft forever preferred_lft forever\n\n# \u67e5\u770b /etc/kubernetes/manifests/keepalived.yaml env \u914d\u7f6e\n[root@lzx-ocboot-ha-test-2 ~]$ cat /etc/kubernetes/manifests/keepalived.yaml | | grep -A 15 env\n    env:\n    # \u5bf9\u5e94 keepalived \u7684\u6743\u91cd\uff0c\u9664\u4e86 primary_master_node \u7684 keepalived \u4f1a\u8bbe\u7f6e 100\uff0c\u5176\u4f59 master_node \u4e0a\u9762\u7684\u90fd\u662f 90\n    - name: KEEPALIVED_PRIORITY\n      value: \"90\"\n    # \u8bbe\u7f6e\u7684 VIP\n    - name: KEEPALIVED_VIRTUAL_IPS\n      value: '#PYTHON2BASH:[''10.127.100.102'']'\n    # \u662f BACKUP \u89d2\u8272\n    - name: KEEPALIVED_STATE\n      value: BACKUP\n    # \u5bc6\u7801\n    - name: KEEPALIVED_PASSWORD\n      value: de17f785\n    # router id\n    - name: KEEPALIVED_ROUTER_ID\n      value: \"12\"\n    # \u6539\u8282\u70b9\u7f51\u5361\u5b9e\u9645 ip\n    - name: KEEPALIVED_NODE_IP\n      value: 10.127.100.229\n    # keepalived \u7ed1\u5b9a\u7684\u7f51\u5361\n    - name: KEEPALIVED_INTERFACE\n      value: eth0\n    image: registry.cn-beijing.aliyuncs.com/yunionio/keepalived:v2.0.25\n\n# \u67e5\u770b\u96c6\u7fa4\u5f53\u524d\u53ea\u6709 2 \u4e2a\u8282\u70b9\n[root@lzx-ocboot-ha-test-2 ocboot]$ kubectl get nodes -o wide\nNAME                   STATUS   ROLES    AGE     VERSION    INTERNAL-IP      EXTERNAL-IP   OS-IMAGE                KERNEL-VERSION                          CONTAINER-RUNTIME\nlzx-ocboot-ha-test-2   Ready    master   4h29m   v1.15.12   10.127.100.229   <none>        CentOS Linux 7 (Core)   3.10.0-1160.6.1.el7.yn20201125.x86_64   docker://20.10.5\nlzx-ocboot-ha-test-3   Ready    master   4h28m   v1.15.12   10.127.100.226   <none>        CentOS Linux 7 (Core)   3.10.0-1160.6.1.el7.yn20201125.x86_64   docker://20.10.5\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u73b0\u5728\u4f7f\u7528 ocboot \u52a0\u5165\u65b0\u7684\u8282\u70b9\uff0c\u7f16\u8f91 ocboot yaml \u914d\u7f6e\uff1a"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u628a\u5f53\u524d\u7684 lzx-ocboot-ha-test-2 \u8fd9\u4e2a\u8282\u70b9\u5f53\u505a primary_master_node"}),"\n",(0,t.jsxs)(e.li,{children:["\u9700\u8981\u65b0\u52a0\u5165 master_node \u8282\u70b9\u4fe1\u606f\uff1a","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"IP: 10.127.100.224"}),"\n",(0,t.jsx)(e.li,{children:"Name: lzx-ocboot-ha-test-4"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"\u56e0\u4e3a\u65e7\u7684 primary_master_node \u5df2\u7ecf\u88ab\u5220\u9664\u4e86\uff0c\u53c8\u628a\u5f53\u524d\u7684 master_node_1 \u5f53\u505a\u65b0\u96c6\u7fa4\u7684 primary_master_node\uff0c\u73b0\u5728\u7684\u914d\u7f6e\u53d8\u6210\u4e0b\u9762\u8fd9\u6837:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yaml",children:'$ cat config-new-k8s-ha.yaml\nprimary_master_node:\n  # \u8fd9\u91cc\u628a\u4e4b\u524d\u7684 master_node_1 10.127.100.229 \u5f53\u505a primary_master_node\n  hostname: 10.127.100.229\n  use_local: false\n  user: root\n  onecloud_version: "v3.8.8"\n  # \u6570\u636e\u5e93\u8fde\u63a5\u4fe1\u606f\uff0c\u6839\u636e\u81ea\u5df1\u7684\u73af\u5883\u586b\u5199\n  db_host: 10.127.100.101\n  db_user: "root"\n  db_password: "0neC1oudDB#"\n  db_port: "3306"\n  image_repository: registry.cn-beijing.aliyuncs.com/yunionio\n  ha_using_local_registry: false\n  node_ip: "10.127.100.229"\n  # keepalived \u66b4\u9732\u51fa\u53bb\u7684 vip\n  controlplane_host: 10.127.100.102\n  controlplane_port: "6443"\n  as_host: true\n  # \u542f\u7528 ha \uff0c\u9ed8\u8ba4\u90e8\u7f72 keepavlied\n  high_availability: true\n  use_ee: false\n  # \u9ad8\u53ef\u7528\u4f7f\u7528 minio\n  enable_minio: true\n  host_networks: "eth0/br0/10.127.100.229"\n\nmaster_nodes:\n  # \u52a0\u5165\u5230 10.127.100.102 vip \u7684 k8s \u96c6\u7fa4\n  controlplane_host: 10.127.100.102\n  controlplane_port: "6443"\n  # \u8fd0\u884c\u4e91\u5e73\u53f0\u63a7\u5236\u76f8\u5173\u7ec4\u4ef6\n  as_controller: true\n  # \u4f5c\u4e3a\u4e91\u5e73\u53f0\u79c1\u6709\u4e91\u5bbf\u4e3b\u673a\u8ba1\u7b97\u8282\u70b9\n  as_host: true\n  # \u542f\u7528 keepavlied\n  high_availability: true\n  hosts:\n  - user: root\n    hostname: "10.127.100.224"\n    host_networks: "eth0/br0/10.127.100.224"\n'})}),"\n",(0,t.jsx)(e.p,{children:"\u5199\u597d\u914d\u7f6e\u540e\uff0c\u4f7f\u7528 ocboot \u52a0\u5165\u65b0\u8282\u70b9\u3002"}),"\n",(0,t.jsx)(e.h1,{id:"\u4e0b\u8f7d-ocboot-\u90e8\u7f72\u5de5\u5177\u4ee3\u7801",children:"\u4e0b\u8f7d ocboot \u90e8\u7f72\u5de5\u5177\u4ee3\u7801\u3002"}),"\n","\n",(0,t.jsx)(l.A,{}),"\n",(0,t.jsx)(e.p,{children:"\u7136\u540e\u52a0\u5165\u8282\u70b9\u3002"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"$ ./run.py config-new-k8s-ha.yaml\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u7b49\u5230 ocboot \u7684 ./run.py \u8fd0\u884c\u5b8c\u6210\u540e\uff0c\u518d\u67e5\u770b node \u4fe1\u606f\uff0c\u53d1\u73b0\u65b0\u7684\u8282\u70b9 lzx-ocboot-ha-test-4(10.127.100.224) \u5df2\u7ecf\u52a0\u5165\u8fdb\u6765\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"[root@lzx-ocboot-ha-test-2 ~]$ kubectl get nodes -o wide\nNAME                   STATUS   ROLES    AGE     VERSION    INTERNAL-IP      EXTERNAL-IP   OS-IMAGE                KERNEL-VERSION                          CONTAINER-RUNTIME\nlzx-ocboot-ha-test-2   Ready    master   5h13m   v1.15.12   10.127.100.229   <none>        CentOS Linux 7 (Core)   3.10.0-1160.6.1.el7.yn20201125.x86_64   docker://20.10.5\nlzx-ocboot-ha-test-3   Ready    master   5h12m   v1.15.12   10.127.100.226   <none>        CentOS Linux 7 (Core)   3.10.0-1160.6.1.el7.yn20201125.x86_64   docker://20.10.5\nlzx-ocboot-ha-test-4   Ready    master   10m     v1.15.12   10.127.100.224   <none>        CentOS Linux 7 (Core)   3.10.0-1160.6.1.el7.yn20201125.x86_64   docker://20.10.5\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u4fee\u6539\u65b0\u7684 primary_master_node keepalived \u7684\u6743\u91cd\u548c\u89d2\u8272"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:'[root@lzx-ocboot-ha-test-2 ~]$ vim /etc/kubernetes/manifests/keepalived.yaml\n...\n    # \u628a\u6743\u91cd\u6539\u6210 100\n    - name: KEEPALIVED_PRIORITY\n      value: "100"\n...\n    # \u628a\u89d2\u8272\u6539\u6210 MASTER\n    - name: KEEPALIVED_STATE\n      value: MASTER\n'})}),"\n",(0,t.jsx)(e.h4,{id:"5-\u6062\u590d\u6709\u72b6\u6001\u7684-pod",children:"5. \u6062\u590d\u6709\u72b6\u6001\u7684 pod"}),"\n",(0,t.jsx)(e.p,{children:"\u65b0\u7684 master \u8282\u70b9\u52a0\u5165\u540e\uff0c\u4f1a\u53d1\u73b0\u539f\u6765\u7684\u6709\u72b6\u6001 pod \u8fd8\u662f Pending\uff0c\u63a5\u4e0b\u6765\u5c31\u9700\u8981\u5220\u9664\u65e7\u7684 pvc \uff0c\u628a\u5b83\u4eec\u542f\u52a8\u5230\u65b0\u7684 master \u8282\u70b9\u4e0a\u3002"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# \u67e5\u770b Pending \u72b6\u6001\u7684 pod\n[root@lzx-ocboot-ha-test-2 ~]$ kubectl get pods -A | grep Pending\nonecloud-minio        minio-0                                              0/1     Pending   0          74m\nonecloud-minio        minio-3                                              0/1     Pending   0          74m\nonecloud-monitoring   monitor-minio-0                                      0/1     Pending   0          74m\nonecloud-monitoring   monitor-minio-3                                      0/1     Pending   0          74m\nonecloud              default-influxdb-85945647d5-x5sv5                    0/1     Pending   0          84m\n\n# \u628a\u73b0\u5728\u7684 primary_master_node \u548c\u65e7\u7684 master_node \u5148\u7981\u6b62\u8c03\u5ea6\uff0c\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u540e\u9762\u7684\u6709\u72b6\u6001 pod \u521b\u5efa\u5230\u65b0\u7684 master \u8282\u70b9\u4e0a\n# \u4fdd\u8bc1 minio \u591a\u526f\u672c\u6253\u6563\u5230\u4e0d\u540c\u7684 master \u8282\u70b9\n[root@lzx-ocboot-ha-test-2 ~]$ kubectl cordon lzx-ocboot-ha-test-2 lzx-ocboot-ha-test-3\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u9996\u5148\u6062\u590d onecloud-minio \u91cc\u9762\u7684 minio statefulset \u7ec4\u4ef6\uff0c\u56e0\u4e3a\u91cc\u9762\u5b58\u50a8\u4e86 glance \u4f9d\u8d56\u7684\u955c\u50cf\uff0c\u901a\u8fc7\u4e4b\u524d\u7684\u547d\u4ee4\u53d1\u73b0 onecloud-minio namespace \u91cc\u9762\u7684 minio-0 \u548c minio-3 \u662f Pending \u72b6\u6001\uff0c\u63a5\u4e0b\u6765\u5220\u9664\u5b83\u4eec\u4f9d\u8d56\u7684 pvc \uff0c\u7136\u540e pod \u5c31\u4f1a\u91cd\u542f\u5230\u65b0\u7684 master_node \u8282\u70b9\u4e0a\uff0c\u64cd\u4f5c\u5982\u4e0b\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:'# \u627e\u5230\u5bf9\u5e94\u7684 pvc\n[root@lzx-ocboot-ha-test-2 ~]$ kubectl get pvc -n onecloud-minio  | egrep \'minio-0|minio-3\'\nexport-minio-0   Bound    pvc-297ed5e5-66c8-4855-8031-c65a0ccfa4d0   1Ti        RWO            local-path     4h55m\nexport-minio-3   Bound    pvc-3dd54509-7745-47dd-84ea-fbacfe1e2f5b   1Ti        RWO            local-path     4h55m\n\n# \u5220\u9664 pvc\n[root@lzx-ocboot-ha-test-2 ~]$ kubectl delete pvc -n onecloud-minio export-minio-0 export-minio-3\n\n# \u5220\u9664 pod\n[root@lzx-ocboot-ha-test-2 ~]$ kubectl delete pods -n onecloud-minio minio-0 minio-3\n\n# \u67e5\u770b\u65b0\u521b\u5efa\u542f\u52a8 minio-0 \u548c minio-3 \uff0c\u5df2\u7ecf\u542f\u52a8\u5230\u65b0\u7684 node lzx-ocboot-ha-test-4 \u4e0a\n[root@lzx-ocboot-ha-test-2 ~]$ kubectl get pods -n onecloud-minio  -o wide\nNAME      READY   STATUS    RESTARTS   AGE    IP              NODE                   NOMINATED NODE   READINESS GATES\nminio-0   1/1     Running   0          7s     10.40.103.200   lzx-ocboot-ha-test-4   <none>           <none>\nminio-1   1/1     Running   0          5h1m   10.40.158.215   lzx-ocboot-ha-test-3   <none>           <none>\nminio-2   1/1     Running   0          5h1m   10.40.159.22    lzx-ocboot-ha-test-2   <none>           <none>\nminio-3   1/1     Running   0          14s    10.40.103.199   lzx-ocboot-ha-test-4   <none>           <none>\n\n# \u67e5\u770b minio-3 \u7684\u65e5\u5fd7\uff0c\u53d1\u73b0\u5df2\u7ecf\u81ea\u6108\u5b8c\u6bd5\n[root@lzx-ocboot-ha-test-2 ~]$ kubectl logs  -n onecloud-minio minio-3\n....\nHealing disk \'/export\' on 1st pool\nHealing disk \'/export\' on 1st pool complete\nSummary:\n{\n  "ID": "0e5c1947-44f0-4f8a-b7f0-e3a55f441d6f",\n  "PoolIndex": 0,\n  "SetIndex": 0,\n  "DiskIndex": 3,\n  "Path": "/export",\n  "Endpoint": "http://minio-3.minio-svc.onecloud-minio.svc.cluster.local:9000/export",\n  "Started": "2022-04-13T06:49:29.882069559Z",\n  "LastUpdate": "2022-04-13T06:49:59.564158167Z",\n  "ObjectsHealed": 10,\n  "ObjectsFailed": 0,\n  "BytesDone": 1756978429,\n  "BytesFailed": 0,\n  "QueuedBuckets": [],\n  "HealedBuckets": [\n    ".minio.sys/config",\n    ".minio.sys/buckets",\n    "onecloud-images"\n  ]\n}\n...\n\n# \u4e5f\u53ef\u4ee5\u767b\u5f55\u5230 lzx-ocboot-ha-test-4 \u4e0a\uff0c\u67e5\u770b local-path csi \u91cc\u9762\u7684 minio onecloud-images bucket \u91cc\u9762\u6709\u6ca1\u6709\u5bf9\u5e94\u7684\u955c\u50cf parts\n$ ssh root@10.127.100.224\n\n# \u8fdb\u5165\u5bf9\u5e94\u7684 pvc \u76ee\u5f55\uff0c\u76ee\u5f55\u540d\u53ef\u4ee5\u4f7f\u7528 kubectl get pvc -n onecloud-minio | grep minio-3 \u83b7\u5f97\n[root@lzx-ocboot-ha-test-4 ~]$ cd /opt/local-path-provisioner/pvc-352277cb-e69d-41bf-b58a-d65cb1e4e6f8/\n[root@lzx-ocboot-ha-test-4 pvc-352277cb-e69d-41bf-b58a-d65cb1e4e6f8]$ du -smh onecloud-images/\n838M    onecloud-images/\n'})}),"\n",(0,t.jsx)(e.p,{children:"\u7136\u540e\u4f7f\u7528\u6062\u590d onecloud-minio \u76f8\u540c\u7684\u65b9\u6cd5\uff0c\u6062\u590d monitor-minio \u5c31\u53ef\u4ee5\uff0c\u53c2\u8003\u547d\u4ee4\u5982\u4e0b\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:'[root@lzx-ocboot-ha-test-2 ~]$ kubectl  delete pvc -n onecloud-monitoring export-monitor-minio-0 export-monitor-minio-3\npersistentvolumeclaim "export-monitor-minio-0" deleted\npersistentvolumeclaim "export-monitor-minio-3" deleted\n\n[root@lzx-ocboot-ha-test-2 ~]$ kubectl  delete pods -n onecloud-monitoring monitor-minio-0 monitor-minio-3\npod "monitor-minio-0" deleted\npod "monitor-minio-3" deleted\n\n[root@lzx-ocboot-ha-test-2 ~]$ kubectl get pods -n onecloud-monitoring  | grep minio\nmonitor-minio-0                                   1/1     Running   0          24s\nmonitor-minio-1                                   1/1     Running   0          5h17m\nmonitor-minio-2                                   1/1     Running   0          5h17m\nmonitor-minio-3                                   1/1     Running   0          24s\n'})}),"\n",(0,t.jsx)(e.p,{children:"\u6062\u590d influxdb deployment\uff0cinfluxdb \u548c minio \u4e0d\u592a\u4e00\u6837\uff0cminio \u4f7f\u7528\u7684 statefulset \u7ba1\u7406\uff0c\u5220\u6389 pod \u548c pvc \u540e\uff0ck8s \u4f1a\u81ea\u52a8\u521b\u5efa\u5bf9\u5e94\u5e8f\u53f7\u7684 pod \u548c pvc \uff0c\u4f46\u662f deployment \u4e0d\u4f1a\uff0c\u6240\u4ee5\u6062\u590d influxdb \u7684\u6b65\u9aa4\u662f\u5220\u6389 pvc\uff0c\u7136\u540e\u540c\u65f6\u5220\u6389 default-influxdb \u8fd9\u4e2a deployment \uff0c\u6211\u4eec\u7684 onecloud-operator \u7ec4\u4ef6\u5c31\u4f1a\u65b0\u5efa\u5bf9\u5e94\u7684\u8d44\u6e90\uff0c\u6b65\u9aa4\u5982\u4e0b\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# \u6062\u590d influxdb\n[root@lzx-ocboot-ha-test-2 ~]# kubectl delete  pvc -n onecloud default-influxdb\n[root@lzx-ocboot-ha-test-2 ~]# kubectl delete  deployment -n onecloud default-influxdb\n[root@lzx-ocboot-ha-test-2 ~]# kubectl get pods -n onecloud | grep influxdb\ndefault-influxdb-85945647d5-mdd2z                    1/1     Running            0          7m44s\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u73b0\u5728\u6240\u6709\u5728\u65e7\u7684 primary_master_node \u4e0a\u7684\u7ec4\u4ef6\u90fd\u6062\u590d\uff0c\u63a5\u4e0b\u6765\u628a\u7981\u6b62\u8c03\u5ea6\u7684\u8282\u70b9\u542f\u7528\u8c03\u5ea6\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"[root@lzx-ocboot-ha-test-2 ~]$ kubectl uncordon lzx-ocboot-ha-test-2 lzx-ocboot-ha-test-3\n"})})]})}function p(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(m,{...n})}):m(n)}},41571:(n,e,o)=>{o.d(e,{A:()=>a});var t=o(14902),i=o(21312),l=o(28541),d=o(74848);function a(){const n=(0,i.T)({id:"OcbootClone.downloadComment",message:"# \u4e0b\u8f7d ocboot \u5de5\u5177\u5230\u672c\u5730",description:"locally download comment"}),e=(0,l.c)("release_branch");return(0,d.jsx)("div",{children:(0,d.jsx)(t.A,{language:"bash",children:n+`\n$ git clone -b ${e} https://github.com/yunionio/ocboot && cd ./ocboot`})})}},28541:(n,e,o)=>{o.d(e,{c:()=>i});var t=o(44586);function i(n){const{siteConfig:e}=(0,t.A)();return e.customFields[n]}},67332:(n,e,o)=>{o.d(e,{A:()=>l});o(96540);var t=o(52830),i=o(74848);function l(n){const e={...n};return e?.code?.length>2&&(e.code=e.code.split("\n").map((n=>n.length>2&&"$ "===n.substring(0,2)?n.substring(2):n)).join("\n")),(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(t.A,{...e})})}}}]);
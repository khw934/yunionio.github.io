"use strict";(self.webpackChunkdocs_new=self.webpackChunkdocs_new||[]).push([[5820],{11871:(e,o,l)=>{l.r(o),l.d(o,{assets:()=>a,contentTitle:()=>c,default:()=>m,frontMatter:()=>n,metadata:()=>r,toc:()=>d});var s=l(74848),t=l(28453);const n={sidebar_position:8},c="Shared LVM Storage With Lvmlockd",r={id:"guides/onpremise/storage/blockstorage/lvmlockd",title:"Shared LVM Storage With Lvmlockd",description:"\u5728 Centos8, OpenEuler \u7b49\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0clvmlockd \u4f5c\u4e3a clvm \u7684\u5347\u7ea7\u65b9\u6848\uff0c\u672c\u6587\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528\u4f7f\u7528 lvmlockd \u642d\u5efa lvm \u96c6\u7fa4\u53ca\u5982\u4f55\u6ce8\u518c\u5230 cloudpods \u4e2d\u3002",source:"@site/docs/guides/onpremise/storage/blockstorage/lvmlockd.md",sourceDirName:"guides/onpremise/storage/blockstorage",slug:"/guides/onpremise/storage/blockstorage/lvmlockd",permalink:"/guides/onpremise/storage/blockstorage/lvmlockd",draft:!1,unlisted:!1,editUrl:"https://github.com/yunionio/website/tree/master/docs/guides/onpremise/storage/blockstorage/lvmlockd.md",tags:[],version:"current",sidebarPosition:8,frontMatter:{sidebar_position:8},sidebar:"tutorialSidebar",previous:{title:"\u5b58\u50a8\u4fe1\u606f\u91c7\u96c6",permalink:"/guides/onpremise/storage/blockstorage/storage_sync"},next:{title:"\u5907\u4efd\u5b58\u50a8",permalink:"/guides/onpremise/storage/backupstorage/"}},a={},d=[{value:"\u914d\u7f6e lvmlockd \u5e76\u521b\u5efa vg",id:"\u914d\u7f6e-lvmlockd-\u5e76\u521b\u5efa-vg",level:2},{value:"cloudpods \u96c6\u7fa4\u521b\u5efa Shared LVM \u5b58\u50a8",id:"cloudpods-\u96c6\u7fa4\u521b\u5efa-shared-lvm-\u5b58\u50a8",level:2},{value:"\u5220\u9664",id:"\u5220\u9664",level:2}];function i(e){const o={code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.h1,{id:"shared-lvm-storage-with-lvmlockd",children:"Shared LVM Storage With Lvmlockd"}),"\n",(0,s.jsx)(o.p,{children:"\u5728 Centos8, OpenEuler \u7b49\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0clvmlockd \u4f5c\u4e3a clvm \u7684\u5347\u7ea7\u65b9\u6848\uff0c\u672c\u6587\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528\u4f7f\u7528 lvmlockd \u642d\u5efa lvm \u96c6\u7fa4\u53ca\u5982\u4f55\u6ce8\u518c\u5230 cloudpods \u4e2d\u3002"}),"\n",(0,s.jsx)(o.h2,{id:"\u914d\u7f6e-lvmlockd-\u5e76\u521b\u5efa-vg",children:"\u914d\u7f6e lvmlockd \u5e76\u521b\u5efa vg"}),"\n",(0,s.jsx)(o.p,{children:"\u4f7f\u7528 lvmlockd \u642d\u5efa shared lvm \u96c6\u7fa4\uff1a"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-bash",children:"\n# \u6ce8\u610f\uff1acentos7 lvm \u4f1a\u9ed8\u8ba4\u8d77 lvmetad \u670d\u52a1\uff0c\u82e5\u662f centos7 \u5bbf\u4e3b\u673a\u9700\u8981\u5148\u7981\u7528\uff1a\n$ systemctl disable lvm2-lvmetad.service --now\n\n$ yum install -y lvm2-lockd.x86_64\n$ yum install -y sanlock.x86_64\n\n$ vi /etc/lvm/lvm.conf\nuse_lvmlockd = 1\n\n# Assign each host a unique host_id in the range 1-2000 by setting\n$ vi /etc/lvm/lvmlocal.conf\n    host_id = 2\n\n$ systemctl enable wdmd sanlock --now\n\n# \u6ce8\u610f\uff1acentos7 \u670d\u52a1\u540d\u79f0\u4e3a lvm2-lvmlockd\uff0c\u6b64\u547d\u4ee4\u8981\u6539\u4e3a systemctl enable lvm2-lvmlockd --now\n$ systemctl enable lvmlockd --now\n\n# \u9996\u4e2a\u8282\u70b9\u6267\u884c\uff0c\u521b\u5efa cluster vg: vgcreate --shared <vgname> <devices>\n$ vgcreate --shared cluster-vg /dev/sdb\n\n# \u6bcf\u4e2a\u8282\u70b9\u6267\u884c\n$ vgchange --lock-start\n\n# \u6210\u529f\u540e\u53ef\u4ee5\u67e5\u770b lvmlock \u4fe1\u606f\n# \u67e5\u770b lvmlock \u4fe1\u606f\n$ lvmlockctl -i\n"})}),"\n",(0,s.jsx)(o.h2,{id:"cloudpods-\u96c6\u7fa4\u521b\u5efa-shared-lvm-\u5b58\u50a8",children:"cloudpods \u96c6\u7fa4\u521b\u5efa Shared LVM \u5b58\u50a8"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-bash",children:"# shared lvm vgname storage1\n# \u4f7f\u7528 lvmlockd \u7684\u5b58\u50a8\u7c7b\u578b\u4e3a slvm\uff0c\u5e76\u4e14\u9700\u8981\u52a0\u4e0a\u53c2\u6570 --lvmlockd, \u533a\u522b\u4e8e\u9700\u8981\u6307\u5b9a master host \u7684 slvm \u5b58\u50a8\n# \u5f53\u524d\u8fd9\u4e2a\u5bbf\u4e3b\u673a\u5e76\u6ca1\u6709\u4e0e\u5b58\u50a8\u5173\u8054\uff0c\u6240\u4ee5\u5728 slvm \u5b58\u50a8\u521b\u5efa\u5b8c\u6210\u540e\u9700\u8981\u5173\u8054\u8be5\u5bbf\u4e3b\u673a\u3002\n$ climc storage-create \\ \n    --storage-type slvm \\\n    --slvm-vg-name storage1 \\\n    --lvmlockd \\ # \u8bbe\u7f6e storage \u4e3a\u4f7f\u7528 lvmlockd \u5b58\u50a8\n    <STORAGE_NAME> <ZONE_ID_OR_NAME>\n\neg:\n$ climc storage-create --slvm-vg-name storage1  --storage-type slvm --lvmlockd lvmlockd-storage1 zone0\n$ climc host-storage-attach host1 lvmlockd-storage1\n\n# \u5176\u4ed6\u9700\u8981\u5173\u8054\u7684\u5bbf\u4e3b\u673a\u4e5f\u53ef\u4ee5\u8fd9\u6837\u5173\u8054\n$ climc host-storage-attach\nUsage: climc host-storage-attach [--help] [--mount-point MOUNT_POINT] <HOST> <STORAGE>\n# host_id \u53ef\u4ee5\u901a\u8fc7 climc host-list \u83b7\u53d6\n$ climc host-storage-attach <HOST_ID> lvmlockd-storage1\n"})}),"\n",(0,s.jsx)(o.h2,{id:"\u5220\u9664",children:"\u5220\u9664"}),"\n",(0,s.jsxs)(o.p,{children:["\u5220\u9664\u5b58\u50a8\u4e0e\u5176\u4ed6\u5b58\u50a8\u7c7b\u4f3c\uff0c\u548c\u5bbf\u4e3b\u673a detach \u540e\u53ef\u6267\u884c ",(0,s.jsx)(o.code,{children:"climc storage-delete"})]})]})}function m(e={}){const{wrapper:o}={...(0,t.R)(),...e.components};return o?(0,s.jsx)(o,{...e,children:(0,s.jsx)(i,{...e})}):i(e)}},28453:(e,o,l)=>{l.d(o,{R:()=>c,x:()=>r});var s=l(96540);const t={},n=s.createContext(t);function c(e){const o=s.useContext(n);return s.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function r(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),s.createElement(n.Provider,{value:o},e.children)}}}]);
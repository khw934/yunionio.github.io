"use strict";(self.webpackChunkdocs_new=self.webpackChunkdocs_new||[]).push([[5331],{74762:(e,n,c)=>{c.r(n),c.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>p,frontMatter:()=>t,metadata:()=>o,toc:()=>d});var i=c(74848),s=c(28453);const t={sidebar_position:1},r="climc \u8ba4\u8bc1",o={id:"guides/climc/auth",title:"climc \u8ba4\u8bc1",description:"\u4ecb\u7ecdClimc\u547d\u4ee4\u884c\u5de5\u5177\u8ba4\u8bc1\u914d\u7f6e\u3002",source:"@site/docs/guides/climc/auth.md",sourceDirName:"guides/climc",slug:"/guides/climc/auth",permalink:"/docs/guides/climc/auth",draft:!1,unlisted:!1,editUrl:"https://github.com/yunionio/website/tree/master/docs/guides/climc/auth.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"\u547d\u4ee4\u884c\u5de5\u5177",permalink:"/docs/guides/climc/"},next:{title:"climc \u4f7f\u7528",permalink:"/docs/guides/climc/usage"}},l={},d=[{value:"\u8ba4\u8bc1\u914d\u7f6e",id:"\u8ba4\u8bc1\u914d\u7f6e",level:2},{value:"\u901a\u8fc7\u7528\u6237\u540d\uff0f\u5bc6\u7801\u8ba4\u8bc1",id:"\u901a\u8fc7\u7528\u6237\u540d\u5bc6\u7801\u8ba4\u8bc1",level:2},{value:"\u63a7\u5236\u8282\u70b9\u8ba4\u8bc1\u914d\u7f6e",id:"\u63a7\u5236\u8282\u70b9\u8ba4\u8bc1\u914d\u7f6e",level:3},{value:"\u975e\u63a7\u5236\u8282\u70b9\u8ba4\u8bc1\u914d\u7f6e",id:"\u975e\u63a7\u5236\u8282\u70b9\u8ba4\u8bc1\u914d\u7f6e",level:3},{value:"token\u8ba4\u8bc1",id:"token\u8ba4\u8bc1",level:2},{value:"\u901a\u8fc7Access Key\uff0fSecret\u8ba4\u8bc1",id:"\u901a\u8fc7access-keysecret\u8ba4\u8bc1",level:2},{value:"\u9a8c\u8bc1",id:"\u9a8c\u8bc1",level:2}];function a(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"climc-\u8ba4\u8bc1",children:"climc \u8ba4\u8bc1"}),"\n",(0,i.jsx)(n.p,{children:"\u4ecb\u7ecdClimc\u547d\u4ee4\u884c\u5de5\u5177\u8ba4\u8bc1\u914d\u7f6e\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u8ba4\u8bc1\u914d\u7f6e",children:"\u8ba4\u8bc1\u914d\u7f6e"}),"\n",(0,i.jsx)(n.p,{children:"climc \u8bf7\u6c42\u4e91\u5e73\u53f0\u540e\u7aef\u670d\u52a1\u7684\u6d41\u7a0b\u5982\u4e0b:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"\u901a\u8fc7\u914d\u7f6e\u4fe1\u606f\uff0c\u4f7f\u7528\u7528\u6237\u540d\u5bc6\u7801\u4ece keystone \u83b7\u53d6 token"}),"\n",(0,i.jsx)(n.li,{children:"token \u4e2d\u5305\u542b\u4e86\u540e\u7aef\u670d\u52a1\u7684 endpoint \u5730\u5740"}),"\n",(0,i.jsx)(n.li,{children:"climc \u5c06\u5bf9\u5e94\u8d44\u6e90\u7684 CURD \u8bf7\u6c42\u53d1\u5f80\u6240\u5c5e\u7684\u540e\u7aef\u670d\u52a1"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u6240\u4ee5\u5728\u64cd\u4f5c\u8d44\u6e90\u524d\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u544a\u8bc9 climc \u60f3\u8981\u64cd\u4f5c\u7684\u4e91\u5e73\u53f0\u548c\u8ba4\u8bc1\u4fe1\u606f\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u76ee\u524dclimc\u652f\u6301\u4e09\u79cd\u8ba4\u8bc1\u65b9\u5f0f\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u901a\u8fc7\u7528\u6237\u540d\uff0f\u5bc6\u7801\u8ba4\u8bc1"}),"\n",(0,i.jsx)(n.li,{children:"token\u8ba4\u8bc1 (\u76ee\u524dcloudshell\u4f7f\u7528\u8fd9\u79cd\u8ba4\u8bc1\u65b9\u5f0f)"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"../../development/apisdk/api",children:"\u901a\u8fc7Access Key\uff0fSecret\u8ba4\u8bc1"})}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"\u7531\u4e8ecloudshell\u5728\u542f\u52a8\u65f6\u5df2\u7ecf\u6ce8\u5165\u4e86token\u73af\u5883\u53d8\u91cf, \u56e0\u6b64\u4e0d\u80fd\u770b\u5230token\u751f\u6210\u7684\u8fc7\u7a0b\uff0c\u82e5\u9700\u8981\u67e5\u770btoken\u751f\u6210\u8fc7\u7a0b\uff0c\u9700\u8981\u6362\u53e6\u5916\u4e24\u79cd\u8ba4\u8bc1\u65b9\u5f0f"}),"\n",(0,i.jsxs)(n.li,{children:["AccessKey\u8ba4\u8bc1\u65b9\u5f0f\u7c7b\u4f3c\u4e8e\u516c\u6709\u4e91\u7684\u8ba4\u8bc1\u7b7e\u540d, \u76ee\u524d\u4ec5python\u548cgo\u7684sdk\u652f\u6301, \u82e5\u7528\u5176\u4ed6\u8bed\u8a00\u63a5\u5165\u9700\u8981\u81ea\u884c\u5b9e\u73b0",(0,i.jsx)(n.a,{href:"https://github.com/yunionio/cloudpods/blob/10b1d9bdd35776cf8cb597d918fa571fbc356238/pkg/mcclient/aksk.go#L80",children:"\u7b7e\u540d\u7b97\u6cd5"})]}),"\n"]})}),"\n",(0,i.jsx)(n.h2,{id:"\u901a\u8fc7\u7528\u6237\u540d\u5bc6\u7801\u8ba4\u8bc1",children:"\u901a\u8fc7\u7528\u6237\u540d\uff0f\u5bc6\u7801\u8ba4\u8bc1"}),"\n",(0,i.jsx)(n.h3,{id:"\u63a7\u5236\u8282\u70b9\u8ba4\u8bc1\u914d\u7f6e",children:"\u63a7\u5236\u8282\u70b9\u8ba4\u8bc1\u914d\u7f6e"}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u63a7\u5236\u8282\u70b9\u4e0a\u53ef\u76f4\u63a5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u8ba4\u8bc1\u914d\u7f6e\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u83b7\u53d6\u73af\u5883\u53d8\u91cf\n$ cat /root/.onecloud_rcadmin\nexport OS_AUTH_URL=https://192.168.0.246:5000/v3\nexport OS_USERNAME=sysadmin\nexport OS_PASSWORD=3hV3***84srk\nexport OS_PROJECT_NAME=system\nexport YUNION_INSECURE=true\nexport OS_REGION_NAME=region0\nexport OS_ENDPOINT_TYPE=publicURL\n\n# \u8ba4\u8bc1\u73af\u5883\u53d8\u91cf\n$ source /root/.onecloud_rcadmin\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u6ce8\u610f: \u5982\u679c\u6267\u884c climc \u65f6\u51fa\u73b0 ",(0,i.jsx)(n.em,{children:"Error: Missing OS_AUTH_URL"})," \u7684\u9519\u8bef\u63d0\u793a\u65f6\uff0c\u8bf7\u91cd\u65b0\u6267\u884c ",(0,i.jsx)(n.code,{children:"source /root/.onecloud_rcadmin"})," \u547d\u4ee4\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"\u975e\u63a7\u5236\u8282\u70b9\u8ba4\u8bc1\u914d\u7f6e",children:"\u975e\u63a7\u5236\u8282\u70b9\u8ba4\u8bc1\u914d\u7f6e"}),"\n",(0,i.jsxs)(n.p,{children:["\u5728\u975e\u63a7\u5236\u8282\u70b9\u505a\u8ba4\u8bc1\u914d\u7f6e\u4e0a\u9996\u5148\u9700\u8981\u5728\u5bf9\u5e94\u7684\u63a7\u5236\u8282\u70b9\u4e0a\u6267\u884c: ",(0,i.jsx)(n.code,{children:"cat /root/.onecloud_rcadmin"}),"\uff1b\n\u5c06\u8f93\u51fa\u7684\u8ba4\u8bc1\u4fe1\u606f\u4fdd\u5b58\u5230\u672c\u5730\u7684\u6587\u4ef6\u4e2d\uff0c\u901a\u8fc7source\u547d\u4ee4\u8ba4\u8bc1\u914d\u7f6e\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u4ee5\u4e0b\u4e3a\u7528\u6237\u540d\uff0f\u5bc6\u7801\u8ba4\u8bc1\u7684\u914d\u7f6e\u6587\u4ef6\u6a21\u677f\uff0c\u901a\u8fc7OS_USERNAME, OS_DOMAIN_NAME, OS_PASSWORD, OS_PROJECT_NAME, OS_PROJECT_DOMAIN\u7b49\u5b57\u6bb5\u6307\u5b9a\u7528\u6237\u7684\u4fe1\u606f\u548c\u9879\u76ee\u7684\u4fe1\u606f\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u5728\u63a7\u5236\u8282\u70b9\u4e0a\u83b7\u53d6\u8ba4\u8bc1\u6240\u9700\u8981\u7684\u914d\u7f6e\u4fe1\u606f\u3002\n$ cat /root/.onecloud_rcadmin\nexport OS_AUTH_URL=https://192.168.0.246:5000/v3\nexport OS_USERNAME=sysadmin\nexport OS_PASSWORD=3hV3***84srk\nexport OS_PROJECT_NAME=system\nexport YUNION_INSECURE=true\nexport OS_REGION_NAME=region0\nexport OS_ENDPOINT_TYPE=publicURL\n\n# \u5c06\u4e0a\u8ff0\u8ba4\u8bc1\u4fe1\u606f\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\uff0c\u65b9\u4fbf source \u4f7f\u7528\n$ cat <<EOF > ~/test_rc_admin\n# keystone \u8ba4\u8bc1\u5730\u5740\nexport OS_AUTH_URL=https://192.168.0.246:5000/v3\n# \u7528\u6237\u540d\nexport OS_USERNAME=sysadmin\n# \u7528\u6237\u5bc6\u7801\nexport OS_PASSWORD=3hV3***84srk\n# \u7528\u6237\u6240\u5c5e\u9879\u76ee\u540d\u79f0\nexport OS_PROJECT_NAME=system\n# \u5141\u8bb8 insecure https \u8fde\u63a5\nexport YUNION_INSECURE=true\n# \u5bf9\u5e94\u7684 region\nexport OS_REGION_NAME=region0\n# endpoint \u7c7b\u578b\u4e3a public\nexport OS_ENDPOINT_TYPE=publicURL\nEOF\n"})}),"\n",(0,i.jsx)(n.h2,{id:"token\u8ba4\u8bc1",children:"token\u8ba4\u8bc1"}),"\n",(0,i.jsx)(n.p,{children:"\u53ef\u4ee5\u4f7f\u7528\u4e34\u65f6\u83b7\u5f97\u7684token\u8fdb\u884c\u8ba4\u8bc1\uff0c\u914d\u7f6e\u6587\u4ef6\u6a21\u677f\u5982\u4e0b\u6240\u793a\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u4e34\u65f6TOKEN\nexport OS_AUTH_TOKEN=gAAAAABlG_bcoWRX6BV0B5Sb3jN0Maoi......UOyDVGCy4-6_AglLh\n# \u9879\u76ee\u540d\u79f0\nexport OS_PROJECT_NAME=system\n# \u9879\u76ee\u5f52\u5c5e\u57df\u540d\u79f0\nexport OS_PROJECT_DOMAIN=Default\n# \u8ba4\u8bc1\u63a5\u53e3\nexport OS_AUTH_URL=https://192.168.0.246:5000/v3\n# \u4f7f\u7528\u670d\u52a1\u7684Endpoint\u7c7b\u578b\nexport OS_ENDPOINT_TYPE=public\n# \u662f\u5426\u7f13\u5b58token\nexport YUNION_USE_CACHED_TOKEN=false\n# \u662f\u5426\u4e0d\u9a8c\u8bc1TLS\u8bc1\u4e66\nexport YUNION_INSECURE=true\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u4e34\u65f6token\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0bclimc\u547d\u4ee4\u83b7\u53d6\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'$ climc session-show\n+-------------------+---------------------------------------------------------------------------------------------------------------------------+\n|       Field       |                                                           Value                                                           |\n+-------------------+---------------------------------------------------------------------------------------------------------------------------+\n| context           | {"ip":"192.168.0.246","source":"cli"}                                                                                     |\n| domain            | Yunion                                                                                                                    |\n| domain_id         | a0fc05a5ac5...c8d612c9631a1c                                                                                              |\n| domain_policies   | ["domain-admin"]                                                                                                          |\n| endpoint_type     | public                                                                                                                    |\n| expires           | 2023-10-04T13:35:25.485534Z                                                                                               |\n| project_domain    | Default                                                                                                                   |\n| project_domain_id | default                                                                                                                   |\n| project_policies  | []                                                                                                                        |\n| region            | YunionHQ                                                                                                                  |\n| role_ids          | 5fc1e5c088984e2....cb,e40d785012...682e3a0c647f340b5                                                                      |\n| roles             | admin,domainadmin                                                                                                         |\n| system_policies   | ["sysadmin"]                                                                                                              |\n| tenant            | system                                                                                                                    |\n| tenant_id         | a7f2e2a81a1e4850a41eae5f140ceb14                                                                                          |\n| token             | gAAAAABlHBidVk6AT58hAHjN3E6tYtliGE061xRSVARWtdW7Z.................................fIeJY3ToKLz-A19rSYql8RKzzG4EkrnKuYD_4NY |\n| user              | qiujian                                                                                                                   |\n| user_id           | 0d48cd5032970fe....c0d9022f9c2346fd                                                                                       |\n+-------------------+---------------------------------------------------------------------------------------------------------------------------+\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u901a\u8fc7access-keysecret\u8ba4\u8bc1",children:"\u901a\u8fc7Access Key\uff0fSecret\u8ba4\u8bc1"}),"\n",(0,i.jsx)(n.p,{children:"\u4ee5\u4e0b\u4e3aAccess Key/Secret\u8ba4\u8bc1\u7684\u914d\u7f6e\u6587\u4ef6\u6a21\u677f\uff0c\u901a\u8fc7OS_ACCESS_KEY, OS_SECRET_KEY\u7b49\u4e24\u4e2a\u5b57\u6bb5\u6307\u5b9a\u7528\u6237\u7684Access Key/secret\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# \u5728\u63a7\u5236\u8282\u70b9\u4e0a\u83b7\u53d6\u7528\u6237\u5728\u4e00\u4e2a\u9879\u76ee\u4e2d\u7684Access Key/Secret\n\n# \u751f\u6210 Secret Key\n$ climc credential-create-aksk\n+--------+----------------------------------------------+\n| Field  |                    Value                     |\n+--------+----------------------------------------------+\n| expire | 0                                            |\n| secret | VGFxZkE3QTd2MmhCbmZkVkJDcFZFaGJYdUQ2c05mUXM= |\n+--------+----------------------------------------------+\n\n# ID\u4e3a Access Key\n$ climc credential-list\n+-----------------------+------------+------------+-----------------------+---------+---------+-----------+---------+-----------------------+-------------+--------------+-----------------------+------+-----------------------+----------------------+----------+----------------------+\n|         blob          | can_delete | can_update |      created_at       | deleted | domain  | domain_id | enabled |          id           | is_emulated |     name     |      project_id       | type |    update_version     |      updated_at      |   user   |       user_id        |\n+-----------------------+------------+------------+-----------------------+---------+---------+-----------+---------+-----------------------+-------------+--------------+-----------------------+------+-----------------------+----------------------+----------+----------------------+\n| {"expire":0,"secret": | true       | true       | 2020-06-15T11:43:32.0 | false   | Default | default   | true    | 0d184a3c9c484e4c892f4 | false       | --1592221412 | d53ea650bfe144da8ee8f | aksk | 0                     | 2020-06-15T11:43:32. | sysadmin | a063d8e2cd584cc48194 |\n| "VGFxZkE3QTd2MmhCbmZk |            |            | 00000Z                |         |         |           |         | 855935e37e7           |             |              | 3fba417b904           |      |                       | 000000Z              |          | 5e7169280435         |\n| VkJDcFZFaGJYdUQ2c05mU |            |            |                       |         |         |           |         |                       |             |              |                       |      |                       |                      |          |                      |\n| XM="}                 |            |            |                       |         |         |           |         |                       |             |              |                       |      |                       |                      |          |                      |\n+-----------------------+------------+------------+-----------------------+---------+---------+-----------+---------+-----------------------+-------------+--------------+-----------------------+------+-----------------------+----------------------+----------+----------------------+\n***  Total: 1 Pages: 1 Limit: 2048 Offset: 0 Page: 1  ***\n\n# \u5c06\u8ba4\u8bc1\u4fe1\u606f\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\uff0c\u65b9\u4fbf source \u4f7f\u7528\n$ cat <<EOF > ~/test_rc_aksk\n# Access Key\nexport OS_ACCESS_KEY=0d184a3c9c484e4c892f4855935e37e7  \n# Secret, \u6ce8\u610f\u540e\u9762\u6709\u4e2a\'=\', \u4e0d\u8981\u5c11\u590d\u5236\nexport OS_SECRET_KEY=VG***5mUXM=\n# \u5141\u8bb8 insecure https \u8fde\u63a5\nexport YUNION_INSECURE=true\n# keystone \u8ba4\u8bc1\u5730\u5740\nexport OS_AUTH_URL=https://192.168.0.246:5000/v3\n# \u5bf9\u5e94\u7684 region\nexport OS_REGION_NAME=region0\nEOF\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u9a8c\u8bc1",children:"\u9a8c\u8bc1"}),"\n",(0,i.jsx)(n.p,{children:"\u6a21\u677f\u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u9a8c\u8bc1\u8ba4\u8bc1\u73af\u5883\u53d8\u91cf\u914d\u7f6e\u6210\u529f\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# source \u8ba4\u8bc1\u73af\u5883\u53d8\u91cf\n$ source ~/test_rc_admin\n# \u6216\u8005\u60f3\u8981\u4f7f\u7528 Access Key/Secret \u767b\u9646\n$ source ~/test_rc_aksk\n\n# \u6267\u884cclimc\u3002\u4f8b\u5982\uff0c\u67e5\u770b\u865a\u62df\u673a\u5217\u8868\n$ climc server-list --scope system\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u6ce8\u610f: \u5982\u679c\u6267\u884c climc \u65f6\u51fa\u73b0 ",(0,i.jsx)(n.em,{children:"Error: Missing OS_AUTH_URL"})," \u7684\u9519\u8bef\u63d0\u793a\u65f6\uff0c\u8bf7 source \u6216\u8bbe\u7f6e\u8ba4\u8bc1\u4e91\u5e73\u53f0\u7684\u73af\u5883\u53d8\u91cf\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u53ef\u4ee5\u901a\u8fc7\u67e5\u770b climc \u7684\u7248\u672c\u53f7\u6765\u83b7\u53d6\u6784\u5efa\u7684\u4fe1\u606f\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'$ climc --version\nYunion API client version:\n {\n  "major": "0",\n  "minor": "0",\n  "gitVersion": "v3.1.9-20200609.1",\n  "gitBranch": "tags/v3.1.8^0",\n  "gitCommit": "5591bbec4",\n  "gitTreeState": "clean",\n  "buildDate": "2020-06-09T12:00:48Z",\n  "goVersion": "go1.13.9",\n  "compiler": "gc",\n  "platform": "linux/amd64"\n}\n'})})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},28453:(e,n,c)=>{c.d(n,{R:()=>r,x:()=>o});var i=c(96540);const s={},t=i.createContext(s);function r(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);
"use strict";(self.webpackChunkdocs_new=self.webpackChunkdocs_new||[]).push([[7142],{10732:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>a,frontMatter:()=>s,metadata:()=>c,toc:()=>d});var r=i(74848),o=i(28453);const s={sidebar_position:4},t="\u81ea\u5b9a\u4e49PCI\u8bbe\u5907\u900f\u4f20",c={id:"guides/onpremise/vminstance/passthrough/custom-pci-devices",title:"\u81ea\u5b9a\u4e49PCI\u8bbe\u5907\u900f\u4f20",description:"\u5e73\u53f0\u5df2\u7ecf\u652f\u6301\u900f\u4f20 GPU, USB, SR-IOV NIC\uff0cNVME \u7b49\u7c7b\u578b\u7684\u8bbe\u5907\uff0c\u5bf9\u4e8e\u8fd9\u4e9b\u7c7b\u578b\u4e4b\u5916\u7684\u8bbe\u5907\uff0c\u4f8b\u5982\u901a\u8fc7\u81ea\u5b9a\u4e49 PCI \u8bbe\u5907\u7c7b\u578b\u7684\u65b9\u5f0f\u6765\u652f\u6301\u3002",source:"@site/docs/guides/onpremise/vminstance/passthrough/custom-pci-devices.md",sourceDirName:"guides/onpremise/vminstance/passthrough",slug:"/guides/onpremise/vminstance/passthrough/custom-pci-devices",permalink:"/docs/guides/onpremise/vminstance/passthrough/custom-pci-devices",draft:!1,unlisted:!1,editUrl:"https://github.com/yunionio/website/tree/master/docs/guides/onpremise/vminstance/passthrough/custom-pci-devices.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"\u7f51\u5361SR-IOV",permalink:"/docs/guides/onpremise/vminstance/passthrough/sriov"},next:{title:"USB \u900f\u4f20",permalink:"/docs/guides/onpremise/vminstance/passthrough/usb-passthrough"}},l={},d=[{value:"\u83b7\u53d6 PCI \u8bbe\u5907 vendor_id \u4e0e device_id",id:"\u83b7\u53d6-pci-\u8bbe\u5907-vendor_id-\u4e0e-device_id",level:2},{value:"\u6dfb\u52a0\u81ea\u5b9a\u4e49 PCI \u8bbe\u5907\u7c7b\u578b",id:"\u6dfb\u52a0\u81ea\u5b9a\u4e49-pci-\u8bbe\u5907\u7c7b\u578b",level:2},{value:"\u63a2\u6d4b\u81ea\u5b9a\u4e49PCI\u8bbe\u5907",id:"\u63a2\u6d4b\u81ea\u5b9a\u4e49pci\u8bbe\u5907",level:2},{value:"\u4f7f\u7528\u81ea\u5b9a\u4e49PCI\u8bbe\u5907",id:"\u4f7f\u7528\u81ea\u5b9a\u4e49pci\u8bbe\u5907",level:2},{value:"\u5bbf\u4e3b\u673a\u7981\u7528\u81ea\u5b9a\u4e49PCI\u8bbe\u5907",id:"\u5bbf\u4e3b\u673a\u7981\u7528\u81ea\u5b9a\u4e49pci\u8bbe\u5907",level:2}];function p(e){const n={code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"\u81ea\u5b9a\u4e49pci\u8bbe\u5907\u900f\u4f20",children:"\u81ea\u5b9a\u4e49PCI\u8bbe\u5907\u900f\u4f20"}),"\n",(0,r.jsx)(n.p,{children:"\u5e73\u53f0\u5df2\u7ecf\u652f\u6301\u900f\u4f20 GPU, USB, SR-IOV NIC\uff0cNVME \u7b49\u7c7b\u578b\u7684\u8bbe\u5907\uff0c\u5bf9\u4e8e\u8fd9\u4e9b\u7c7b\u578b\u4e4b\u5916\u7684\u8bbe\u5907\uff0c\u4f8b\u5982\u901a\u8fc7\u81ea\u5b9a\u4e49 PCI \u8bbe\u5907\u7c7b\u578b\u7684\u65b9\u5f0f\u6765\u652f\u6301\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u4f7f\u7528\u81ea\u5b9a\u4e49PCI\u900f\u4f20\u8bbe\u5907\u7684\u6b65\u9aa4\u5982\u4e0b\uff1a"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u83b7\u53d6\u8be5\u7c7b\u578bPCI\u8bbe\u5907\u7684vendor_id\u4e0edevice_id"}),"\n",(0,r.jsx)(n.li,{children:"\u5728\u5e73\u53f0\u6dfb\u52a0\u81ea\u5b9a\u4e49PCI\u8bbe\u5907\u7c7b\u578b"}),"\n",(0,r.jsx)(n.li,{children:"\u63a2\u6d4b\u6302\u8f7d\u5728\u5bbf\u4e3b\u673a\u4e0a\u7684\u81ea\u5b9a\u4e49PCI\u8bbe\u5907"}),"\n",(0,r.jsx)(n.li,{children:"\u5728\u5e73\u53f0\u5c06PCI\u8bbe\u5907\u548c\u865a\u62df\u673a\u7ed1\u5b9a\uff0c\u5728\u865a\u62df\u673a\u5185\u4f7f\u7528\u8be5\u8bbe\u5907"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u83b7\u53d6-pci-\u8bbe\u5907-vendor_id-\u4e0e-device_id",children:"\u83b7\u53d6 PCI \u8bbe\u5907 vendor_id \u4e0e device_id"}),"\n",(0,r.jsx)(n.p,{children:"\u6dfb\u52a0\u81ea\u5b9a\u4e49PCI\u8bbe\u5907\u7c7b\u578b\u4e4b\u524d\u9700\u8981\u83b7\u53d6\u8bbe\u5907\u7684 vendor_id \u548c device_id"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u767b\u9646\u5230\u6709\u8be5\u8bbe\u5907\u7684\u5bbf\u4e3b\u673a\u6267\u884c lspci\u627e\u5230\u5bf9\u5e94\u7684 pci \u8bbe\u5907\u7684\u5730\u5740\uff1a\neg:\n$ lspci\n00:00.0 Host bridge: Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 DMI2 (rev 04)\n00:01.0 PCI bridge: Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 PCI Express Root Port 1a (rev 04)\n00:02.0 PCI bridge: Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 PCI Express Root Port 2a (rev 04)\n00:03.0 PCI bridge: Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 PCI Express Root Port 3a (rev 04)\n00:05.0 System peripheral: Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 VTd/Memory Map/Misc (rev 04)\n00:05.2 System peripheral: Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 IIO RAS (rev 04)\n00:05.4 PIC: Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 IOAPIC (rev 04)\n00:11.0 PCI bridge: Intel Corporation C600/X79 series chipset PCI Express Virtual Root Port (rev 06)\n00:16.0 Communication controller: Intel Corporation C600/X79 series chipset MEI Controller #1 (rev 05)\n00:19.0 Ethernet controller: Intel Corporation 82579LM Gigabit Network Connection (Lewisville) (rev 06)\n00:1a.0 USB controller: Intel Corporation C600/X79 series chipset USB2 Enhanced Host Controller #2 (rev 06)\n00:1b.0 Audio device: Intel Corporation C600/X79 series chipset High Definition Audio Controller (rev 06)\n00:1c.0 PCI bridge: Intel Corporation C600/X79 series chipset PCI Express Root Port 3 (rev b6)\n00:1c.4 PCI bridge: Intel Corporation C600/X79 series chipset PCI Express Root Port 5 (rev b6)\n00:1d.0 USB controller: Intel Corporation C600/X79 series chipset USB2 Enhanced Host Controller #1 (rev 06)\n00:1e.0 PCI bridge: Intel Corporation 82801 PCI Bridge (rev a6)\n00:1f.0 ISA bridge: Intel Corporation C600/X79 series chipset LPC Controller (rev 06)\n00:1f.2 RAID bus controller: Intel Corporation C600/X79 series chipset SATA RAID Controller (rev 06)\n00:1f.3 SMBus: Intel Corporation C600/X79 series chipset SMBus Host Controller (rev 06)\n02:00.0 VGA compatible controller: NVIDIA Corporation GK107GL [Quadro K420] (rev a1)\n\n\u6839\u636e pci \u5730\u5740\u83b7\u53d6 vendor_id \u4e0e device_id:\nlspci -n -s <PCI_ADDR>\neg:\nlspci -n -s 02:00.0\n02:00.0 0300: 10de:0ff3 (rev a1)\n10de \u4e3a vendor_id, 0ff3 \u4e3a device_id\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u6dfb\u52a0\u81ea\u5b9a\u4e49-pci-\u8bbe\u5907\u7c7b\u578b",children:"\u6dfb\u52a0\u81ea\u5b9a\u4e49 PCI \u8bbe\u5907\u7c7b\u578b"}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u4e91\u5e73\u53f0\u521b\u5efa\u81ea\u5b9a\u4e49pci\u8bbe\u5907\u7c7b\u578b"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"climc isolated-device-model-create\nUsage: climc isolated-device-model-create [--help] [--hosts HOSTS] <MODEL> <DEV_TYPE> <VENDOR_ID> <DEVICE_ID>\n\n# --hosts \u4e3a\u9700\u8981\u63a2\u6d4b\u626b\u63cf PCI \u8bbe\u5907\u7684\u5bbf\u4e3b\u673a\uff0c\u5982\u679c\u672a\u586b\u53ef\u91cd\u542f host-agent \u751f\u6548\u3002\u5982\u679c\u5bbf\u4e3b\u673a\u6570\u91cf\u8f83\u591a\u5efa\u8bae\u76f4\u63a5\u91cd\u542f host-agent\n# <MODEL> \u4e3a PCI \u8bbe\u5907\u578b\u53f7\n# <DEV_TYPE> \u4e3a\u8bbe\u5907\u7c7b\u578b\uff0c\u5982 NPU\u3002\u5bf9\u4e8e\u5df2\u7ecf\u652f\u6301\u7684\u8bbe\u5907\u7c7b\u578b USB, GPU-HPC, GPU-VGA, NIC \u7b49\u4e0d\u80fd\u518d\u6b21\u521b\u5efa\u3002\n# <VENDOR_ID> <DEVICE_ID> \u4e3a\u5382\u5546ID\u548c\u8bbe\u5907ID\n\n\neg:\nclimc isolated-device-model-create --hosts host1 Atlas-800 NPU 1a03 2000\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u63a2\u6d4b\u81ea\u5b9a\u4e49pci\u8bbe\u5907",children:"\u63a2\u6d4b\u81ea\u5b9a\u4e49PCI\u8bbe\u5907"}),"\n",(0,r.jsx)(n.p,{children:"\u5b9a\u4e49\u81ea\u5b9a\u4e49PCI\u8bbe\u5907\u7c7b\u578b\u540e\uff0c\u9700\u8981\u5728\u6307\u5b9a\u5bbf\u4e3b\u673a\u63a2\u6d4b\u5e76\u4e0a\u62a5\u8be5\u5bbf\u4e3b\u673a\u4e0a\u6302\u8f7d\u7684\u81ea\u5b9a\u4e49PCI\u8bbe\u5907\uff0c\u5177\u4f53\u65b9\u6cd5\u6709\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4f7f\u7528\u5982\u4e0bclimc\u547d\u4ee4"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ climc isolated-device-list  --host oc-node-1-192-168-121-21\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u8bbf\u95ee\u524d\u7aefWebUI\uff0c\u6307\u5b9a\u6307\u5b9a\u5bbf\u4e3b\u673a\u7684\u8be6\u60c5-\u900f\u4f20\u8bbe\u5907\u5217\u8868"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u91cd\u542f\u8be5\u5bbf\u4e3b\u673a\u4e0a\u7684default-host\u5bb9\u5668"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u6267\u884c\u4ee5\u4e0a\u4efb\u610f\u64cd\u4f5c\u540e\uff0c\u5982\u679c\u914d\u7f6e\u6b63\u786e\uff0c\u5219\u53ef\u4ee5\u5728\u8be5\u5bbf\u4e3b\u673a\u7684\u900f\u4f20\u8bbe\u5907\u5217\u8868\u67e5\u770b\u5230\u4e0a\u62a5\u7684\u900f\u4f20\u8bbe\u5907"}),"\n",(0,r.jsx)(n.h2,{id:"\u4f7f\u7528\u81ea\u5b9a\u4e49pci\u8bbe\u5907",children:"\u4f7f\u7528\u81ea\u5b9a\u4e49PCI\u8bbe\u5907"}),"\n",(0,r.jsx)(n.p,{children:"\u6dfb\u52a0\u81ea\u5b9a\u4e49 PCI \u8bbe\u5907\u7c7b\u578b\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u5728\u521b\u5efa\u865a\u673a\u9009\u62e9\u81ea\u5b9a\u4e49\u8bbe\u5907\u7c7b\u578b\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"climc server-create --isolated-device 'Atlas-800' ......\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u67e5\u770b\u81ea\u5b9a\u4e49 PCI \u8bbe\u5907\u7c7b\u578b\u5217\u8868"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"climc isolated-device-model-list\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u5bbf\u4e3b\u673a\u7981\u7528\u81ea\u5b9a\u4e49pci\u8bbe\u5907",children:"\u5bbf\u4e3b\u673a\u7981\u7528\u81ea\u5b9a\u4e49PCI\u8bbe\u5907"}),"\n",(0,r.jsx)(n.p,{children:"\u5728 /etc/yunion/host.conf \u4e2d\u6dfb\u52a0"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"disable_custom_device: true\n"})})]})}function a(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>c});var r=i(96540);const o={},s=r.createContext(o);function t(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);
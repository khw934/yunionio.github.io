"use strict";(self.webpackChunkdocs_new=self.webpackChunkdocs_new||[]).push([[4847],{32296:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>a});var t=n(74848),r=n(28453);const i={sidebar_position:5},c="\u8fc1\u79fb\u78c1\u76d8\u5b58\u50a8",o={id:"guides/onpremise/vminstance/change-disk-storge",title:"\u8fc1\u79fb\u78c1\u76d8\u5b58\u50a8",description:"\u4ecb\u7ecd\u5982\u4f55\u628a\u865a\u62df\u673a\u7684\u78c1\u76d8\u8fc1\u79fb\u5230\u53e6\u4e00\u4e2a\u5b58\u50a8\u3002",source:"@site/docs/guides/onpremise/vminstance/change-disk-storge.md",sourceDirName:"guides/onpremise/vminstance",slug:"/guides/onpremise/vminstance/change-disk-storge",permalink:"/guides/onpremise/vminstance/change-disk-storge",draft:!1,unlisted:!1,editUrl:"https://github.com/yunionio/website/tree/master/docs/guides/onpremise/vminstance/change-disk-storge.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"QGA \u4f7f\u7528\u4ecb\u7ecd",permalink:"/guides/onpremise/vminstance/qga"},next:{title:"\u865a\u62df\u673a\u8fc1\u79fb",permalink:"/guides/onpremise/vminstance/migrate"}},d={},a=[{value:"Ceph RBD \u78c1\u76d8\u8fc1\u79fb\u5230\u672c\u5730\u5b58\u50a8",id:"ceph-rbd-\u78c1\u76d8\u8fc1\u79fb\u5230\u672c\u5730\u5b58\u50a8",level:2},{value:"\u672c\u5730\u78c1\u76d8\u8fc1\u79fb\u5230 Ceph RBD \u5b58\u50a8",id:"\u672c\u5730\u78c1\u76d8\u8fc1\u79fb\u5230-ceph-rbd-\u5b58\u50a8",level:2},{value:"Ceph RBD \u78c1\u76d8\u8fc1\u79fb\u5230\u53e6\u4e00\u4e2a Ceph \u5b58\u50a8",id:"ceph-rbd-\u78c1\u76d8\u8fc1\u79fb\u5230\u53e6\u4e00\u4e2a-ceph-\u5b58\u50a8",level:2},{value:"\u4e24\u4e2a Ceph \u96c6\u7fa4\u63a5\u53e3\u517c\u5bb9",id:"\u4e24\u4e2a-ceph-\u96c6\u7fa4\u63a5\u53e3\u517c\u5bb9",level:3},{value:"\u4e24\u4e2a Ceph \u96c6\u7fa4\u4e0d\u517c\u5bb9",id:"\u4e24\u4e2a-ceph-\u96c6\u7fa4\u4e0d\u517c\u5bb9",level:3},{value:"\u5176\u4ed6\u6ce8\u610f\u4e8b\u9879",id:"\u5176\u4ed6\u6ce8\u610f\u4e8b\u9879",level:2},{value:"\u78c1\u76d8\u66f4\u6539\u5b58\u50a8\u7684\u539f\u7406",id:"\u78c1\u76d8\u66f4\u6539\u5b58\u50a8\u7684\u539f\u7406",level:2}];function l(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h1,{id:"\u8fc1\u79fb\u78c1\u76d8\u5b58\u50a8",children:"\u8fc1\u79fb\u78c1\u76d8\u5b58\u50a8"}),"\n",(0,t.jsx)(s.p,{children:"\u4ecb\u7ecd\u5982\u4f55\u628a\u865a\u62df\u673a\u7684\u78c1\u76d8\u8fc1\u79fb\u5230\u53e6\u4e00\u4e2a\u5b58\u50a8\u3002"}),"\n",(0,t.jsx)(s.p,{children:"\u5728 v3.9.4 \u7248\u672c\u540e\u53ef\u4ee5\u628a\u865a\u62df\u673a\u7684\u78c1\u76d8\u8fc1\u79fb\u5230\u53e6\u4e00\u4e2a\u5b58\u50a8\uff0c\u5e94\u7528\u573a\u666f\u5982\u4e0b\uff1a"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Ceph RBD \u78c1\u76d8\u8fc1\u79fb\u5230\u672c\u5730\u5b58\u50a8"}),"\n",(0,t.jsx)(s.li,{children:"\u672c\u5730\u78c1\u76d8\u8fc1\u79fb\u5230 Ceph \u5b58\u50a8"}),"\n",(0,t.jsx)(s.li,{children:"Ceph RBD \u78c1\u76d8\u8fc1\u79fb\u5230\u53e6\u4e00\u4e2a Ceph \u5b58\u50a8"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"\u53e6\u5916\u9650\u5236\u6761\u4ef6\u5982\u4e0b\uff1a"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"\u4e92\u76f8\u8fc1\u79fb\u7684\u4e24\u4e2a\u5b58\u50a8\u5fc5\u987b\u6302\u8f7d\u5230\u865a\u62df\u673a\u6240\u5728\u7684\u5bbf\u4e3b\u673a"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"\u5047\u8bbe\u73af\u5883\u4e2d\u4e00\u53f0\u540d\u53eb x86-node01-11-10-1-180-11 \u7684\u5bbf\u4e3b\u673a\u5206\u522b\u6302\u8f7d\u4e86\u4e00\u4e2a Ceph \u5b58\u50a8\u548c\u4e00\u4e2a\u672c\u5730\u5b58\u50a8\uff0c\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u53ef\u4ee5\u67e5\u8bad\u5230\u8fd9\u53f0\u5bbf\u4e3b\u673a\u4e0a\u6302\u8f7d\u7684\u5b58\u50a8\uff1a"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"$ climc host-storage-list --host x86-node01-11-10-1-180-11 --details\n+----------------------------------+----------------------------+-----------+---------------+----------------+\n|             Storage              |        Mount_point         | Capacity  | Used_capacity | Waste_capacity |\n+----------------------------------+----------------------------+-----------+---------------+----------------+\n| wz_rbd                           | rbd:rbd                    | 241013618 | 1556480       | 30720          |\n| host_10.1.180.11_local_storage_0 | /opt/cloud/workspace/disks | 681664    | 696320        | 0              |\n+----------------------------------+----------------------------+-----------+---------------+----------------+\n"})}),"\n",(0,t.jsxs)(s.p,{children:["\u901a\u8fc7\u4e0a\u9762\u7684 ",(0,t.jsx)(s.code,{children:"climc host-storage-list"})," \u547d\u4ee4\u627e\u5230 x86-node01-11-10-1-180-11 \u8fd9\u53f0\u5bbf\u4e3b\u673a\u4e0a\u9762\u6709 2 \u4e2a\u5b58\u50a8\uff0cCeph RBD \u5b58\u50a8\u4e3a wz_rbd\uff0c\u672c\u5730\u5b58\u50a8\u4e3a host_10.1.180.11_local_storage_0 \u3002"]}),"\n",(0,t.jsx)(s.h2,{id:"ceph-rbd-\u78c1\u76d8\u8fc1\u79fb\u5230\u672c\u5730\u5b58\u50a8",children:"Ceph RBD \u78c1\u76d8\u8fc1\u79fb\u5230\u672c\u5730\u5b58\u50a8"}),"\n",(0,t.jsx)(s.p,{children:"\u4e0b\u9762\u547d\u4ee4\u6d4b\u8bd5\u521b\u5efa\u4e00\u53f0\u865a\u62df\u673a\u5230 wz_rbd Ceph \u5b58\u50a8\uff0c\u7136\u540e\u628a\u78c1\u76d8\u8fc1\u79fb\u5230 host_10.1.180.11_local_storage_0 \u672c\u5730\u5b58\u50a8\u3002"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# \u9996\u5148\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a tvm-wz \u865a\u62df\u673a\uff0c\u78c1\u76d8\u4f7f\u7528 rbd\uff0c\u6307\u5b9a\u521b\u5efa\u5230\u5bbf\u4e3b\u673a\n$ climc server-create --disk CentOS-7.6.1810-20190430.qcow2:rbd \\\n    --net vm-test-net \\\n    --mem-spec 1g \\\n    --ncpu 1 \\\n    --allow-delete \\\n    --auto-start \\\n    --prefer-host x86-node01-11-10-1-180-11 \\\n    tvm-wz\n\n# \u67e5\u770b\u865a\u62df\u673a\u7684\u78c1\u76d8\u4fe1\u606f\n# \u627e\u5230\u5bf9\u5e94\u7684\u78c1\u76d8\u540d\u79f0\u4e3a vdisk-tvm-wz-1636100820075603665\n$ climc server-disk-list --server tvm --details\n+-------+--------------------------------------+-------------------------------+-----------+--------+------------+-------+--------+-----------+--------------+\n| Guest |               Disk_ID                |             Disk              | Disk_size | Driver | Cache_mode | Index | Status | Disk_type | Storage_type |\n+-------+--------------------------------------+-------------------------------+-----------+--------+------------+-------+--------+-----------+--------------+\n| tvm-wz| 65ca88b1-186f-440a-8930-b4914e62cb3d | vdisk-tvm-wz-1636100820075603665 | 30720     | scsi   | none       | 0     | ready  | sys       | rbd       |\n+-------+--------------------------------------+-------------------------------+-----------+--------+------------+-------+--------+-----------+--------------+\n\n# \u67e5\u770b\u78c1\u76d8 vdisk-tvm-wz-1636100820075603665 \u6240\u5728\u7684\u5b58\u50a8\u4e3a h3c_blockpool1\n$ climc disk-show vdisk-tvm-wz-1636100820075603665 | grep storage\n| storage                   | wz_rbd                                                                  |\n| storage_status            | online                                                                  |\n| storage_type              | rbd                                                                     |\n"})}),"\n",(0,t.jsx)(s.p,{children:"\u73b0\u5728\u5df2\u7ecf\u521b\u5efa\u597d\u4f7f\u7528 wz_rbd Ceph \u5b58\u50a8\u7684\u865a\u62df\u673a\u4e86\uff0c\u63a5\u4e0b\u6765\u628a\u8fd9\u4e2a tvm-wz \u865a\u62df\u673a\u7684 vdisk-tvm-wz-1636100820075603665 \u78c1\u76d8\u8fc1\u79fb\u5230\u672c\u5730\u5b58\u50a8\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# \u5c06\u865a\u62df\u673a\u5173\u673a\u624d\u80fd\u8fdb\u884c\u78c1\u76d8\u8fc1\u79fb\u5b58\u50a8\n$ climc server-stop tvm-wz\n\n# \u6267\u884c\u4e0b\u9762\u7684 server-change-disk-storage \u547d\u4ee4\u628a tvm \u865a\u62df\u673a\u7684 vdisk-tvm-1636100820075603665 \u78c1\u76d8\u8fc1\u79fb\u5230\u672c\u5730\u5b58\u50a8\n$ climc server-change-disk-storage tvm-wz vdisk-tvm-wz-1636100820075603665 host_10.1.180.11_local_storage_0\n\n# \u7136\u540e\u67e5\u770b\u865a\u62df\u673a\u7684\u72b6\u6001\uff0c\u78c1\u76d8\u8fc1\u79fb\u5b58\u50a8\u865a\u62df\u673a\u4f1a\u5904\u4e8e disk_change_storage \u7684\u72b6\u6001\n$ climc server-list --search tvm-wz --details --scope system\n| 329bfce5-135f-4113-861e-bd44b8aaf9e0 | tvm-wz | postpaid     | 10.2.18.252 | 30720 | disk_change_storage      | 1          | 1024      | Default  | default  |\n\n# \u7b49\u5f85\u865a\u62df\u673a\u72b6\u6001\u53d8\u4e3a ready \u8868\u793a\u8fc1\u79fb\u5b8c\u6bd5\n# \u7136\u540e\u518d\u67e5\u770b\u865a\u62df\u673a\u7684\u78c1\u76d8\u4e3a vdisk-tvm-wz-1636103786977105704\n$ climc server-disk-list --server tvm-wz --details                                                                                    \n+--------+--------------------------------------+----------------------------------+-----------+--------+------------+-------+--------+-----------+--------------+\n| Guest  |               Disk_ID                |               Disk               | Disk_size | Driver | Cache_mode | Index | Status | Disk_type | Storage_type |\n+--------+--------------------------------------+----------------------------------+-----------+--------+------------+-------+--------+-----------+--------------+\n| tvm-wz | 61e4f0e4-597a-4aa9-8cde-0369879b9236 | vdisk-tvm-wz-1636103786977105704 | 30720     | scsi   | none       | 0     | ready  | sys       | local        |\n+--------+--------------------------------------+----------------------------------+-----------+--------+------------+-------+--------+-----------+--------------+\n\n# \u67e5\u770b\u65b0\u7684\u78c1\u76d8 vdisk-tvm-wz-1636103786977105704 \u7684\u5b58\u50a8\uff0c\u53d1\u73b0\u5df2\u7ecf\u53d8\u4e3a\u672c\u5730\u5b58\u50a8\u4e86\n$ climc disk-show  vdisk-tvm-wz-1636103786977105704 | grep storage\n| storage                   | host_10.1.180.11_local_storage_0                                                 |\n| storage_id                | 4484274b-8483-4166-8e3f-f3c37c4b4997                                             |\n| storage_status            | online                                                                           |\n| storage_type              | local                                                                            |\n"})}),"\n",(0,t.jsx)(s.h2,{id:"\u672c\u5730\u78c1\u76d8\u8fc1\u79fb\u5230-ceph-rbd-\u5b58\u50a8",children:"\u672c\u5730\u78c1\u76d8\u8fc1\u79fb\u5230 Ceph RBD \u5b58\u50a8"}),"\n",(0,t.jsx)(s.p,{children:"\u8fd8\u662f\u5229\u7528\u4e4b\u524d\u521b\u5efa\u597d\u7684 tvm-wz \u865a\u62df\u673a\uff0c\u73b0\u5728\u865a\u62df\u673a\u7684\u78c1\u76d8\u4e3a\u672c\u5730\u7684 vdisk-tvm-wz-1636103786977105704 \u78c1\u76d8\uff0c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u628a\u8be5\u78c1\u76d8\u8fc1\u79fb\u5230 wz_rbd Ceph \u5b58\u50a8\u3002"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# \u8fc1\u79fb\u672c\u5730\u78c1\u76d8\u5230 wz_rbd\n$ climc server-change-disk-storage tvm-wz vdisk-tvm-wz-1636103786977105704 wz_rbd\n\n# \u7b49\u5f85\u8fc1\u79fb\u5b8c\u6210\u540e\uff0c\u518d\u6267\u884c\u4e4b\u524d\u7684\u547d\u4ee4\u67e5\u770b\u5148\u5728\u865a\u62df\u673a\u7684\u78c1\u76d8\uff0c\u53d1\u73b0\u5df2\u7ecf\u4f7f\u7528 wz_rbd \u5b58\u50a8\u4e86\n# \u65b0\u7684\u78c1\u76d8\u4e3a vdisk-tvm-wz-1636104909252150575\n$ climc server-disk-list --server tvm-wz --details                                                                                    \n+--------+----------------------------------+-----------+--------+------------+-------+--------+-----------+--------------+\n| Guest  |               Disk               | Disk_size | Driver | Cache_mode | Index | Status | Disk_type | Storage_type |\n+--------+----------------------------------+-----------+--------+------------+-------+--------+-----------+--------------+\n| tvm-wz | vdisk-tvm-wz-1636104909252150575 | 30720     | scsi   | none       | 0     | ready  | sys       | rbd          |\n+--------+----------------------------------+-----------+--------+------------+-------+--------+-----------+--------------+\n\n$ climc disk-show vdisk-tvm-wz-1636104909252150575 | grep storage\n| storage                   | wz_rbd                                |\n| storage_id                | 061342a6-8f5a-4bc6-8757-8bb6c12bda83  |\n| storage_status            | online                                |\n| storage_type              | rbd                                   |\n"})}),"\n",(0,t.jsx)(s.p,{children:"\u6d4b\u8bd5\u8fc1\u79fb\u5b8c\u6210\u540e\uff0c\u628a\u865a\u62df\u673a\u5f00\u673a\uff0c\u80fd\u591f\u6b63\u5e38\u542f\u52a8\uff0c\u5e76\u4e14\u91cc\u9762\u6ca1\u6709\u6570\u636e\u4e22\u5931\uff0c\u5c31\u6ca1\u6709\u95ee\u9898\u3002"}),"\n",(0,t.jsx)(s.h2,{id:"ceph-rbd-\u78c1\u76d8\u8fc1\u79fb\u5230\u53e6\u4e00\u4e2a-ceph-\u5b58\u50a8",children:"Ceph RBD \u78c1\u76d8\u8fc1\u79fb\u5230\u53e6\u4e00\u4e2a Ceph \u5b58\u50a8"}),"\n",(0,t.jsx)(s.h3,{id:"\u4e24\u4e2a-ceph-\u96c6\u7fa4\u63a5\u53e3\u517c\u5bb9",children:"\u4e24\u4e2a Ceph \u96c6\u7fa4\u63a5\u53e3\u517c\u5bb9"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"\u6ce8\u610f"}),"\uff1a\u8fd9\u79cd\u65b9\u6cd5\u9002\u7528\u4e8e\u6e90 Ceph \u548c\u76ee\u6807 Ceph \u96c6\u7fa4\u517c\u5bb9\u7684\u60c5\u51b5\uff0c\u4f9d\u8d56\u7684 rbd \u52a8\u6001\u5e93\u4e00\u81f4\u624d\u884c\uff0c\u4e0d\u7136\u4f1a\u5931\u8d25\u3002"]}),"\n",(0,t.jsx)(s.p,{children:"\u5047\u8bbe\u73af\u5883\u4e2d\u6709\u53e6\u5916\u4e00\u4e2a\u53eb\u505a wz_rbd \u7684 Ceph \u5b58\u50a8\uff0c\u4e0b\u9762\u547d\u4ee4\u6d4b\u8bd5\u521b\u5efa\u4e00\u53f0\u865a\u62df\u673a\u5230 h3c_blockpool1 Ceph \u5b58\u50a8\uff0c\u7136\u540e\u628a\u78c1\u76d8\u8fc1\u79fb\u5230\u4e00\u4e2a\u540d\u4e3a wz_rbd \u7684 Ceph \u5b58\u50a8\u3002"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# \u9996\u5148\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a tvm \u865a\u62df\u673a\uff0c\u78c1\u76d8\u4f7f\u7528 rbd\uff0c\u6307\u5b9a\u521b\u5efa\u5230\u5bbf\u4e3b\u673a\n$ climc server-create --disk CentOS-7.6.1810-20190430.qcow2:rbd \\\n    --net vm-test-net \\\n    --mem-spec 1g \\\n    --ncpu 1 \\\n    --allow-delete \\\n    --auto-start \\\n    --prefer-host x86-node03-13-10-1-180-13 \\\n    tvm\n\n# \u67e5\u770b\u865a\u62df\u673a\u7684\u78c1\u76d8\u4fe1\u606f\n# \u627e\u5230\u5bf9\u5e94\u7684\u78c1\u76d8\u540d\u79f0\u4e3a vdisk-tvm-1636100820075603665\n$ climc server-disk-list --server tvm --details\n+-------+--------------------------------------+-------------------------------+-----------+--------+------------+-------+--------+-----------+--------------+\n| Guest |               Disk_ID                |             Disk              | Disk_size | Driver | Cache_mode | Index | Status | Disk_type | Storage_type |\n+-------+--------------------------------------+-------------------------------+-----------+--------+------------+-------+--------+-----------+--------------+\n| tvm   | 65ca88b1-186f-440a-8930-b4914e62cb3d | vdisk-tvm-1636100820075603665 | 30720     | scsi   | none       | 0     | ready  | sys       | rbd          |\n+-------+--------------------------------------+-------------------------------+-----------+--------+------------+-------+--------+-----------+--------------+\n\n# \u67e5\u770b\u78c1\u76d8 vdisk-tvm-1636100820075603665 \u6240\u5728\u7684\u5b58\u50a8\u4e3a h3c_blockpool1\n$ climc disk-show vdisk-tvm-1636100820075603665 | grep storage\n| storage                   | h3c_blockpool1                                                                  |\n| storage_id                | 0bf0cf3c-8cc8-47bb-8d1e-ab97f103e267                                            |\n| storage_status            | online                                                                          |\n| storage_type              | rbd                                                                             |\n"})}),"\n",(0,t.jsx)(s.p,{children:"\u73b0\u5728\u5df2\u7ecf\u521b\u5efa\u597d\u4f7f\u7528 h3c_blockpool1 Ceph \u5b58\u50a8\u7684\u865a\u62df\u673a\u4e86\uff0c\u63a5\u4e0b\u6765\u628a\u8fd9\u4e2a tvm \u865a\u62df\u673a\u7684 vdisk-tvm-1636100820075603665 \u78c1\u76d8\u8fc1\u79fb\u5230\u53e6\u4e00\u4e2a Ceph \u5b58\u50a8 wz_rbd\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# \u9996\u5148\u9700\u8981\u628a wz_rbd \u5b58\u50a8\u6302\u8f7d\u5230\u865a\u62df\u673a\u6240\u5728\u7684\u5bbf\u4e3b\u673a x86-node03-13-10-1-180-13\n$ climc host-storage-attach x86-node03-13-10-1-180-13 wz_rbd\n\n# \u67e5\u770b\u5bbf\u4e3b\u673a\u4e0a\u6302\u8f7d\u7684\u5b58\u50a8\uff0c\u4f1a\u53d1\u73b0\u591a\u4e00\u5757\u5b58\u50a8 wz_rbd\n$ climc host-storage-list --host x86-node03-13-10-1-180-13 --details\n+----------------------------------+----------------------------+-----------+---------------+----------------+---------------+----------+\n|             Storage              |        Mount_point         | Capacity  | Used_capacity | Waste_capacity | Free_capacity | cmtbound |\n+----------------------------------+----------------------------+-----------+---------------+----------------+---------------+----------+\n| wz_rbd                           | rbd:rbd                    | 241018691 | 1525760       | 30720          | 239462208     | 1        |\n| h3c_blockpool1                   | rbd:.HDDdisk.rbd           | 192653544 | 122880        | 0              | 192530656     | 1        |\n| host_10.1.180.13_local_storage_0 | /opt/cloud/workspace/disks | 681664    | 61440         | 0              | 620224        | 1        |\n+----------------------------------+----------------------------+-----------+---------------+----------------+---------------+----------+\n\n# \u5c06\u865a\u62df\u673a\u5173\u673a\u624d\u80fd\u8fdb\u884c\u78c1\u76d8\u8fc1\u79fb\u5b58\u50a8\n$ climc server-stop tvm\n\n# \u6267\u884c\u4e0b\u9762\u7684 server-change-disk-storage \u547d\u4ee4\u628a tvm \u865a\u62df\u673a\u7684 vdisk-tvm-1636100820075603665 \u78c1\u76d8\u8fc1\u79fb\u5230 wz_rbd \u5b58\u50a8\n$ climc server-change-disk-storage tvm vdisk-tvm-1636100820075603665 wz_rbd\n"})}),"\n",(0,t.jsx)(s.h3,{id:"\u4e24\u4e2a-ceph-\u96c6\u7fa4\u4e0d\u517c\u5bb9",children:"\u4e24\u4e2a Ceph \u96c6\u7fa4\u4e0d\u517c\u5bb9"}),"\n",(0,t.jsx)(s.p,{children:"\u5982\u679c\u4e24\u4e2a Ceph \u96c6\u7fa4\u4e0d\u517c\u5bb9\uff0c\u6bd4\u5982\u4e00\u8fb9\u7528\u7684\u5f00\u6e90 Ceph \u96c6\u7fa4\uff0c\u53e6\u5916\u4e00\u8fb9\u7528\u7684\u662f\u5546\u4e1a Ceph \u96c6\u7fa4\uff0c\u4e24\u5957\u96c6\u7fa4\u7684\u52a8\u6001\u5e93\u4e0d\u4e00\u81f4\u5c31\u65e0\u6cd5\u628a\u4e24\u4e2a Ceph \u5b58\u50a8\u6302\u8f7d\u5230\u5e73\u53f0\u7684\u4e00\u53f0\u5bbf\u4e3b\u673a\u4e0a\u3002"}),"\n",(0,t.jsx)(s.p,{children:"\u9047\u5230\u8fd9\u79cd\u60c5\u51b5\u53ef\u4ee5\u91c7\u53d6\u4e00\u4e2a\u5229\u7528 NFS \u5b58\u50a8\u4f5c\u4e3a\u4e2d\u8f6c\u7684\u53d8\u901a\u89e3\u51b3\u65b9\u6848\uff0c\u5047\u8bbe host1 \u8ba1\u7b97\u8282\u70b9\u6302\u8f7d\u4e86 Ceph1\uff0c\u4e0a\u9762\u6709\u53f0\u865a\u62df\u673a vm \u4f7f\u7528\u4e86 Ceph1\uff0c\u8981\u628a vm \u8fc1\u79fb\u5230 host2 \u7684 Ceph2 \u96c6\u7fa4\u91cc\u9762\uff0c\u6b65\u9aa4\u5982\u4e0b\uff1a"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"\u81ea\u5df1\u642d\u5efa\u4e00\u4e2a NFS \u670d\u52a1\uff0c\u5728\u4e91\u5e73\u53f0\u524d\u7aef\u521b\u5efa NFS \u5b58\u50a8"}),"\n",(0,t.jsx)(s.li,{children:"\u7136\u540e\u5728\u5e73\u53f0\u524d\u7aef\u628a\u8fd9\u4e2a NFS \u5b58\u50a8\u5206\u522b\u6302\u8f7d\u5230 host1 \u548c host2"}),"\n",(0,t.jsx)(s.li,{children:"\u628a host1 \u4e0a\u7684 vm \u8c03\u7528 server-change-disk-storage \u628a Ceph1 \u91cc\u9762\u7684\u78c1\u76d8\u8fc1\u79fb\u5230 NFS \u5b58\u50a8"}),"\n",(0,t.jsx)(s.li,{children:"\u7136\u540e\u8c03\u7528 server-migrate \u547d\u4ee4\u6216\u8005\u53bb\u524d\u6bb5\u8fdb\u884c\u8fc1\u79fb\u64cd\u4f5c\uff0c\u628a vm \u8fc1\u79fb\u5230 host2"}),"\n",(0,t.jsx)(s.li,{children:"\u6700\u540e\u518d\u8c03\u7528 server-change-disk-storage \u628a host2 \u4e0a\u7684 vm \u78c1\u76d8\u8fc1\u79fb\u5230 Ceph2"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"\u63a5\u4e0b\u6765\u662f\u64cd\u4f5c\u7684\u547d\u4ee4\u884c\u6b65\u9aa4\uff1a"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# \u5047\u8bbe NFS \u670d\u52a1\u5668\u7684\u5730\u5740\u4e3a 172.16.254.124\n# \u5171\u4eab\u7684\u76ee\u5f55\u4e3a /opt/nfs_data\n# \u5728\u5e73\u53f0\u521b\u5efa\u5bf9\u5e94\u7684 nfs-store \u5b58\u50a8\n$ climc storage-create --storage-type nfs \\\n    --capacity 1024000 \\ # \u5bb9\u91cf\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u586b\u5199\n    --nfs-host 172.16.254.124 \\\n    --nfs-shared-dir '/opt/nfs_data' \\\n    nfs-store zone0\n\n# \u7136\u540e\u628a nfs-store \u6302\u8f7d\u5230 host1 \u548c host2 \u7684 /opt/nfs_share \u76ee\u5f55\n# \u9700\u8981\u767b\u5f55 host1 \u548c host2 \u521b\u5efa /opt/nfs_share \u76ee\u5f55\n[root@host1] $ mkdir -p /opt/nfs_share\n[root@host2] $ mkdir -p /opt/nfs_share\n\n# \u5728\u5e73\u53f0\u6302\u8f7d nfs-store \u5230 host1 \u548c host2 \n$ climc host-storage-attach --mount-point /opt/nfs_share host1 nfs-store\n$ climc host-storage-attach --mount-point /opt/nfs_share host2 nfs-store\n\n# \u628a host1 \u4e0a\u7684 vm \u78c1\u76d8\u6539\u4e3a nfs-store\n$ climc server-disk-list --server vm --details\n+-------+--------------------------------------+-------------------------------+-----------+--------+------------+-------+--------+-----------+--------------+\n| Guest |               Disk_ID                |             Disk              | Disk_size | Driver | Cache_mode | Index | Status | Disk_type | Storage_type |\n+-------+--------------------------------------+-------------------------------+-----------+--------+------------+-------+--------+-----------+--------------+\n| vm| 65ca88b1-186f-440a-8930-b4914e62cb3d | vdisk-vm-wz-1636100820075603665 | 30720     | scsi   | none       | 0     | ready  | sys       | rbd       |\n+-------+--------------------------------------+-------------------------------+-----------+--------+------------+-------+--------+-----------+--------------+\n\n# \u6267\u884c\u4e0b\u9762\u7684 server-change-disk-storage \u547d\u4ee4\u628a vm \u865a\u62df\u673a\u7684\u78c1\u76d8\u8fc1\u79fb\u5230 nfs-store\n$ climc server-change-disk-storage vm vdisk-vm-wz-1636100820075603665 nfs-store\n\n# \u7b49\u5f85\u865a\u62df\u673a vm \u72b6\u6001\u53d8\u4e3a ready \u540e\n# \u518d\u628a\u865a\u62df\u673a\u8fc1\u79fb\u5230 host2\n$ climc server-migrate --prefer-host host2 vm\n\n# \u7136\u540e\u518d\u8c03\u7528 server-change-disk-storage \u628a vm \u865a\u62df\u673a\u78c1\u76d8\u8fc1\u79fb\u5230 ceph2 \u5b58\u50a8\n# \u627e\u5230\u73b0\u5728\u78c1\u76d8\u4e3a vdisk-vm-1636100820075603665\uff0c\u53d1\u73b0\u7c7b\u578b Storage_type \u4e3a nfs\n$ climc server-disk-list --server vm --details\n+-------+--------------------------------------+-------------------------------+-----------+--------+------------+-------+--------+-----------+--------------+\n| Guest |               Disk_ID                |             Disk              | Disk_size | Driver | Cache_mode | Index | Status | Disk_type | Storage_type |\n+-------+--------------------------------------+-------------------------------+-----------+--------+------------+-------+--------+-----------+--------------+\n| vm| 65ca88b1-186f-440a-8930-b4914e62cb3d | vdisk-vm-1636100820075603665 | 30720     | scsi   | none       | 0     | ready  | sys       | nfs       |\n+-------+--------------------------------------+-------------------------------+-----------+--------+------------+-------+--------+-----------+--------------+\n\n# \u67e5\u770b\u5bbf\u4e3b\u673a host2 \u4e0a\u6302\u8f7d\u7684\u5b58\u50a8\n# \u53d1\u73b0\u6709 nfs-store \u548c ceph2\n$ climc host-storage-list --host host2 --details\n+----------------------------------+----------------------------+-----------+\n|             Storage              |        Mount_point         | Capacity  |\n+----------------------------------+----------------------------+-----------+\n| ceph2                           | rbd:rbd                    | 241018691 | \n| nfs                   | /opt/nfs_share           | 1024000 | 122880      | \n| host_10.1.180.13_local_storage_0 | /opt/cloud/workspace/disks | 681664    |\n+----------------------------------+----------------------------+-----------++\n\n# \u628a\u865a\u62df\u673a vm \u78c1\u76d8\u8fc1\u79fb\u5230 ceph2\n$ climc server-change-disk-storage vm vdisk-vm-1636100820075603665 ceph2\n"})}),"\n",(0,t.jsx)(s.h2,{id:"\u5176\u4ed6\u6ce8\u610f\u4e8b\u9879",children:"\u5176\u4ed6\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"\u66f4\u6539\u5b58\u50a8\u7684\u65e7\u78c1\u76d8\u4f1a\u5220\u9664\u5230\u56de\u6536\u7ad9\uff0c\u4f1a\u5360\u7528\u5b9e\u9645\u7684\u7269\u7406\u7a7a\u95f4\uff0c\u5982\u679c\u786e\u5b9a\u8fd9\u4e9b\u65e7\u7684\u78c1\u76d8\u4e0d\u4f7f\u7528\u4e86\uff0c\u53ef\u4ee5\u5728\u56de\u6536\u7ad9\u91cc\u9762\u6e05\u7406\u3002"}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"\u78c1\u76d8\u66f4\u6539\u5b58\u50a8\u7684\u539f\u7406",children:"\u78c1\u76d8\u66f4\u6539\u5b58\u50a8\u7684\u539f\u7406"}),"\n",(0,t.jsxs)(s.p,{children:["\u76ee\u524d\u78c1\u76d8\u66f4\u6539\u5b58\u50a8\u5e95\u5c42\u4f7f\u7528\u4e86 ",(0,t.jsx)(s.code,{children:"qemu-img convert"})," \u7684\u547d\u4ee4\u6765\u8fdb\u884c\u78c1\u76d8\u5e95\u5c42\u5b58\u50a8\u53d8\u66f4\uff0c\u5728\u4e91\u5e73\u53f0\u6267\u884c\u4e86 ",(0,t.jsx)(s.code,{children:"climc server-change-disk-storage"})," \u547d\u4ee4\u540e\uff0c\u53ef\u4ee5\u767b\u5f55\u5230\u865a\u62df\u673a\u6240\u5728\u7684\u5bbf\u4e3b\u673a\uff0c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a ",(0,t.jsx)(s.code,{children:"qemu-img convert"})," \u7684\u8fdb\u7a0b\uff1a"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"$ ps faux | grep qemu-img | grep convert\nroot     3701532 13.8  0.1 1516864 102056 ?      Ssl  17:35   0:00  \\_ /usr/local/qemu-2.12.1/bin/qemu-img convert -f qcow2 -O raw /opt/cloud/workspace/disks/61e4f0e4-597a-4aa9-8cde-0369879b9236 rbd:rbd/d55671c1-ec1b-4c2c-87cb-aa4aa517744e:mon_host=172.16.2.31\\;172.16.2.32\\;172.16.2.33:key=AQBBi1RhiSvXChAAnFzGrpAGM5N8dWb3rTdQwQ\\=\\=:rados_osd_op_timeout=1200:client_mount_timeout=120:rados_mon_op_timeout=5\n"})})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>c,x:()=>o});var t=n(96540);const r={},i=t.createContext(r);function c(e){const s=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),t.createElement(i.Provider,{value:s},e.children)}}}]);
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Cloudpods –
物理机</title><link>https://www.cloudpods.org//v3.9/zh/docs/function_principle/onpremise/baremetal/</link><description>Recent content in 物理机 on Cloudpods</description><generator>Hugo -- gohugo.io</generator><language>zh</language><lastBuildDate>Wed, 10 Jul 2019 10:16:53 +0800</lastBuildDate><atom:link href="https://www.cloudpods.org//v3.9/zh/docs/function_principle/onpremise/baremetal/index.xml" rel="self" type="application/rss+xml"/><item><title>Docs: 物理机服务原理</title><link>https://www.cloudpods.org//v3.9/zh/docs/function_principle/onpremise/baremetal/principle/</link><pubDate>Fri, 19 Jul 2019 20:28:13 +0800</pubDate><guid>https://www.cloudpods.org//v3.9/zh/docs/function_principle/onpremise/baremetal/principle/</guid><description>
&lt;h2 id="功能介绍">功能介绍&lt;/h2>
&lt;p>云平台支持 Baremetal(物理机) 管理，提供的功能如下:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>自动化上架: 物理机上架加电启动后，自动注册到云管平台，自动分配BMC IP地址，初始化IPMI账号密码，自动上报物理机硬件配置（CPU、内存、序列号、网卡、磁盘等）&lt;/p>
&lt;/li>
&lt;li>
&lt;p>自动化装机: 根据配置要求自动配置 RAID，自动分区格式化磁盘，自动部署操作系统镜像，自动初始化操作系统账号密码，自动分配IP地址，可以植入配置文件&lt;/p>
&lt;/li>
&lt;li>
&lt;p>生命周期管理: 支持物理机自动化开机，关机，重装系统，远程带外管理，卸载操作系统等操作&lt;/p>
&lt;/li>
&lt;li>
&lt;p>与虚拟机共享镜像: 使用虚拟机镜像部署物理机，便于虚拟机和物理机统一操作系统运行环境&lt;/p>
&lt;/li>
&lt;li>
&lt;p>API 支持: 以上操作均支持API操作，便于与其他系统的自动化流程集成&lt;/p>
&lt;/li>
&lt;li>
&lt;p>服务器型号支持: 支持Dell、HP、华为、浪潮、联想、超微等主流x86服务器厂商和机型&lt;/p>
&lt;/li>
&lt;li>
&lt;p>RAID 控制器支持: LSI MegaRaid, HP Smart Array, LSI MPT2SAS, LSI MPT3SAS, Mrarvell RAID等&lt;/p>
&lt;/li>
&lt;li>
&lt;p>转换为宿主机: 直接将物理机转换为运行虚拟机的宿主机&lt;/p>
&lt;/li>
&lt;li>
&lt;p>托管已有服务器： 托管已有并装好系统的物理机&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="服务架构">服务架构&lt;/h2>
&lt;p>物理机管理服务架构如下:&lt;/p>
&lt;p>&lt;img src="../images/baremetal-arch.png" alt="物理机管理架构">&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Baremetal &amp;lt;-&amp;gt; DHCP Relay： 处理 PXE 网络启动&lt;/p>
&lt;/li>
&lt;li>
&lt;p>DHCP Relay &amp;lt;-&amp;gt; Baremetal Agent:&lt;/p>
&lt;ul>
&lt;li>转发 PXE Boot 请求，获取网络启动相关的信息&lt;/li>
&lt;li>通过 DHCP 和 TFTP 服务下发 PXE 配置
&lt;ul>
&lt;li>云平台定制的&lt;a href="https://github.com/yunionio/yunionos">PXE引导系统&lt;/a> kernel 和 initramfs: 运行 SSH 服务，制作 RAID，收集硬件信息等&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Baremetal Agent &amp;lt;-&amp;gt; Region Server:&lt;/p>
&lt;ul>
&lt;li>通过 Region Server 注册物理机记录&lt;/li>
&lt;li>获取网络 IP 地址&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Baremetal Agent &amp;lt;-&amp;gt; Baremetal:&lt;/p>
&lt;ul>
&lt;li>Baremetal 通知 Agent SSH 相关的登录信息&lt;/li>
&lt;li>Agent 通过 SSH 配置 Baremetal 的 IPMI&lt;/li>
&lt;li>Agent 通过 IPMI 控制 Baremetal 开关机等操作&lt;/li>
&lt;li>Agent 通过 SSH 执行做 RAID，装机，销毁等操作&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Glance Server -&amp;gt; Baremetal: Baremetal 从 Glance server 下载装机镜像&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在交换机上开启 DHCP Relay 功能(或者使用 DHCP Relay软件)，relay 指向 Baremetal Agent&lt;/p>
&lt;ul>
&lt;li>物理机上架通电后，设置 PXE 网络启动，DHCP Relay 会将 PXE Boot 请求转发到 Baremetal Agent，Baremetal Agent 收到 PXE Boot 请求，向 Region Server 注册物理机记录&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="技术细节">技术细节&lt;/h2>
&lt;h3 id="注册物理机">注册物理机&lt;/h3>
&lt;p>注册物理机有自动注册和手动注册两种方式，如果 Baremetal Agent 开启了自动注册功能，就会自动在云平台创建 baremetal 记录；如果为手动注册方式，就需要先调用物理机创建接口把对应的 PXE 网卡对应的 MAC 地址注册到平台。&lt;/p>
&lt;p>注册的流程如下:&lt;/p>
&lt;ol>
&lt;li>物理机 PXE 启动时会发送 DHCP PXE boot 的请求，通过 DHCP Relay 请求会到 Baremetal Agent;&lt;/li>
&lt;li>Baremetal Agent 从 DHCP 请求中取出网卡 MAC 地址，拿 MAC 地址向 Region Server 过滤物理机记录;&lt;/li>
&lt;li>Region Server 告诉 Baremetal Agent 改 MAC 地址没有物理机，Baremetal Agent 就会新建记录，并从 Region Server 获取分配对应网段的 IP 地址, 通过内置 DHCP 服务回包给物理机;&lt;/li>
&lt;li>物理机 PXE DHCP 请求获得分配的 IP 地址后，会通过 TFTP 从 Baremetal Agent 下载启动引导文件(kernel 和 initramfs)，然后使用 ramdisk 机制进入我们定制的 initramfs 小系统;&lt;/li>
&lt;li>initramfs 小系统启动后，会启动 sshd 服务，然后修改 root 用户密码，将这些登录信息通知回 Baremetal Agent;&lt;/li>
&lt;li>Baremetal Agent 收到通知后，记录 ssh 登录的信息，开始进行准备工作;&lt;/li>
&lt;li>准备工作包括配置 IPMI，收集硬件信息等，当这些操作完成后，将所有信息上报给 Region Server 完成注册&lt;/li>
&lt;/ol>
&lt;h3 id="pxe引导系统">PXE引导系统&lt;/h3>
&lt;p>PXE引导系统(&lt;a href="https://github.com/yunionio/yunionos">https://github.com/yunionio/yunionos&lt;/a>) 是我们使用 &lt;a href="https://buildroot.org/">Buildroot&lt;/a> 工具定制的用于 PXE 启动和管理物理机的小型 Linux 系统，作用如下:&lt;/p>
&lt;ol>
&lt;li>运行 sshd 服务，提供 Baremetal Agent 远程执行命令&lt;/li>
&lt;li>包含 LSI MegaRaid, HP Smart Array, LSI MPT2SAS, LSI MPT3SAS, Mrarvell RAID等驱动和工具，用于制作 RAID&lt;/li>
&lt;li>包含 ipmitool 和相关 driver，用于配置和调用 IPMI BMC 管理物理机&lt;/li>
&lt;li>包含 qemu-img, sgdisk, parted 等磁盘分区工具，用于创建操作系统&lt;/li>
&lt;/ol>
&lt;h3 id="ssh-管理">SSH 管理&lt;/h3>
&lt;p>当物理机通过 PXE 进入 PXE引导系统后会启动 sshd 服务，并将 ssh login 信息通知给 Baremetal Agent，Baremetal Agent 会更新 ssh 相关的登录信息&lt;/p>
&lt;h3 id="raid-配置">RAID 配置&lt;/h3>
&lt;p>RAID 配置由 Baremetal Agent 根据用户的配置，生成 raid 配置命令，通过 ssh 远程控制 PXE引导系统 在物理机上制作 RAID&lt;/p>
&lt;h3 id="安装操作系统">安装操作系统&lt;/h3>
&lt;p>RAID 做完后，Baremetal Agent 会通过 ssh 远程控制 PXE引导系统 安装操作系统和分区，流程如下:&lt;/p>
&lt;ol>
&lt;li>调用 &lt;a href="https://github.com/yunionio/yunionos/blob/master/src/lib/mos/rootcreate.sh">/lib/mos/rootcreate.sh&lt;/a> 将系统创建到磁盘:&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>通过 wget 从 Glance Server 下载用户指定的 image 镜像&lt;/li>
&lt;li>通过 qemu-img convert 命名将 image 写入到磁盘&lt;/li>
&lt;/ul>
&lt;ol start="2">
&lt;li>创建好系统后，会根据用户的配置将系统盘 resize 分区&lt;/li>
&lt;li>创建其它分区并格式化&lt;/li>
&lt;li>Baremetal Agent 进行一些网络，磁盘配置的设置：比如 bonding，ip 设置, /etc/fstab, 改变 hostname 等&lt;/li>
&lt;/ol>
&lt;h3 id="开关机">开关机&lt;/h3>
&lt;p>注册好的的物理机会配置好 IPMI, IPMI 相关的信息会记录在数据库，Baremetal Agent 通过 ipmitool 控制开关机&lt;/p>
&lt;h3 id="重装操作系统">重装操作系统&lt;/h3>
&lt;p>类似于安装操作系统，流程上会让安装了操作系统的物理机重新进入 PXE引导系统，然后重新安装操作系统&lt;/p>
&lt;h3 id="远程访问">远程访问&lt;/h3>
&lt;p>Baremetal Agent 通过 ipmitool sol 接口提供串口控制界面&lt;/p>
&lt;h3 id="删除操作系统">删除操作系统&lt;/h3>
&lt;p>对正在运行操作系统的物理机重启进入 PXE 网络启动，进入 PXE引导系统，调用 &lt;a href="https://github.com/yunionio/yunionos/blob/master/src/lib/mos/partdestroy.sh">/lib/mos/partdestory.sh&lt;/a> 销毁磁盘分区和相应的 raid 命令销毁 raid 配置&lt;/p></description></item><item><title>Docs: 物理机相关操作</title><link>https://www.cloudpods.org//v3.9/zh/docs/function_principle/onpremise/baremetal/machine/</link><pubDate>Mon, 07 Feb 2022 19:02:52 +0800</pubDate><guid>https://www.cloudpods.org//v3.9/zh/docs/function_principle/onpremise/baremetal/machine/</guid><description/></item><item><title>Docs: 纳管物理机</title><link>https://www.cloudpods.org//v3.9/zh/docs/function_principle/onpremise/baremetal/create_register_redirect/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.cloudpods.org//v3.9/zh/docs/function_principle/onpremise/baremetal/create_register_redirect/</guid><description>
&lt;p>Cloudpods平台支持纳管Linux物理服务器并基于物理服务器创建裸金属服务器。&lt;/p>
&lt;h2 id="启用baremetal服务">启用Baremetal服务&lt;/h2>
&lt;p>请确保环境中已启用Baremetal服务，Baremetal服务提供PXE Server、DHCP、TFTP、http等功能，用于完成纳管物理机操作并管理物理机。Cloudpods安装完成后默认不启用Baremetal服务，需要用户按照下面命令在环境中的任意节点上启用Baremetal服务。&lt;/p>
&lt;ol>
&lt;li>
&lt;p>通过SSH等以root用户登录到First Node节点。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>使用&lt;code>kubectl get pods -n onecloud |grep baremetal&lt;/code>命令查看环境中是否已启用Baremetal服务。如已存在，忽略步骤3、4。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>如不存在Baremetal服务，执行以下命令启用Baremetal服务。其中$node_name是节点的名称；$listen-interface是baremetal-agent监听的网卡名称。
&lt;div class="alert alert-warning" role="alert">
&lt;h4 class="alert-heading">注意&lt;/h4>
如果需要启用Baremetal服务的节点安装了host服务，监听网卡请设置为br0，其余情况监听网卡为节点的实际网卡名称。
&lt;/div>
&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 在指定节点上启用Baremetal服务并监听网卡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ ocadm baremetal &lt;span style="color:#204a87">enable&lt;/span> --node &lt;span style="color:#000">$node_name&lt;/span> --listen-interface &lt;span style="color:#000">$listen_interface&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 禁用Baremetal服务&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ ocadm baremetal disable --node &lt;span style="color:#000">$node_name&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 如在node1主机上启用baremetal服务，并监听br0网卡。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ ocadm baremetal &lt;span style="color:#204a87">enable&lt;/span> --node node1 --listen-interface br0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>Baremetal服务启用后，可通过以下命令查看baremetal-agent是否注册到控制节点上。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 查看baremetal的pods&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ kubectl get pods -n onecloud &lt;span style="color:#000;font-weight:bold">|&lt;/span> grep baremetal
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>default-baremetal-agent-fb5d4b5f7-2ld8v 1/1 Running &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span> 15m
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="纳管物理机方式介绍">纳管物理机方式介绍&lt;/h2>
&lt;p>Cloudpods平台目前支持5种纳管物理机的方式及纳管原理介绍，请根据具体情况选择合适的方式。&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>方式&lt;/th>
&lt;th>纳管物理机数量&lt;/th>
&lt;th>已有IPMI信息&lt;/th>
&lt;th>启动引导方式&lt;/th>
&lt;th>DHCP Relay&lt;/th>
&lt;th>网络分配方式&lt;/th>
&lt;th>依赖Redfish API&lt;/th>
&lt;th>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>ISO引导注册&lt;/td>
&lt;td>小规模&lt;/td>
&lt;td>是&lt;/td>
&lt;td>ISO&lt;/td>
&lt;td>否&lt;/td>
&lt;td>静态分配&lt;/td>
&lt;td>是&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>PXE引导注册&lt;/td>
&lt;td>小规模&lt;/td>
&lt;td>是&lt;/td>
&lt;td>PXE&lt;/td>
&lt;td>是&lt;/td>
&lt;td>DHCP分配&lt;/td>
&lt;td>否&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>预注册&lt;/td>
&lt;td>小规模&lt;/td>
&lt;td>否&lt;/td>
&lt;td>PXE&lt;/td>
&lt;td>是&lt;/td>
&lt;td>DHCP分配&lt;/td>
&lt;td>否&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>自动注册&lt;/td>
&lt;td>大规模&lt;/td>
&lt;td>否&lt;/td>
&lt;td>PXE&lt;/td>
&lt;td>是&lt;/td>
&lt;td>DHCP分配&lt;/td>
&lt;td>否&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>托管&lt;/td>
&lt;td>小规模&lt;/td>
&lt;td>是&lt;/td>
&lt;td>-&lt;/td>
&lt;td>-&lt;/td>
&lt;td>-&lt;/td>
&lt;td>-&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="iso引导注册">ISO引导注册&lt;/h3>
&lt;p>该方式对网络无要求，但是要求物理机已配置了BMC信息，且服务器支持Redfish等。&lt;/p>
&lt;ol>
&lt;li>在Cloudpods平台上配置物理服务器的BMC信息以及管理口IP地址。&lt;/li>
&lt;li>Baremetal将会通过Redfish API验证物理服务器的BMC信息，进而获取物理服务器的配置信息，如服务器SN、厂商型号以及网卡信息等。&lt;/li>
&lt;li>验证通过后，物理服务器上的Redfish API将会通过带外网加载Baremetal提供的PXE引导系统的ISO。&lt;/li>
&lt;li>进入PXE引导系统后根据配置设置管理口的IP地址，从而使物理服务器可以通过管理网访问Baremetal，上报服务器的SSH登录信息。&lt;/li>
&lt;li>Baremetal通过SSH调用PXE引导系统中的工具，收集服务器信息，并进行管理操作等。&lt;/li>
&lt;li>至此，物理服务器成功注册到Cloudpods平台。&lt;/li>
&lt;/ol>
&lt;h3 id="pxe引导注册">PXE引导注册：&lt;/h3>
&lt;p>该方式要求用户环境存在DHCP Relay，且要求物理机已配置BMC信息，且在引导注册过程中不会改变物理机的BMC信息。如果服务器不支持Redfish，还需要提供服务器的MAC地址。&lt;/p>
&lt;ol>
&lt;li>在Cloudpods平台上配置物理服务器的BMC信息并设置服务器PXE启动等。&lt;/li>
&lt;li>Baremetal通过IPMI验证物理服务器的BMC信息。&lt;/li>
&lt;li>验证通过后，收集少量的服务器信息，设置物理服务器为开机启动，物理服务器通过DHCP配置管理口IP地址、&lt;/li>
&lt;li>通过管理网启动引导物理服务器进入PXE引导系统，上报SSH登录信息。&lt;/li>
&lt;li>Baremetal通过SSH调用PXE引导系统中的工具，收集服务器信息，并进行管理操作等。&lt;/li>
&lt;li>至此，物理服务器成功注册到Cloudpods平台。&lt;/li>
&lt;/ol>
&lt;h3 id="自动注册">自动注册&lt;/h3>
&lt;p>该方式适用于大规模的服务器自动注册到云管平台，仅要求用户环境存在DHCP Relay，引导注册过程中会重置BMC信息。&lt;/p>
&lt;ol>
&lt;li>新上架的物理服务器设置PXE启动上电后，物理服务器接入的三层网关上的DHCP Relay将转发物理服务器的PXE请求到Baremetal。&lt;/li>
&lt;li>Baremetal服务收到请求后将会响应PXE请求，引导物理服务器从网络加载PXE引导系统并重启进入PXE引导系统，上报服务器的ssh信息，&lt;/li>
&lt;li>Baremetal通过SSH调用PXE引导系统中的工具，收集服务器信息，重置服务器BMC信息（如不提供BMC信息，将按照默认的信息进行配置）。&lt;/li>
&lt;li>至此，物理服务器成功注册到Cloudpods平台。&lt;/li>
&lt;/ol>
&lt;h3 id="预注册">预注册&lt;/h3>
&lt;p>该方式适用于小规模的服务器注册到云管平台，该方式要求用户环境存在DHCP Relay，且提供服务器的MAC地址，在引导过程中会重置BMC信息。&lt;/p>
&lt;ol>
&lt;li>新上架的物理服务器设置PXE启动上电后，物理服务器接入的三层网关上的DHCP Relay将转发物理服务器的PXE请求到Baremetal。&lt;/li>
&lt;li>Baremetal服务收到请求后将会验证物理服务器的MAC地址是否匹配，匹配成功后将会记录物理服务器的基本信息并响应PXE请求，引导物理服务器从网络加载PXE引导系统并重启进入PXE引导系统，上报服务器的ssh信息，&lt;/li>
&lt;li>Baremetal通过SSH调用PXE引导系统中的工具，收集服务器信息，重置服务器BMC信息（如不提供BMC信息，将按照默认的信息进行配置）。&lt;/li>
&lt;li>至此，物理服务器成功注册到Cloudpods平台。&lt;/li>
&lt;/ol>
&lt;h3 id="托管">托管&lt;/h3>
&lt;p>该方式适用于已有操作系统的服务器，该方式对网络无要求。执行托管脚本后将使用容器技术在物理服务器中运行PXE引导系统收集服务器信息，而不会影响物理机的原有操作系统。&lt;/p>
&lt;h2 id="典型组网介绍">典型组网介绍&lt;/h2>
&lt;p>&lt;img src="../../images/networking1.png" alt="">&lt;/p>
&lt;h3 id="组网说明">组网说明&lt;/h3>
&lt;ul>
&lt;li>IPMI网络用于远程访问BMC（Baseboard Management Controller），通过IPMI网络可以远程控制物理服务器的开关机等。&lt;/li>
&lt;li>管理网：执行管理物理服务器操作的网络，例如配置物理服务器，安装软件等。&lt;/li>
&lt;li>PXE网：发送PXE请求，获取IP地址等，PXE网络一般跟管理网为一个网络。&lt;/li>
&lt;li>业务网：物理服务器上运行业务需要的网络。&lt;/li>
&lt;/ul>
&lt;h3 id="配置dhcp-relay选做">配置DHCP Relay（选做）&lt;/h3>
&lt;p>ISO引导注册或托管物理机请忽略该步骤。&lt;/p>
&lt;p>由于Baremetal Agent服务只会处理DHCP Relay的单播请求，所以当使用PXE引导注册、预注册、自动注册的方式纳管物理机时要求在网络环境中配置DHCP Relay，并将其Relay到部署Baremetal的节点上。&lt;/p>
&lt;ul>
&lt;li>当物理机与Baremetal节点在同一个二层网络时，此时用户可以选择使用Host服务的DHCP Relay功能或在物理交换机上配置DHCP Relay。&lt;/li>
&lt;li>当物理机与Baremetal节点在三层网络环境中，此时用户只能在物理交换机上配置DHCP Relay。&lt;/li>
&lt;/ul>
&lt;h4 id="host服务启用dhcp-relay">Host服务启用DHCP Relay&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 登录到任意一台已经部署好计算节点的服务器上修改 /etc/yunion/host.conf，添加dhcp_relay 配置项：&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>dhcp_relay:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- 10.168.222.198 &lt;span style="color:#8f5902;font-style:italic"># baremetal agent dhcp服务监听地址&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#0000cf;font-weight:bold">67&lt;/span> &lt;span style="color:#8f5902;font-style:italic"># baremetal agent dhcp服务监听端口&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 查看host服务对应pod&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ kubectl get pods -n onecloud -o wide &lt;span style="color:#000;font-weight:bold">|&lt;/span> grep host
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>default-host-p6d8h 2/2 Running &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span> 78m 10.168.222.189 k8s-dev1 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>default-host-xdc7x 2/2 Running &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span> 78m 10.168.222.150 k8s-dev2 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 删除host服务的pod，重启host服务&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ kubectl delete pods -n onecloud default-host-p6d8h default-host-xdc7x
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="物理交换机配置dhcp-relay">物理交换机配置DHCP Relay&lt;/h4>
&lt;p>需要分别针对物理机的IPMI网段和管理网段配置DHCP Relay。&lt;/p>
&lt;p>不同厂家的物理交换机配置DHCP Relay的命令不同，以下配置仅供参考，请根据实际情况进行配置。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 配置DHCP Relay，并Relay到Baremetal所在节点的IP上。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>interface Vlanif10
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>description new_test_host_net
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip address 10.127.100.1 255.255.255.0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>dhcp &lt;span style="color:#204a87;font-weight:bold">select&lt;/span> relay
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>dhcp relay binding server group baremetal-group
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>dhcp relay server group baremetal-group
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>server 10.127.100.2 &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="配置流程">配置流程&lt;/h2>
&lt;ol>
&lt;li>根据组网规划创建物理服务器使用的IPMI IP子网和PXE IP子网以及裸金属设备使用的IP子网。&lt;/li>
&lt;li>根据需求选择添加物理机的方式。&lt;/li>
&lt;li>已纳管的物理机可以用于创建裸金属设备。&lt;/li>
&lt;/ol>
&lt;h2 id="操作步骤">操作步骤&lt;/h2>
&lt;h3 id="网络配置">网络配置&lt;/h3>
&lt;p>无论使用何种方式纳管物理机，都需要在Cloudpods平台上配置物理机类型、IPMI以及PXE类型的IP子网，其中PXE网段可以和物理机类型共用一个网段。请根据网络规划配置IP子网。&lt;/p>
&lt;h4 id="创建ipmi-ip子网">创建IPMI IP子网&lt;/h4>
&lt;ol>
&lt;li>在云管平台单击左上角&lt;img src="../../user/images/intro/nav.png" alt="">导航菜单，在弹出的左侧菜单栏中单击 &lt;strong>&lt;em>&amp;ldquo;网络/基础网络/IP子网&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，进入IP子网页面。&lt;/li>
&lt;li>单击列表上方 &lt;strong>&lt;em>&amp;ldquo;新建&amp;rdquo;&lt;/em>&lt;/strong> 按钮，进入创建IP子网页面。&lt;/li>
&lt;li>设置以下参数：
&lt;ul>
&lt;li>子网名称：用于标识IPMI子网。&lt;/li>
&lt;li>平台：选择本地IDC。&lt;/li>
&lt;li>二层网络：请根据规划选择区域、专有网络以及可用的二层网络。后续用户申请裸金属时需要在二层网络所在的区域和可用区中选择。&lt;/li>
&lt;li>服务器类型：选择IPMI。&lt;/li>
&lt;li>IP子网：设置IP子网网段、子网掩码、网关以及VLAN ID等。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮。&lt;/li>
&lt;/ol>
&lt;h4 id="创建pxe-ip子网">创建PXE IP子网&lt;/h4>
&lt;ol>
&lt;li>在云管平台单击左上角&lt;img src="../../user/images/intro/nav.png" alt="">导航菜单，在弹出的左侧菜单栏中单击 &lt;strong>&lt;em>&amp;ldquo;网络/基础网络/IP子网&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，进入IP子网页面。&lt;/li>
&lt;li>单击列表上方 &lt;strong>&lt;em>&amp;ldquo;新建&amp;rdquo;&lt;/em>&lt;/strong> 按钮，进入创建IP子网页面。&lt;/li>
&lt;li>设置以下参数：
&lt;ul>
&lt;li>子网名称：用于标识IPMI子网。&lt;/li>
&lt;li>平台：选择本地IDC。&lt;/li>
&lt;li>二层网络：请根据规划选择区域、专有网络以及可用的二层网络。后续用户申请裸金属时需要在二层网络所在的区域和可用区中选择。&lt;/li>
&lt;li>服务器类型：选择PXE。&lt;/li>
&lt;li>IP子网：设置IP子网网段、子网掩码、网关以及VLAN ID等。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮。&lt;/li>
&lt;/ol>
&lt;h4 id="创建物理机或虚拟机ip子网">创建物理机或虚拟机IP子网&lt;/h4>
&lt;p>用户创建裸金属设备时会优先使用物理机IP子网，若环境中不存在可用的物理机IP子网将会使用虚拟机IP子网。&lt;/p>
&lt;ol>
&lt;li>在云管平台单击左上角&lt;img src="../../user/images/intro/nav.png" alt="">导航菜单，在弹出的左侧菜单栏中单击 &lt;strong>&lt;em>&amp;ldquo;网络/基础网络/IP子网&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，进入IP子网页面。&lt;/li>
&lt;li>单击列表上方 &lt;strong>&lt;em>&amp;ldquo;新建&amp;rdquo;&lt;/em>&lt;/strong> 按钮，进入创建IP子网页面。&lt;/li>
&lt;li>设置以下参数：
&lt;ul>
&lt;li>子网名称：用于标识IPMI子网。&lt;/li>
&lt;li>平台：选择本地IDC。&lt;/li>
&lt;li>二层网络：请根据规划选择区域、专有网络以及可用的二层网络。后续用户申请裸金属时需要在二层网络所在的区域和可用区中选择。&lt;/li>
&lt;li>服务器类型：选择物理机或虚拟机IP子网，新建裸金属服务器时默认优先使用物理机IP子网，当没有可用的物理机IP子网将使用虚拟机IP子网。&lt;/li>
&lt;li>IP子网：设置IP子网网段、子网掩码、网关以及VLAN ID等。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮。&lt;/li>
&lt;/ol>
&lt;h3 id="纳管物理机">纳管物理机&lt;/h3>
&lt;h4 id="iso引导注册-1">ISO引导注册&lt;/h4>
&lt;p>ISO引导注册之前请管理员提前准备以下信息：&lt;/p>
&lt;ul>
&lt;li>物理服务器的BMC信息。&lt;/li>
&lt;li>物理服务器管理口IP地址、IP子网或二层网络等。&lt;/li>
&lt;/ul>
&lt;ol>
&lt;li>在左侧导航栏，选择 &lt;strong>&lt;em>&amp;ldquo;主机/基础资源/物理机&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，进入物理机页面。&lt;/li>
&lt;li>单击 &lt;strong>&lt;em>&amp;ldquo;添加&amp;rdquo;&lt;/em>&lt;/strong> 按钮，进入添加物理机页面，选择添加方式为“ISO引导注册”。&lt;/li>
&lt;li>配置以下信息：
&lt;ul>
&lt;li>指定域：选择物理机所属的域。&lt;/li>
&lt;li>单条录入：配置以下参数。
&lt;ul>
&lt;li>物理机名称：设置物理服务器的名称。&lt;/li>
&lt;li>备注：设置物理机的备注信息。&lt;/li>
&lt;li>IPMI地址：输入服务器上已配置好的IPMI地址。&lt;/li>
&lt;li>IPMI用户名：输入服务器上已配置好的IPMI用户名。&lt;/li>
&lt;li>IPMI密码：输入服务器上已配置好的IPMI密码信息。若输入的BMC信息不正确则无法正确完成引导注册。&lt;/li>
&lt;li>标签：支持为新建的物理机绑定标签。支持选择已有标签和新建标签。
&lt;ul>
&lt;li>新建标签：单击列表上方 &lt;strong>&lt;em>新建&lt;/em>&lt;/strong> 按钮，设置标签键和标签值，单击 &lt;strong>&lt;em>&amp;ldquo;添加&amp;rdquo;&lt;/em>&lt;/strong> 按钮，新建标签并绑定到资源上。&lt;/li>
&lt;li>选择已有标签：单击 &lt;strong>&lt;em>&amp;ldquo;已有标签&amp;rdquo;&lt;/em>&lt;/strong> 按钮，选择标签键和值。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>管理口IP：选择IP子网，如需指定静态IP，可单击 &lt;strong>&lt;em>&amp;ldquo;手动配置IP&amp;rdquo;&lt;/em>&lt;/strong> 按钮，设置IP地址，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮。由于ISO引导注册适用于没有DHCP Relay的环境，所以用户必须配置提供服务器管理口接入的IP子网或IP地址信息。&lt;/li>
&lt;li>只注册不引导：不重启引导进入PXE引导系统，勾选该项后，仅收集到服务器的部分信息，此时的服务器无法用于创建裸金属，需要进行检测硬件配置操作使其正式投入生产使用。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>模板导入：支持导入含有物理机注册信息的XLSX格式的模板文件。
&lt;ul>
&lt;li>导入物理机信息需要按照预先设定的格式，请先下载模板。&lt;/li>
&lt;li>在下载的host_template.xlsx文件中补充物理机的信息。所有物理机信息请都放在同一个sheet页面中。&lt;/li>
&lt;li>单击虚线框或将模板文件拖拽到虚线框，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，上传模板文件。&lt;/li>
&lt;li>只注册不引导：不重启引导进入PXE引导系统，勾选该项后，仅收集到服务器的部分信息，此时的服务器无法用于创建裸金属，需要进行检测硬件配置操作使其正式投入生产使用。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，完成引导注册。&lt;/li>
&lt;/ol>
&lt;h4 id="pxe引导注册-1">PXE引导注册&lt;/h4>
&lt;p>PXE引导注册之前请管理员提前准备以下信息：&lt;/p>
&lt;ul>
&lt;li>物理服务器的BMC信息。&lt;/li>
&lt;/ul>
&lt;ol>
&lt;li>在左侧导航栏，选择 &lt;strong>&lt;em>&amp;ldquo;主机/基础资源/物理机&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，进入物理机页面。&lt;/li>
&lt;li>单击 &lt;strong>&lt;em>&amp;ldquo;添加&amp;rdquo;&lt;/em>&lt;/strong> 按钮，进入添加物理机页面，选择添加方式为“PXE引导注册”。&lt;/li>
&lt;li>配置以下信息：
&lt;ul>
&lt;li>指定域：选择物理机所属的域。&lt;/li>
&lt;li>单条录入：配置以下参数。
&lt;ul>
&lt;li>物理机名称：设置物理服务器的名称。&lt;/li>
&lt;li>备注：设置物理机的备注信息。&lt;/li>
&lt;li>IPMI地址：输入服务器上已配置好的IPMI地址。&lt;/li>
&lt;li>IPMI用户名：输入服务器上已配置好的IPMI用户名。&lt;/li>
&lt;li>IPMI密码：输入服务器上已配置好的IPMI密码信息。若输入的BMC信息不正确则无法正确完成引导注册。&lt;/li>
&lt;li>管理口MAC地址：设置服务器的管理口MAC地址，支持Redfish的服务器无需填写该项。&lt;/li>
&lt;li>管理口IP：选填。支持选择IP子网，如需指定静态IP，可单击 &lt;strong>&lt;em>&amp;ldquo;手动配置IP&amp;rdquo;&lt;/em>&lt;/strong> 按钮，设置IP地址，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮。留空则由DHCP自动分配IP。&lt;/li>
&lt;li>标签：支持为新建的物理机绑定标签。支持选择已有标签和新建标签。
&lt;ul>
&lt;li>新建标签：单击列表上方 &lt;strong>&lt;em>新建&lt;/em>&lt;/strong> 按钮，设置标签键和标签值，单击 &lt;strong>&lt;em>&amp;ldquo;添加&amp;rdquo;&lt;/em>&lt;/strong> 按钮，新建标签并绑定到资源上。&lt;/li>
&lt;li>选择已有标签：单击 &lt;strong>&lt;em>&amp;ldquo;已有标签&amp;rdquo;&lt;/em>&lt;/strong> 按钮，选择标签键和值。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>只注册不引导：不重启引导进入PXE引导系统，勾选该项后，仅收集到服务器的部分信息，此时的服务器无法用于创建裸金属，需要进行检测硬件配置操作使其正式投入生产使用。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>模板导入：支持导入含有物理机注册信息的XLSX格式的模板文件。
&lt;ul>
&lt;li>导入物理机信息需要按照预先设定的格式，请先下载模板。&lt;/li>
&lt;li>在下载的host_template.xlsx文件中补充物理机的信息。所有物理机信息请都放在同一个sheet页面中。&lt;/li>
&lt;li>单击虚线框或将模板文件拖拽到虚线框，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，上传模板文件。&lt;/li>
&lt;li>只注册不引导：不重启引导进入PXE引导系统，勾选该项后，仅收集到服务器的部分信息，此时的服务器无法用于创建裸金属，需要进行检测硬件配置操作使其正式投入生产使用。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，完成引导注册。&lt;/li>
&lt;/ol>
&lt;h4 id="预注册-1">预注册&lt;/h4>
&lt;p>预注册操作仅是预上架服务器信息，并不代表物理机已注册到Cloudpods平台，实际注册需要等到服务器上电启动。&lt;/p>
&lt;p>预注册物理机之前请管理员提前准备以下信息：&lt;/p>
&lt;ul>
&lt;li>物理服务器的MAC地址和名称，必填。&lt;/li>
&lt;li>由管理员规划BMC信息（IPMI地址、用户名、密码等信息），物理服务器可以事先不配置BMC信息，后续注册虚拟机引导时将会将物理服务器的BMC信息重置为注册物理机时设置的BMC信息。&lt;/li>
&lt;/ul>
&lt;ol>
&lt;li>
&lt;p>在左侧导航栏，选择 &lt;strong>&lt;em>&amp;ldquo;主机/基础资源/物理机&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，进入物理机页面。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>单击 &lt;strong>&lt;em>&amp;ldquo;添加&amp;rdquo;&lt;/em>&lt;/strong> 按钮，进入添加物理机页面，选择添加方式为“预注册”。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>支持3种导入物理机信息的方式。其中单条录入适用于托管单台服务器的场景，批量导入和文件导入适用于一次性托管多台服务器的场景。&lt;/p>
&lt;ul>
&lt;li>指定域：选择物理机所属的域。&lt;/li>
&lt;li>单条录入：配置以下参数。
&lt;ul>
&lt;li>MAC地址：物理机设备的MAC地址。&lt;/li>
&lt;li>物理机名称：物理机设备的名称。&lt;/li>
&lt;li>备注：设置物理机的备注信息。&lt;/li>
&lt;li>IPMI地址：设置物理机的IPMI地址，当不设置该参数时，若平台上存在IPMI的IP子网，系统将自动为其分配IP地址，一般建议新机器留空，旧机器设置之前的IP地址。&lt;/li>
&lt;li>IPMI用户名：设置IPMI管理用户名。当不设置该参数时，系统默认使用root用户登录，一般建议新机器留空，旧机器设置之前的用户名。&lt;/li>
&lt;li>IPMI密码：设置IPMI用户的密码。当不设置该参数时，系统默认密码为YunionDev@123。一般建议新机器留空，旧机器设置之前的密码。&lt;/li>
&lt;li>标签：支持为新建的物理机绑定标签。支持选择已有标签和新建标签。
- 新建标签：单击列表上方 &lt;strong>&lt;em>新建&lt;/em>&lt;/strong> 按钮，设置标签键和标签值，单击 &lt;strong>&lt;em>&amp;ldquo;添加&amp;rdquo;&lt;/em>&lt;/strong> 按钮，新建标签并绑定到资源上。
- 选择已有标签：单击 &lt;strong>&lt;em>&amp;ldquo;已有标签&amp;rdquo;&lt;/em>&lt;/strong> 按钮，选择标签键和值。&lt;/li>
&lt;li>设置完成后，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>批量录入：请注意以下内容。
&lt;ul>
&lt;li>一行为一条物理机记录，一次最多支持导入100条记录。&lt;/li>
&lt;li>录入信息格式为“MAC地址,名称,IPMI地址,IPMI用户名,IPMI密码”，中间以英文逗号“,”分割，若密码中包含中文逗号“，”需要使用单条录入功能进行注册。&lt;/li>
&lt;li>其中MAC地址和名称为必填项，其他参数可省略不填写。&lt;/li>
&lt;li>例如：ee:b3:f4:48:1c:f5,gpuhost01,192.168.1.1,root,admin123&lt;/li>
&lt;li>例如：ee:b3:f4:48:1c:f5,gpuhost01,,, &amp;ndash;省略了IPMI地址、IPMI用户名和IPMI密码&lt;/li>
&lt;li>录入完成后，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>模板导入：支持导入含有物理机注册信息的XLSX格式的模板文件。
&lt;ul>
&lt;li>导入物理机信息需要按照预先设定的格式，请先下载模板。&lt;/li>
&lt;li>在下载的host_template.xlsx文件中补充物理机的信息。所有物理机信息请都放在同一个sheet页面中。&lt;/li>
&lt;li>单击虚线框或将模板文件拖拽到虚线框，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，上传模板文件。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>至此，服务器预上架准备完毕。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>等待管理员将服务器设置为PXE启动，并为服务器上电后，才会进行真正的注册物理机操作，并获取服务器的基本信息等。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>当服务器在平台上有信息显示后，管理员可以在Cloudpods平台上对物理机进行管理操作等。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">说明&lt;/h4>
&lt;p>目前前端不支持设置预注册物理机的 PXE 启动 IP，可以通过在后端用命令行指定，操作如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 通过 host-create 命令创建物理机记录&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 对应物理机名称为 bm1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># PXE 启动网卡 MAC 为 2c:ea:7f:af:77:5b&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># --access-ip 指定 pxe 启动的 IP&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># --ipmi-addr 设置需要配置的 IPMI IP&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># --ipmi-user 设置需要配置的 IPMI 用户&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># --ipmi-passwd 设置对应的 IPMI 用户密码&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># --no-probe 表示不要进行 IPMI 探测，和引导注册区分开&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ climc host-create &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --access-ip 10.2.0.35 &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --ipmi-addr 10.3.0.25 &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --ipmi-user root &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --ipmi-passwd YunionDev@123 &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --no-probe &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> bm1 2c:ea:7f:af:77:5b
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;h4 id="自动注册-1">自动注册&lt;/h4>
&lt;p>Cloudpods平台默认未启用自动注册功能，如需要使用该功能，可通过界面或climc命令启用自动注册。&lt;/p>
&lt;p>&lt;strong>全局设置启用自动注册&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>
&lt;p>在云管平台单击左上角&lt;img src="../../user/images/intro/nav.png" alt="">导航菜单，在弹出的左侧菜单栏中单击 &lt;strong>&lt;em>&amp;ldquo;系统配置/全局设置/全局设置&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，进入全局设置页面。&lt;/p>
&lt;p>&lt;img src="../../images/autoregister.png" alt="">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>单击 &lt;strong>&lt;em>&amp;ldquo;编辑&amp;rdquo;&lt;/em>&lt;/strong> 按钮，开启自动注册功能。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>Climc启用自动注册&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 命令行开启自动注册&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ climc service-edit-config baremetal
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic"># 自动注册选项，默认为 false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> auto_register_baremetal: &lt;span style="color:#204a87">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="托管物理机">托管物理机&lt;/h4>
&lt;p>托管物理机操作可以纳管已安装操作系统的物理服务器，在纳管服务器之前，需要用户了解物理服务器的BMC（IPMI地址、用户名、密码）信息等。&lt;/p>
&lt;p>在托管服务器之前，请确保以下条件：&lt;/p>
&lt;ul>
&lt;li>平台上已创建了包含物理服务器的IPMI类型和物理机类型的IP子网；&lt;/li>
&lt;li>物理服务器已配置了BMC信息（IPMI地址、用户名、密码）；&lt;/li>
&lt;li>物理服务器已放开2222或之后端口；如2222端口已被占用，则需放开2222之后的端口。&lt;/li>
&lt;/ul>
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">说明&lt;/h4>
托管的物理机所在域与操作用户有关。
&lt;/div>
&lt;ol>
&lt;li>
&lt;p>在左侧导航栏，选择 &lt;strong>&lt;em>&amp;ldquo;主机/基础资源/物理机&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，进入物理机页面。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>单击 &lt;strong>&lt;em>&amp;ldquo;添加&amp;rdquo;&lt;/em>&lt;/strong> 按钮，进入添加物理机页面，选择添加方式为“托管”。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>单击&amp;quot;点击复制&amp;quot;链接，复制命令。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>通过ssh等远程连接到物理服务器，在服务器中执行复制的命令。&lt;/p>
&lt;p>&lt;img src="../../images/command.png" alt="">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>命令执行过程中需要输入服务器的IPMI用户名、密码以及IPMI IP，设置完成后等待一段时间，物理机会被注册到Cloudpods平台，同时将创建一个与之前物理机同配置的裸金属服务器。&lt;/p>
&lt;/li>
&lt;/ol></description></item><item><title>Docs: 安装操作系统/新建裸金属</title><link>https://www.cloudpods.org//v3.9/zh/docs/function_principle/onpremise/baremetal/create_server/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.cloudpods.org//v3.9/zh/docs/function_principle/onpremise/baremetal/create_server/</guid><description>
&lt;p>目前平台支持通过两个入口创建裸金属。&lt;/p>
&lt;ul>
&lt;li>在物理机页面安装操作系统即可基于当前物理机创建裸金属。&lt;/li>
&lt;li>在裸金属页面新建裸金属，并通过规格筛选出对应的物理机新建裸金属。&lt;/li>
&lt;/ul>
&lt;h2 id="climc操作">climc操作&lt;/h2>
&lt;h3 id="安装操作系统">安装操作系统&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>climc server-create &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --hypervisor baremetal &lt;span style="color:#4e9a06">\ &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># 指定 server 的类型为 baremetal&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> --ncpu &lt;span style="color:#0000cf;font-weight:bold">24&lt;/span> &lt;span style="color:#4e9a06">\ &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># 创建到 24 核 cpu 的物理机&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> --mem-spec 64g &lt;span style="color:#4e9a06">\ &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># 创建到 64g 内存大小的物理机&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> --net &lt;span style="color:#4e9a06">&amp;#39;bms-net&amp;#39;&lt;/span> &lt;span style="color:#4e9a06">\ &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># 创建到 bms-net 的网络下&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> --raid-config &lt;span style="color:#4e9a06">&amp;#39;raid1:2:MegaRaid&amp;#39;&lt;/span> &lt;span style="color:#4e9a06">\ &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># 第1块盘，使用 MegaRaid 控制器上的(0-1)号两块物理盘做 raid1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> --raid-config &lt;span style="color:#4e9a06">&amp;#39;none:1&amp;#39;&lt;/span> &lt;span style="color:#4e9a06">\ &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># 第2块盘，使用 MegaRaid 控制器上的(2)号物理盘，不做 raid&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> --raid-config &lt;span style="color:#4e9a06">&amp;#39;raid10:4:MegaRaid&amp;#39;&lt;/span> &lt;span style="color:#4e9a06">\ &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># 第3快盘, 使用 MegaRaid 控制器上的(3-6)号四块物理盘做raid10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> --disk CentOS-7.5.qcow2:100g &lt;span style="color:#4e9a06">\ &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># 系统盘使用 CentOS-7.5.qcow2 镜像作为操作系统，大小为 100g，使用第1块 raid1 的盘&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> --disk &lt;span style="color:#4e9a06">&amp;#39;autoextend:ext4:/opt&amp;#39;&lt;/span> &lt;span style="color:#4e9a06">\ &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># 分区挂载到 /opt, 使用第1块 raid1 的盘，文件系统为 ext4, 大小为(第一块盘总大小 - 该盘其他分区的大小(100g))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> --disk &lt;span style="color:#4e9a06">&amp;#39;autoextend:xfs:/data-nonraid&amp;#39;&lt;/span> &lt;span style="color:#4e9a06">\ &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># 分区挂载到 /data-nonraid, 使用第2块没做 raid 的盘, 文件系统为 xfs，使用所有空间&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> --disk &lt;span style="color:#4e9a06">&amp;#39;autoextend:ext4:/data-raid10&amp;#39;&lt;/span> &lt;span style="color:#4e9a06">\ &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># 分区挂载到 /data-raid10, 使用第3块 raid10 的盘，文件系统为 ext4, 使用所有空间&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;server_name&amp;gt; &lt;span style="color:#8f5902;font-style:italic"># 裸金属服务器名称&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 另外可以通过参数 `--prefer-host $baremetal-hostname` 创建到指定的物理机&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="raid-配置和分区">raid 配置和分区&lt;/h4>
&lt;p>调用 server-create 接口时通过 &amp;lsquo;&amp;ndash;raid-config&amp;rsquo; 传递参数来配置 raid，每个 raid-config 对应到操作系统可见的磁盘设备(/dev/sdx)。&lt;/p>
&lt;p>&amp;lsquo;&amp;ndash;disk&amp;rsquo; 参数对应不同磁盘上的分区，分区对应到磁盘的逻辑为: 分区按照顺序创建到第1块磁盘上，当 disk 设置 autoextend 参数后，表示接下来的 disk 分区会创建到下一个磁盘，以此类推。&lt;/p>
&lt;ul>
&lt;li>raid 配置 API 参数:&lt;/li>
&lt;/ul>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Key&lt;/th>
&lt;th>Type&lt;/th>
&lt;th>value&lt;/th>
&lt;th>解释&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>type(磁盘类型)&lt;/td>
&lt;td>string&lt;/td>
&lt;td>rotate(机械盘), ssd(固态盘), hybrid(未知)&lt;/td>
&lt;td>-&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>conf (raid)&lt;/td>
&lt;td>string&lt;/td>
&lt;td>none, raid0, raid1, raid5, raid10&lt;/td>
&lt;td>做raid几或者不做&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>count (磁盘数量)&lt;/td>
&lt;td>int&lt;/td>
&lt;td>e.g. 0, 2, 4&lt;/td>
&lt;td>小于等于物理机实际的盘数&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>range (磁盘范围)&lt;/td>
&lt;td>[]int&lt;/td>
&lt;td>e.g. [0,1,2,3], [4,7], [5,6]&lt;/td>
&lt;td>物理磁盘在控制器上的索引号&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>splits (切割物理盘)&lt;/td>
&lt;td>string&lt;/td>
&lt;td>(30%,20%,), (300g,100g,)&lt;/td>
&lt;td>做好 raid 的物理盘再切割为多块物理盘&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>adapter (控制器号)&lt;/td>
&lt;td>int&lt;/td>
&lt;td>0, 1&lt;/td>
&lt;td>对应driver的 Adapter 控制器&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>driver (控制器名称)&lt;/td>
&lt;td>string&lt;/td>
&lt;td>MegaRaid,HPSARaid,Mpt2SAS,MarvelRaid,Linux,PCIE&lt;/td>
&lt;td>1台物理机上有多个控制器时用于选择盘&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>strip (设置raid strip 大小)&lt;/td>
&lt;td>*int&lt;/td>
&lt;td>e.g. 64*1024&lt;/td>
&lt;td>设置strip size, 可选&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ra&lt;/td>
&lt;td>*bool&lt;/td>
&lt;td>&lt;/td>
&lt;td>设置读模式&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>wt&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>设置写模式&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>cachedbadbbu&lt;/td>
&lt;td>*bool&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>direct&lt;/td>
&lt;td>*bool&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;ul>
&lt;li>
&lt;p>命令行格式:&lt;/p>
&lt;p>&amp;lsquo;(none,raid0,raid1,raid5,raid10):%d:(MegaRaid|HPSARaid|Mpt2SAS|MarvelRaid|Linux|PCIE):(rotate|ssd|hybrid):[0-n]:strip%dk:adapter%d:ra:nora:wt:wb:direct:cachedbadbbu:nocachedbadbbu&amp;rsquo;&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>Docs: 物理机更换网卡</title><link>https://www.cloudpods.org//v3.9/zh/docs/function_principle/onpremise/baremetal/change_netif/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.cloudpods.org//v3.9/zh/docs/function_principle/onpremise/baremetal/change_netif/</guid><description>
&lt;p>云平台会记录物理机的网卡信息，如果实际环境中替换了物理机的网卡，需要手动保持平台里面物理机的网卡信息和实际环境中的一致。&lt;/p>
&lt;h2 id="删掉物理机网卡">删掉物理机网卡&lt;/h2>
&lt;p>假设需要移除物理机 bm1 上 mac 为 52:54:00:12:34:56 的网卡，对应操作如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ climc host-remove-netif bm1 52:54:00:12:34:56
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="添加新的网卡">添加新的网卡&lt;/h2>
&lt;p>手动给物理机添加网卡后，同步平台里面的信息有两种方式，一种是让物理机重新 PXE 启动一次，平台对应的硬件信息就会更新，这种方式适用于物理机上没有安装操作系统或者删除了操作系统的情况。&lt;/p>
&lt;p>另外一种是使用命令 &lt;code>host-add-netif&lt;/code> 给物理机添加网卡：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 给物理机 bm2 添加 admin 类型的网卡，二层网络为 bcast0 ，MAC 地址为 52:54:00:12:34:56，手动配置 IP 地址为 10.10.10.10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 网卡顺序为第一张(0)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ climc host-add-netif --ip-addr 10.10.10.10 --type admin bm2 bcast0 52:54:00:12:34:56 &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>查看物理机的网卡：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ climc host-network-list --details --host bm2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>+--------------------------------------+------+--------------------------------------+------------+--------------+-------------------+----------+
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">|&lt;/span> Baremetal_ID &lt;span style="color:#000;font-weight:bold">|&lt;/span> Host &lt;span style="color:#000;font-weight:bold">|&lt;/span> Network_ID &lt;span style="color:#000;font-weight:bold">|&lt;/span> Network &lt;span style="color:#000;font-weight:bold">|&lt;/span> IP_addr &lt;span style="color:#000;font-weight:bold">|&lt;/span> Mac_addr &lt;span style="color:#000;font-weight:bold">|&lt;/span> Nic_Type &lt;span style="color:#000;font-weight:bold">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>+--------------------------------------+------+--------------------------------------+------------+--------------+-------------------+----------+
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">|&lt;/span> 610a7133-a2f6-4e52-8b12-2067296863a4 &lt;span style="color:#000;font-weight:bold">|&lt;/span> bm2 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 14f56d88-0a70-404f-872e-56949bf0e488 &lt;span style="color:#000;font-weight:bold">|&lt;/span> pxe-net &lt;span style="color:#000;font-weight:bold">|&lt;/span> 10.10.10.10 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 52:54:00:12:34:56 &lt;span style="color:#000;font-weight:bold">|&lt;/span> admin &lt;span style="color:#000;font-weight:bold">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">|&lt;/span> 610a7133-a2f6-4e52-8b12-2067296863a4 &lt;span style="color:#000;font-weight:bold">|&lt;/span> bm2 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 14f56d88-0a70-404f-872e-56949bf0e488 &lt;span style="color:#000;font-weight:bold">|&lt;/span> ipmi-net &lt;span style="color:#000;font-weight:bold">|&lt;/span> 10.0.2.3 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 30:4e:05:26:22:43 &lt;span style="color:#000;font-weight:bold">|&lt;/span> ipmi &lt;span style="color:#000;font-weight:bold">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>+--------------------------------------+------+--------------------------------------+------------+--------------+-------------------+----------+
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Docs: 物理机更改 IP</title><link>https://www.cloudpods.org//v3.9/zh/docs/function_principle/onpremise/baremetal/change_ip_address/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.cloudpods.org//v3.9/zh/docs/function_principle/onpremise/baremetal/change_ip_address/</guid><description>
&lt;p>云平台里面的物理机会分配 2 个 IP 地址，一个分配给 BMC IPMI 的地址，还有一个是物理机 PXE 启动时候的地址。如果物理机安装操作系统，会在平台生成一条裸金属的记录，裸金属记录也会被分配一个 IP 地址。物理机安装操作系统的时候，在默认没有指定 IP 地址的情况下，裸金属分配的 IP 地址会优先复用对应物理机上的 PXE IP 地址。&lt;/p>
&lt;p>通常情况下，这些 IP 地址都由云平台记录和管理，不需要手动去更改。但有时候遇到物理网络的变更，可能会手动更改 IPMI 或者操作系统里面的 IP 地址，手动更改相应的 IP 地址后，就需要更新云平台对应的 IP 地址。&lt;/p>
&lt;div class="alert alert-warning" role="alert">
&lt;h4 class="alert-heading">注意&lt;/h4>
如果手动更改了物理机上的 IP 地址，但是云平台对应的信息没有同步更新，管理另外的物理机就可能出现 IP 地址冲突。
&lt;/div>
&lt;h2 id="物理机更改-ip">物理机更改 IP&lt;/h2>
&lt;p>对于没有安装操作系统的物理机，可以更改 IPMI 和 PXE 的 IP 地址。&lt;/p>
&lt;h3 id="更改-ipmi-ip">更改 IPMI IP&lt;/h3>
&lt;p>假设要把名称为 bm1 的物理机 IPMI 地址变为 10.0.2.2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 先用 host-list 找到对应的物理机&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 能看到 bm1 的状态 status 字段为 running&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ climc host-list --search bm1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>+--------------------------------------+------+-------------------+--------------+---------+---------+-------------+----------+-----------+------------+---------------+--------------+-----------+--------------+-----------+--------------+
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">|&lt;/span> ID &lt;span style="color:#000;font-weight:bold">|&lt;/span> Name &lt;span style="color:#000;font-weight:bold">|&lt;/span> Access_mac &lt;span style="color:#000;font-weight:bold">|&lt;/span> Access_ip &lt;span style="color:#000;font-weight:bold">|&lt;/span> Status &lt;span style="color:#000;font-weight:bold">|&lt;/span> enabled &lt;span style="color:#000;font-weight:bold">|&lt;/span> host_status &lt;span style="color:#000;font-weight:bold">|&lt;/span> mem_size &lt;span style="color:#000;font-weight:bold">|&lt;/span> cpu_count &lt;span style="color:#000;font-weight:bold">|&lt;/span> node_count &lt;span style="color:#000;font-weight:bold">|&lt;/span> sn &lt;span style="color:#000;font-weight:bold">|&lt;/span> storage_type &lt;span style="color:#000;font-weight:bold">|&lt;/span> host_type &lt;span style="color:#000;font-weight:bold">|&lt;/span> storage_size &lt;span style="color:#000;font-weight:bold">|&lt;/span> domain_id &lt;span style="color:#000;font-weight:bold">|&lt;/span> public_scope &lt;span style="color:#000;font-weight:bold">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>+--------------------------------------+------+-------------------+--------------+---------+---------+-------------+----------+-----------+------------+---------------+--------------+-----------+--------------+-----------+--------------+
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">|&lt;/span> 610a7133-a2f6-4e52-8b12-2067296863a4 &lt;span style="color:#000;font-weight:bold">|&lt;/span> bm1 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 52:54:00:12:34:56 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 10.168.26.70 &lt;span style="color:#000;font-weight:bold">|&lt;/span> running &lt;span style="color:#000;font-weight:bold">|&lt;/span> &lt;span style="color:#204a87">true&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span> offline &lt;span style="color:#000;font-weight:bold">|&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">4096&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span> Not Specified &lt;span style="color:#000;font-weight:bold">|&lt;/span> hybrid &lt;span style="color:#000;font-weight:bold">|&lt;/span> baremetal &lt;span style="color:#000;font-weight:bold">|&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">215040&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span> default &lt;span style="color:#000;font-weight:bold">|&lt;/span> system &lt;span style="color:#000;font-weight:bold">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>+--------------------------------------+------+-------------------+--------------+---------+---------+-------------+----------+-----------+------------+---------------+--------------+-----------+--------------+-----------+--------------+
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 查看 bm1 上网卡对应的 IP 地址&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 能够看到类型为 ipmi 的网卡 30:4e:05:26:22:43 分配的地址为 10.0.2.3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ climc host-network-list --host bm1 --details
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>+--------------------------------------+------+--------------------------------------+------------+--------------+-------------------+----------+
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">|&lt;/span> Baremetal_ID &lt;span style="color:#000;font-weight:bold">|&lt;/span> Host &lt;span style="color:#000;font-weight:bold">|&lt;/span> Network_ID &lt;span style="color:#000;font-weight:bold">|&lt;/span> Network &lt;span style="color:#000;font-weight:bold">|&lt;/span> IP_addr &lt;span style="color:#000;font-weight:bold">|&lt;/span> Mac_addr &lt;span style="color:#000;font-weight:bold">|&lt;/span> Nic_Type &lt;span style="color:#000;font-weight:bold">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>+--------------------------------------+------+--------------------------------------+------------+--------------+-------------------+----------+
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">|&lt;/span> 610a7133-a2f6-4e52-8b12-2067296863a4 &lt;span style="color:#000;font-weight:bold">|&lt;/span> bm1 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 14f56d88-0a70-404f-872e-56949bf0e488 &lt;span style="color:#000;font-weight:bold">|&lt;/span> pxe-net &lt;span style="color:#000;font-weight:bold">|&lt;/span> 10.168.26.72 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 52:54:00:12:34:56 &lt;span style="color:#000;font-weight:bold">|&lt;/span> admin &lt;span style="color:#000;font-weight:bold">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">|&lt;/span> 610a7133-a2f6-4e52-8b12-2067296863a4 &lt;span style="color:#000;font-weight:bold">|&lt;/span> bm1 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 14f56d88-0a70-404f-872e-56949bf0e488 &lt;span style="color:#000;font-weight:bold">|&lt;/span> ipmi-net &lt;span style="color:#000;font-weight:bold">|&lt;/span> 10.0.2.3 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 30:4e:05:26:22:43 &lt;span style="color:#000;font-weight:bold">|&lt;/span> ipmi &lt;span style="color:#000;font-weight:bold">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>+--------------------------------------+------+--------------------------------------+------------+--------------+-------------------+----------+
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 更新 IPMI 地址为 10.0.2.2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ climc host-update --ipmi-ip-addr 10.0.2.2 bm1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 更新完 IPMI 地址后需要调用 IPMI 探测的接口重新刷新一遍信息&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ climc host-ipmi-probe bm1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 执行 host-ipmi-probe 后，bm1 的状态 status 字段会变为 start_probe&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 探测完成后状态会变为 running ，期间可以用 host-list 命令查看&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 等到探测完毕后，再用 host-network-list 命令查看 ipmi 地址&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 发现已经更新为 10.0.2.2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ climc host-network-list --host bm1 --details &lt;span style="color:#000;font-weight:bold">|&lt;/span> grep ipmi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">|&lt;/span> 610a7133-a2f6-4e52-8b12-2067296863a4 &lt;span style="color:#000;font-weight:bold">|&lt;/span> bm1 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 14f56d88-0a70-404f-872e-56949bf0e488 &lt;span style="color:#000;font-weight:bold">|&lt;/span> ipmi-net &lt;span style="color:#000;font-weight:bold">|&lt;/span> 10.0.2.2 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 30:4e:05:26:22:43 &lt;span style="color:#000;font-weight:bold">|&lt;/span> ipmi &lt;span style="color:#000;font-weight:bold">|&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="更改-pxe-ip">更改 PXE IP&lt;/h3>
&lt;p>物理机在安装系统，或者重装系统的时候，会先 PXE 引导进入平台定制的精简 Linux 系统，可以通过以下命令更改 PXE 启动时分配的 IP 地址。&lt;/p>
&lt;p>假设要把名称为 bm1 的 PXE 启动 IP 地址从 10.168.26.72 变为 10.168.26.70 。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 先查看物理机 bm1 上网卡已经分配的 IP 地址&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ climc host-network-list --host bm1 --details
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>+--------------------------------------+------+--------------------------------------+------------+--------------+-------------------+----------+
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">|&lt;/span> Baremetal_ID &lt;span style="color:#000;font-weight:bold">|&lt;/span> Host &lt;span style="color:#000;font-weight:bold">|&lt;/span> Network_ID &lt;span style="color:#000;font-weight:bold">|&lt;/span> Network &lt;span style="color:#000;font-weight:bold">|&lt;/span> IP_addr &lt;span style="color:#000;font-weight:bold">|&lt;/span> Mac_addr &lt;span style="color:#000;font-weight:bold">|&lt;/span> Nic_Type &lt;span style="color:#000;font-weight:bold">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>+--------------------------------------+------+--------------------------------------+------------+--------------+-------------------+----------+
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">|&lt;/span> 610a7133-a2f6-4e52-8b12-2067296863a4 &lt;span style="color:#000;font-weight:bold">|&lt;/span> bm1 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 14f56d88-0a70-404f-872e-56949bf0e488 &lt;span style="color:#000;font-weight:bold">|&lt;/span> pxe-net &lt;span style="color:#000;font-weight:bold">|&lt;/span> 10.168.26.72 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 52:54:00:12:34:56 &lt;span style="color:#000;font-weight:bold">|&lt;/span> admin &lt;span style="color:#000;font-weight:bold">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">|&lt;/span> 610a7133-a2f6-4e52-8b12-2067296863a4 &lt;span style="color:#000;font-weight:bold">|&lt;/span> bm1 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 14f56d88-0a70-404f-872e-56949bf0e488 &lt;span style="color:#000;font-weight:bold">|&lt;/span> ipmi-net &lt;span style="color:#000;font-weight:bold">|&lt;/span> 10.0.2.2 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 30:4e:05:26:22:43 &lt;span style="color:#000;font-weight:bold">|&lt;/span> ipmi &lt;span style="color:#000;font-weight:bold">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>+--------------------------------------+------+--------------------------------------+------------+--------------+-------------------+----------+
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 其中类型为 admin 的网卡表示分配给 PXE 启动的 IP&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 对应网卡的 MAC 地址为 52:54:00:12:34:56&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 先把物理机网卡禁用&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ climc host-disable-netif bm1 52:54:00:12:34:56
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 然后重新启用对应网卡，分配指定的 IP 地址&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ climc host-enable-netif --ip 10.168.26.70 bm1 52:54:00:12:34:56
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 再查看 bm1 上的网卡 IP 地址分配情况，发现 admin 类型的网卡已经变为 10.168.26.70&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ climc host-network-list --host bm1 --details
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>+--------------------------------------+------+--------------------------------------+------------+--------------+-------------------+----------+
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">|&lt;/span> Baremetal_ID &lt;span style="color:#000;font-weight:bold">|&lt;/span> Host &lt;span style="color:#000;font-weight:bold">|&lt;/span> Network_ID &lt;span style="color:#000;font-weight:bold">|&lt;/span> Network &lt;span style="color:#000;font-weight:bold">|&lt;/span> IP_addr &lt;span style="color:#000;font-weight:bold">|&lt;/span> Mac_addr &lt;span style="color:#000;font-weight:bold">|&lt;/span> Nic_Type &lt;span style="color:#000;font-weight:bold">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>+--------------------------------------+------+--------------------------------------+------------+--------------+-------------------+----------+
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">|&lt;/span> 610a7133-a2f6-4e52-8b12-2067296863a4 &lt;span style="color:#000;font-weight:bold">|&lt;/span> bm1 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 14f56d88-0a70-404f-872e-56949bf0e488 &lt;span style="color:#000;font-weight:bold">|&lt;/span> pxe-net &lt;span style="color:#000;font-weight:bold">|&lt;/span> 10.168.26.70 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 52:54:00:12:34:56 &lt;span style="color:#000;font-weight:bold">|&lt;/span> admin &lt;span style="color:#000;font-weight:bold">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">|&lt;/span> 610a7133-a2f6-4e52-8b12-2067296863a4 &lt;span style="color:#000;font-weight:bold">|&lt;/span> bm1 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 25056dcc-45dr-3wef-8734-9b5694f880e4 &lt;span style="color:#000;font-weight:bold">|&lt;/span> ipmi-net &lt;span style="color:#000;font-weight:bold">|&lt;/span> 10.0.2.2 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 30:4e:05:26:22:43 &lt;span style="color:#000;font-weight:bold">|&lt;/span> ipmi &lt;span style="color:#000;font-weight:bold">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>+--------------------------------------+------+--------------------------------------+------------+--------------+-------------------+----------+
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="裸金属更改-ip-地址">裸金属更改 IP 地址&lt;/h2>
&lt;p>物理机安装完操作系统后，在平台有一条对应的裸金属记录，裸金属分配的 IP 地址对应当前磁盘操作系统上的 IP 地址，如果手动修改了操作系统的 IP，需要使用以下的命令行更改对应裸金属的 IP 地址。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 先找到物理机 bm1 上对应的裸金属记录&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ climc server-list --scope system --host bm1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 查看裸金属 bms 上的网卡和 IP 地址对应关系&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 会发现 bms 上的网卡 MAC 地址其实和 bm1 物理机的网卡时一致的&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># IP 地址也是优先复用的&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ climc server-network-list --server bms --details
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>+--------------------------------------+-------+--------------------------------------+---------+-------------------+---------------+
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">|&lt;/span> Guest_ID &lt;span style="color:#000;font-weight:bold">|&lt;/span> Guest &lt;span style="color:#000;font-weight:bold">|&lt;/span> Network_ID &lt;span style="color:#000;font-weight:bold">|&lt;/span> Network &lt;span style="color:#000;font-weight:bold">|&lt;/span> Mac_addr &lt;span style="color:#000;font-weight:bold">|&lt;/span> IP_addr &lt;span style="color:#000;font-weight:bold">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>+--------------------------------------+-------+--------------------------------------+---------+-------------------+---------------+
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">|&lt;/span> 398df1ce-1675-42b9-87d0-87634e21f139 &lt;span style="color:#000;font-weight:bold">|&lt;/span> bms &lt;span style="color:#000;font-weight:bold">|&lt;/span> 14f56d88-0a70-404f-872e-56949bf0e488 &lt;span style="color:#000;font-weight:bold">|&lt;/span> pxe-net &lt;span style="color:#000;font-weight:bold">|&lt;/span> 52:54:00:12:34:56 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 10.168.26.72 &lt;span style="color:#000;font-weight:bold">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>+--------------------------------------+-------+--------------------------------------+---------+-------------------+---------------+
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 然后更新裸金属 bms 的 IP 地址，改为 pxe-net 子网里面的 10.168.26.70 地址&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ climc server-change-ipaddr bms 52:54:00:12:34:56 pxe-net:10.168.26.70
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Docs: 裸金属网卡命名</title><link>https://www.cloudpods.org//v3.9/zh/docs/function_principle/onpremise/baremetal/nic_persistent_naming/</link><pubDate>Thu, 09 Sep 2021 22:25:05 +0800</pubDate><guid>https://www.cloudpods.org//v3.9/zh/docs/function_principle/onpremise/baremetal/nic_persistent_naming/</guid><description>
&lt;h2 id="为什么物理机的网卡名称总是命名为en0-en1-">为什么物理机的网卡名称总是命名为en0, en1, &amp;hellip;?&lt;/h2>
&lt;p>传统的Linux网卡命名规则为按照内核探测网卡的顺序，把网卡依次命名为eth0, eth1, &amp;hellip;。这种命名方式导致的问题时在添加/删除网卡设备后，导致网卡的名称发生变化（例如将eth0的网卡移除，重启之后，原来命名为eth1的网卡会变成eth0）。为了让网卡的名称和内核探测网卡的顺序无关，从systemd/udev v197开始引入了Predictable-Network-Interface-Names的机制，采用网卡的firmware/topology/location信息来命名网卡，例如 eno1， ens1，enp2s0等。具体参见 &lt;a href="https://www.freedesktop.org/wiki/Software/systemd/PredictableNetworkInterfaceNames/">https://www.freedesktop.org/wiki/Software/systemd/PredictableNetworkInterfaceNames/&lt;/a> 。&lt;/p>
&lt;p>采用新机制避免了因为网卡的检测顺序、增删网卡等导致的网卡名称不持久，但却导致网卡的名称没有规律可循，而云平台初始化裸金属时需要能够明确地配置指定物理机网卡的IP配置。&lt;/p>
&lt;p>为此，Cloudpods按照PXE引导系统探测网卡的顺序给网卡依次命名为en0, en1, &amp;hellip;&lt;/p>
&lt;p>为了实现网卡的自定义命名，Cloudpods做了如下操作：&lt;/p>
&lt;ol>
&lt;li>
&lt;p>关闭 Predictable-Network-Interface-Names 机制，需要修改 /etc/default/grub，在内核启动参数添加 &amp;ldquo;net.ifnames=0 biosdevnames=0&amp;rdquo;&lt;/p>
&lt;/li>
&lt;li>
&lt;p>修改 /etc/udev/rules.d/70-persistent-net.rules ，一次写入网卡的mac和名称映射关系，udev将按照mac对网卡进行命名&lt;/p>
&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">KERNEL&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">==&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;*&amp;#34;&lt;/span>, &lt;span style="color:#000">SUBSYSTEM&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">==&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;net&amp;#34;&lt;/span>, &lt;span style="color:#000">ACTION&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">==&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;add&amp;#34;&lt;/span>, &lt;span style="color:#000">DRIVERS&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">==&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;?*&amp;#34;&lt;/span>, ATTR&lt;span style="color:#ce5c00;font-weight:bold">{&lt;/span>address&lt;span style="color:#ce5c00;font-weight:bold">}==&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;00:22:a6:48:39:10&amp;#34;&lt;/span>, ATTR&lt;span style="color:#ce5c00;font-weight:bold">{&lt;/span>type&lt;span style="color:#ce5c00;font-weight:bold">}==&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;1&amp;#34;&lt;/span>, &lt;span style="color:#000">NAME&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;en0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">KERNEL&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">==&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;*&amp;#34;&lt;/span>, &lt;span style="color:#000">SUBSYSTEM&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">==&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;net&amp;#34;&lt;/span>, &lt;span style="color:#000">ACTION&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">==&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;add&amp;#34;&lt;/span>, &lt;span style="color:#000">DRIVERS&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">==&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;?*&amp;#34;&lt;/span>, ATTR&lt;span style="color:#ce5c00;font-weight:bold">{&lt;/span>address&lt;span style="color:#ce5c00;font-weight:bold">}==&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;00:22:a6:48:39:11&amp;#34;&lt;/span>, ATTR&lt;span style="color:#ce5c00;font-weight:bold">{&lt;/span>type&lt;span style="color:#ce5c00;font-weight:bold">}==&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;1&amp;#34;&lt;/span>, &lt;span style="color:#000">NAME&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;en1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="物理机更换网卡后的注意事项">物理机更换网卡后的注意事项&lt;/h2>
&lt;p>物理机如果更换网卡，首先需要同时更新Cloudpods对应物理机的网卡数据，具体操作请参见 &lt;a href="../change_netif">更换网卡&lt;/a> 。&lt;/p>
&lt;p>同时，由于采用了如上自定义命名网卡的机制，新加入的网卡的mac不在udev的规则中，会出现新网卡的命名不遵循enX的命名规律，导致网卡的IP配置不生效。因此需要采用如下措施修改udev的命名规则：&lt;/p>
&lt;ol>
&lt;li>
&lt;p>手动修改 /etc/udev/rules.d/70-persistent-net.rules&lt;/p>
&lt;/li>
&lt;li>
&lt;p>如果允许物理机重启，可以执行如下命令，让物理机重启boot进入PXE引导系统，初始化一系列配置文件，包括udev的配置文件：&lt;/p>
&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>climc server-deploy &amp;lt;baremetal_server_id&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Docs: Bonding模式共享BMC网口</title><link>https://www.cloudpods.org//v3.9/zh/docs/function_principle/onpremise/baremetal/bonding_shared_bmc_nic/</link><pubDate>Mon, 20 Sep 2021 22:25:05 +0800</pubDate><guid>https://www.cloudpods.org//v3.9/zh/docs/function_principle/onpremise/baremetal/bonding_shared_bmc_nic/</guid><description>
&lt;h2 id="双网卡bonding模式下共享bmc网口不工作怎么办">双网卡Bonding模式下共享BMC网口不工作怎么办？&lt;/h2>
&lt;p>为了保证网卡的物理冗余，Bonding是常见的技术手段。Bonding将两个物理网口绑定为一个虚拟的网口，使得任意一个网口失效都不会影响该网口的通信。更多信息请参见 &lt;a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/networking_guide/ch-configure_network_bonding">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/networking_guide/ch-configure_network_bonding&lt;/a> 。开启Bonding后，当物理机通过Bonding网口发送报文时，会按照Bonding配置的模式，以主备或者负载均衡的方式，选择其中一个物理网口发送报文。反之，当交换机向物理机的Bonding网口发送报文时，也会按照规则选择其中一个网口作为实际的接收网口发送报文，接收到的报文在服务器的虚拟Bonding网口进行重组，就好像报文是通过一个网口接收的一样。&lt;/p>
&lt;p>BMC网口是网络访问物理服务器BMC带外管理服务的网络接口，有两种模式：1）专用网口（dedicated），物理机主板上有一个专门的独立网口用于访问BMC。2）共享模式（shared）：可以通过物理机的板载通信网口（一般是第一个口）访问BMC，这个时候通过第一个口既可以访问物理机的第一个网口，也可以访问BMC，可以理解为第一个网口有两个mac地址，一个是BMC的网口mac，另一个是正常的网口的mac。为了便于部署，节约交换机网口和网线，很多时候会采用共享模式的BMC网口。BMC网口采用专用还是共享模式需要在BMC的控制面板进行设置。&lt;/p>
&lt;p>当开启了BMC共享网口模式，使用第一个板载物理网口作为共享BMC口，同时又使用第一二个网口bonding的时候，往往会导致BMC网口访问失效。究其原因也比较容易理解：当外部访问BMC网口时，交换机会认为访问BMC的报文也是一个访问物理机的普通报文，会按照发送给物理机bonding网口的逻辑处理，选择其中一个网口发送。但是，由于BMC网口只监听在第一个网口，交换机通过第二个网口发送的报文就无法被BMC接收到。这样BMC无法正常接收报文，导致BMC网络功能无法正常访问。&lt;/p>
&lt;p>要解决这个问题，原理也比较简单：需要在物理机上联的交换机上做路由策略，将访问BMC的报文必须从指定的第一个网口发送，这样BMC就能接收到完整的报文，从而能够正常通信。&lt;/p>
&lt;p>然而，配置这样的路由策略比较复杂。&lt;/p>
&lt;p>庆幸的是，目前一些新型交换机已经为此场景设计了专门的命令，用来解决这个问题。例如，H3C的交换机就增加配置聚合管理VLAN和聚合管理端口的专用命令，如下图所示。&lt;/p>
&lt;img src="../images/link-aggregation-management.png">
&lt;p>具体请参见：https://www.h3c.com/cn/d_201903/1157320_30005_0.htm#_Toc4502224&lt;/p></description></item><item><title>Docs: 物理机与宿主机互相转换</title><link>https://www.cloudpods.org//v3.9/zh/docs/function_principle/onpremise/baremetal/convert/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.cloudpods.org//v3.9/zh/docs/function_principle/onpremise/baremetal/convert/</guid><description>
&lt;h3 id="转换为宿主机">转换为宿主机&lt;/h3>
&lt;p>该功能用于将物理机设备转换成宿主机。物理机用于创建裸金属服务器，宿主机用于创建虚拟机。&lt;/p>
&lt;h4 id="准备工作">准备工作&lt;/h4>
&lt;ol>
&lt;li>宿主机即安装了host服务的计算节点，在云管平台上将物理机转换为宿主机时需要使用由我司提供的专门制作的宿主机镜像，镜像可从下面地址获取：
&lt;ul>
&lt;li>v3.9 镜像：https://iso.yunion.cn/vm-images/host-convert-v39-20230404.qcow2&lt;/li>
&lt;li>v3.9 UEFI 镜像(宿主机如果是 UEFI 启动)：https://iso.yunion.cn/vm-images/host-convert-uefi-v39-20230404.qcow2&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>将该镜像上传到管理平台，并记录该镜像的id信息。&lt;/li>
&lt;li>在控制节点上通过climc命令设置物理机转换宿主机的默认镜像。&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 设置默认镜像的镜像id&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ climc service-config --config &lt;span style="color:#000">convert_hypervisor_default_template&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>a9b67435-8c08-4063-8ea6-d885ea26aa79 region2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="4">
&lt;li>将物理机转换为宿主机时可直接选择磁盘RAID设置参数，进行转换宿主机操作。或通过自定义设置选择宿主机镜像，进行转换宿主机操作。&lt;/li>
&lt;/ol>
&lt;h4 id="操作步骤">操作步骤&lt;/h4>
&lt;p>&lt;big>&lt;strong>climc操作&lt;/strong>&lt;/big>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 转换为宿主机&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>climc host-convert-hypervisor
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="回收为物理机">回收为物理机&lt;/h3>
&lt;p>该功能用于将宿主机回收成物理机。当宿主机类型为KVM且包含IPMI信息时可转为宿主机。物理机用于创建裸金属服务器，宿主机用于创建虚拟机。&lt;/p>
&lt;p>&lt;big>&lt;strong>climc操作&lt;/strong>&lt;/big>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 回收为物理机&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>climc host-undo-convert &amp;lt;host_id&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Docs: 物理机硬件规格要求</title><link>https://www.cloudpods.org//v3.9/zh/docs/function_principle/onpremise/baremetal/hardware-requirements/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.cloudpods.org//v3.9/zh/docs/function_principle/onpremise/baremetal/hardware-requirements/</guid><description>
&lt;h2 id="cpu-架构">CPU 架构&lt;/h2>
&lt;p>x86&lt;/p>
&lt;h2 id="bios-主板">BIOS 主板&lt;/h2>
&lt;ul>
&lt;li>支持 Legacy(传统模式) 的 PXE 引导网络启动&lt;/li>
&lt;li>支持 BMC IPMI 带外控制 (开启IPMI-over-LAN)&lt;/li>
&lt;li>如果设置了 PXE、硬盘启动的引导顺序，当 PXE 启动不成功的时候，会尝试磁盘启动&lt;/li>
&lt;/ul>
&lt;h2 id="硬盘">硬盘&lt;/h2>
&lt;p>硬盘支持 HDD(机械硬盘)、SSD(固态硬盘) 和 NVME SSD。&lt;/p>
&lt;p>支持以下 RAID 驱动：&lt;/p>
&lt;ul>
&lt;li>MegaRaid&lt;/li>
&lt;li>HPSARaid&lt;/li>
&lt;li>Mpt2/3SAS&lt;/li>
&lt;li>AdaptecRaid&lt;/li>
&lt;li>MarvelRaid&lt;/li>
&lt;/ul>
&lt;p>NVME SSD 需要内核中 &lt;strong>nvme&lt;/strong> 或者 &lt;strong>nvme_core&lt;/strong> 驱动的&lt;/p>
&lt;h2 id="网卡">网卡&lt;/h2>
&lt;p>支持以下内核网卡驱动：&lt;/p>
&lt;ul>
&lt;li>ixgbe&lt;/li>
&lt;li>igb&lt;/li>
&lt;li>e1000, e100e&lt;/li>
&lt;li>tg3&lt;/li>
&lt;li>bnx2&lt;/li>
&lt;li>i40e&lt;/li>
&lt;li>bnx2x&lt;/li>
&lt;li>bnxt_en&lt;/li>
&lt;/ul></description></item><item><title>Docs: 物理机测试方案</title><link>https://www.cloudpods.org//v3.9/zh/docs/function_principle/onpremise/baremetal/testcase/</link><pubDate>Fri, 19 Jul 2019 20:25:05 +0800</pubDate><guid>https://www.cloudpods.org//v3.9/zh/docs/function_principle/onpremise/baremetal/testcase/</guid><description>
&lt;h2 id="1-环境要求">1. 环境要求&lt;/h2>
&lt;h3 id="11-物理机设置">1.1 物理机设置&lt;/h3>
&lt;p>物理机设置要求如下：&lt;/p>
&lt;ol>
&lt;li>
&lt;p>物理机的启动方式推荐采用legacy（BIOS）方式，UEFI方式不推荐。只有在必须采用UEFI时才选用UEFI。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>物理机的默认启动方式为网络PXE启动，硬盘启动为第二顺位的启动介质&lt;/p>
&lt;/li>
&lt;li>
&lt;p>需要允许物理机网卡的PXE启动（BIOS开启IPMI-over-LAN）&lt;/p>
&lt;/li>
&lt;li>
&lt;p>需要允许网络访问物理机的BMC（BIOS开启网卡PXE）&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="12-测试网络设置">1.2 测试网络设置&lt;/h3>
&lt;p>物理服务器的网络接口（NIC）分为BMC NIC和服务器NIC，BMC NIC用于通过网络访问物理机的BMC控制功能，BMC NIC可以配置为和服务器NIC共享物理机接口，也可以配置为独立的网络接口。&lt;/p>
&lt;img src="../images/baremetal_test.png" width="700">
&lt;p>其中，交换机0为部署服务的节点接入的三层交换机，交换机1为待管理物理服务器的服务器NIC接入三层交换机，交换机2为待管理物理服务器的BMC NIC接入三层交换机。&lt;/p>
&lt;p>此处，交换机0，1，2可以是同一个三层交换机，这是最简化的场景，也就是服务节点、待管理交换机的服务器NIC、以及BMC NIC都在一个二层网络内。&lt;/p>
&lt;p>一般物理机服务器采用bonding需要配置双NIC接入。目前只支持802.3ad LACP模式，也就是mode为4的bond。如果要支持bond这种模式，需要物理机的两个NIC都接入交换机1，此处交换机1可能是一对堆叠交换机。&lt;/p>
&lt;h3 id="13-ip子网设置">1.3 IP子网设置&lt;/h3>
&lt;p>需要在平台做如下配置用于物理机的IP地址分配：新建物理机用二层网络（如：brbm），如果物理机BMC NIC和物理机 NIC的二层网络隔离，则需新建BMC NIC用二层网络 brbmc。在二层网络brbm上新建属性为baremetal或PXE的IP子网（vbm），用于分配物理机NIC的IP地址。在二层网络brbmc（或bmbm）上新建属性为IPMI的 IP子网，用于分配BMC NIC的IP地址（vbmc）。&lt;/p>
&lt;p>连通性要求：要求baremetal agent能够直接访问vbm和vbmc的IP地址。&lt;/p>
&lt;h3 id="14-交换机设置">1.4 交换机设置&lt;/h3>
&lt;p>为了允许物理机能够网络PXE启动，需要设置交换机1的dhcp_relay为bareemetal_agent所在节点IP地址的UDP 67端口。&lt;/p>
&lt;p>如果采用“预注册”方式注册物理机，则也需要设置交换机2的dhcp_relay为baremetal_agent所在节点IP地址的UDP 67端口。&lt;/p>
&lt;p>在最简网络模式下，依旧是上文所说的服务和待管理物理机在同一个IP子网的网络配置下，如果不方便开启三层交换机的dhcp_relay，则可以借用Cloudpods的Host服务，开启其dhcp_relay功能，作为测试IP子网的dhcp relay服务器。具体开启方法为：修改该Host服务所在宿主机的配置文件 /etc/yunion/host.conf，增加 dhcp_relay 的配置项，内容为baremetal_agent部署节点IP的UDP 67端口。配置好后，记得重启该host服务。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">dhcp_relay&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>- &lt;span style="color:#0000cf;font-weight:bold">192.168.222.101&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>- &lt;span style="color:#0000cf;font-weight:bold">67&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>注意&lt;/strong> 待管理物理机所在网络内不能有其他DHCP服务器！&lt;/p>
&lt;h3 id="15-物理机硬件信息要求">1.5 物理机硬件信息要求&lt;/h3>
&lt;p>需要提前准备好物理机的如下信息：&lt;/p>
&lt;ol>
&lt;li>如果采用PXE引导注册或预注册的物理服务器，需要第一个网络PXE启动的物理机 NIC的mac地址&lt;/li>
&lt;li>如果采用PXE引导注册或ISO引导注册，需要物理机的BMC NIC的IP地址和BMC 账号，密码。&lt;/li>
&lt;/ol>
&lt;h2 id="2-测试流程">2. 测试流程&lt;/h2>
&lt;h3 id="21-物理机注册">2.1 物理机注册&lt;/h3>
&lt;p>物理机注册实现将一台物理机注册到云平台，云平台会引导物理机启动进入一个网络加载的内存Linux系统，通过该Linux接管物理机，实现自动采集物理机的配置信息，并注册到平台。&lt;/p>
&lt;p>支持如下四种注册方式：&lt;/p>
&lt;h4 id="211-pxe引导注册推荐方式">2.1.1 PXE引导注册(推荐方式)&lt;/h4>
&lt;p>物理机已经配置BMC NIC的IP，通过BMC控制物理服务器通过PXE协议引导物理机网络启动进入内存Linux系统。这种方式依赖PXE网络启动，因此要求设置交换机1的dhcp_relay。&lt;/p>
&lt;h4 id="212-iso引导注">2.1.2 ISO引导注&lt;/h4>
&lt;p>物理机已经配置BMC NIC的IP，通过物理机的虚拟ISO介质引导物理机启动进入内存Linux系统。这种方式不依赖PXE启动，因此不要求设置交换机1的dhcp_relay。但是要求物理机支持设置BMC的虚拟机ISO介质，一般只有最新的少数物理服务器支持，例如HPE Gen10。&lt;/p>
&lt;h4 id="213-预注册">2.1.3 预注册&lt;/h4>
&lt;p>和PXE引导注册类似，但是物理机未配置BMC NIC的IP。这种方式会自动设置BMC NIC的IP，需要探测BMC NIC的连通性，因此需要设置交换机2的dhcp_relay。&lt;/p>
&lt;h4 id="214-托管">2.1.4 托管&lt;/h4>
&lt;p>这种方式适用于已经安装了操作系统，不适合进行开关机操作的物理服务器的注册。这种方式只支持物理服务器上已安装系统为Linux。这种方式要求管理员在物理服务器的操作系统内执行指定的脚本命令，并输入物理服务器的BMC NIC IP和密码，实现物理服务器的注册。&lt;/p>
&lt;h3 id="22-物理机安装操作系统">2.2 物理机安装操作系统&lt;/h3>
&lt;p>使用上述注册的物理机安装操作系统。我们将安装了操作系统的物理机成为“裸金属”服务器。&lt;/p>
&lt;p>注意：&lt;/p>
&lt;ol>
&lt;li>如果物理服务器采用双网卡接入，可以测试自动设置网卡的bonding模式，此时网卡需要勾选“bond”选项&lt;/li>
&lt;li>新安装的操作系统的IP地址可以复用物理服务器PXE启动注册用的PXE IP地址，此时选择网络需要注册还是选择PXE IP子网。&lt;/li>
&lt;/ol>
&lt;h3 id="23-安装物理机监控agent">2.3 安装物理机监控agent&lt;/h3>
&lt;p>在“裸金属”服务器的监控面板，安装监控agent，查看物理机是否有监控指标数据。&lt;/p>
&lt;h3 id="24-删除操作系统">2.4 删除操作系统&lt;/h3>
&lt;p>删除“裸金属”服务器上安装的操作系统，成为一台“闲置”的物理机&lt;/p></description></item><item><title>Docs: 如何手动更改安装了操作系统的裸金属服务器RAID配置</title><link>https://www.cloudpods.org//v3.9/zh/docs/function_principle/onpremise/baremetal/manual_change_raid/</link><pubDate>Wed, 09 Jun 2021 22:25:05 +0800</pubDate><guid>https://www.cloudpods.org//v3.9/zh/docs/function_principle/onpremise/baremetal/manual_change_raid/</guid><description>
&lt;h2 id="手动更改安装了操作系统的裸金属服务器的raid配置">手动更改安装了操作系统的裸金属服务器的RAID配置&lt;/h2>
&lt;p>Cloudpods裸金属管理可以实现在安装操作系统的过程中，自动化地配置RAID配置，支持MegaRaid，HPSmart Array等RAID卡。但是安装完操作系统后，在不重装系统的情况下，无法重新自动配置RAID，例如，给RAID增加磁盘或者更改RAID级别等。这时候就必须通过手动方式进行。本文介绍如何手动更改安装了操作系统的裸金属服务器的RAID配置。&lt;/p>
&lt;ol>
&lt;li>将该裸金属服务器重启进入维护模式&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>climc host-maintenance &amp;lt;host_id&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>该命令将重启物理机，并启动进入网络PXE引导的内存操作系统&lt;/p>
&lt;ol start="2">
&lt;li>等引导启动进入内存操作系统后，ssh登入该系统&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>climc host-ssh &amp;lt;host_id&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="3">
&lt;li>更改RAID配置&lt;/li>
&lt;/ol>
&lt;p>RAID的工具软件位于内存操作系统的/opt目录下，包含MegaRaid, HPSA, SAS, Marvel等RAID的控制工具软件&lt;/p>
&lt;ol start="4">
&lt;li>更改RAID配置完成后，重启恢复已安装的操作系统&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>climc host-unmaintenance &amp;lt;host_id&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>
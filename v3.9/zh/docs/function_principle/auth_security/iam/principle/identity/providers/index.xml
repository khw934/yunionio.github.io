<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Cloudpods –
认证源</title><link>https://www.cloudpods.org//v3.9/zh/docs/function_principle/auth_security/iam/principle/identity/providers/</link><description>Recent content in 认证源 on Cloudpods</description><generator>Hugo -- gohugo.io</generator><lastBuildDate>Sun, 04 Aug 2019 20:51:23 +0800</lastBuildDate><atom:link href="https://www.cloudpods.org//v3.9/zh/docs/function_principle/auth_security/iam/principle/identity/providers/index.xml" rel="self" type="application/rss+xml"/><item><title>Docs: SQL认证源</title><link>https://www.cloudpods.org//v3.9/zh/docs/function_principle/auth_security/iam/principle/identity/providers/sql/</link><pubDate>Sun, 04 Aug 2019 20:51:23 +0800</pubDate><guid>https://www.cloudpods.org//v3.9/zh/docs/function_principle/auth_security/iam/principle/identity/providers/sql/</guid><description>
&lt;p>SQL认证源的用户和组信息存储在Keystone本地数据库。SQL认证源无需配置，默认启用。每个服务使用的系统用户都是SQL认证源用户。&lt;/p></description></item><item><title>Docs: LDAP认证源</title><link>https://www.cloudpods.org//v3.9/zh/docs/function_principle/auth_security/iam/principle/identity/providers/ldap/</link><pubDate>Sun, 04 Aug 2019 20:51:23 +0800</pubDate><guid>https://www.cloudpods.org//v3.9/zh/docs/function_principle/auth_security/iam/principle/identity/providers/ldap/</guid><description>
&lt;p>Cloudpods LDAP认证源支持从LDAP导入用户和组，其中支持Microsoft Active Directory (MSAD) 和OpenLDAP，以及通用的LDAP服务端。&lt;/p>
&lt;p>域，用户和组的定义来源于LDAP。不允许添加删除。不可修改字段如下表所示。&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>资源&lt;/th>
&lt;th>不可修改字段名称&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>域&lt;/td>
&lt;td>name&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>组&lt;/td>
&lt;td>name, displayname&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>用户&lt;/td>
&lt;td>name, displayname, enabled, mobile, email, password&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>ldap认证源的基础配置如下：&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>配置项&lt;/th>
&lt;th>说明&lt;/th>
&lt;th>举例&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>url&lt;/td>
&lt;td>服务器地址，必须以ldap://或者ldaps://开头&lt;/td>
&lt;td>ldap://192.168.222.201:389&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>suffix&lt;/td>
&lt;td>LDAP根路径的DN&lt;/td>
&lt;td>DC=ipa,DC=yunionyun,DC=com&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>user&lt;/td>
&lt;td>接入LDAP只读账户的用户名，对于AD，是用户名，对于openldap，是用户的DN&lt;/td>
&lt;td>UID=dcadmin,CN=users,CN=accounts,DC=ipa,DC=yunionyun,DC=com&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>password&lt;/td>
&lt;td>接入LDAP只读账户的密码&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>对于导入单域的模板，需要指定user_tree_dn和group_tree_dn两个参数&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>配置项&lt;/th>
&lt;th>说明&lt;/th>
&lt;th>举例&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>user_tree_dn&lt;/td>
&lt;td>用户查找根路径，将会在该路径下递归查找用户&lt;/td>
&lt;td>CN=users,CN=accounts,DC=ipa,DC=yunionyun,DC=com&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>group_tree_dn&lt;/td>
&lt;td>组查找跟路径，将会在该路径下递归查找组&lt;/td>
&lt;td>CN=groups,CN=accounts,DC=ipa,DC=yunionyun,DC=com&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>对于导入多域的模板，需要指定domain_tree_dn&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>配置项&lt;/th>
&lt;th>说明&lt;/th>
&lt;th>举例&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>domain_tree_dn&lt;/td>
&lt;td>域查找根路径，将会在该路径下的一级子节点中查找域&lt;/td>
&lt;td>OU=集团公司,DC=yuniondc,DC=com&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>对于非模板的LDAP配置，有如下的配置项：&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>配置项&lt;/th>
&lt;th>说明&lt;/th>
&lt;th>msad_one_domain默认值&lt;/th>
&lt;th>msad_multi_domain默认值&lt;/th>
&lt;th>openldap_one_domain默认值&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>query_scope&lt;/td>
&lt;td>默认查找范围：tree_dn下的整个substree（sub）还是当前级别（one）&lt;/td>
&lt;td>NA&lt;/td>
&lt;td>NA&lt;/td>
&lt;td>NA&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>import_domain&lt;/td>
&lt;td>是否导入域&lt;/td>
&lt;td>false&lt;/td>
&lt;td>true&lt;/td>
&lt;td>false&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>domain_tree_dn&lt;/td>
&lt;td>如果import_domain为true，导入域信息的根路径&lt;/td>
&lt;td>NA&lt;/td>
&lt;td>-&lt;/td>
&lt;td>NA&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>domain_filter&lt;/td>
&lt;td>查找域的过滤器&lt;/td>
&lt;td>NA&lt;/td>
&lt;td>-&lt;/td>
&lt;td>NA&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>domain_objectclass&lt;/td>
&lt;td>对应域的对象的class&lt;/td>
&lt;td>NA&lt;/td>
&lt;td>organizationalUnit&lt;/td>
&lt;td>NA&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>domain_id_attribute&lt;/td>
&lt;td>域ID对应的属性名&lt;/td>
&lt;td>NA&lt;/td>
&lt;td>objectGUID&lt;/td>
&lt;td>NA&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>domain_name_attribute&lt;/td>
&lt;td>域名称对应的属性名&lt;/td>
&lt;td>NA&lt;/td>
&lt;td>name&lt;/td>
&lt;td>NA&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>domain_query_scope&lt;/td>
&lt;td>查找域信息的范围：sub或one&lt;/td>
&lt;td>NA&lt;/td>
&lt;td>one&lt;/td>
&lt;td>NA&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>user_tree_dn&lt;/td>
&lt;td>导入用户信息的根节点的DN，如果import_domain为true，则该字段无意义&lt;/td>
&lt;td>-&lt;/td>
&lt;td>NA&lt;/td>
&lt;td>-&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>user_filter&lt;/td>
&lt;td>查找用户的过滤器&lt;/td>
&lt;td>-&lt;/td>
&lt;td>-&lt;/td>
&lt;td>-&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>user_objectclass&lt;/td>
&lt;td>对应用户的对象的class&lt;/td>
&lt;td>organizationalPerson&lt;/td>
&lt;td>organizationalPerson&lt;/td>
&lt;td>person&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>user_id_attribute&lt;/td>
&lt;td>用户ID对应的对象属性名&lt;/td>
&lt;td>sAMAccountName&lt;/td>
&lt;td>sAMAccountName&lt;/td>
&lt;td>uid&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>user_name_attribute&lt;/td>
&lt;td>用户名对应的对象属性名&lt;/td>
&lt;td>sAMAccountName&lt;/td>
&lt;td>sAMAccountName&lt;/td>
&lt;td>uid&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>user_enabled_attribute&lt;/td>
&lt;td>用户启用的属性名&lt;/td>
&lt;td>userAccountControl&lt;/td>
&lt;td>userAccountControl&lt;/td>
&lt;td>nsAccountLock&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>user_enabled_mask&lt;/td>
&lt;td>用户启用属性对应的掩码&lt;/td>
&lt;td>2 (0x10)&lt;/td>
&lt;td>2 (0x10)&lt;/td>
&lt;td>0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>user_enabled_default&lt;/td>
&lt;td>用户启用属性的缺省值&lt;/td>
&lt;td>512&lt;/td>
&lt;td>512&lt;/td>
&lt;td>FALSE&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>user_enabled_invert&lt;/td>
&lt;td>用户启用属性是否取反&lt;/td>
&lt;td>true&lt;/td>
&lt;td>true&lt;/td>
&lt;td>true&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>user_additional_attribute_mapping&lt;/td>
&lt;td>用户额外属性的映射表&lt;/td>
&lt;td>{&amp;ldquo;displayName:displayname&amp;rdquo;, &amp;ldquo;telephoneNumber:mobile&amp;rdquo;, &amp;ldquo;mail:email&amp;rdquo; }&lt;/td>
&lt;td>{&amp;ldquo;displayName:displayname&amp;rdquo;, &amp;ldquo;telephoneNumber:mobile&amp;rdquo;, &amp;ldquo;mail:email&amp;rdquo; }&lt;/td>
&lt;td>{&amp;ldquo;displayName:displayname&amp;rdquo;, &amp;ldquo;mobile:mobile&amp;rdquo;, &amp;ldquo;mail:email&amp;rdquo; }&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>user_query_scope&lt;/td>
&lt;td>查找用户信息的范围：sub或one&lt;/td>
&lt;td>sub&lt;/td>
&lt;td>sub&lt;/td>
&lt;td>sub&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>group_tree_dn&lt;/td>
&lt;td>导入组信息的根路径&lt;/td>
&lt;td>-&lt;/td>
&lt;td>-&lt;/td>
&lt;td>-&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>group_filter&lt;/td>
&lt;td>查找组的过滤器&lt;/td>
&lt;td>-&lt;/td>
&lt;td>-&lt;/td>
&lt;td>-&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>group_objectclass&lt;/td>
&lt;td>对应组的对象的class&lt;/td>
&lt;td>group&lt;/td>
&lt;td>group&lt;/td>
&lt;td>ipausergroup&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>group_id_attribute&lt;/td>
&lt;td>组ID对应的对象属性名&lt;/td>
&lt;td>sAMAccountName&lt;/td>
&lt;td>sAMAccountName&lt;/td>
&lt;td>cn&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>group_name_attribute&lt;/td>
&lt;td>组名对应的对象属性名&lt;/td>
&lt;td>name&lt;/td>
&lt;td>name&lt;/td>
&lt;td>cn&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>group_member_attribute&lt;/td>
&lt;td>组的成员属性对应的对象属性名&lt;/td>
&lt;td>member&lt;/td>
&lt;td>member&lt;/td>
&lt;td>member&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>group_members_are_ids&lt;/td>
&lt;td>租的成员列表包含的是用户ID还是用户名&lt;/td>
&lt;td>false&lt;/td>
&lt;td>false&lt;/td>
&lt;td>false&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>group_query_scope&lt;/td>
&lt;td>查找组信息的范围：sub或one&lt;/td>
&lt;td>sub&lt;/td>
&lt;td>sub&lt;/td>
&lt;td>sub&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="认证源的同步">认证源的同步&lt;/h3>
&lt;p>对于ldap等可以全量同步的认证源，会定期全量同步域、用户和组信息，同步周期默认15分钟，可以通过参数 default_sync_interval_seoncds 配置。&lt;/p>
&lt;h3 id="配置命令">配置命令&lt;/h3>
&lt;p>LDAP认证源支持三种模式：&lt;/p>
&lt;ol>
&lt;li>单域模式&lt;/li>
&lt;/ol>
&lt;p>将指定LDAP dn_tree下的用户和组导入到指定的一个域下。其中，该模式支持两种导入模板，一种是 msad_one_domain，也就是 MSAD 的导入模板，另外一种是 openldap_one_domain, 也就是OpenLDAP的导入模板。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">climc idp-create-ldap-single-domain --target-domain example_domain --url ldap://192.168.222.102 --suffix &lt;span style="color:#4e9a06">&amp;#39;DC=ipa,DC=example,DC=com&amp;#39;&lt;/span> --user &lt;span style="color:#4e9a06">&amp;#39;UID=dcadmin,CN=users,CN=accounts,DC=ipa,DC=example,DC=com&amp;#39;&lt;/span> --password &amp;lt;password&amp;gt; --user-tree-dn &lt;span style="color:#4e9a06">&amp;#39;CN=users,CN=accounts,DC=ipa,DC=example,DC=com&amp;#39;&lt;/span> --group-tree-dn &lt;span style="color:#4e9a06">&amp;#39;CN=groups,CN=accounts,DC=ipa,DC=example,DC=com&amp;#39;&lt;/span> mainLdap openldap_one_domain
&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>多域模式&lt;/li>
&lt;/ol>
&lt;p>将指定LDAP dn_tree下的每个OU导入为一个新的域，将对应OU下的用户和组分别导入到对应域下。该模式只支持一种模板 msad_multi_domain，也就是只支持 MSAD 的导入(因为只有MSAD支持OU的概念）。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">climc idp-create-ldap-multi-domain --url &lt;span style="color:#4e9a06">&amp;#39;ldap://192.168.222.102&amp;#39;&lt;/span> --suffix &lt;span style="color:#4e9a06">&amp;#39;DC=example,DC=com&amp;#39;&lt;/span> --user &lt;span style="color:#4e9a06">&amp;#39;dcadmin&amp;#39;&lt;/span> --password &amp;lt;password&amp;gt; --domain-tree-dn &lt;span style="color:#4e9a06">&amp;#39;OU=集团公司,DC=example,DC=com&amp;#39;&lt;/span> multildap msad_multi_domain
&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="3">
&lt;li>自定义模式&lt;/li>
&lt;/ol>
&lt;p>完全自定义模式，需要用户指定所有的LDAP参数。这种模式参数比较复杂，只有在以上模式不生效情况下才建议使用。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">climc idp-create-ldap &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--no-auto-create-project&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--target-domain TARGET_DOMAIN&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--auto-create-project&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--query-scope &lt;span style="color:#ce5c00;font-weight:bold">{&lt;/span>one,sub&lt;span style="color:#ce5c00;font-weight:bold">}]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--user USER&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--password PASSWORD&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--disable-user-on-import&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--domain-tree-dn DOMAIN_TREE_DN&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--domain-filter DOMAIN_FILTER&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--domain-objectclass DOMAIN_OBJECTCLASS&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--domain-id-attribute DOMAIN_ID_ATTRIBUTE&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--domain-name-attribute DOMAIN_NAME_ATTRIBUTE&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--domain-query-scope &lt;span style="color:#ce5c00;font-weight:bold">{&lt;/span>one,sub&lt;span style="color:#ce5c00;font-weight:bold">}]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--user-tree-dn USER_TREE_DN&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--user-filter USER_FILTER&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--user-objectclass USER_OBJECTCLASS&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--user-id-attribute USER_ID_ATTRIBUTE&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--user-name-attribute USER_NAME_ATTRIBUTE&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--user-enabled-attribute USER_ENABLED_ATTRIBUTE&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--user-enabled-mask USER_ENABLED_MASK&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--user-enabled-default USER_ENABLED_DEFAULT&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--user-enabled-invert&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--user-additional-attribute USER_ADDITIONAL_ATTRIBUTE&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--user-query-scope &lt;span style="color:#ce5c00;font-weight:bold">{&lt;/span>one,sub&lt;span style="color:#ce5c00;font-weight:bold">}]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--group-tree-dn GROUP_TREE_DN&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--group-filter GROUP_FILTER&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--group-objectclass GROUP_OBJECTCLASS&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--group-id-attribute GROUP_ID_ATTRIBUTE&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--group-name-attribute GROUP_NAME_ATTRIBUTE&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--group-member-attribute GROUP_MEMBER_ATTRIBUTE&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--group-members-are-ids&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--group-query-scope &lt;span style="color:#ce5c00;font-weight:bold">{&lt;/span>one,sub&lt;span style="color:#ce5c00;font-weight:bold">}]&lt;/span> &amp;lt;--url URL&amp;gt; &amp;lt;--suffix SUFFIX&amp;gt; &amp;lt;NAME&amp;gt;
&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Cloudpods –
操作指南</title><link>https://www.cloudpods.org//v3.8/zh/docs/monitor_ops/monitor/tutorial/</link><description>Recent content in 操作指南 on Cloudpods</description><generator>Hugo -- gohugo.io</generator><lastBuildDate>Fri, 19 Jul 2019 20:59:00 +0800</lastBuildDate><atom:link href="https://www.cloudpods.org//v3.8/zh/docs/monitor_ops/monitor/tutorial/index.xml" rel="self" type="application/rss+xml"/><item><title>Docs: 安装监控Agent</title><link>https://www.cloudpods.org//v3.8/zh/docs/monitor_ops/monitor/tutorial/installagent/</link><pubDate>Fri, 19 Jul 2019 20:59:00 +0800</pubDate><guid>https://www.cloudpods.org//v3.8/zh/docs/monitor_ops/monitor/tutorial/installagent/</guid><description>
&lt;p>Cloudpods 平台虚拟机默认支持免密登录，所以可以直接安装Agent。非Cloudpods 平台在安装Agent时需要判断当前虚拟机是否已支持免密登录。&lt;/p>
&lt;h2 id="安装监控agent">安装监控Agent&lt;/h2>
&lt;p>&lt;strong>Cloudpods 平台&lt;/strong>&lt;/p>
&lt;p>当Cloudpods平台上虚拟机和裸金属已默认直接免密登录时，可以直接安装Agent。&lt;/p>
&lt;ol>
&lt;li>在主机-主机-虚拟机/裸金属页面，单击虚拟机/裸金属名称项，进入虚拟机/裸金属详情页面。&lt;/li>
&lt;li>单击“监控”页签，进入监控页面。&lt;/li>
&lt;li>单击 &lt;strong>&lt;em>&amp;ldquo;安装Agent&amp;rdquo;&lt;/em>&lt;/strong> 按钮，直接安装Agent。&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>其他平台&lt;/strong>&lt;/p>
&lt;p>非Cloudpods平台上虚拟机在安装Agent前需要确保虚拟机已支持免密登录。如何将虚拟机设置为免密登录请参考&lt;a href="#%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95%E9%85%8D%E7%BD%AE">虚拟机免密登录配置&lt;/a>。&lt;/p>
&lt;ol>
&lt;li>在主机-主机-虚拟机页面，单击虚拟机名称项，进入虚拟机详情页面。&lt;/li>
&lt;li>单击“监控”页签，进入监控页面。&lt;/li>
&lt;li>单击 &lt;strong>&lt;em>&amp;ldquo;安装Agent&amp;rdquo;&lt;/em>&lt;/strong> 按钮，开始探测虚拟机的免密登录状态。
&lt;ul>
&lt;li>当虚拟机可以免密登录时，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，安装Agent。
&lt;ul>
&lt;li>当虚拟机所在VPC或IP中存在SSH代理节点时，将会直接安装Agent。&lt;/li>
&lt;li>当虚拟机所在VPC或IP中不存在SSH代理节点时，将会安装Agent失败，并提示创建SSH代理节点。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>当虚拟机不可免密登录时，请先将虚拟机设置为免密登录状态。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">说明&lt;/h4>
当Agent安装失败后，可以将鼠标移到到“安装失败，可尝试重新安装”上，将会展示Agent安装失败的具体原因。
&lt;/div>
&lt;h2 id="虚拟机免密登录配置">虚拟机免密登录配置&lt;/h2>
&lt;p>虚拟机支持被平台免密登录，有以下两点要求：&lt;/p>
&lt;ul>
&lt;li>虚拟机与平台网络通，即通过EIP、NAT网关或SSH代理等方式使虚拟机与平台网络通。
&lt;ul>
&lt;li>EIP、NAT网关等通过公网IP等使虚拟机可以直接与平台进行通信。&lt;/li>
&lt;li>SSH代理适用于为VPC内的虚拟机安装Agent，该场景适用于不想为VPC内的所有虚拟机都绑定EIP或NAT网关等，仅需要VPC内的一台虚拟机可以与平台网络连通即可，通过将该虚拟机设置为SSH代理节点，为VPC的其他虚拟机提供代理服务，使虚拟机可以与平台网络连通。可参考&lt;a href="#%E6%96%B0%E5%BB%BAssh%E4%BB%A3%E7%90%86%E8%8A%82%E7%82%B9">新建SSH代理节点&lt;/a>的步骤为VPC内的虚拟机设置SSH代理。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>虚拟机中存在平台的公钥文件。设置免密登录功能仅用于将平台的公钥拷贝到虚拟机中，请先确保虚拟机与平台网络通。&lt;/li>
&lt;/ul>
&lt;h3 id="设置免密登录">设置免密登录&lt;/h3>
&lt;p>该功能用于用于配置相关参数使虚拟机能够免密登录，设置免密登录之前需要确保虚拟机与平台网络通。&lt;/p>
&lt;p>&lt;strong>设置免密登录&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>在虚拟机页面，单击虚拟机右侧操作列 &lt;strong>&lt;em>&amp;ldquo;更多&amp;rdquo;&lt;/em>&lt;/strong> 按钮，选择 &lt;strong>&lt;em>&amp;ldquo;密码密钥-设置免密登录&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，弹出设置免密登录对话框。&lt;/li>
&lt;li>配置以下参数：
&lt;ul>
&lt;li>设置方式：支持密钥、密码、脚本等方式将平台的公钥上传到虚拟机上。
&lt;ul>
&lt;li>当设置方式为“密钥”时，请使用root用户或具有使用sudo免密权限的用户以其私钥，请确保可以通过用户名和私钥通过ssh连接到对应虚拟机，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，进入等待执行结果页面，开始设置并探测虚拟机的免密登录状态是否变为免密登录。&lt;/li>
&lt;li>当设置方式为“密码”时，请使用root用户或具有使用sudo免密权限的用户以其密码，请确保可以通过用户名和密码通过ssh连接到对应虚拟机。单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，进入等待执行结果页面，开始设置并探测虚拟机的免密登录状态是否变为免密登录。&lt;/li>
&lt;li>当设置方式为“脚本”时，请请使用root或具有sudo权限的用户在虚拟机中执行以下脚本，执行完成后，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，进入等待执行结果页面，开始设置并探测虚拟机的免密登录状态是否变为免密登录。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>SSH端口：当虚拟机SSH默认端口22被禁用后，可通过修改SSH端口连接到虚拟机。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>若虚拟机可以免密登录，直接单击 &lt;strong>&lt;em>&amp;ldquo;关闭&amp;rdquo;&lt;/em>&lt;/strong> 按钮。&lt;/li>
&lt;li>若虚拟机仍不可免密登录，请在操作列表查看不可免密登录的原因。
&lt;ul>
&lt;li>如报错原因中提示“Failed to connect to the host via ssh”，则需要先将该虚拟机通过绑定EIP或NAT网关以及SSH代理等方式，使其与平台网络可通。&lt;/li>
&lt;li>如报错原因中提示“Permission denied”，则表示输入的信息错误，可单击 &lt;strong>&lt;em>&amp;ldquo;上一步&amp;rdquo;&lt;/em>&lt;/strong> 按钮，修改配置，继续设置并探测。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>批量设置免密登录&lt;/strong>&lt;/p>
&lt;p>只支持批量为同一项目下的虚拟机设置免密登录。&lt;/p>
&lt;ol>
&lt;li>在虚拟机列表中选择一个或多个虚拟机，单击列表上方 &lt;strong>&lt;em>&amp;ldquo;批量操作&amp;rdquo;&lt;/em>&lt;/strong> 按钮，选择下拉菜单 &lt;strong>&lt;em>&amp;ldquo;密码密钥-设置免密登录&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，弹出设置免密登录对话框。&lt;/li>
&lt;li>配置以下参数：
&lt;ul>
&lt;li>设置方式：支持密钥、密码、脚本等方式将平台的公钥上传到虚拟机上。
&lt;ul>
&lt;li>当设置方式为“密钥”时，请使用root用户或具有使用sudo免密权限的用户以其私钥，请确保可以通过用户名和私钥通过ssh连接到对应虚拟机，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，进入等待执行结果页面，开始设置并探测虚拟机的免密登录状态是否变为免密登录。&lt;/li>
&lt;li>当设置方式为“密码”时，请使用root用户或具有使用sudo免密权限的用户以其密码，请确保可以通过用户名和密码通过ssh连接到对应虚拟机。单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，进入等待执行结果页面，开始设置并探测虚拟机的免密登录状态是否变为免密登录。&lt;/li>
&lt;li>当设置方式为“脚本”时，请请使用root或具有sudo权限的用户在虚拟机中执行以下脚本，执行完成后，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，进入等待执行结果页面，开始设置并探测虚拟机的免密登录状态是否变为免密登录。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>SSH端口：当虚拟机SSH默认端口22被禁用后，可通过修改SSH端口连接到虚拟机。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>若虚拟机可以免密登录，直接单击 &lt;strong>&lt;em>&amp;ldquo;关闭&amp;rdquo;&lt;/em>&lt;/strong> 按钮。&lt;/li>
&lt;li>若虚拟机仍不可免密登录，请在操作列表查看不可免密登录的原因。
&lt;ul>
&lt;li>如报错原因中提示“Failed to connect to the host via ssh”，则需要先将该虚拟机通过绑定EIP、NAT网关以或SSH代理等方式，使其与平台网络可通。&lt;/li>
&lt;li>如报错原因中提示“Permission denied”，则表示输入的信息错误，可单击 &lt;strong>&lt;em>&amp;ldquo;上一步&amp;rdquo;&lt;/em>&lt;/strong> 按钮，修改配置，继续设置并探测。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h3 id="探测免密登录">探测免密登录&lt;/h3>
&lt;p>该功能用于探测虚拟机是否能被平台免密登录。&lt;/p>
&lt;p>&lt;strong>探测免密登录&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>在虚拟机页面，单击虚拟机右侧操作列 &lt;strong>&lt;em>&amp;ldquo;更多&amp;rdquo;&lt;/em>&lt;/strong> 按钮，选择 &lt;strong>&lt;em>&amp;ldquo;密码密钥-探测免密登录&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，弹出探测免密登录对话框。&lt;/li>
&lt;li>开始探测免密登录，并支持在操作列表查看不可免密登录的原因。
&lt;ul>
&lt;li>如报错原因中提示“none publickey”，可通过设置免密登录功能，将虚拟机设置为免密登录状态。&lt;/li>
&lt;li>如报错原因中提示“network error”，则需要先将该虚拟机通过绑定EIP或NAT网关以及SSH代理等方式，使其与平台网络可通。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>批量探测免密登录&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>在虚拟机列表中选择一个或多个虚拟机，单击列表上方 &lt;strong>&lt;em>&amp;ldquo;批量操作&amp;rdquo;&lt;/em>&lt;/strong> 按钮，选择下拉菜单 &lt;strong>&lt;em>&amp;ldquo;密码密钥-探测免密登录&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，弹出探测免密登录对话框。&lt;/li>
&lt;li>开始探测免密登录，并支持在操作列表查看不可免密登录的原因。
&lt;ul>
&lt;li>如报错原因中提示“none publickey”，可通过设置免密登录功能，将虚拟机设置为免密登录状态。&lt;/li>
&lt;li>如报错原因中提示“network error”，则需要先将该虚拟机通过绑定EIP或NAT网关以及SSH代理等方式，使其与平台网络可通。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h3 id="新建ssh代理节点">新建SSH代理节点&lt;/h3>
&lt;p>该功能用于新建代理节点。&lt;/p>
&lt;h4 id="虚拟机配置要求">虚拟机配置要求&lt;/h4>
&lt;ul>
&lt;li>目前只支持Linux操作系统的虚拟机作为SSH代理节点。&lt;/li>
&lt;li>请确保虚拟机处于运行中状态；&lt;/li>
&lt;li>请确保虚拟机支持通过平台免密登录；虚拟机能被平台免密登录，则要求虚拟机与平台网络通（即通过EIP、NAT网关或SSH代理等方式使虚拟机与平台网络通）以及虚拟机中存在平台的公钥文件。&lt;/li>
&lt;li>请检查虚拟机的sshd配置，GatewayPorts是clientspecified，若该项值为no，则只允许绑定127.0.0.1的地址，使remote forward无法正常使用，造成安装监控Agent的虚拟机无法向平台上报监控数据等。&lt;/li>
&lt;/ul>
&lt;h4 id="操作步骤">操作步骤&lt;/h4>
&lt;ol>
&lt;li>在SSH代理节点页面，单击列表上方 &lt;strong>&lt;em>&amp;ldquo;新建&amp;rdquo;&lt;/em>&lt;/strong> 按钮，进入新建SSH代理节点页面。&lt;/li>
&lt;li>在选择虚拟机页面设置以下参数：
&lt;ul>
&lt;li>域：设置SSH代理节点所属域，并通过域过滤可选的虚拟机。&lt;/li>
&lt;li>名称：设置SSH代理节点的名称。&lt;/li>
&lt;li>区域：通过平台、区域过滤VPC。&lt;/li>
&lt;li>网络：通过VPC、网络过滤虚拟机。&lt;/li>
&lt;li>虚拟机：通过上面的筛选条件过滤出符合条件的虚拟机，并支持在搜索框中通过名称和IP搜索虚拟机，请确保所选的虚拟机符合&lt;a href="#%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%85%8D%E7%BD%AE%E8%A6%81%E6%B1%82">虚拟机配置要求&lt;/a>，如没有合适的虚拟机，可以单击“新建”超链接，跳转到虚拟机列表页面创建符合需求的虚拟机。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>选择好虚拟机后，单击 &lt;strong>&lt;em>&amp;ldquo;下一步&amp;rdquo;&lt;/em>&lt;/strong> 按钮，开始探测虚拟机的免密登录状态。
&lt;ul>
&lt;li>如虚拟机可免密登录，可直接单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，开始创建虚拟机。&lt;/li>
&lt;li>如虚拟机不可免密登录，请先点击列表操作列 &lt;strong>&lt;em>&amp;ldquo;查看&amp;rdquo;&lt;/em>&lt;/strong> 按钮，查看探测免密登录失败的具体原因。
&lt;ul>
&lt;li>如报错原因中提示“none publickey”，可通过设置免密登录功能，将虚拟机设置为免密登录状态。设置免密登录方式配置参数如下：
&lt;ul>
&lt;li>设置方式：支持密钥、密码、脚本等方式将平台的公钥上传到虚拟机上。&lt;/li>
&lt;li>当设置方式为“密钥”时，请使用root用户或具有使用sudo免密权限的用户以其私钥，请确保可以通过用户名和私钥通过ssh连接到对应虚拟机，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，开始设置并探测虚拟机的免密登录状态是否变为免密登录。&lt;/li>
&lt;li>当设置方式为“密码”时，请使用root用户或具有使用sudo免密权限的用户以其密码，请确保可以通过用户名和密码通过ssh连接到对应虚拟机。单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，开始设置并探测虚拟机的免密登录状态是否变为免密登录。&lt;/li>
&lt;li>当设置方式为“脚本”时，请请使用root或具有sudo权限的用户在虚拟机中执行以下脚本，执行完成后，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，开始设置并探测虚拟机的免密登录状态是否变为免密登录。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>如报错原因中提示“network error”，则需要返回上一步选择其他虚拟机，或为该虚拟机通过绑定EIP或NAT网关等方式，使其与平台网络可通。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>只有当虚拟机免密登录状态为“可免密登录”时，才支持单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，开始创建SSH代理节点。&lt;/li>
&lt;li>在创建SSH代理节点时将会检查虚拟机的sshd配置是否符合虚拟机配置要求，若不符合将会尝试变更虚拟机的sshd配置，因此可能会造成创建ssh代理节点时间过长，若提示超时，请重新单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，创建SSH代理节点。&lt;/li>
&lt;/ol></description></item></channel></rss>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Cloudpods –
常见问题</title><link>https://www.cloudpods.org//v3.8/zh/docs/onpremise/storage/faq/</link><description>Recent content in 常见问题 on Cloudpods</description><generator>Hugo -- gohugo.io</generator><atom:link href="https://www.cloudpods.org//v3.8/zh/docs/onpremise/storage/faq/index.xml" rel="self" type="application/rss+xml"/><item><title>Docs: 如何添加和删除本地存储</title><link>https://www.cloudpods.org//v3.8/zh/docs/onpremise/storage/faq/add-storage/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.cloudpods.org//v3.8/zh/docs/onpremise/storage/faq/add-storage/</guid><description>
&lt;p>本地存储的虚拟机磁盘存储在本地目录里，跟该目录使用的文件系统无关，可以使ext4或者xfs。虚拟磁盘的文件格式采用qcow2格式。默认的存储位置是宿主机的目录 /opt/cloud/workspace/disks。&lt;/p>
&lt;p>存储虚拟磁盘的本地目录需要在宿主机的配置文件里显示声明。host服务的配置项 local_image_path 指定本宿主机用来保存虚拟机磁盘的目录。&lt;/p>
&lt;h2 id="如何添加本地存储目录">如何添加本地存储目录？&lt;/h2>
&lt;ol>
&lt;li>修改/etc/yunion/host.conf，则 local_image_path 的字符串数组中添加新的本地磁盘：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#204a87;font-weight:bold">local_image_path&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>- &lt;span style="color:#000">/opt/cloud/workspace/disks&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>- &lt;span style="color:#000">/new_image_path&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>重启host服务&lt;/li>
&lt;/ol>
&lt;p>host服务重启后，稍等片刻，查看宿主机的存储列表，就能看到这个新的存储注册上来了。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">climc storage-list --host &amp;lt;HOST&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="如何删除本地存储">如何删除本地存储？&lt;/h2>
&lt;ol>
&lt;li>需要确保所有的虚拟磁盘都被删除，特别需要留意被伪删除的磁盘，以及被标记为系统资源的磁盘:&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#8f5902;font-style:italic"># 查看所有的磁盘，包括不再执行命令用户所在项目下的所有磁盘，以及被标记为系统资源的磁盘&lt;/span>
climc disk-list --storage --scope system --system
&lt;span style="color:#8f5902;font-style:italic"># 查看所有的未删除的磁盘&lt;/span>
climc disk-list --storage &amp;lt;storage_id&amp;gt; --scope system --system --pending-delete
&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>解除存储和宿主机的关联关系：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">climc host-storage-detach &amp;lt;HOST&amp;gt; &amp;lt;STORAGE&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="3">
&lt;li>删除存储&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">climc storage-delete &amp;lt;STORAGE&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="4">
&lt;li>
&lt;p>到宿主机，修改 /etc/yunion/host.conf，将该存储所在路径从 local_image_path 删除&lt;/p>
&lt;/li>
&lt;li>
&lt;p>重启host服务&lt;/p>
&lt;/li>
&lt;/ol></description></item></channel></rss>
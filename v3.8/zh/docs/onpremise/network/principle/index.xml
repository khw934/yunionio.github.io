<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Cloudpods –
原理介绍</title><link>https://www.cloudpods.org//v3.8/zh/docs/onpremise/network/principle/</link><description>Recent content in 原理介绍 on Cloudpods</description><generator>Hugo -- gohugo.io</generator><lastBuildDate>Tue, 03 Aug 2021 10:53:20 +0800</lastBuildDate><atom:link href="https://www.cloudpods.org//v3.8/zh/docs/onpremise/network/principle/index.xml" rel="self" type="application/rss+xml"/><item><title>Docs: 宿主机网络</title><link>https://www.cloudpods.org//v3.8/zh/docs/onpremise/network/principle/host/</link><pubDate>Tue, 03 Aug 2021 10:53:20 +0800</pubDate><guid>https://www.cloudpods.org//v3.8/zh/docs/onpremise/network/principle/host/</guid><description>
&lt;h2 id="经典网络">经典网络&lt;/h2>
&lt;p>宿主机内通过host服务的配置项networks（/etc/yunion/host.conf）指定宿主机的网络配置，该配置指定宿主机的指定物理网卡对应的二层网络，有两种配置方式：&lt;/p>
&lt;ul>
&lt;li>
&lt;p>网卡名称/网桥名称/网卡IP，例如：eth0/br0/192.168.222.10。这种配置模式告诉系统，宿主机的物理网卡eth0对接了192.168.222.10这个IP对应的IP子网对应的二层网络，并且将该物理网卡和网桥br0桥接。这种模式的物理网卡要被宿主机用来和外界通信，因此要配置一个有效的IP地址。在host服务启动时，会检测该IP是否配置在这个物理网卡上，如果不匹配，host服务会放弃启动。以此避免误配置该网卡。启动成功后，host服务会自动创建网桥，把物理网卡计入该网桥，并且把物理网卡上的IP配置信息迁移到网桥，以维持宿主机的正常网络通信。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>网卡名称/网桥名称/二层网络名称，例如：eth1/brpub/wire1。这种配置模式告诉系统，宿主机的物理网卡eth1对接了二层网络wire1，该网卡不需要配置有效IP地址，并且该物理网卡和网桥brpub桥接。这种模式的物理网卡不被宿主机用来通信，因此不需要显式地配置有效的IP地址。在host服务启动时，会检查该物理网卡是否没有IP，如果有IP，则会放弃启动。以此避免误操作。启动成功后，会自动创建网桥，把物理网卡加入该网桥，并且会自动分配一个169.254.0.0/16的IP给这个网桥。&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="宿主机网络配置对调度的影响">宿主机网络配置对调度的影响&lt;/h3>
&lt;p>当创建一台经典网络的虚拟机，调度器会查看虚拟机准备对接的IP子网，根据IP子网的二层网络过滤出对接的宿主机，把这些宿主机作为候选宿主机。&lt;/p>
&lt;h2 id="vpc网络">VPC网络&lt;/h2>
&lt;p>在host服务启动后，会在宿主机内创建用于vpc通信的网桥（默认名称为brvpc），所有对接VPC网络的虚拟机的虚拟网卡都要加入这个网桥。&lt;/p></description></item><item><title>Docs: 裸金属网络</title><link>https://www.cloudpods.org//v3.8/zh/docs/onpremise/network/principle/baremetal/</link><pubDate>Tue, 03 Aug 2021 10:53:20 +0800</pubDate><guid>https://www.cloudpods.org//v3.8/zh/docs/onpremise/network/principle/baremetal/</guid><description>
&lt;p>目前，裸金属服务器只能使用经典网络。&lt;/p>
&lt;h2 id="经典网络">经典网络&lt;/h2>
&lt;p>一台裸金属服务器有多个网卡，系统需要检测出这台裸金属的每个网口跟哪个二层网络对接，这样在分配裸金属服务器时，才能根据二层网络信息选择正确的IP子网。&lt;/p>
&lt;p>系统通过两种方式探测裸金属的网卡对接的二层网络：&lt;/p>
&lt;ul>
&lt;li>
&lt;p>自动探测：在裸金属的prepare阶段，裸金属会自动设置每个网卡进行dhcp探测，当这个网卡所在网络的交换机配置了dhcp relay，则会把发出的dhcp请求转发到baremetal agent。baremetal Agent根据dhcp报文的来源IP找到匹配的IP子网，从而判断出该物理机网卡归属的二层子网。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>手动设置：通过执行climc命令或者在前端界面，可以设置裸金属服务每个网卡对应的二层网络。&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>对应的climc命令为：&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">climc host-add-netif &amp;lt;host_id&amp;gt; &amp;lt;wire_id&amp;gt; &amp;lt;mac&amp;gt; &amp;lt;index&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="裸金属网络配置对调度的影响">裸金属网络配置对调度的影响&lt;/h3>
&lt;p>当用户申请一台裸金属服务器，并给定裸金属服务器对接的IP子网信息时，调度器会过滤出物理网口对接了该IP子网对应的二层网络的裸金属，作为候选。&lt;/p>
&lt;p>如果用户申请的裸金属服务器的网卡要做bonding，则调度器会选择同时具有两个网卡，并且两个网卡都对接了指定IP子网对应的二层网络。&lt;/p></description></item></channel></rss>
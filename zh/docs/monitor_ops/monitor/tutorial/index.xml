<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Cloudpods –
操作指南</title><link>https://www.cloudpods.org/zh/docs/monitor_ops/monitor/tutorial/</link><description>Recent content in 操作指南 on Cloudpods</description><generator>Hugo -- gohugo.io</generator><lastBuildDate>Fri, 19 Jul 2019 20:59:00 +0800</lastBuildDate><atom:link href="https://www.cloudpods.org/zh/docs/monitor_ops/monitor/tutorial/index.xml" rel="self" type="application/rss+xml"/><item><title>Docs: 监控总览</title><link>https://www.cloudpods.org/zh/docs/monitor_ops/monitor/tutorial/overview/</link><pubDate>Mon, 17 Jan 2022 14:59:41 +0800</pubDate><guid>https://www.cloudpods.org/zh/docs/monitor_ops/monitor/tutorial/overview/</guid><description>
&lt;p>支持查看未恢复告警的告警总数、近30日告警趋势以及支持从不同维度查看系统内的监控情况&lt;/p></description></item><item><title>Docs: 监控查询</title><link>https://www.cloudpods.org/zh/docs/monitor_ops/monitor/tutorial/metric/</link><pubDate>Mon, 17 Jan 2022 14:59:09 +0800</pubDate><guid>https://www.cloudpods.org/zh/docs/monitor_ops/monitor/tutorial/metric/</guid><description>
&lt;p>目前Cloudpods平台支持两种采集虚拟机监控指标的方式。&lt;/p>
&lt;ul>
&lt;li>默认情况下，通过宿主机或者公有云API提供的监控指标，主要包括CPU利用率、网络入流量、网络出流量、磁盘读速率、磁盘写速率等监控指标。&lt;/li>
&lt;li>如需获取更准确的监控指标，需要为虚拟机&lt;a href="./installagent">安装监控Agent&lt;/a>，可获取的监控指标，包括包括CPU使用率、内存使用率、网络入流量、网络出流量、磁盘使用率、磁盘读速率、磁盘写速率等。&lt;/li>
&lt;/ul></description></item><item><title>Docs: 监控面板</title><link>https://www.cloudpods.org/zh/docs/monitor_ops/monitor/tutorial/panel/</link><pubDate>Fri, 14 Jan 2022 17:16:24 +0800</pubDate><guid>https://www.cloudpods.org/zh/docs/monitor_ops/monitor/tutorial/panel/</guid><description/></item><item><title>Docs: 监控资源</title><link>https://www.cloudpods.org/zh/docs/monitor_ops/monitor/tutorial/resource/</link><pubDate>Mon, 17 Jan 2022 16:47:42 +0800</pubDate><guid>https://www.cloudpods.org/zh/docs/monitor_ops/monitor/tutorial/resource/</guid><description/></item><item><title>Docs: 自动迁移</title><link>https://www.cloudpods.org/zh/docs/monitor_ops/monitor/tutorial/auto_migration/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.cloudpods.org/zh/docs/monitor_ops/monitor/tutorial/auto_migration/</guid><description>
&lt;h2 id="使用场景">使用场景&lt;/h2>
&lt;ul>
&lt;li>当宿主机 CPU 使用率超过阈值或内存超过阈值后，自动迁移宿主机上部分虚拟机到指定范围的宿主机&lt;/li>
&lt;li>当宿主机 CPU 使用率超过阈值或内存超过阈值后，自动迁移宿主机上部分虚拟机到负载最空的宿主机&lt;/li>
&lt;/ul>
&lt;h2 id="监控指标">监控指标&lt;/h2>
&lt;p>每台宿主机都有对应的 cpu.usage_active 和 mem.available 监控指标，说明如下：&lt;/p>
&lt;ul>
&lt;li>cpu.usage_active: CPU 总核心使用率，上限为 100% ，表示所有核心都处于忙碌状态&lt;/li>
&lt;li>mem.available: 内存可用大小，单位为 Byte&lt;/li>
&lt;/ul>
&lt;h2 id="实现原理">实现原理&lt;/h2>
&lt;p>创建对应的宿主机监控报警指标，当宿主机发生报警的时候，监控服务根据指标的当前值和阈值只差，选择宿主机上对应的虚拟机进行迁移。&lt;/p>
&lt;h2 id="使用说明">使用说明&lt;/h2>
&lt;h3 id="cpu">CPU&lt;/h3>
&lt;p>下面以宿主机 CPU 超过阈值，迁移虚拟机到其他宿主举例：&lt;/p>
&lt;ol>
&lt;li>创建 cpu.usage_active 的迁移规则，名为 test-cpu ，监控宿主机 test-66-onecloud02 上的指标，当 cpu.usage_active 大于 60% 后触发自动迁移，每隔 2 分钟检查一次&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">$ climc monitor-migrationalert-create &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --period 2m &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --source-host test-66-onecloud02 &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> test-cpu cpu.usage_active.gt &lt;span style="color:#0000cf;font-weight:bold">60&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>创建对应的虚拟机进行测试，假设宿主机 CPU 40 核，为了达到阈值触发迁移，虚拟机的 CPU 核数就需要是 24 (40 * 60%) 核，然后在虚拟机使用 stress-ng 压测工具把所有核心打到 100%&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#8f5902;font-style:italic"># 创建虚拟机&lt;/span>
$ climc server-create --disk CentOS-7.6.1810-20190430.qcow2 &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --net your-net &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --mem-spec 1g &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --ncpu &lt;span style="color:#0000cf;font-weight:bold">24&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --allow-delete &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --auto-start &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --prefer-host test-66-onecloud02 &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> cpu-test-vm
&lt;span style="color:#8f5902;font-style:italic"># 登录虚拟机，使用 stress-ng 压测 CPU&lt;/span>
$ climc server-ssh cpu-test-vm
&lt;span style="color:#ce5c00;font-weight:bold">(&lt;/span>cpu-test-vm&lt;span style="color:#ce5c00;font-weight:bold">)&lt;/span>$ yum install -y stress-ng
&lt;span style="color:#ce5c00;font-weight:bold">(&lt;/span>cpu-test-vm&lt;span style="color:#ce5c00;font-weight:bold">)&lt;/span>$ stress-ng --cpu &lt;span style="color:#0000cf;font-weight:bold">24&lt;/span> --timeout 36000s
&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="3">
&lt;li>隔2分钟查看监控迁移记录&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#8f5902;font-style:italic"># 可以先登录 influxdb 查看当前宿主机的监控指标&lt;/span>
$ kubectl &lt;span style="color:#204a87">exec&lt;/span> -ti -n onecloud &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>kubectl get pods -n onecloud &lt;span style="color:#000;font-weight:bold">|&lt;/span> grep default-influxdb &lt;span style="color:#000;font-weight:bold">|&lt;/span> awk &lt;span style="color:#4e9a06">&amp;#39;{print $1}&amp;#39;&lt;/span>&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> -- influx -host 127.0.0.1 -port &lt;span style="color:#0000cf;font-weight:bold">30086&lt;/span> -type influxql -ssl -precision rfc3339 -unsafeSsl
Connected to https://127.0.0.1:30086 version 1.7.7
InfluxDB shell version: 1.7.7
&amp;gt; use telegraf
&lt;span style="color:#8f5902;font-style:italic"># 通过 climc host-list --search test-66-onecloud02 得到 host_id 为 6fc10297-eb20-4a96-86a8-4b65260d6016&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># 下面查看该宿主过去 2m 的 cpu.usage_active 指标已经大于 60% 的阈值了&lt;/span>
&amp;gt; &lt;span style="color:#204a87;font-weight:bold">select&lt;/span> usage_active from cpu where &lt;span style="color:#000">host_id&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;6fc10297-eb20-4a96-86a8-4b65260d6016&amp;#39;&lt;/span> and &lt;span style="color:#204a87">time&lt;/span> &amp;gt; now&lt;span style="color:#ce5c00;font-weight:bold">()&lt;/span> - 2m GROUP BY &lt;span style="color:#4e9a06">&amp;#34;host_id&amp;#34;&lt;/span>
name: cpu
tags: &lt;span style="color:#000">host_id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>6fc10297-eb20-4a96-86a8-4b65260d6016
&lt;span style="color:#204a87">time&lt;/span> usage_active
---- ------------
2022-06-28T03:55:00Z 62.90831581190119
2022-06-28T03:56:00Z 70.15669899594904
&lt;span style="color:#8f5902;font-style:italic"># 查看报警迁移记录&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># 找到 id 为 a7a92f4a-fed1-49bb-880b-59eae5185acc&lt;/span>
$ climc monitor-migrationalert-list --scope system
+--------------------------------------+----------+------------------+
&lt;span style="color:#000;font-weight:bold">|&lt;/span> id &lt;span style="color:#000;font-weight:bold">|&lt;/span> name &lt;span style="color:#000;font-weight:bold">|&lt;/span> metric_type &lt;span style="color:#000;font-weight:bold">|&lt;/span>
+--------------------------------------+----------+------------------+
&lt;span style="color:#000;font-weight:bold">|&lt;/span> a7a92f4a-fed1-49bb-880b-59eae5185acc &lt;span style="color:#000;font-weight:bold">|&lt;/span> test-cpu &lt;span style="color:#000;font-weight:bold">|&lt;/span> cpu.usage_active &lt;span style="color:#000;font-weight:bold">|&lt;/span>
+--------------------------------------+----------+------------------+
&lt;span style="color:#8f5902;font-style:italic"># 查看迁移记录事件&lt;/span>
$ climc monitor-migrationalert-event a7a92f4a-fed1-49bb-880b-59eae5185acc --scope system
+--------+-----------------------------+--------------------------------------+----------------+----------+--------------+--------+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
&lt;span style="color:#000;font-weight:bold">|&lt;/span> id &lt;span style="color:#000;font-weight:bold">|&lt;/span> ops_time &lt;span style="color:#000;font-weight:bold">|&lt;/span> obj_id &lt;span style="color:#000;font-weight:bold">|&lt;/span> obj_type &lt;span style="color:#000;font-weight:bold">|&lt;/span> obj_name &lt;span style="color:#000;font-weight:bold">|&lt;/span> user &lt;span style="color:#000;font-weight:bold">|&lt;/span> tenant &lt;span style="color:#000;font-weight:bold">|&lt;/span> action &lt;span style="color:#000;font-weight:bold">|&lt;/span> notes &lt;span style="color:#000;font-weight:bold">|&lt;/span>
+--------+-----------------------------+--------------------------------------+----------------+----------+--------------+--------+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
&lt;span style="color:#000;font-weight:bold">|&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">428124&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span> 2022-06-28T07:40:02.000000Z &lt;span style="color:#000;font-weight:bold">|&lt;/span> a7a92f4a-fed1-49bb-880b-59eae5185acc &lt;span style="color:#000;font-weight:bold">|&lt;/span> migrationalert &lt;span style="color:#000;font-weight:bold">|&lt;/span> test-cpu &lt;span style="color:#000;font-weight:bold">|&lt;/span> monitoradmin &lt;span style="color:#000;font-weight:bold">|&lt;/span> system &lt;span style="color:#000;font-weight:bold">|&lt;/span> find_result_fail &lt;span style="color:#000;font-weight:bold">|&lt;/span> find result to migrate: not found target &lt;span style="color:#204a87;font-weight:bold">for&lt;/span> guest &lt;span style="color:#000;font-weight:bold">&amp;amp;&lt;/span>balancer.cpuCandidate&lt;span style="color:#ce5c00;font-weight:bold">{&lt;/span>guestResource:&lt;span style="color:#ce5c00;font-weight:bold">(&lt;/span>*balancer.guestResource&lt;span style="color:#ce5c00;font-weight:bold">)(&lt;/span>0xc001963c20&lt;span style="color:#ce5c00;font-weight:bold">)&lt;/span>, usageActive:99.46995000000001, guestCPUCount:24, hostCPUCount:40&lt;span style="color:#ce5c00;font-weight:bold">}&lt;/span>: &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>host:test-69-onecloud01:current&lt;span style="color:#ce5c00;font-weight:bold">(&lt;/span>55.313408&lt;span style="color:#ce5c00;font-weight:bold">)&lt;/span> + guest:cpu-test-vm:score&lt;span style="color:#ce5c00;font-weight:bold">(&lt;/span>59.681970&lt;span style="color:#ce5c00;font-weight:bold">)&lt;/span> &amp;gt;&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> threshold&lt;span style="color:#ce5c00;font-weight:bold">(&lt;/span>60.000000&lt;span style="color:#ce5c00;font-weight:bold">)&lt;/span>, host:a15:current&lt;span style="color:#ce5c00;font-weight:bold">(&lt;/span>62.305391&lt;span style="color:#ce5c00;font-weight:bold">)&lt;/span> + guest:cpu-test-vm:score&lt;span style="color:#ce5c00;font-weight:bold">(&lt;/span>59.681970&lt;span style="color:#ce5c00;font-weight:bold">)&lt;/span> &amp;gt;&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> threshold&lt;span style="color:#ce5c00;font-weight:bold">(&lt;/span>60.000000&lt;span style="color:#ce5c00;font-weight:bold">)]&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span>
&lt;span style="color:#000;font-weight:bold">|&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">427991&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span> 2022-06-28T03:56:57.000000Z &lt;span style="color:#000;font-weight:bold">|&lt;/span> a7a92f4a-fed1-49bb-880b-59eae5185acc &lt;span style="color:#000;font-weight:bold">|&lt;/span> migrationalert &lt;span style="color:#000;font-weight:bold">|&lt;/span> test-cpu &lt;span style="color:#000;font-weight:bold">|&lt;/span> sysadmin &lt;span style="color:#000;font-weight:bold">|&lt;/span> system &lt;span style="color:#000;font-weight:bold">|&lt;/span> create &lt;span style="color:#000;font-weight:bold">|&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">{&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;id&amp;#34;&lt;/span>:&lt;span style="color:#4e9a06">&amp;#34;a7a92f4a-fed1-49bb-880b-59eae5185acc&amp;#34;&lt;/span>,&lt;span style="color:#4e9a06">&amp;#34;name&amp;#34;&lt;/span>:&lt;span style="color:#4e9a06">&amp;#34;test-cpu&amp;#34;&lt;/span>,&lt;span style="color:#4e9a06">&amp;#34;res_name&amp;#34;&lt;/span>:&lt;span style="color:#4e9a06">&amp;#34;migrationalert&amp;#34;&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">}&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span>
+--------+-----------------------------+--------------------------------------+----------------+----------+--------------+--------+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
&lt;span style="color:#8f5902;font-style:italic"># 发现了一条 find_result_fail 的记录，表示虽然发生了报警，但是没有找到对应的目标宿主机进行迁移&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># 原因是集群中的另外两台宿主机 test-69-onecloud01 当前指标为 55.313408%，a15 为 59.681970%，如果把 cpu-test-vm 59.681970% 的 cpu 负载迁移到另外两台宿主机&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># 又会导致其他两台宿主机超过阈值，所以失败&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># 如果把集群节点的负载降低，或者加入新的宿主机，负载高的虚拟机预期就会迁移过去，下面是迁移成功的记录&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># 假设我重新使用 climc monitor-migrationalert-create 创建了一条 a15 宿主机的迁移规则，大于 60 触发，id 为 afc9468c-2cd7-4be8-83c7-92d7535a53cf&lt;/span>
$ climc monitor-migrationalert-event afc9468c-2cd7-4be8-83c7-92d7535a53cf --scope system
+--------+-----------------------------+--------------------------------------+----------------+----------+--------------+--------+-----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
&lt;span style="color:#000;font-weight:bold">|&lt;/span> id &lt;span style="color:#000;font-weight:bold">|&lt;/span> ops_time &lt;span style="color:#000;font-weight:bold">|&lt;/span> obj_id &lt;span style="color:#000;font-weight:bold">|&lt;/span> obj_type &lt;span style="color:#000;font-weight:bold">|&lt;/span> obj_name &lt;span style="color:#000;font-weight:bold">|&lt;/span> user &lt;span style="color:#000;font-weight:bold">|&lt;/span> tenant &lt;span style="color:#000;font-weight:bold">|&lt;/span> action &lt;span style="color:#000;font-weight:bold">|&lt;/span> notes &lt;span style="color:#000;font-weight:bold">|&lt;/span>
+--------+-----------------------------+--------------------------------------+----------------+----------+--------------+--------+-----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
&lt;span style="color:#000;font-weight:bold">|&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">428147&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span> 2022-06-28T07:56:01.000000Z &lt;span style="color:#000;font-weight:bold">|&lt;/span> afc9468c-2cd7-4be8-83c7-92d7535a53cf &lt;span style="color:#000;font-weight:bold">|&lt;/span> migrationalert &lt;span style="color:#000;font-weight:bold">|&lt;/span> test-cpu &lt;span style="color:#000;font-weight:bold">|&lt;/span> monitoradmin &lt;span style="color:#000;font-weight:bold">|&lt;/span> system &lt;span style="color:#000;font-weight:bold">|&lt;/span> migrating &lt;span style="color:#000;font-weight:bold">|&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">{&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;guest&amp;#34;&lt;/span>:&lt;span style="color:#ce5c00;font-weight:bold">{&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;host&amp;#34;&lt;/span>:&lt;span style="color:#4e9a06">&amp;#34;a15&amp;#34;&lt;/span>,&lt;span style="color:#4e9a06">&amp;#34;host_id&amp;#34;&lt;/span>:&lt;span style="color:#4e9a06">&amp;#34;733b10fa-bd33-4503-836d-2ccd225bf12f&amp;#34;&lt;/span>,&lt;span style="color:#4e9a06">&amp;#34;id&amp;#34;&lt;/span>:&lt;span style="color:#4e9a06">&amp;#34;a3107d1f-c46e-43cf-8aa8-55743d1533b1&amp;#34;&lt;/span>,&lt;span style="color:#4e9a06">&amp;#34;name&amp;#34;&lt;/span>:&lt;span style="color:#4e9a06">&amp;#34;aisenzhe&amp;#34;&lt;/span>,&lt;span style="color:#4e9a06">&amp;#34;score&amp;#34;&lt;/span>:10.769393333333335,&lt;span style="color:#4e9a06">&amp;#34;vcpu_count&amp;#34;&lt;/span>:8,&lt;span style="color:#4e9a06">&amp;#34;vmem_size&amp;#34;&lt;/span>:8192&lt;span style="color:#ce5c00;font-weight:bold">}&lt;/span>,&lt;span style="color:#4e9a06">&amp;#34;target_host&amp;#34;&lt;/span>:&lt;span style="color:#ce5c00;font-weight:bold">{&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;id&amp;#34;&lt;/span>:&lt;span style="color:#4e9a06">&amp;#34;6fc10297-eb20-4a96-86a8-4b65260d6016&amp;#34;&lt;/span>,&lt;span style="color:#4e9a06">&amp;#34;name&amp;#34;&lt;/span>:&lt;span style="color:#4e9a06">&amp;#34;test-66-onecloud02&amp;#34;&lt;/span>,&lt;span style="color:#4e9a06">&amp;#34;score&amp;#34;&lt;/span>:22.65071999099409&lt;span style="color:#ce5c00;font-weight:bold">}}&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span>
+--------+-----------------------------+--------------------------------------+----------------+----------+--------------+--------+-----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
&lt;span style="color:#8f5902;font-style:italic"># 上述信息表示把 a15 上的 aisenzhe 虚拟机(cpu.usage_active 10.76%) 迁移到 test-66-onecloud02(cpu.usage_active 22.65%) 目标宿主机上&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># 查看虚拟机的状态发现正在迁移中&lt;/span>
$ climc server-list --search aisenzhe
+--------------------------------------+----------+--------------+-----------+------------+-----------+-----------+-----------------------------+------------+---------+-----------+
&lt;span style="color:#000;font-weight:bold">|&lt;/span> ID &lt;span style="color:#000;font-weight:bold">|&lt;/span> Name &lt;span style="color:#000;font-weight:bold">|&lt;/span> Billing_type &lt;span style="color:#000;font-weight:bold">|&lt;/span> Status &lt;span style="color:#000;font-weight:bold">|&lt;/span> vcpu_count &lt;span style="color:#000;font-weight:bold">|&lt;/span> vmem_size &lt;span style="color:#000;font-weight:bold">|&lt;/span> Secgrp_id &lt;span style="color:#000;font-weight:bold">|&lt;/span> Created_at &lt;span style="color:#000;font-weight:bold">|&lt;/span> Hypervisor &lt;span style="color:#000;font-weight:bold">|&lt;/span> os_type &lt;span style="color:#000;font-weight:bold">|&lt;/span> is_system &lt;span style="color:#000;font-weight:bold">|&lt;/span>
+--------------------------------------+----------+--------------+-----------+------------+-----------+-----------+-----------------------------+------------+---------+-----------+
&lt;span style="color:#000;font-weight:bold">|&lt;/span> a3107d1f-c46e-43cf-8aa8-55743d1533b1 &lt;span style="color:#000;font-weight:bold">|&lt;/span> aisenzhe &lt;span style="color:#000;font-weight:bold">|&lt;/span> postpaid &lt;span style="color:#000;font-weight:bold">|&lt;/span> migrating &lt;span style="color:#000;font-weight:bold">|&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">8&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">8192&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span> default &lt;span style="color:#000;font-weight:bold">|&lt;/span> 2022-01-06T08:34:45.000000Z &lt;span style="color:#000;font-weight:bold">|&lt;/span> kvm &lt;span style="color:#000;font-weight:bold">|&lt;/span> Linux &lt;span style="color:#000;font-weight:bold">|&lt;/span> &lt;span style="color:#204a87">false&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span>
+--------------------------------------+----------+--------------+-----------+------------+-----------+-----------+-----------------------------+------------+---------+-----------+
&lt;span style="color:#8f5902;font-style:italic"># 热迁移会持续一段时间，具体时间视虚拟机内存和磁盘大小而定，等待迁移结束后，会记录迁移成功的日志&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="其他操作">其他操作&lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#8f5902;font-style:italic"># 自动调节集群宿主机 cpu 负载，即不指定 --source-host 参数&lt;/span>
$ climc monitor-migrationalert-create --period 5m all-host-cpu cpu.usage_active.gt &lt;span style="color:#0000cf;font-weight:bold">80&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># 指定目标宿主机，当宿主机 cpu.usage_active 大于 80 后，只能迁移到目标宿主机 host1 和 host2&lt;/span>
$ climc monitor-migrationalert-create --period 5m --target-host host1 --target-host host2 target-host-cpu cpu.usage_active.gt &lt;span style="color:#0000cf;font-weight:bold">80&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># 指定监控的源宿主机，只关心 src-host1 和 src-host2 的监控&lt;/span>
$ climc monitor-migrationalert-create --period 5m --source-host src-host1 --source-host src-host2 src-host-cpu cpu.usage_active.gt &lt;span style="color:#0000cf;font-weight:bold">80&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># 指定迁移的源虚拟机，当宿主机 cpu.usage_active 大于 80 时候，只能迁移 gst1 和 gst2 虚拟机&lt;/span>
$ climc monitor-migrationalert-create --period 5m --source-guest gst1 --source-guest gst2 host-gst-cpu cpu.usage_active.gt &lt;span style="color:#0000cf;font-weight:bold">80&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="注意事项">注意事项&lt;/h2>
&lt;p>该功能目前只是 alpha 版本不一定稳定，仅限测试使用。&lt;/p>
&lt;p>另外为了防止迁移条件判断不准确，导致宿主机之前虚拟机相互迁移，最后出现雪崩效应。&lt;/p>
&lt;p>目前同一个时刻，只会一条报警触发的迁移逻辑，会一次迁移一批机器。如果该时刻另外一个 migrationalert 报警规则触发，会放弃此次迁移，必须等待全局没有其他 migrationalert 触发的迁移时，才会开始自己的迁移逻辑。&lt;/p></description></item></channel></rss>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Cloudpods –
操作指南</title><link>https://www.cloudpods.org/zh/docs/onpremise/baremetal/tutorial/</link><description>Recent content in 操作指南 on Cloudpods</description><generator>Hugo -- gohugo.io</generator><lastBuildDate>Tue, 08 Feb 2022 16:22:13 +0800</lastBuildDate><atom:link href="https://www.cloudpods.org/zh/docs/onpremise/baremetal/tutorial/index.xml" rel="self" type="application/rss+xml"/><item><title>Docs: 纳管物理机</title><link>https://www.cloudpods.org/zh/docs/onpremise/baremetal/tutorial/create_register_redirect/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.cloudpods.org/zh/docs/onpremise/baremetal/tutorial/create_register_redirect/</guid><description>
&lt;p>Cloudpods平台支持纳管Linux物理服务器并基于物理服务器创建裸金属服务器。&lt;/p>
&lt;h2 id="启用baremetal服务">启用Baremetal服务&lt;/h2>
&lt;p>请确保环境中已启用Baremetal服务，Baremetal服务提供PXE Server、DHCP、TFTP、http等功能，用于完成纳管物理机操作并管理物理机。Cloudpods安装完成后默认不启用Baremetal服务，需要用户按照下面命令在环境中的任意节点上启用Baremetal服务。&lt;/p>
&lt;ol>
&lt;li>
&lt;p>通过SSH等以root用户登录到First Node节点。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>使用&lt;code>kubectl get pods -n onecloud |grep baremetal&lt;/code>命令查看环境中是否已启用Baremetal服务。如已存在，忽略步骤3、4。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>如不存在Baremetal服务，执行以下命令启用Baremetal服务。其中$node_name是节点的名称；$listen-interface是baremetal-agent监听的网卡名称。
&lt;div class="alert alert-warning" role="alert">
&lt;h4 class="alert-heading">注意&lt;/h4>
如果需要启用Baremetal服务的节点安装了host服务，监听网卡请设置为br0，其余情况监听网卡为节点的实际网卡名称。
&lt;/div>
&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#8f5902;font-style:italic"># 在指定节点上启用Baremetal服务并监听网卡&lt;/span>
$ ocadm baremetal &lt;span style="color:#204a87">enable&lt;/span> --node &lt;span style="color:#000">$node_name&lt;/span> --listen-interface &lt;span style="color:#000">$listen_interface&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#8f5902;font-style:italic"># 禁用Baremetal服务&lt;/span>
$ ocadm baremetal disable --node &lt;span style="color:#000">$node_name&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#8f5902;font-style:italic"># 如在node1主机上启用baremetal服务，并监听br0网卡。&lt;/span>
$ ocadm baremetal &lt;span style="color:#204a87">enable&lt;/span> --node node1 --listen-interface br0
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>Baremetal服务启用后，可通过以下命令查看baremetal-agent是否注册到控制节点上。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#8f5902;font-style:italic"># 查看baremetal的pods&lt;/span>
$ kubectl get pods -n onecloud &lt;span style="color:#000;font-weight:bold">|&lt;/span> grep baremetal
default-baremetal-agent-fb5d4b5f7-2ld8v 1/1 Running &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span> 15m
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="纳管物理机方式介绍">纳管物理机方式介绍&lt;/h2>
&lt;p>Cloudpods平台目前支持5种纳管物理机的方式及纳管原理介绍，请根据具体情况选择合适的方式。&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>方式&lt;/th>
&lt;th>纳管物理机数量&lt;/th>
&lt;th>已有IPMI信息&lt;/th>
&lt;th>启动引导方式&lt;/th>
&lt;th>DHCP Relay&lt;/th>
&lt;th>网络分配方式&lt;/th>
&lt;th>依赖Redfish API&lt;/th>
&lt;th>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>ISO引导注册&lt;/td>
&lt;td>小规模&lt;/td>
&lt;td>是&lt;/td>
&lt;td>ISO&lt;/td>
&lt;td>否&lt;/td>
&lt;td>静态分配&lt;/td>
&lt;td>是&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>PXE引导注册&lt;/td>
&lt;td>小规模&lt;/td>
&lt;td>是&lt;/td>
&lt;td>PXE&lt;/td>
&lt;td>是&lt;/td>
&lt;td>DHCP分配&lt;/td>
&lt;td>否&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>预注册&lt;/td>
&lt;td>小规模&lt;/td>
&lt;td>否&lt;/td>
&lt;td>PXE&lt;/td>
&lt;td>是&lt;/td>
&lt;td>DHCP分配&lt;/td>
&lt;td>否&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>自动注册&lt;/td>
&lt;td>大规模&lt;/td>
&lt;td>否&lt;/td>
&lt;td>PXE&lt;/td>
&lt;td>是&lt;/td>
&lt;td>DHCP分配&lt;/td>
&lt;td>否&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>托管&lt;/td>
&lt;td>小规模&lt;/td>
&lt;td>是&lt;/td>
&lt;td>-&lt;/td>
&lt;td>-&lt;/td>
&lt;td>-&lt;/td>
&lt;td>-&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="iso引导注册">ISO引导注册&lt;/h3>
&lt;p>该方式对网络无要求，但是要求物理机已配置了BMC信息，且服务器支持Redfish等。&lt;/p>
&lt;ol>
&lt;li>在Cloudpods平台上配置物理服务器的BMC信息以及管理口IP地址。&lt;/li>
&lt;li>Baremetal将会通过Redfish API验证物理服务器的BMC信息，进而获取物理服务器的配置信息，如服务器SN、厂商型号以及网卡信息等。&lt;/li>
&lt;li>验证通过后，物理服务器上的Redfish API将会通过带外网加载Baremetal提供的YunionOS的ISO。&lt;/li>
&lt;li>进入YunionOS系统后根据配置设置管理口的IP地址，从而使物理服务器可以通过管理网访问Baremetal，上报服务器的SSH登录信息。&lt;/li>
&lt;li>Baremetal通过SSH调用YunionOS中的工具，收集服务器信息，并进行管理操作等。&lt;/li>
&lt;li>至此，物理服务器成功注册到Cloudpods平台。&lt;/li>
&lt;/ol>
&lt;h3 id="pxe引导注册">PXE引导注册：&lt;/h3>
&lt;p>该方式要求用户环境存在DHCP Relay，且要求物理机已配置BMC信息，且在引导注册过程中不会改变物理机的BMC信息。如果服务器不支持Redfish，还需要提供服务器的MAC地址。&lt;/p>
&lt;ol>
&lt;li>在Cloudpods平台上配置物理服务器的BMC信息并设置服务器PXE启动等。&lt;/li>
&lt;li>Baremetal通过IPMI验证物理服务器的BMC信息。&lt;/li>
&lt;li>验证通过后，收集少量的服务器信息，设置物理服务器为开机启动，物理服务器通过DHCP配置管理口IP地址、&lt;/li>
&lt;li>通过管理网启动引导物理服务器进入YunionOS，上报SSH登录信息。&lt;/li>
&lt;li>Baremetal通过SSH调用YunionOS中的工具，收集服务器信息，并进行管理操作等。&lt;/li>
&lt;li>至此，物理服务器成功注册到Cloudpods平台。&lt;/li>
&lt;/ol>
&lt;h3 id="自动注册">自动注册&lt;/h3>
&lt;p>该方式适用于大规模的服务器自动注册到云管平台，仅要求用户环境存在DHCP Relay，引导注册过程中会重置BMC信息。&lt;/p>
&lt;ol>
&lt;li>新上架的物理服务器设置PXE启动上电后，物理服务器接入的三层网关上的DHCP Relay将转发物理服务器的PXE请求到Baremetal。&lt;/li>
&lt;li>Baremetal服务收到请求后将会响应PXE请求，引导物理服务器从网络加载YunionOS系统并重启进入YunionOS系统，上报服务器的ssh信息，&lt;/li>
&lt;li>Baremetal通过SSH调用YunionOS中的工具，收集服务器信息，重置服务器BMC信息（如不提供BMC信息，将按照默认的信息进行配置）。&lt;/li>
&lt;li>至此，物理服务器成功注册到Cloudpods平台。&lt;/li>
&lt;/ol>
&lt;h3 id="预注册">预注册&lt;/h3>
&lt;p>该方式适用于小规模的服务器注册到云管平台，该方式要求用户环境存在DHCP Relay，且提供服务器的MAC地址，在引导过程中会重置BMC信息。&lt;/p>
&lt;ol>
&lt;li>新上架的物理服务器设置PXE启动上电后，物理服务器接入的三层网关上的DHCP Relay将转发物理服务器的PXE请求到Baremetal。&lt;/li>
&lt;li>Baremetal服务收到请求后将会验证物理服务器的MAC地址是否匹配，匹配成功后将会记录物理服务器的基本信息并响应PXE请求，引导物理服务器从网络加载YunionOS系统并重启进入YunionOS系统，上报服务器的ssh信息，&lt;/li>
&lt;li>Baremetal通过SSH调用YunionOS中的工具，收集服务器信息，重置服务器BMC信息（如不提供BMC信息，将按照默认的信息进行配置）。&lt;/li>
&lt;li>至此，物理服务器成功注册到Cloudpods平台。&lt;/li>
&lt;/ol>
&lt;h3 id="托管">托管&lt;/h3>
&lt;p>该方式适用于已有操作系统的服务器，该方式对网络无要求。执行托管脚本后将使用容器技术在物理服务器中运行YunionOS收集服务器信息，而不会影响物理机的原有操作系统。&lt;/p>
&lt;h2 id="典型组网介绍">典型组网介绍&lt;/h2>
&lt;p>&lt;img src="../../images/networking1.png" alt="">&lt;/p>
&lt;h3 id="组网说明">组网说明&lt;/h3>
&lt;ul>
&lt;li>IPMI网络用于远程访问BMC（Baseboard Management Controller），通过IPMI网络可以远程控制物理服务器的开关机等。&lt;/li>
&lt;li>管理网：执行管理物理服务器操作的网络，例如配置物理服务器，安装软件等。&lt;/li>
&lt;li>PXE网：发送PXE请求，获取IP地址等，PXE网络一般跟管理网为一个网络。&lt;/li>
&lt;li>业务网：物理服务器上运行业务需要的网络。&lt;/li>
&lt;/ul>
&lt;h3 id="配置dhcp-relay选做">配置DHCP Relay（选做）&lt;/h3>
&lt;p>ISO引导注册或托管物理机请忽略该步骤。&lt;/p>
&lt;p>由于Baremetal Agent服务只会处理DHCP Relay的单播请求，所以当使用PXE引导注册、预注册、自动注册的方式纳管物理机时要求在网络环境中配置DHCP Relay，并将其Relay到部署Baremetal的节点上。&lt;/p>
&lt;ul>
&lt;li>当物理机与Baremetal节点在同一个二层网络时，此时用户可以选择使用Host服务的DHCP Relay功能或在物理交换机上配置DHCP Relay。&lt;/li>
&lt;li>当物理机与Baremetal节点在三层网络环境中，此时用户只能在物理交换机上配置DHCP Relay。&lt;/li>
&lt;/ul>
&lt;h4 id="host服务启用dhcp-relay">Host服务启用DHCP Relay&lt;/h4>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#8f5902;font-style:italic"># 登录到任意一台已经部署好计算节点的服务器上修改 /etc/yunion/host.conf，添加dhcp_relay 配置项：&lt;/span>
dhcp_relay:
- 10.168.222.198 &lt;span style="color:#8f5902;font-style:italic"># baremetal agent dhcp服务监听地址&lt;/span>
- &lt;span style="color:#0000cf;font-weight:bold">67&lt;/span> &lt;span style="color:#8f5902;font-style:italic"># baremetal agent dhcp服务监听端口&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#8f5902;font-style:italic"># 查看host服务对应pod&lt;/span>
$ kubectl get pods -n onecloud -o wide &lt;span style="color:#000;font-weight:bold">|&lt;/span> grep host
default-host-p6d8h 2/2 Running &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span> 78m 10.168.222.189 k8s-dev1 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
default-host-xdc7x 2/2 Running &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span> 78m 10.168.222.150 k8s-dev2 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#8f5902;font-style:italic"># 删除host服务的pod，重启host服务&lt;/span>
$ kubectl delete pods -n onecloud default-host-p6d8h default-host-xdc7x
&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="物理交换机配置dhcp-relay">物理交换机配置DHCP Relay&lt;/h4>
&lt;p>需要分别针对物理机的IPMI网段和管理网段配置DHCP Relay。&lt;/p>
&lt;p>不同厂家的物理交换机配置DHCP Relay的命令不同，以下配置仅供参考，请根据实际情况进行配置。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#8f5902;font-style:italic"># 配置DHCP Relay，并Relay到Baremetal所在节点的IP上。&lt;/span>
interface Vlanif10
description new_test_host_net
ip address 10.127.100.1 255.255.255.0
dhcp &lt;span style="color:#204a87;font-weight:bold">select&lt;/span> relay
dhcp relay binding server group baremetal-group
dhcp relay server group baremetal-group
server 10.127.100.2 &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="配置流程">配置流程&lt;/h2>
&lt;ol>
&lt;li>根据组网规划创建物理服务器使用的IPMI IP子网和PXE IP子网以及裸金属设备使用的IP子网。&lt;/li>
&lt;li>根据需求选择添加物理机的方式。&lt;/li>
&lt;li>已纳管的物理机可以用于创建裸金属设备。&lt;/li>
&lt;/ol>
&lt;h2 id="操作步骤">操作步骤&lt;/h2>
&lt;h3 id="网络配置">网络配置&lt;/h3>
&lt;p>无论使用何种方式纳管物理机，都需要在Cloudpods平台上配置物理机类型、IPMI以及PXE类型的IP子网，其中PXE网段可以和物理机类型共用一个网段。请根据网络规划配置IP子网。&lt;/p>
&lt;h4 id="创建ipmi-ip子网">创建IPMI IP子网&lt;/h4>
&lt;ol>
&lt;li>在云管平台单击左上角&lt;img src="../../user/images/intro/nav.png" alt="">导航菜单，在弹出的左侧菜单栏中单击 &lt;strong>&lt;em>&amp;ldquo;网络/基础网络/IP子网&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，进入IP子网页面。&lt;/li>
&lt;li>单击列表上方 &lt;strong>&lt;em>&amp;ldquo;新建&amp;rdquo;&lt;/em>&lt;/strong> 按钮，进入创建IP子网页面。&lt;/li>
&lt;li>设置以下参数：
&lt;ul>
&lt;li>子网名称：用于标识IPMI子网。&lt;/li>
&lt;li>平台：选择本地IDC。&lt;/li>
&lt;li>二层网络：请根据规划选择区域、专有网络以及可用的二层网络。后续用户申请裸金属时需要在二层网络所在的区域和可用区中选择。&lt;/li>
&lt;li>服务器类型：选择IPMI。&lt;/li>
&lt;li>IP子网：设置IP子网网段、子网掩码、网关以及VLAN ID等。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮。&lt;/li>
&lt;/ol>
&lt;h4 id="创建pxe-ip子网">创建PXE IP子网&lt;/h4>
&lt;ol>
&lt;li>在云管平台单击左上角&lt;img src="../../user/images/intro/nav.png" alt="">导航菜单，在弹出的左侧菜单栏中单击 &lt;strong>&lt;em>&amp;ldquo;网络/基础网络/IP子网&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，进入IP子网页面。&lt;/li>
&lt;li>单击列表上方 &lt;strong>&lt;em>&amp;ldquo;新建&amp;rdquo;&lt;/em>&lt;/strong> 按钮，进入创建IP子网页面。&lt;/li>
&lt;li>设置以下参数：
&lt;ul>
&lt;li>子网名称：用于标识IPMI子网。&lt;/li>
&lt;li>平台：选择本地IDC。&lt;/li>
&lt;li>二层网络：请根据规划选择区域、专有网络以及可用的二层网络。后续用户申请裸金属时需要在二层网络所在的区域和可用区中选择。&lt;/li>
&lt;li>服务器类型：选择PXE。&lt;/li>
&lt;li>IP子网：设置IP子网网段、子网掩码、网关以及VLAN ID等。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮。&lt;/li>
&lt;/ol>
&lt;h4 id="创建物理机或虚拟机ip子网">创建物理机或虚拟机IP子网&lt;/h4>
&lt;p>用户创建裸金属设备时会优先使用物理机IP子网，若环境中不存在可用的物理机IP子网将会使用虚拟机IP子网。&lt;/p>
&lt;ol>
&lt;li>在云管平台单击左上角&lt;img src="../../user/images/intro/nav.png" alt="">导航菜单，在弹出的左侧菜单栏中单击 &lt;strong>&lt;em>&amp;ldquo;网络/基础网络/IP子网&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，进入IP子网页面。&lt;/li>
&lt;li>单击列表上方 &lt;strong>&lt;em>&amp;ldquo;新建&amp;rdquo;&lt;/em>&lt;/strong> 按钮，进入创建IP子网页面。&lt;/li>
&lt;li>设置以下参数：
&lt;ul>
&lt;li>子网名称：用于标识IPMI子网。&lt;/li>
&lt;li>平台：选择本地IDC。&lt;/li>
&lt;li>二层网络：请根据规划选择区域、专有网络以及可用的二层网络。后续用户申请裸金属时需要在二层网络所在的区域和可用区中选择。&lt;/li>
&lt;li>服务器类型：选择物理机或虚拟机IP子网，新建裸金属服务器时默认优先使用物理机IP子网，当没有可用的物理机IP子网将使用虚拟机IP子网。&lt;/li>
&lt;li>IP子网：设置IP子网网段、子网掩码、网关以及VLAN ID等。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮。&lt;/li>
&lt;/ol>
&lt;h3 id="纳管物理机">纳管物理机&lt;/h3>
&lt;h4 id="iso引导注册-1">ISO引导注册&lt;/h4>
&lt;p>ISO引导注册之前请管理员提前准备以下信息：&lt;/p>
&lt;ul>
&lt;li>物理服务器的BMC信息。&lt;/li>
&lt;li>物理服务器管理口IP地址、IP子网或二层网络等。&lt;/li>
&lt;/ul>
&lt;ol>
&lt;li>在左侧导航栏，选择 &lt;strong>&lt;em>&amp;ldquo;主机/基础资源/物理机&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，进入物理机页面。&lt;/li>
&lt;li>单击 &lt;strong>&lt;em>&amp;ldquo;添加&amp;rdquo;&lt;/em>&lt;/strong> 按钮，进入添加物理机页面，选择添加方式为“ISO引导注册”。&lt;/li>
&lt;li>配置以下信息：
&lt;ul>
&lt;li>指定域：选择物理机所属的域。&lt;/li>
&lt;li>单条录入：配置以下参数。
&lt;ul>
&lt;li>物理机名称：设置物理服务器的名称。&lt;/li>
&lt;li>备注：设置物理机的备注信息。&lt;/li>
&lt;li>IPMI地址：输入服务器上已配置好的IPMI地址。&lt;/li>
&lt;li>IPMI用户名：输入服务器上已配置好的IPMI用户名。&lt;/li>
&lt;li>IPMI密码：输入服务器上已配置好的IPMI密码信息。若输入的BMC信息不正确则无法正确完成引导注册。&lt;/li>
&lt;li>标签：支持为新建的物理机绑定标签。支持选择已有标签和新建标签。
&lt;ul>
&lt;li>新建标签：单击列表上方 &lt;strong>&lt;em>新建&lt;/em>&lt;/strong> 按钮，设置标签键和标签值，单击 &lt;strong>&lt;em>&amp;ldquo;添加&amp;rdquo;&lt;/em>&lt;/strong> 按钮，新建标签并绑定到资源上。&lt;/li>
&lt;li>选择已有标签：单击 &lt;strong>&lt;em>&amp;ldquo;已有标签&amp;rdquo;&lt;/em>&lt;/strong> 按钮，选择标签键和值。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>管理口IP：选择IP子网，如需指定静态IP，可单击 &lt;strong>&lt;em>&amp;ldquo;手动配置IP&amp;rdquo;&lt;/em>&lt;/strong> 按钮，设置IP地址，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮。由于ISO引导注册适用于没有DHCP Relay的环境，所以用户必须配置提供服务器管理口接入的IP子网或IP地址信息。&lt;/li>
&lt;li>只注册不引导：不重启引导进入YunionOS系统，勾选该项后，仅收集到服务器的部分信息，此时的服务器无法用于创建裸金属，需要进行检测硬件配置操作使其正式投入生产使用。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>模板导入：支持导入含有物理机注册信息的XLSX格式的模板文件。
&lt;ul>
&lt;li>导入物理机信息需要按照预先设定的格式，请先下载模板。&lt;/li>
&lt;li>在下载的host_template.xlsx文件中补充物理机的信息。所有物理机信息请都放在同一个sheet页面中。&lt;/li>
&lt;li>单击虚线框或将模板文件拖拽到虚线框，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，上传模板文件。&lt;/li>
&lt;li>只注册不引导：不重启引导进入YunionOS系统，勾选该项后，仅收集到服务器的部分信息，此时的服务器无法用于创建裸金属，需要进行检测硬件配置操作使其正式投入生产使用。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，完成引导注册。&lt;/li>
&lt;/ol>
&lt;h4 id="pxe引导注册-1">PXE引导注册&lt;/h4>
&lt;p>PXE引导注册之前请管理员提前准备以下信息：&lt;/p>
&lt;ul>
&lt;li>物理服务器的BMC信息。&lt;/li>
&lt;/ul>
&lt;ol>
&lt;li>在左侧导航栏，选择 &lt;strong>&lt;em>&amp;ldquo;主机/基础资源/物理机&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，进入物理机页面。&lt;/li>
&lt;li>单击 &lt;strong>&lt;em>&amp;ldquo;添加&amp;rdquo;&lt;/em>&lt;/strong> 按钮，进入添加物理机页面，选择添加方式为“PXE引导注册”。&lt;/li>
&lt;li>配置以下信息：
&lt;ul>
&lt;li>指定域：选择物理机所属的域。&lt;/li>
&lt;li>单条录入：配置以下参数。
&lt;ul>
&lt;li>物理机名称：设置物理服务器的名称。&lt;/li>
&lt;li>备注：设置物理机的备注信息。&lt;/li>
&lt;li>IPMI地址：输入服务器上已配置好的IPMI地址。&lt;/li>
&lt;li>IPMI用户名：输入服务器上已配置好的IPMI用户名。&lt;/li>
&lt;li>IPMI密码：输入服务器上已配置好的IPMI密码信息。若输入的BMC信息不正确则无法正确完成引导注册。&lt;/li>
&lt;li>管理口MAC地址：设置服务器的管理口MAC地址，支持Redfish的服务器无需填写该项。&lt;/li>
&lt;li>管理口IP：选填。支持选择IP子网，如需指定静态IP，可单击 &lt;strong>&lt;em>&amp;ldquo;手动配置IP&amp;rdquo;&lt;/em>&lt;/strong> 按钮，设置IP地址，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮。留空则由DHCP自动分配IP。&lt;/li>
&lt;li>标签：支持为新建的物理机绑定标签。支持选择已有标签和新建标签。
&lt;ul>
&lt;li>新建标签：单击列表上方 &lt;strong>&lt;em>新建&lt;/em>&lt;/strong> 按钮，设置标签键和标签值，单击 &lt;strong>&lt;em>&amp;ldquo;添加&amp;rdquo;&lt;/em>&lt;/strong> 按钮，新建标签并绑定到资源上。&lt;/li>
&lt;li>选择已有标签：单击 &lt;strong>&lt;em>&amp;ldquo;已有标签&amp;rdquo;&lt;/em>&lt;/strong> 按钮，选择标签键和值。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>只注册不引导：不重启引导进入YunionOS系统，勾选该项后，仅收集到服务器的部分信息，此时的服务器无法用于创建裸金属，需要进行检测硬件配置操作使其正式投入生产使用。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>模板导入：支持导入含有物理机注册信息的XLSX格式的模板文件。
&lt;ul>
&lt;li>导入物理机信息需要按照预先设定的格式，请先下载模板。&lt;/li>
&lt;li>在下载的host_template.xlsx文件中补充物理机的信息。所有物理机信息请都放在同一个sheet页面中。&lt;/li>
&lt;li>单击虚线框或将模板文件拖拽到虚线框，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，上传模板文件。&lt;/li>
&lt;li>只注册不引导：不重启引导进入YunionOS系统，勾选该项后，仅收集到服务器的部分信息，此时的服务器无法用于创建裸金属，需要进行检测硬件配置操作使其正式投入生产使用。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，完成引导注册。&lt;/li>
&lt;/ol>
&lt;h4 id="预注册-1">预注册&lt;/h4>
&lt;p>预注册操作仅是预上架服务器信息，并不代表物理机已注册到Cloudpods平台，实际注册需要等到服务器上电启动。&lt;/p>
&lt;p>预注册物理机之前请管理员提前准备以下信息：&lt;/p>
&lt;ul>
&lt;li>物理服务器的MAC地址和名称，必填。&lt;/li>
&lt;li>由管理员规划BMC信息（IPMI地址、用户名、密码等信息），物理服务器可以事先不配置BMC信息，后续注册虚拟机引导时将会将物理服务器的BMC信息重置为注册物理机时设置的BMC信息。&lt;/li>
&lt;/ul>
&lt;ol>
&lt;li>
&lt;p>在左侧导航栏，选择 &lt;strong>&lt;em>&amp;ldquo;主机/基础资源/物理机&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，进入物理机页面。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>单击 &lt;strong>&lt;em>&amp;ldquo;添加&amp;rdquo;&lt;/em>&lt;/strong> 按钮，进入添加物理机页面，选择添加方式为“预注册”。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>支持3种导入物理机信息的方式。其中单条录入适用于托管单台服务器的场景，批量导入和文件导入适用于一次性托管多台服务器的场景。&lt;/p>
&lt;ul>
&lt;li>指定域：选择物理机所属的域。&lt;/li>
&lt;li>单条录入：配置以下参数。
&lt;ul>
&lt;li>MAC地址：物理机设备的MAC地址。&lt;/li>
&lt;li>物理机名称：物理机设备的名称。&lt;/li>
&lt;li>备注：设置物理机的备注信息。&lt;/li>
&lt;li>IPMI地址：设置物理机的IPMI地址，当不设置该参数时，若平台上存在IPMI的IP子网，系统将自动为其分配IP地址，一般建议新机器留空，旧机器设置之前的IP地址。&lt;/li>
&lt;li>IPMI用户名：设置IPMI管理用户名。当不设置该参数时，系统默认使用root用户登录，一般建议新机器留空，旧机器设置之前的用户名。&lt;/li>
&lt;li>IPMI密码：设置IPMI用户的密码。当不设置该参数时，系统默认密码为YunionDev@123。一般建议新机器留空，旧机器设置之前的密码。&lt;/li>
&lt;li>标签：支持为新建的物理机绑定标签。支持选择已有标签和新建标签。
- 新建标签：单击列表上方 &lt;strong>&lt;em>新建&lt;/em>&lt;/strong> 按钮，设置标签键和标签值，单击 &lt;strong>&lt;em>&amp;ldquo;添加&amp;rdquo;&lt;/em>&lt;/strong> 按钮，新建标签并绑定到资源上。
- 选择已有标签：单击 &lt;strong>&lt;em>&amp;ldquo;已有标签&amp;rdquo;&lt;/em>&lt;/strong> 按钮，选择标签键和值。&lt;/li>
&lt;li>设置完成后，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>批量录入：请注意以下内容。
&lt;ul>
&lt;li>一行为一条物理机记录，一次最多支持导入100条记录。&lt;/li>
&lt;li>录入信息格式为“MAC地址,名称,IPMI地址,IPMI用户名,IPMI密码”，中间以英文逗号“,”分割，若密码中包含中文逗号“，”需要使用单条录入功能进行注册。&lt;/li>
&lt;li>其中MAC地址和名称为必填项，其他参数可省略不填写。&lt;/li>
&lt;li>例如：ee:b3:f4:48:1c:f5,gpuhost01,192.168.1.1,root,admin123&lt;/li>
&lt;li>例如：ee:b3:f4:48:1c:f5,gpuhost01,,, &amp;ndash;省略了IPMI地址、IPMI用户名和IPMI密码&lt;/li>
&lt;li>录入完成后，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>模板导入：支持导入含有物理机注册信息的XLSX格式的模板文件。
&lt;ul>
&lt;li>导入物理机信息需要按照预先设定的格式，请先下载模板。&lt;/li>
&lt;li>在下载的host_template.xlsx文件中补充物理机的信息。所有物理机信息请都放在同一个sheet页面中。&lt;/li>
&lt;li>单击虚线框或将模板文件拖拽到虚线框，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，上传模板文件。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>至此，服务器预上架准备完毕。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>等待管理员将服务器设置为PXE启动，并为服务器上电后，才会进行真正的注册物理机操作，并获取服务器的基本信息等。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>当服务器在平台上有信息显示后，管理员可以在Cloudpods平台上对物理机进行管理操作等。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">说明&lt;/h4>
&lt;p>目前前端不支持设置预注册物理机的 PXE 启动 IP，可以通过在后端用命令行指定，操作如下：&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#8f5902;font-style:italic"># 通过 host-create 命令创建物理机记录&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># 对应物理机名称为 bm1&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># PXE 启动网卡 MAC 为 2c:ea:7f:af:77:5b&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># --access-ip 指定 pxe 启动的 IP&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># --ipmi-addr 设置需要配置的 IPMI IP&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># --ipmi-user 设置需要配置的 IPMI 用户&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># --ipmi-passwd 设置对应的 IPMI 用户密码&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># --no-probe 表示不要进行 IPMI 探测，和引导注册区分开&lt;/span>
$ climc host-create &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --access-ip 10.2.0.35 &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --ipmi-addr 10.3.0.25 &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --ipmi-user root &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --ipmi-passwd YunionDev@123 &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --no-probe &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> bm1 2c:ea:7f:af:77:5b
&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;h4 id="自动注册-1">自动注册&lt;/h4>
&lt;p>Cloudpods平台默认未启用自动注册功能，如需要使用该功能，可通过界面或climc命令启用自动注册。&lt;/p>
&lt;p>&lt;strong>全局设置启用自动注册&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>
&lt;p>在云管平台单击左上角&lt;img src="../../user/images/intro/nav.png" alt="">导航菜单，在弹出的左侧菜单栏中单击 &lt;strong>&lt;em>&amp;ldquo;系统配置/全局设置/全局设置&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，进入全局设置页面。&lt;/p>
&lt;p>&lt;img src="../../images/autoregister.png" alt="">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>单击 &lt;strong>&lt;em>&amp;ldquo;编辑&amp;rdquo;&lt;/em>&lt;/strong> 按钮，开启自动注册功能。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>Climc启用自动注册&lt;/strong>&lt;/p>
&lt;pre>&lt;code># 命令行开启自动注册
$ climc service-edit-config baremetal
...
# 自动注册选项，默认为 false
auto_register_baremetal: true
...
&lt;/code>&lt;/pre>&lt;h4 id="托管物理机">托管物理机&lt;/h4>
&lt;p>托管物理机操作可以纳管已安装操作系统的物理服务器，在纳管服务器之前，需要用户了解物理服务器的BMC（IPMI地址、用户名、密码）信息等。&lt;/p>
&lt;p>在托管服务器之前，请确保以下条件：&lt;/p>
&lt;ul>
&lt;li>平台上已创建了包含物理服务器的IPMI类型和物理机类型的IP子网；&lt;/li>
&lt;li>物理服务器已配置了BMC信息（IPMI地址、用户名、密码）；&lt;/li>
&lt;li>物理服务器已放开2222或之后端口；如2222端口已被占用，则需放开2222之后的端口。&lt;/li>
&lt;/ul>
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">说明&lt;/h4>
托管的物理机所在域与操作用户有关。
&lt;/div>
&lt;ol>
&lt;li>
&lt;p>在左侧导航栏，选择 &lt;strong>&lt;em>&amp;ldquo;主机/基础资源/物理机&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，进入物理机页面。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>单击 &lt;strong>&lt;em>&amp;ldquo;添加&amp;rdquo;&lt;/em>&lt;/strong> 按钮，进入添加物理机页面，选择添加方式为“托管”。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>单击&amp;quot;点击复制&amp;quot;链接，复制命令。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>通过ssh等远程连接到物理服务器，在服务器中执行复制的命令。&lt;/p>
&lt;p>&lt;img src="../../images/command.png" alt="">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>命令执行过程中需要输入服务器的IPMI用户名、密码以及IPMI IP，设置完成后等待一段时间，物理机会被注册到Cloudpods平台，同时将创建一个与之前物理机同配置的裸金属服务器。&lt;/p>
&lt;/li>
&lt;/ol></description></item><item><title>Docs: 安装操作系统/新建裸金属</title><link>https://www.cloudpods.org/zh/docs/onpremise/baremetal/tutorial/create_server/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.cloudpods.org/zh/docs/onpremise/baremetal/tutorial/create_server/</guid><description>
&lt;p>目前平台支持通过两个入口创建裸金属。&lt;/p>
&lt;ul>
&lt;li>在物理机页面安装操作系统即可基于当前物理机创建裸金属。&lt;/li>
&lt;li>在裸金属页面新建裸金属，并通过规格筛选出对应的物理机新建裸金属。&lt;/li>
&lt;/ul>
&lt;h2 id="界面操作">界面操作&lt;/h2>
&lt;h3 id="安装操作系统">安装操作系统&lt;/h3>
&lt;p>该功能用于基于当前物理机新建裸金属。&lt;/p>
&lt;ol>
&lt;li>在左侧导航栏，选择 &lt;strong>&lt;em>&amp;ldquo;主机/基础资源/物理机&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，进入物理机页面。&lt;/li>
&lt;li>单击物理机右侧操作列 &lt;strong>&lt;em>&amp;ldquo;更多&amp;rdquo;&lt;/em>&lt;/strong> 按钮，选择下拉菜单 &lt;strong>&lt;em>&amp;ldquo;安装操作系统&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，进入新建裸金属页面。&lt;/li>
&lt;li>设置以下参数：
&lt;ul>
&lt;li>
&lt;p>名称：裸金属名称。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>主机数量与规格：由于裸金属独占物理机，数量和规格不可改。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>操作系统：&lt;/p>
&lt;ul>
&lt;li>公共镜像：对应系统镜像列表中的Linux操作系统的公共镜像，由管理员维护。&lt;/li>
&lt;li>自定义镜像：对应系统镜像列表中的Linux操作系统的自定义镜像，一般是由用户上传。&lt;/li>
&lt;li>从ISO启动：对应系统镜像列表中ISO格式的Linux操作系统镜像。选择ISO镜像文件时，需要用户为裸金属服务器安装操作系统。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>磁盘配置：单击 &lt;strong>&lt;em>&amp;ldquo;新增磁盘&amp;rdquo;&lt;/em>&lt;/strong> 按钮，弹出新建磁盘配置对话框。&lt;/p>
&lt;ul>
&lt;li>
&lt;p>选择物理机上的磁盘类型（HDD:3.6TIB表示物理机上一块磁盘大小为3.6TiB、磁盘类HDD）、设置RAID（包括不做RAID、RAID0、RAID1、RAID5、RAID10）&lt;/p>
&lt;/li>
&lt;li>
&lt;p>设置磁盘数量，即使用几块相同配置的磁盘做RAID配置，如对磁盘做RAID0，磁盘利用率为100%；对2块磁盘做RAID1，磁盘利用率为50%；对3块及以上磁盘做RAID5，磁盘利用率为(n-1)/n；对4块及以上磁盘做RAID10，磁盘利用率为50%。&lt;/p>
&lt;ul>
&lt;li>RAID0和不做RAID对磁盘数量无要求；&lt;/li>
&lt;li>RAID1要求至少有2块相同的磁盘；&lt;/li>
&lt;li>RAID5要求至少有3块相同的磁盘；&lt;/li>
&lt;li>RAID10要求至少有4块相同的磁盘；&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="../../../images/computing/raid.png" alt="">
&lt;img src="../../../images/computing/partition.png" alt="">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>磁盘RAID配置完成后，显示磁盘分区名称和大小信息，支持在界面修改分区，可分别单击“系统分区”黄色区域修改分区设置、单击“待分区”区域设置分区。分区参数如下：&lt;/p>
&lt;ul>
&lt;li>挂载点：设置分区挂载点，系统分区挂载点默认为“/”。&lt;/li>
&lt;li>分区格式：包括ext4、xfs、ntfs、swap分区。&lt;/li>
&lt;li>分区大小：包括最大容量和手动输入两种，最大容量使用磁盘所有空间，手动输入可以手动设置分区大小，单位为GB。&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="../../../images/computing/createpartition1.png" alt="">&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>网络：设置裸金属的IP地址。当环境中有两张与网线连接的网卡需要做绑定设置时，可勾选&amp;quot;启用bonding&amp;quot;
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">说明&lt;/h4>
当物理机有两张连接网线的网卡时，将会自动绑定，当物理机有大于两张连接网线的网卡时，网卡绑定结果不可控，请谨慎操作。
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>指定IP子网：选择IP子网，如需指定静态IP，可单击 &lt;strong>&lt;em>&amp;ldquo;手动配置IP&amp;rdquo;&lt;/em>&lt;/strong> 按钮，设置IP地址，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮。&lt;/li>
&lt;li>指定调度标签：设置调度标签以及调度标签偏好。设置的调度标签偏好将会覆盖调度标签上的默认策略。根据调度标签及调度偏好选择最优的IP子网。
&lt;ul>
&lt;li>尽量使用（prefer）：调度时优先使用拥有这种标签的IP子网。&lt;/li>
&lt;li>避免使用（avoid）：调度时尽量避免拥有这种标签的IP子网。&lt;/li>
&lt;li>禁止使用（exclude）：调度时排除拥有这种标签的IP子网。&lt;/li>
&lt;li>必须使用（require）：调度时必须使用拥有这种标签的IP子网。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>管理员密码：设置管理员密码，在Linux系统中为root用户的密码，在Windows操作系统中为administrator用户的密码。&lt;/p>
&lt;ul>
&lt;li>随机生成：随机生成管理员密码，用户可在虚拟机列表密码列查看复制管理员密码。&lt;/li>
&lt;li>关联密钥：仅支持Linux操作系统的虚拟机。在关联密钥之前请先在“网络-密钥”页面新建SSH密钥。关联密钥后，用户需要使用SSH密钥对登录虚拟机。&lt;/li>
&lt;li>保留镜像设置：管理员密码为镜像中已有的管理员密码。&lt;/li>
&lt;li>手工输入：可手动设置管理员密码。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>备注：设置裸金属的备注信息。&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>单击 &lt;strong>&lt;em>&amp;ldquo;新建&amp;rdquo;&lt;/em>&lt;/strong> 按钮，创建裸金属。&lt;/li>
&lt;/ol>
&lt;h3 id="新建裸金属">新建裸金属&lt;/h3>
&lt;p>该功能用于新建裸金属服务器。&lt;/p>
&lt;ol>
&lt;li>在裸金属页面，单击列表上方 &lt;strong>&lt;em>&amp;ldquo;新建&amp;rdquo;&lt;/em>&lt;/strong> 按钮，进入新建裸金属页面。&lt;/li>
&lt;li>设置以下参数：
&lt;ul>
&lt;li>
&lt;p>指定项目：设置裸金属服务器的所属项目。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>区域：选择区域和可用区。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>名称：裸金属服务器名称，当创建多个裸金属服务器时，除第一台服务器名称外，其他服务器名称都以名称-1~N表示，虚拟机和裸金属公用名称空间。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>备注：设置裸金属的备注信息。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>主机数量：设置创建的裸金属数量。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>操作系统：裸金属只支持Linux操作系统的镜像。&lt;/p>
&lt;ul>
&lt;li>公共镜像：对应系统镜像列表中的Linux操作系统的公共镜像，由管理员维护。&lt;/li>
&lt;li>自定义镜像：对应系统镜像列表中的Linux操作系统的自定义镜像，一般是由用户上传。&lt;/li>
&lt;li>从ISO启动：对应系统镜像列表中ISO格式的Linux操作系统镜像。选择ISO镜像文件时，需要用户为裸金属服务器安装操作系统。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>规格：列表中显示所有可选规格。（即列出所有启用状态的物理机规格信息）&lt;/p>
&lt;/li>
&lt;li>
&lt;p>磁盘配置：单击 &lt;strong>&lt;em>&amp;ldquo;新增磁盘&amp;rdquo;&lt;/em>&lt;/strong> 按钮，弹出新建磁盘配置对话框，配置相关参数，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮。&lt;/p>
&lt;ul>
&lt;li>
&lt;p>选择物理机上的磁盘类型（HDD:3.6TIB表示物理机上一块磁盘大小为3.6TiB、磁盘类HDD）、设置RAID（包括不做RAID、RAID0、RAID1、RAID5、RAID10）&lt;/p>
&lt;/li>
&lt;li>
&lt;p>设置磁盘数量，即使用几块相同配置的磁盘做RAID配置，如对磁盘做RAID0，磁盘利用率为100%；对2块磁盘做RAID1，磁盘利用率为50%；对3块及以上磁盘做RAID5，磁盘利用率为(n-1)/n；对4块及以上磁盘做RAID10，磁盘利用率为50%。&lt;/p>
&lt;ul>
&lt;li>RAID0和不做RAID对磁盘数量无要求；&lt;/li>
&lt;li>RAID1要求至少有2块相同的磁盘；&lt;/li>
&lt;li>RAID5要求至少有3块相同的磁盘；&lt;/li>
&lt;li>RAID10要求至少有4块相同的磁盘；&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="../../../images/computing/raid.png" alt="">&lt;/p>
&lt;p>&lt;img src="../../../images/computing/partition.png" alt="">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>配置完成后，显示磁盘分区名称和大小信息，支持在界面修改分区，可分别单击“系统”绿区域更新分区设置或单击“剩余”灰色区域新建分区。分区参数如下：&lt;/p>
&lt;ul>
&lt;li>挂载点：设置分区挂载点，系统分区挂载点默认为“/”。&lt;/li>
&lt;li>分区格式：包括ext4、xfs、ntfs、swap分区。&lt;/li>
&lt;li>分区大小：包括最大容量和手动输入两种，最大容量使用磁盘所有空间，手动输入可以手动设置分区大小，单位为GB。&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="../../../images/computing/createpartition1.png" alt="">&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>管理员密码：设置管理员密码，在Linux系统中为root用户的密码。&lt;/p>
&lt;ul>
&lt;li>随机生成：随机生成管理员密码，用户可在裸金属列表密码列查看复制管理员密码。&lt;/li>
&lt;li>关联密钥：在关联密钥之前需要先新建密钥。关联密钥后，用户需要使用私钥远程登录裸金属服务器。&lt;/li>
&lt;li>保留镜像设置：管理员密码为镜像中已有的管理员密码。&lt;/li>
&lt;li>手工输入：可手动设置管理员密码。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>高级设置：包括网络和调度策略，可保持默认。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>网络：设置裸金属的IP地址。当环境中有两张与网线连接的网卡需要做绑定设置时，可勾选&amp;quot;启用bonding&amp;quot;
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">说明&lt;/h4>
新建裸金属服务器时选择的IP子网与创建裸金属的物理机IP子网相同时，裸金属将会复用物理机的IP地址，不会再分配新的IP地址。
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>指定IP子网：选择IP子网，如需指定静态IP，可单击 &lt;strong>&lt;em>&amp;ldquo;手动配置IP&amp;rdquo;&lt;/em>&lt;/strong> 按钮，设置IP地址，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮。&lt;/li>
&lt;li>指定调度标签：设置调度标签以及调度标签偏好。设置的调度标签偏好将会覆盖调度标签上的默认策略。根据调度标签及调度偏好选择最优的IP子网。
&lt;ul>
&lt;li>尽量使用（prefer）：调度时优先使用拥有这种标签的IP子网。&lt;/li>
&lt;li>避免使用（avoid）：调度时尽量避免拥有这种标签的IP子网。&lt;/li>
&lt;li>禁止使用（exclude）：调度时排除拥有这种标签的IP子网。&lt;/li>
&lt;li>必须使用（require）：调度时必须使用拥有这种标签的IP子网。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">说明&lt;/h4>
当物理机有两张连接网线的网卡时，将会自动绑定，当物理机有大于两张连接网线的网卡时，网卡绑定结果不可控，请谨慎操作。
&lt;/div>
&lt;ul>
&lt;li>
&lt;p>调度策略：通过调度策略选择物理机。&lt;/p>
&lt;ul>
&lt;li>指定物理机：直接选择物理机。&lt;/li>
&lt;li>指定调度标签：设置调度标签以及调度标签的偏好。设置的调度标签偏好将会覆盖调度标签的默认策略。根据调度标签及调度标签偏好选择对应的物理机。
&lt;ul>
&lt;li>尽量使用（prefer）：调度时优先使用拥有这种标签的物理机。&lt;/li>
&lt;li>避免使用（avoid）：调度时尽量避免拥有这种标签的物理机。&lt;/li>
&lt;li>禁止使用（exclude）：调度时排除拥有这种标签的物理机。&lt;/li>
&lt;li>必须使用（require）：调度时必须使用拥有这种标签的物理机。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;ol start="3">
&lt;li>单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，创建裸金属设备。&lt;/li>
&lt;/ol>
&lt;h2 id="climc操作">climc操作&lt;/h2>
&lt;h3 id="安装操作系统-1">安装操作系统&lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">climc server-create &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --hypervisor baremetal &lt;span style="color:#4e9a06">\ &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># 指定 server 的类型为 baremetal&lt;/span>
--ncpu &lt;span style="color:#0000cf;font-weight:bold">24&lt;/span> &lt;span style="color:#4e9a06">\ &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># 创建到 24 核 cpu 的物理机&lt;/span>
--raid-config &lt;span style="color:#4e9a06">&amp;#39;raid1:2:MegaRaid&amp;#39;&lt;/span> &lt;span style="color:#4e9a06">\ &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># 第1块盘，使用 MegaRaid 控制器上的(0-1)号两块物理盘做 raid1&lt;/span>
--raid-config &lt;span style="color:#4e9a06">&amp;#39;none:1&amp;#39;&lt;/span> &lt;span style="color:#4e9a06">\ &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># 第2块盘，使用 MegaRaid 控制器上的(2)号物理盘，不做 raid&lt;/span>
--raid-config &lt;span style="color:#4e9a06">&amp;#39;raid10:4:MegaRaid&amp;#39;&lt;/span> &lt;span style="color:#4e9a06">\ &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># 第3快盘, 使用 MegaRaid 控制器上的(3-6)号四块物理盘做raid10&lt;/span>
--disk CentOS-7.5.qcow2:100g &lt;span style="color:#4e9a06">\ &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># 系统盘使用 CentOS-7.5.qcow2 镜像作为操作系统，大小为 100g，使用第1块 raid1 的盘&lt;/span>
--disk &lt;span style="color:#4e9a06">&amp;#39;autoextend:ext4:/opt&amp;#39;&lt;/span> &lt;span style="color:#4e9a06">\ &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># 分区挂载到 /opt, 使用第1块 raid1 的盘，文件系统为 ext4, 大小为(第一块盘总大小 - 该盘其他分区的大小(100g))&lt;/span>
--disk &lt;span style="color:#4e9a06">&amp;#39;autoextend:xfs:/data-nonraid&amp;#39;&lt;/span> &lt;span style="color:#4e9a06">\ &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># 分区挂载到 /data-nonraid, 使用第2块没做 raid 的盘, 文件系统为 xfs，使用所有空间&lt;/span>
--disk &lt;span style="color:#4e9a06">&amp;#39;autoextend:ext4:/data-raid10&amp;#39;&lt;/span> &lt;span style="color:#4e9a06">\ &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># 分区挂载到 /data-raid10, 使用第3块 raid10 的盘，文件系统为 ext4, 使用所有空间&lt;/span>
&amp;lt;server_name&amp;gt; &lt;span style="color:#4e9a06">\ &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># 裸金属服务器名称&lt;/span>
64g &lt;span style="color:#8f5902;font-style:italic"># 创建到 64g 内存大小的物理机&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="raid-配置和分区">raid 配置和分区&lt;/h4>
&lt;p>调用 server-create 接口时通过 &amp;lsquo;&amp;ndash;raid-config&amp;rsquo; 传递参数来配置 raid，每个 raid-config 对应到操作系统可见的磁盘设备(/dev/sdx)。&lt;/p>
&lt;p>&amp;lsquo;&amp;ndash;disk&amp;rsquo; 参数对应不同磁盘上的分区，分区对应到磁盘的逻辑为: 分区按照顺序创建到第1块磁盘上，当 disk 设置 autoextend 参数后，表示接下来的 disk 分区会创建到下一个磁盘，以此类推。&lt;/p>
&lt;ul>
&lt;li>raid 配置 API 参数:&lt;/li>
&lt;/ul>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Key&lt;/th>
&lt;th>Type&lt;/th>
&lt;th>value&lt;/th>
&lt;th>解释&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>type(磁盘类型)&lt;/td>
&lt;td>string&lt;/td>
&lt;td>rotate(机械盘), ssd(固态盘), hybrid(未知)&lt;/td>
&lt;td>-&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>conf (raid)&lt;/td>
&lt;td>string&lt;/td>
&lt;td>none, raid0, raid1, raid5, raid10&lt;/td>
&lt;td>做raid几或者不做&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>count (磁盘数量)&lt;/td>
&lt;td>int&lt;/td>
&lt;td>e.g. 0, 2, 4&lt;/td>
&lt;td>小于等于物理机实际的盘数&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>range (磁盘范围)&lt;/td>
&lt;td>[]int&lt;/td>
&lt;td>e.g. [0,1,2,3], [4,7], [5,6]&lt;/td>
&lt;td>物理磁盘在控制器上的索引号&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>splits (切割物理盘)&lt;/td>
&lt;td>string&lt;/td>
&lt;td>(30%,20%,), (300g,100g,)&lt;/td>
&lt;td>做好 raid 的物理盘再切割为多块物理盘&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>adapter (控制器号)&lt;/td>
&lt;td>int&lt;/td>
&lt;td>0, 1&lt;/td>
&lt;td>对应driver的 Adapter 控制器&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>driver (控制器名称)&lt;/td>
&lt;td>string&lt;/td>
&lt;td>MegaRaid,HPSARaid,Mpt2SAS,MarvelRaid,Linux,PCIE&lt;/td>
&lt;td>1台物理机上有多个控制器时用于选择盘&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>strip (设置raid strip 大小)&lt;/td>
&lt;td>*int&lt;/td>
&lt;td>e.g. 64*1024&lt;/td>
&lt;td>设置strip size, 可选&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ra&lt;/td>
&lt;td>*bool&lt;/td>
&lt;td>&lt;/td>
&lt;td>设置读模式&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>wt&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>设置写模式&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>cachedbadbbu&lt;/td>
&lt;td>*bool&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>direct&lt;/td>
&lt;td>*bool&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;ul>
&lt;li>
&lt;p>命令行格式:&lt;/p>
&lt;p>&amp;lsquo;(none,raid0,raid1,raid5,raid10):%d:(MegaRaid|HPSARaid|Mpt2SAS|MarvelRaid|Linux|PCIE):(rotate|ssd|hybrid):[0-n]:strip%dk:adapter%d:ra:nora:wt:wb:direct:cachedbadbbu:nocachedbadbbu&amp;rsquo;&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>Docs: 更改 IP</title><link>https://www.cloudpods.org/zh/docs/onpremise/baremetal/tutorial/change_ip_address/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.cloudpods.org/zh/docs/onpremise/baremetal/tutorial/change_ip_address/</guid><description>
&lt;p>云平台里面的物理机会分配 2 个 IP 地址，一个分配给 BMC IPMI 的地址，还有一个是物理机 PXE 启动时候的地址。如果物理机安装操作系统，会在平台生成一条裸金属的记录，裸金属记录也会被分配一个 IP 地址。物理机安装操作系统的时候，在默认没有指定 IP 地址的情况下，裸金属分配的 IP 地址会优先复用对应物理机上的 PXE IP 地址。&lt;/p>
&lt;p>通常情况下，这些 IP 地址都由云平台记录和管理，不需要手动去更改。但有时候遇到物理网络的变更，可能会手动更改 IPMI 或者操作系统里面的 IP 地址，手动更改相应的 IP 地址后，就需要更新云平台对应的 IP 地址。&lt;/p>
&lt;div class="alert alert-warning" role="alert">
&lt;h4 class="alert-heading">注意&lt;/h4>
如果手动更改了物理机上的 IP 地址，但是云平台对应的信息没有同步更新，管理另外的物理机就可能出现 IP 地址冲突。
&lt;/div>
&lt;h2 id="物理机更改-ip">物理机更改 IP&lt;/h2>
&lt;p>对于没有安装操作系统的物理机，可以更改 IPMI 和 PXE 的 IP 地址。&lt;/p>
&lt;h3 id="更改-ipmi-ip">更改 IPMI IP&lt;/h3>
&lt;p>假设要把名称为 bm1 的物理机 IPMI 地址变为 10.0.2.2&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#8f5902;font-style:italic"># 先用 host-list 找到对应的物理机&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># 能看到 bm1 的状态 status 字段为 running&lt;/span>
$ climc host-list --search bm1
+--------------------------------------+------+-------------------+--------------+---------+---------+-------------+----------+-----------+------------+---------------+--------------+-----------+--------------+-----------+--------------+
&lt;span style="color:#000;font-weight:bold">|&lt;/span> ID &lt;span style="color:#000;font-weight:bold">|&lt;/span> Name &lt;span style="color:#000;font-weight:bold">|&lt;/span> Access_mac &lt;span style="color:#000;font-weight:bold">|&lt;/span> Access_ip &lt;span style="color:#000;font-weight:bold">|&lt;/span> Status &lt;span style="color:#000;font-weight:bold">|&lt;/span> enabled &lt;span style="color:#000;font-weight:bold">|&lt;/span> host_status &lt;span style="color:#000;font-weight:bold">|&lt;/span> mem_size &lt;span style="color:#000;font-weight:bold">|&lt;/span> cpu_count &lt;span style="color:#000;font-weight:bold">|&lt;/span> node_count &lt;span style="color:#000;font-weight:bold">|&lt;/span> sn &lt;span style="color:#000;font-weight:bold">|&lt;/span> storage_type &lt;span style="color:#000;font-weight:bold">|&lt;/span> host_type &lt;span style="color:#000;font-weight:bold">|&lt;/span> storage_size &lt;span style="color:#000;font-weight:bold">|&lt;/span> domain_id &lt;span style="color:#000;font-weight:bold">|&lt;/span> public_scope &lt;span style="color:#000;font-weight:bold">|&lt;/span>
+--------------------------------------+------+-------------------+--------------+---------+---------+-------------+----------+-----------+------------+---------------+--------------+-----------+--------------+-----------+--------------+
&lt;span style="color:#000;font-weight:bold">|&lt;/span> 610a7133-a2f6-4e52-8b12-2067296863a4 &lt;span style="color:#000;font-weight:bold">|&lt;/span> bm1 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 52:54:00:12:34:56 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 10.168.26.70 &lt;span style="color:#000;font-weight:bold">|&lt;/span> running &lt;span style="color:#000;font-weight:bold">|&lt;/span> &lt;span style="color:#204a87">true&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span> offline &lt;span style="color:#000;font-weight:bold">|&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">4096&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span> Not Specified &lt;span style="color:#000;font-weight:bold">|&lt;/span> hybrid &lt;span style="color:#000;font-weight:bold">|&lt;/span> baremetal &lt;span style="color:#000;font-weight:bold">|&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">215040&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span> default &lt;span style="color:#000;font-weight:bold">|&lt;/span> system &lt;span style="color:#000;font-weight:bold">|&lt;/span>
+--------------------------------------+------+-------------------+--------------+---------+---------+-------------+----------+-----------+------------+---------------+--------------+-----------+--------------+-----------+--------------+
&lt;span style="color:#8f5902;font-style:italic"># 查看 bm1 上网卡对应的 IP 地址&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># 能够看到类型为 ipmi 的网卡 30:4e:05:26:22:43 分配的地址为 10.0.2.3&lt;/span>
$ climc host-network-list --host bm1 --details
+--------------------------------------+------+--------------------------------------+------------+--------------+-------------------+----------+
&lt;span style="color:#000;font-weight:bold">|&lt;/span> Baremetal_ID &lt;span style="color:#000;font-weight:bold">|&lt;/span> Host &lt;span style="color:#000;font-weight:bold">|&lt;/span> Network_ID &lt;span style="color:#000;font-weight:bold">|&lt;/span> Network &lt;span style="color:#000;font-weight:bold">|&lt;/span> IP_addr &lt;span style="color:#000;font-weight:bold">|&lt;/span> Mac_addr &lt;span style="color:#000;font-weight:bold">|&lt;/span> Nic_Type &lt;span style="color:#000;font-weight:bold">|&lt;/span>
+--------------------------------------+------+--------------------------------------+------------+--------------+-------------------+----------+
&lt;span style="color:#000;font-weight:bold">|&lt;/span> 610a7133-a2f6-4e52-8b12-2067296863a4 &lt;span style="color:#000;font-weight:bold">|&lt;/span> bm1 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 14f56d88-0a70-404f-872e-56949bf0e488 &lt;span style="color:#000;font-weight:bold">|&lt;/span> pxe-net &lt;span style="color:#000;font-weight:bold">|&lt;/span> 10.168.26.72 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 52:54:00:12:34:56 &lt;span style="color:#000;font-weight:bold">|&lt;/span> admin &lt;span style="color:#000;font-weight:bold">|&lt;/span>
&lt;span style="color:#000;font-weight:bold">|&lt;/span> 610a7133-a2f6-4e52-8b12-2067296863a4 &lt;span style="color:#000;font-weight:bold">|&lt;/span> bm1 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 14f56d88-0a70-404f-872e-56949bf0e488 &lt;span style="color:#000;font-weight:bold">|&lt;/span> ipmi-net &lt;span style="color:#000;font-weight:bold">|&lt;/span> 10.0.2.3 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 30:4e:05:26:22:43 &lt;span style="color:#000;font-weight:bold">|&lt;/span> ipmi &lt;span style="color:#000;font-weight:bold">|&lt;/span>
+--------------------------------------+------+--------------------------------------+------------+--------------+-------------------+----------+
&lt;span style="color:#8f5902;font-style:italic"># 更新 IPMI 地址为 10.0.2.2&lt;/span>
$ climc host-update --ipmi-ip-addr 10.0.2.2 bm1
&lt;span style="color:#8f5902;font-style:italic"># 更新完 IPMI 地址后需要调用 IPMI 探测的接口重新刷新一遍信息&lt;/span>
$ climc host-ipmi-probe bm1
&lt;span style="color:#8f5902;font-style:italic"># 执行 host-ipmi-probe 后，bm1 的状态 status 字段会变为 start_probe&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># 探测完成后状态会变为 running ，期间可以用 host-list 命令查看&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># 等到探测完毕后，再用 host-network-list 命令查看 ipmi 地址&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># 发现已经更新为 10.0.2.2&lt;/span>
$ climc host-network-list --host bm1 --details &lt;span style="color:#000;font-weight:bold">|&lt;/span> grep ipmi
&lt;span style="color:#000;font-weight:bold">|&lt;/span> 610a7133-a2f6-4e52-8b12-2067296863a4 &lt;span style="color:#000;font-weight:bold">|&lt;/span> bm1 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 14f56d88-0a70-404f-872e-56949bf0e488 &lt;span style="color:#000;font-weight:bold">|&lt;/span> ipmi-net &lt;span style="color:#000;font-weight:bold">|&lt;/span> 10.0.2.2 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 30:4e:05:26:22:43 &lt;span style="color:#000;font-weight:bold">|&lt;/span> ipmi &lt;span style="color:#000;font-weight:bold">|&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="更改-pxe-ip">更改 PXE IP&lt;/h3>
&lt;p>物理机在安装系统，或者重装系统的时候，会先 PXE 引导进入平台定制的精简 Linux 系统，可以通过以下命令更改 PXE 启动时分配的 IP 地址。&lt;/p>
&lt;p>假设要把名称为 bm1 的 PXE 启动 IP 地址从 10.168.26.72 变为 10.168.26.70 。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#8f5902;font-style:italic"># 先查看物理机 bm1 上网卡已经分配的 IP 地址&lt;/span>
$ climc host-network-list --host bm1 --details
+--------------------------------------+------+--------------------------------------+------------+--------------+-------------------+----------+
&lt;span style="color:#000;font-weight:bold">|&lt;/span> Baremetal_ID &lt;span style="color:#000;font-weight:bold">|&lt;/span> Host &lt;span style="color:#000;font-weight:bold">|&lt;/span> Network_ID &lt;span style="color:#000;font-weight:bold">|&lt;/span> Network &lt;span style="color:#000;font-weight:bold">|&lt;/span> IP_addr &lt;span style="color:#000;font-weight:bold">|&lt;/span> Mac_addr &lt;span style="color:#000;font-weight:bold">|&lt;/span> Nic_Type &lt;span style="color:#000;font-weight:bold">|&lt;/span>
+--------------------------------------+------+--------------------------------------+------------+--------------+-------------------+----------+
&lt;span style="color:#000;font-weight:bold">|&lt;/span> 610a7133-a2f6-4e52-8b12-2067296863a4 &lt;span style="color:#000;font-weight:bold">|&lt;/span> bm1 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 14f56d88-0a70-404f-872e-56949bf0e488 &lt;span style="color:#000;font-weight:bold">|&lt;/span> pxe-net &lt;span style="color:#000;font-weight:bold">|&lt;/span> 10.168.26.72 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 52:54:00:12:34:56 &lt;span style="color:#000;font-weight:bold">|&lt;/span> admin &lt;span style="color:#000;font-weight:bold">|&lt;/span>
&lt;span style="color:#000;font-weight:bold">|&lt;/span> 610a7133-a2f6-4e52-8b12-2067296863a4 &lt;span style="color:#000;font-weight:bold">|&lt;/span> bm1 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 14f56d88-0a70-404f-872e-56949bf0e488 &lt;span style="color:#000;font-weight:bold">|&lt;/span> ipmi-net &lt;span style="color:#000;font-weight:bold">|&lt;/span> 10.0.2.2 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 30:4e:05:26:22:43 &lt;span style="color:#000;font-weight:bold">|&lt;/span> ipmi &lt;span style="color:#000;font-weight:bold">|&lt;/span>
+--------------------------------------+------+--------------------------------------+------------+--------------+-------------------+----------+
&lt;span style="color:#8f5902;font-style:italic"># 其中类型为 admin 的网卡表示分配给 PXE 启动的 IP&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># 对应网卡的 MAC 地址为 52:54:00:12:34:56&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># 先把物理机网卡禁用&lt;/span>
$ climc host-disable-netif bm1 52:54:00:12:34:56
&lt;span style="color:#8f5902;font-style:italic"># 然后重新启用对应网卡，分配指定的 IP 地址&lt;/span>
$ climc host-enable-netif --ip 10.168.26.70 bm1 52:54:00:12:34:56
&lt;span style="color:#8f5902;font-style:italic"># 再查看 bm1 上的网卡 IP 地址分配情况，发现 admin 类型的网卡已经变为 10.168.26.70&lt;/span>
$ climc host-network-list --host bm1 --details
+--------------------------------------+------+--------------------------------------+------------+--------------+-------------------+----------+
&lt;span style="color:#000;font-weight:bold">|&lt;/span> Baremetal_ID &lt;span style="color:#000;font-weight:bold">|&lt;/span> Host &lt;span style="color:#000;font-weight:bold">|&lt;/span> Network_ID &lt;span style="color:#000;font-weight:bold">|&lt;/span> Network &lt;span style="color:#000;font-weight:bold">|&lt;/span> IP_addr &lt;span style="color:#000;font-weight:bold">|&lt;/span> Mac_addr &lt;span style="color:#000;font-weight:bold">|&lt;/span> Nic_Type &lt;span style="color:#000;font-weight:bold">|&lt;/span>
+--------------------------------------+------+--------------------------------------+------------+--------------+-------------------+----------+
&lt;span style="color:#000;font-weight:bold">|&lt;/span> 610a7133-a2f6-4e52-8b12-2067296863a4 &lt;span style="color:#000;font-weight:bold">|&lt;/span> bm1 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 14f56d88-0a70-404f-872e-56949bf0e488 &lt;span style="color:#000;font-weight:bold">|&lt;/span> pxe-net &lt;span style="color:#000;font-weight:bold">|&lt;/span> 10.168.26.70 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 52:54:00:12:34:56 &lt;span style="color:#000;font-weight:bold">|&lt;/span> admin &lt;span style="color:#000;font-weight:bold">|&lt;/span>
&lt;span style="color:#000;font-weight:bold">|&lt;/span> 610a7133-a2f6-4e52-8b12-2067296863a4 &lt;span style="color:#000;font-weight:bold">|&lt;/span> bm1 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 25056dcc-45dr-3wef-8734-9b5694f880e4 &lt;span style="color:#000;font-weight:bold">|&lt;/span> ipmi-net &lt;span style="color:#000;font-weight:bold">|&lt;/span> 10.0.2.2 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 30:4e:05:26:22:43 &lt;span style="color:#000;font-weight:bold">|&lt;/span> ipmi &lt;span style="color:#000;font-weight:bold">|&lt;/span>
+--------------------------------------+------+--------------------------------------+------------+--------------+-------------------+----------+
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="裸金属更改-ip-地址">裸金属更改 IP 地址&lt;/h2>
&lt;p>物理机安装完操作系统后，在平台有一条对应的裸金属记录，裸金属分配的 IP 地址对应当前磁盘操作系统上的 IP 地址，如果手动修改了操作系统的 IP，需要使用以下的命令行更改对应裸金属的 IP 地址。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#8f5902;font-style:italic"># 先找到物理机 bm1 上对应的裸金属记录&lt;/span>
$ climc server-list --scope system --host bm1
&lt;span style="color:#8f5902;font-style:italic"># 查看裸金属 bms 上的网卡和 IP 地址对应关系&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># 会发现 bms 上的网卡 MAC 地址其实和 bm1 物理机的网卡时一致的&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># IP 地址也是优先复用的&lt;/span>
$ climc server-network-list --server bms --details
+--------------------------------------+-------+--------------------------------------+---------+-------------------+---------------+
&lt;span style="color:#000;font-weight:bold">|&lt;/span> Guest_ID &lt;span style="color:#000;font-weight:bold">|&lt;/span> Guest &lt;span style="color:#000;font-weight:bold">|&lt;/span> Network_ID &lt;span style="color:#000;font-weight:bold">|&lt;/span> Network &lt;span style="color:#000;font-weight:bold">|&lt;/span> Mac_addr &lt;span style="color:#000;font-weight:bold">|&lt;/span> IP_addr &lt;span style="color:#000;font-weight:bold">|&lt;/span>
+--------------------------------------+-------+--------------------------------------+---------+-------------------+---------------+
&lt;span style="color:#000;font-weight:bold">|&lt;/span> 398df1ce-1675-42b9-87d0-87634e21f139 &lt;span style="color:#000;font-weight:bold">|&lt;/span> bms &lt;span style="color:#000;font-weight:bold">|&lt;/span> 14f56d88-0a70-404f-872e-56949bf0e488 &lt;span style="color:#000;font-weight:bold">|&lt;/span> pxe-net &lt;span style="color:#000;font-weight:bold">|&lt;/span> 52:54:00:12:34:56 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 10.168.26.72 &lt;span style="color:#000;font-weight:bold">|&lt;/span>
+--------------------------------------+-------+--------------------------------------+---------+-------------------+---------------+
&lt;span style="color:#8f5902;font-style:italic"># 然后更新裸金属 bms 的 IP 地址，改为 pxe-net 子网里面的 10.168.26.70 地址&lt;/span>
$ climc server-change-ipaddr bms 52:54:00:12:34:56 pxe-net:10.168.26.70
&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Docs: 更换网卡</title><link>https://www.cloudpods.org/zh/docs/onpremise/baremetal/tutorial/change_netif/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.cloudpods.org/zh/docs/onpremise/baremetal/tutorial/change_netif/</guid><description>
&lt;p>云平台会记录物理机的网卡信息，如果实际环境中替换了物理机的网卡，需要手动保持平台里面物理机的网卡信息和实际环境中的一致。&lt;/p>
&lt;h2 id="删掉物理机网卡">删掉物理机网卡&lt;/h2>
&lt;p>假设需要移除物理机 bm1 上 mac 为 52:54:00:12:34:56 的网卡，对应操作如下：&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">$ climc host-remove-netif bm1 52:54:00:12:34:56
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="添加新的网卡">添加新的网卡&lt;/h2>
&lt;p>手动给物理机添加网卡后，同步平台里面的信息有两种方式，一种是让物理机重新 PXE 启动一次，平台对应的硬件信息就会更新，这种方式适用于物理机上没有安装操作系统或者删除了操作系统的情况。&lt;/p>
&lt;p>另外一种是使用命令 &lt;code>host-add-netif&lt;/code> 给物理机添加网卡：&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#8f5902;font-style:italic"># 给物理机 bm2 添加 admin 类型的网卡，二层网络为 bcast0 ，MAC 地址为 52:54:00:12:34:56，手动配置 IP 地址为 10.10.10.10&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># 网卡顺序为第一张(0)&lt;/span>
$ climc host-add-netif --ip-addr 10.10.10.10 --type admin bm2 bcast0 52:54:00:12:34:56 &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>查看物理机的网卡：&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">$ climc host-network-list --details --host bm2
+--------------------------------------+------+--------------------------------------+------------+--------------+-------------------+----------+
&lt;span style="color:#000;font-weight:bold">|&lt;/span> Baremetal_ID &lt;span style="color:#000;font-weight:bold">|&lt;/span> Host &lt;span style="color:#000;font-weight:bold">|&lt;/span> Network_ID &lt;span style="color:#000;font-weight:bold">|&lt;/span> Network &lt;span style="color:#000;font-weight:bold">|&lt;/span> IP_addr &lt;span style="color:#000;font-weight:bold">|&lt;/span> Mac_addr &lt;span style="color:#000;font-weight:bold">|&lt;/span> Nic_Type &lt;span style="color:#000;font-weight:bold">|&lt;/span>
+--------------------------------------+------+--------------------------------------+------------+--------------+-------------------+----------+
&lt;span style="color:#000;font-weight:bold">|&lt;/span> 610a7133-a2f6-4e52-8b12-2067296863a4 &lt;span style="color:#000;font-weight:bold">|&lt;/span> bm2 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 14f56d88-0a70-404f-872e-56949bf0e488 &lt;span style="color:#000;font-weight:bold">|&lt;/span> pxe-net &lt;span style="color:#000;font-weight:bold">|&lt;/span> 10.10.10.10 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 52:54:00:12:34:56 &lt;span style="color:#000;font-weight:bold">|&lt;/span> admin &lt;span style="color:#000;font-weight:bold">|&lt;/span>
&lt;span style="color:#000;font-weight:bold">|&lt;/span> 610a7133-a2f6-4e52-8b12-2067296863a4 &lt;span style="color:#000;font-weight:bold">|&lt;/span> bm2 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 14f56d88-0a70-404f-872e-56949bf0e488 &lt;span style="color:#000;font-weight:bold">|&lt;/span> ipmi-net &lt;span style="color:#000;font-weight:bold">|&lt;/span> 10.0.2.3 &lt;span style="color:#000;font-weight:bold">|&lt;/span> 30:4e:05:26:22:43 &lt;span style="color:#000;font-weight:bold">|&lt;/span> ipmi &lt;span style="color:#000;font-weight:bold">|&lt;/span>
+--------------------------------------+------+--------------------------------------+------------+--------------+-------------------+----------+
&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Docs: 物理机与宿主机互相转换</title><link>https://www.cloudpods.org/zh/docs/onpremise/baremetal/tutorial/convert/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.cloudpods.org/zh/docs/onpremise/baremetal/tutorial/convert/</guid><description>
&lt;h3 id="转换为宿主机">转换为宿主机&lt;/h3>
&lt;p>该功能用于将物理机设备转换成宿主机。物理机用于创建裸金属服务器，宿主机用于创建虚拟机。&lt;/p>
&lt;h4 id="准备工作">准备工作&lt;/h4>
&lt;ol>
&lt;li>宿主机即安装了host服务的计算节点，在云管平台上将物理机转换为宿主机时需要使用由我司提供的专门制作的宿主机镜像。&lt;/li>
&lt;li>将该镜像上传到管理平台，并记录该镜像的id信息。&lt;/li>
&lt;li>在控制节点上通过climc命令设置物理机转换宿主机的默认镜像。&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#8f5902;font-style:italic"># 设置默认镜像的镜像id&lt;/span>
$ climc service-config --config &lt;span style="color:#000">convert_hypervisor_default_template&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>a9b67435-8c08-4063-8ea6-d885ea26aa79 region2
&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="4">
&lt;li>将物理机转换为宿主机时可直接选择磁盘RAID设置参数，进行转换宿主机操作。或通过自定义设置选择宿主机镜像，进行转换宿主机操作。&lt;/li>
&lt;/ol>
&lt;h4 id="操作步骤">操作步骤&lt;/h4>
&lt;p>&lt;big>&lt;strong>界面操作&lt;/strong>&lt;/big>&lt;/p>
&lt;ol>
&lt;li>
&lt;p>在左侧导航栏，选择 &lt;strong>&lt;em>&amp;ldquo;主机/基础资源/物理机&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，进入物理机页面。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>单击物理机右侧操作列 &lt;strong>&lt;em>&amp;ldquo;更多&amp;rdquo;&lt;/em>&lt;/strong> 按钮，选择下拉菜单 &lt;strong>&lt;em>&amp;ldquo;转换为宿主机&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，弹出转换为宿主机对话框&lt;/p>
&lt;/li>
&lt;li>
&lt;p>配置以下参数：&lt;/p>
&lt;ul>
&lt;li>宿主机名称：宿主机名称默认为物理机名称，可修改。&lt;/li>
&lt;li>宿主机类型：目前仅支持KVM宿主机。&lt;/li>
&lt;li>磁盘RAID配置：包括默认配置(最高冗余)、RAID-1/RAID-10（两倍冗余）、RAID-5（1.x倍冗余）、RAID-0（无冗余）、自定义配置等。
&lt;div class="alert alert-warning" role="alert">
&lt;h4 class="alert-heading">注意&lt;/h4>
&lt;ul>
&lt;li>当物理机只存在一个RAID控制器，且该控制器下存在大于等于4块相同配置的磁盘时，物理机磁盘支持以上所有选项；&lt;/li>
&lt;li>当磁盘RAID配置为不是“自定义配置”时，物理机转换成宿主机的镜像为控制节点上region.conf配置文件中设置的镜像，且不支持设置网卡绑定。&lt;/li>
&lt;li>当物理机上存储不同大小的磁盘时，只支持自定义配置；&lt;/li>
&lt;/ul>
&lt;/div>
&lt;/li>
&lt;li>当选择默认配置(最高冗余)、RAID-1/RAID-10（两倍冗余）、RAID-5（1.x倍冗余）、RAID-0（无冗余）时，需要配置网络信息，选择是否启用bonding。
&lt;ul>
&lt;li>网络：设置宿主机的IP地址。当环境中有两张与网线连接的网卡需要做绑定设置时，可勾选&amp;quot;启用bonding&amp;quot;
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">说明&lt;/h4>
当物理机有两张连接网线的网卡时，将会自动绑定，当物理机有大于两张连接网线的网卡时，网卡绑定结果不可控，请谨慎操作。
&lt;/div>
&lt;ul>
&lt;li>指定IP子网：选择IP子网，如需指定静态IP，可单击 &lt;strong>&lt;em>&amp;ldquo;手动配置IP&amp;rdquo;&lt;/em>&lt;/strong> 按钮，设置IP地址，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮。&lt;/li>
&lt;li>指定调度标签：设置调度标签以及调度标签偏好。设置的调度标签偏好将会覆盖调度标签上的默认策略。根据调度标签及调度偏好选择最优的IP子网。
&lt;ul>
&lt;li>尽量使用（prefer）：调度时优先使用拥有这种标签的IP子网。&lt;/li>
&lt;li>避免使用（avoid）：调度时尽量避免拥有这种标签的IP子网。&lt;/li>
&lt;li>禁止使用（exclude）：调度时排除拥有这种标签的IP子网。&lt;/li>
&lt;li>必须使用（require）：调度时必须使用拥有这种标签的IP子网。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>当选择自定义配置时，需要选择磁盘镜像、在自定义磁盘配置中新增磁盘，选择磁盘以及RIAD配置，设置网络信息，选择是否bonding。
&lt;ul>
&lt;li>
&lt;p>镜像：当选择自定义设置时，需要设置镜像为专用于宿主机的镜像。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>自定义硬盘配置：单击 &lt;strong>&lt;em>&amp;ldquo;新增磁盘&amp;rdquo;&lt;/em>&lt;/strong> 按钮，弹出新建磁盘配置对话框。&lt;/p>
&lt;ul>
&lt;li>
&lt;p>选择物理机上的磁盘类型（HDD:3.6TIB表示物理机上一块磁盘大小为3.6TiB、磁盘类HDD）、设置RAID（包括不做RAID、RAID0、RAID1、RAID5、RAID10）&lt;/p>
&lt;/li>
&lt;li>
&lt;p>设置磁盘数量，即使用几块相同配置的磁盘做RAID配置，如对磁盘做RAID0，磁盘利用率为100%；对2块磁盘做RAID1，磁盘利用率为50%；对3块及以上磁盘做RAID5，磁盘利用率为(n-1)/n；对4块及以上磁盘做RAID10，磁盘利用率为50%。&lt;/p>
&lt;ul>
&lt;li>
&lt;p>RAID0和不做RAID对磁盘数量无要求；&lt;/p>
&lt;/li>
&lt;li>
&lt;p>RAID1要求至少有2块相同的磁盘；&lt;/p>
&lt;/li>
&lt;li>
&lt;p>RAID5要求至少有3块相同的磁盘；&lt;/p>
&lt;/li>
&lt;li>
&lt;p>RAID10要求至少有4块相同的磁盘；&lt;/p>
&lt;p>&lt;img src="../../../images/computing/raid.png" alt="">
&lt;img src="../../../images/computing/partition.png" alt="">&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，显示磁盘分区名称和大小信息，支持在界面修改分区，可分别单击“系统分区”黄色区域修改分区设置、单击“待分区”区域设置分区。分区参数如下：&lt;/p>
&lt;ul>
&lt;li>挂载点：设置分区挂载点，存储池默认挂载点为“/opt/cloud/workspace”。&lt;/li>
&lt;li>分区格式：包括ext4、xfs、ntfs、swap分区。&lt;/li>
&lt;li>分区大小：包括最大容量和手动输入两种，最大容量使用磁盘所有空间，手动输入可以手动设置分区大小，单位为GB。&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="../../../images/computing/createpartition1.png" alt="">&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>网络：设置宿主机的IP地址。当环境中有两张与网线连接的网卡需要做绑定设置时，可勾选&amp;quot;启用bonding&amp;quot;
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">说明&lt;/h4>
当物理机有两张连接网线的网卡时，将会自动绑定，当物理机有大于两张连接网线的网卡时，网卡绑定结果不可控，请谨慎操作。
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>指定IP子网：选择IP子网，如需指定静态IP，可单击 &lt;strong>&lt;em>&amp;ldquo;手动配置IP&amp;rdquo;&lt;/em>&lt;/strong> 按钮，设置IP地址，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮。&lt;/li>
&lt;li>指定调度标签：设置调度标签以及调度标签偏好。设置的调度标签偏好将会覆盖调度标签上的默认策略。根据调度标签及调度偏好选择最优的IP子网。
&lt;ul>
&lt;li>尽量使用（prefer）：调度时优先使用拥有这种标签的IP子网。&lt;/li>
&lt;li>避免使用（avoid）：调度时尽量避免拥有这种标签的IP子网。&lt;/li>
&lt;li>禁止使用（exclude）：调度时排除拥有这种标签的IP子网。&lt;/li>
&lt;li>必须使用（require）：调度时必须使用拥有这种标签的IP子网。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，将物理机转换为宿主机。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>&lt;big>&lt;strong>climc操作&lt;/strong>&lt;/big>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#8f5902;font-style:italic"># 转换为宿主机&lt;/span>
climc host-convert-hypervisor
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="回收为物理机">回收为物理机&lt;/h3>
&lt;p>该功能用于将宿主机回收成物理机。当宿主机类型为KVM且包含IPMI信息时可转为宿主机。物理机用于创建裸金属服务器，宿主机用于创建虚拟机。&lt;/p>
&lt;p>&lt;big>&lt;strong>界面操作&lt;/strong>&lt;/big>&lt;/p>
&lt;p>&lt;strong>单个宿主机回收为物理机&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>单击宿主机右侧操作列 &lt;strong>&lt;em>&amp;ldquo;更多&amp;rdquo;&lt;/em>&lt;/strong> 按钮，选择下拉菜单 &lt;strong>&lt;em>&amp;ldquo;回收为宿主机&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，弹出操作确认对话框。&lt;/li>
&lt;li>单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，完成操作，可在物理机列表查看到服务器信息。&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>批量将宿主机回收为物理机&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>在宿主机列表中勾选一个或多个宿主机，单击列表上方 &lt;strong>&lt;em>&amp;ldquo;批量操作&amp;rdquo;&lt;/em>&lt;/strong> 按钮，选择下拉菜单 &lt;strong>&lt;em>&amp;ldquo;回收为宿主机&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，弹出操作确认对话框。&lt;/li>
&lt;li>单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，完成操作，可在物理机列表查看到服务器信息。&lt;/li>
&lt;/ol>
&lt;p>&lt;big>&lt;strong>climc操作&lt;/strong>&lt;/big>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#8f5902;font-style:italic"># 回收为物理机&lt;/span>
climc host-undo-convert &amp;lt;host_id&amp;gt;
&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Docs: 物理机相关操作</title><link>https://www.cloudpods.org/zh/docs/onpremise/baremetal/tutorial/machine/</link><pubDate>Mon, 07 Feb 2022 19:02:52 +0800</pubDate><guid>https://www.cloudpods.org/zh/docs/onpremise/baremetal/tutorial/machine/</guid><description/></item><item><title>Docs: 裸金属相关操作</title><link>https://www.cloudpods.org/zh/docs/onpremise/baremetal/tutorial/baremetal/</link><pubDate>Mon, 07 Feb 2022 19:01:54 +0800</pubDate><guid>https://www.cloudpods.org/zh/docs/onpremise/baremetal/tutorial/baremetal/</guid><description/></item><item><title>Docs: 物理机测试方案</title><link>https://www.cloudpods.org/zh/docs/onpremise/baremetal/tutorial/testcase/</link><pubDate>Fri, 19 Jul 2019 20:25:05 +0800</pubDate><guid>https://www.cloudpods.org/zh/docs/onpremise/baremetal/tutorial/testcase/</guid><description>
&lt;h2 id="1-环境要求">1. 环境要求&lt;/h2>
&lt;h3 id="11-物理机设置">1.1 物理机设置&lt;/h3>
&lt;p>物理机设置要求如下：&lt;/p>
&lt;ol>
&lt;li>
&lt;p>物理机的启动方式推荐采用legacy（BIOS）方式，UEFI方式不推荐。只有在必须采用UEFI时才选用UEFI。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>物理机的默认启动方式为网络PXE启动，硬盘启动为第二顺位的启动介质&lt;/p>
&lt;/li>
&lt;li>
&lt;p>需要允许物理机网卡的PXE启动（BIOS开启IPMI-over-LAN）&lt;/p>
&lt;/li>
&lt;li>
&lt;p>需要允许网络访问物理机的BMC（BIOS开启网卡PXE）&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="12-测试网络设置">1.2 测试网络设置&lt;/h3>
&lt;p>物理服务器的网络接口（NIC）分为BMC NIC和服务器NIC，BMC NIC用于通过网络访问物理机的BMC控制功能，BMC NIC可以配置为和服务器NIC共享物理机接口，也可以配置为独立的网络接口。&lt;/p>
&lt;img src="../../images/baremetal_test.png" width="700">
&lt;p>其中，交换机0为部署服务的节点接入的三层交换机，交换机1为待管理物理服务器的服务器NIC接入三层交换机，交换机2为待管理物理服务器的BMC NIC接入三层交换机。&lt;/p>
&lt;p>此处，交换机0，1，2可以是同一个三层交换机，这是最简化的场景，也就是服务节点、待管理交换机的服务器NIC、以及BMC NIC都在一个二层网络内。&lt;/p>
&lt;p>一般物理机服务器采用bonding需要配置双NIC接入。目前只支持802.3ad LACP模式，也就是mode为4的bond。如果要支持bond这种模式，需要物理机的两个NIC都接入交换机1，此处交换机1可能是一对堆叠交换机。&lt;/p>
&lt;h3 id="13-ip子网设置">1.3 IP子网设置&lt;/h3>
&lt;p>需要在平台做如下配置用于物理机的IP地址分配：新建物理机用二层网络（如：brbm），如果物理机BMC NIC和物理机 NIC的二层网络隔离，则需新建BMC NIC用二层网络 brbmc。在二层网络brbm上新建属性为baremetal或PXE的IP子网（vbm），用于分配物理机NIC的IP地址。在二层网络brbmc（或bmbm）上新建属性为IPMI的 IP子网，用于分配BMC NIC的IP地址（vbmc）。&lt;/p>
&lt;p>连通性要求：要求baremetal agent能够直接访问vbm和vbmc的IP地址。&lt;/p>
&lt;h3 id="14-交换机设置">1.4 交换机设置&lt;/h3>
&lt;p>为了允许物理机能够网络PXE启动，需要设置交换机1的dhcp_relay为bareemetal_agent所在节点IP地址的UDP 67端口。&lt;/p>
&lt;p>如果采用“预注册”方式注册物理机，则也需要设置交换机2的dhcp_relay为baremetal_agent所在节点IP地址的UDP 67端口。&lt;/p>
&lt;p>在最简网络模式下，依旧是上文所说的服务和待管理物理机在同一个IP子网的网络配置下，如果不方便开启三层交换机的dhcp_relay，则可以借用Cloudpods的Host服务，开启其dhcp_relay功能，作为测试IP子网的dhcp relay服务器。具体开启方法为：修改该Host服务所在宿主机的配置文件 /etc/yunion/host.conf，增加 dhcp_relay 的配置项，内容为baremetal_agent部署节点IP的UDP 67端口。配置好后，记得重启该host服务。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#204a87;font-weight:bold">dhcp_relay&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>- &lt;span style="color:#0000cf;font-weight:bold">192.168.222.101&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>- &lt;span style="color:#0000cf;font-weight:bold">67&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>注意&lt;/strong> 待管理物理机所在网络内不能有其他DHCP服务器！&lt;/p>
&lt;h3 id="15-物理机硬件信息要求">1.5 物理机硬件信息要求&lt;/h3>
&lt;p>需要提前准备好物理机的如下信息：&lt;/p>
&lt;ol>
&lt;li>如果采用PXE引导注册或预注册的物理服务器，需要第一个网络PXE启动的物理机 NIC的mac地址&lt;/li>
&lt;li>如果采用PXE引导注册或ISO引导注册，需要物理机的BMC NIC的IP地址和BMC 账号，密码。&lt;/li>
&lt;/ol>
&lt;h2 id="2-测试流程">2. 测试流程&lt;/h2>
&lt;h3 id="21-物理机注册">2.1 物理机注册&lt;/h3>
&lt;p>物理机注册实现将一台物理机注册到云平台，云平台会引导物理机启动进入一个网络加载的内存Linux系统，通过该Linux接管物理机，实现自动采集物理机的配置信息，并注册到平台。&lt;/p>
&lt;p>支持如下四种注册方式：&lt;/p>
&lt;h4 id="211-pxe引导注册推荐方式">2.1.1 PXE引导注册(推荐方式)&lt;/h4>
&lt;p>物理机已经配置BMC NIC的IP，通过BMC控制物理服务器通过PXE协议引导物理机网络启动进入内存Linux系统。这种方式依赖PXE网络启动，因此要求设置交换机1的dhcp_relay。&lt;/p>
&lt;h4 id="212-iso引导注">2.1.2 ISO引导注&lt;/h4>
&lt;p>物理机已经配置BMC NIC的IP，通过物理机的虚拟ISO介质引导物理机启动进入内存Linux系统。这种方式不依赖PXE启动，因此不要求设置交换机1的dhcp_relay。但是要求物理机支持设置BMC的虚拟机ISO介质，一般只有最新的少数物理服务器支持，例如HPE Gen10。&lt;/p>
&lt;h4 id="213-预注册">2.1.3 预注册&lt;/h4>
&lt;p>和PXE引导注册类似，但是物理机未配置BMC NIC的IP。这种方式会自动设置BMC NIC的IP，需要探测BMC NIC的连通性，因此需要设置交换机2的dhcp_relay。&lt;/p>
&lt;h4 id="214-托管">2.1.4 托管&lt;/h4>
&lt;p>这种方式适用于已经安装了操作系统，不适合进行开关机操作的物理服务器的注册。这种方式只支持物理服务器上已安装系统为Linux。这种方式要求管理员在物理服务器的操作系统内执行指定的脚本命令，并输入物理服务器的BMC NIC IP和密码，实现物理服务器的注册。&lt;/p>
&lt;h3 id="22-物理机安装操作系统">2.2 物理机安装操作系统&lt;/h3>
&lt;p>使用上述注册的物理机安装操作系统。我们将安装了操作系统的物理机成为“裸金属”服务器。&lt;/p>
&lt;p>注意：&lt;/p>
&lt;ol>
&lt;li>如果物理服务器采用双网卡接入，可以测试自动设置网卡的bonding模式，此时网卡需要勾选“bond”选项&lt;/li>
&lt;li>新安装的操作系统的IP地址可以复用物理服务器PXE启动注册用的PXE IP地址，此时选择网络需要注册还是选择PXE IP子网。&lt;/li>
&lt;/ol>
&lt;h3 id="23-安装物理机监控agent">2.3 安装物理机监控agent&lt;/h3>
&lt;p>在“裸金属”服务器的监控面板，安装监控agent，查看物理机是否有监控指标数据。&lt;/p>
&lt;h3 id="24-删除操作系统">2.4 删除操作系统&lt;/h3>
&lt;p>删除“裸金属”服务器上安装的操作系统，成为一台“闲置”的物理机&lt;/p></description></item></channel></rss>
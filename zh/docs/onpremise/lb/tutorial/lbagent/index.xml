<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Cloudpods –
负载均衡节点</title><link>https://www.cloudpods.org/zh/docs/onpremise/lb/tutorial/lbagent/</link><description>Recent content in 负载均衡节点 on Cloudpods</description><generator>Hugo -- gohugo.io</generator><lastBuildDate>Mon, 20 Dec 2021 16:42:13 +0800</lastBuildDate><atom:link href="https://www.cloudpods.org/zh/docs/onpremise/lb/tutorial/lbagent/index.xml" rel="self" type="application/rss+xml"/><item><title>Docs: 新建节点</title><link>https://www.cloudpods.org/zh/docs/onpremise/lb/tutorial/lbagent/create/</link><pubDate>Mon, 20 Dec 2021 16:42:21 +0800</pubDate><guid>https://www.cloudpods.org/zh/docs/onpremise/lb/tutorial/lbagent/create/</guid><description>
&lt;ol>
&lt;li>
&lt;p>单击列表上方 &lt;strong>&lt;em>&amp;ldquo;新建&amp;rdquo;&lt;/em>&lt;/strong> 按钮，弹出创建节点对话框。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>配置以下参数：&lt;/p>
&lt;ul>
&lt;li>名称：节点的名称。&lt;/li>
&lt;li>集群：节点所属的集群，若无合适集群，可单击输入框下的“新建”超链接创建集群。&lt;/li>
&lt;li>优先级：设置节点的优先级，数字越大优先级越大，优先级大的节点默认为master节点。&lt;/li>
&lt;li>抢占模式：设置是否启用抢占模式，当抢占模式开启后，若优先级高的backup节点遇到优先级低的master节点，backup节点将抢占成为master节点。&lt;/li>
&lt;li>VRRP路由ID：设置节点的VRRP路由ID，同一集群下的节点的VRRP路由ID必须相同，不同集群下的节点的VRRP路由ID必须不同。&lt;/li>
&lt;li>VRRP网口：节点广播通告用的网卡名称。&lt;/li>
&lt;li>VRRP通告间隔：VRRP广播通告间隔，关系到故障时自动切换的灵敏度。&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>高级配置&lt;/strong>：默认隐藏，可根据需求进行配置。&lt;/p>
&lt;ul>
&lt;li>VRRP密码：设置VRRP通信的密码，主备节点的VRRP密码必须相同，为空则密码默认为YunionLB。&lt;/li>
&lt;li>转发实例心跳超时时间：设置转发节点部署的虚拟机心跳超时时间，当超过超时时间的虚拟机未收到心跳时，状态将变为UNKNOWN，默认为3600秒，取值范围为600~3600。&lt;/li>
&lt;li>配置Telegraf参数：
&lt;ul>
&lt;li>InfluxDB地址：用于监控数据上传通道，一般InfluxDB部署在控制节点上，格式为&lt;a href="https://%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9IP%E5%9C%B0%E5%9D%80:30086">https://控制节点IP地址:30086&lt;/a>。&lt;/li>
&lt;li>InfluxDB数据库名称：设置InfluxDB数据库的名称。&lt;/li>
&lt;li>监控数据采集间隔：设置telegraf采集监控数据的间隔，默认为5s，取值范围为1~600。&lt;/li>
&lt;li>配置模板：可根据需求自定义telegraf配置模板。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>配置HAProxy参数：
&lt;ul>
&lt;li>HAProxy线程数：设置HAProxy线程数，请根据实际情况设置。默认为1，取值范围为1~64。&lt;/li>
&lt;li>日志输出设置：设置日志的保存位置，支持保存到本地、远端服务器等，输入格式例如“/dev/log”、IP、IP:port。为空则表示不记录日志。&lt;/li>
&lt;li>记录HTTP日志：是否记录HTTP类型的日志。&lt;/li>
&lt;li>记录TCP日志：是否记录TCP类型的日志。&lt;/li>
&lt;li>记录Normal日志：是否记录正常日志。&lt;/li>
&lt;li>请求中最大http头数：设置请求中最大http头数量，默认为101，取值为1~32767。&lt;/li>
&lt;li>配置模板：可根据需求自定义HAProxy配置模板。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>配置Keepalived参数：
&lt;ul>
&lt;li>配置模板：可根据需求自定义Keepalived配置模板。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，创建节点。&lt;/p>
&lt;/li>
&lt;/ol></description></item><item><title>Docs: 部署节点</title><link>https://www.cloudpods.org/zh/docs/onpremise/lb/tutorial/lbagent/deploy/</link><pubDate>Wed, 22 Dec 2021 14:54:38 +0800</pubDate><guid>https://www.cloudpods.org/zh/docs/onpremise/lb/tutorial/lbagent/deploy/</guid><description>
&lt;p>节点创建完成后需要将其部署在虚拟机、宿主机或外部机器上才能正常使用，部署节点的过程即将的配置文件下发到绑定的虚拟机上面。&lt;/p>
&lt;div class="alert alert-warning" role="alert">
&lt;h4 class="alert-heading">注意&lt;/h4>
&lt;p>当转发节点上有监听任意IP的某个端口的服务配置时，会造成在使用该转发节点的LB实例上配置对应协议端口的监听无法正常使用。&lt;/p>
&lt;pre>&lt;code># 在转发节点上查看监听任意IP的端口情况
$ netstat -nlp |grep 0.0.0.0:
tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 7120/sshd
&lt;/code>&lt;/pre>&lt;p>通过查询可以发现转发节点上的sshd服务正在监听任意IP的TCP 22端口，如用户需要在LB实例上配置TCP 22端口的监听，则需要将转发节点的sshd配置文件，将&amp;quot;/etc/ssh/sshd_config&amp;quot;配置文件的&lt;code>#ListenAddress 0.0.0.0&lt;/code>改为&lt;code>ListenAddress &amp;lt;转发节点IP&amp;gt;&lt;/code> 。&lt;/p>
&lt;/div>
&lt;ol>
&lt;li>
&lt;p>在负载均衡节点页面，单击节点右侧操作列 &lt;strong>&lt;em>&amp;ldquo;部署&amp;rdquo;&lt;/em>&lt;/strong> 按钮，弹出部署对话框。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>配置以下参数：&lt;/p>
&lt;ul>
&lt;li>指定系统用户：需要使用系统管理员用户部署节点。设置项目为“system”、选择已知密码的系统用户名并输入对应密码。如不存在已知系统用户密码，可通过climc命令创建系统用户lbagent用户，并使用lbagent用户及密码部署。
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">说明&lt;/h4>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#8f5902;font-style:italic"># 创建lbagent系统用户&lt;/span>
$ climc user-create lbagent --password xxx --system-account
&lt;span style="color:#8f5902;font-style:italic"># 将lbagent用户以管理员的角色加入到system项目&lt;/span>
$ climc project-add-user system lbagent admin
&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;/li>
&lt;li>部署类型：选择转发实例节点，请尽量选取相互独立的虚拟机、宿主机或外部机器。
&lt;ul>
&lt;li>当选择虚拟机时，要求虚拟机与负载均衡集群处于同一可用区，且虚拟机与控制节点网络连通。&lt;/li>
&lt;li>当选择宿主机时，要求宿主机与负载均衡集群处于同一可用区，且宿主机与控制节点网络连通。&lt;/li>
&lt;li>当选择外部机器时，要求ansible server（一般为控制节点）能够访问到目标机器。且目标机器上存在cloudroot用户，cloudroot用户支持sudo免密登录，管理员使用公钥可以免密登录cloudroot等。
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">说明&lt;/h4>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#8f5902;font-style:italic"># 获取管理员公钥&lt;/span>
$ climc sshkeypair-show --admin
&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Yum源地址：Yum源地址，&lt;a href="https://yunioniso.oss-cn-beijing.aliyuncs.com/iso/%7Bversion%7D/rpms">https://yunioniso.oss-cn-beijing.aliyuncs.com/iso/{version}/rpms&lt;/a>，且建议不勾选Yum源TLS校验。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，弹出部署对话框，查看节点的部署情况。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>若部署未执行完成，可再次单击 &lt;strong>&lt;em>&amp;ldquo;部署&amp;rdquo;&lt;/em>&lt;/strong> 按钮，在弹出的部署对话框中的单击”任务正在执行中框中“提示框的”详情“超链接，查看节点的部署情况。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>节点部署完成后，将显示节点的主备以及心跳信息等。&lt;/p>
&lt;/li>
&lt;/ol></description></item><item><title>Docs: 下线节点</title><link>https://www.cloudpods.org/zh/docs/onpremise/lb/tutorial/lbagent/offline/</link><pubDate>Wed, 22 Dec 2021 14:56:07 +0800</pubDate><guid>https://www.cloudpods.org/zh/docs/onpremise/lb/tutorial/lbagent/offline/</guid><description>
&lt;p>该功能用于下线节点，节点下线会将节点配置文件从部署主机上删除。&lt;/p>
&lt;ol>
&lt;li>在负载均衡节点页面，单击节点右侧操作列 &lt;strong>&lt;em>&amp;ldquo;下线&amp;rdquo;&lt;/em>&lt;/strong> 按钮，弹出下线确认对话框。&lt;/li>
&lt;li>单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，下线节点。&lt;/li>
&lt;/ol></description></item><item><title>Docs: 修改节点</title><link>https://www.cloudpods.org/zh/docs/onpremise/lb/tutorial/lbagent/modify/</link><pubDate>Wed, 22 Dec 2021 14:57:22 +0800</pubDate><guid>https://www.cloudpods.org/zh/docs/onpremise/lb/tutorial/lbagent/modify/</guid><description>
&lt;p>该功能用于修改节点的配置信息。&lt;/p>
&lt;ol>
&lt;li>在负载均衡节点页面，单击节点右侧操作列 &lt;strong>&lt;em>&amp;ldquo;更多&amp;rdquo;&lt;/em>&lt;/strong> 按钮，选择下拉菜单 &lt;strong>&lt;em>&amp;ldquo;修改&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，进入修改节点页面。&lt;/li>
&lt;li>修改相关参数，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮。&lt;/li>
&lt;/ol></description></item><item><title>Docs: 设置心跳超时时间</title><link>https://www.cloudpods.org/zh/docs/onpremise/lb/tutorial/lbagent/sethearttime/</link><pubDate>Wed, 22 Dec 2021 14:57:38 +0800</pubDate><guid>https://www.cloudpods.org/zh/docs/onpremise/lb/tutorial/lbagent/sethearttime/</guid><description>
&lt;p>该功能用于修改转发实例的心跳超时时间。当转发实例超过超时时间未收到心跳时，节点状态将变为UNKNOWN。&lt;/p>
&lt;ol>
&lt;li>在负载均衡节点页面，单击节点右侧操作列 &lt;strong>&lt;em>&amp;ldquo;更多&amp;rdquo;&lt;/em>&lt;/strong> 按钮，选择下拉菜单 &lt;strong>&lt;em>&amp;ldquo;设置心跳超时时间&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，弹出设置心跳超时时间对话框。&lt;/li>
&lt;li>设置转发实例心跳超时时间，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，完成操作。&lt;/li>
&lt;/ol></description></item><item><title>Docs: 删除节点</title><link>https://www.cloudpods.org/zh/docs/onpremise/lb/tutorial/lbagent/delete/</link><pubDate>Mon, 20 Dec 2021 16:42:24 +0800</pubDate><guid>https://www.cloudpods.org/zh/docs/onpremise/lb/tutorial/lbagent/delete/</guid><description>
&lt;h3 id="前提条件">前提条件&lt;/h3>
&lt;p>确保已&lt;a href="https://www.cloudpods.org/zh/docs/onpremise/lb/tutorial/lbagent/offline/">下线节点&lt;/a>&lt;/p>
&lt;h3 id="操作步骤">操作步骤&lt;/h3>
&lt;ol>
&lt;li>在负载均衡节点页面，单击节点右侧操作列 &lt;strong>&lt;em>&amp;ldquo;删除&amp;rdquo;&lt;/em>&lt;/strong> 按钮，弹出删除确认对话框。&lt;/li>
&lt;li>勾选”确定已经实际操作下线“后，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，删除节点。&lt;/li>
&lt;/ol></description></item><item><title>Docs: 查看节点详情</title><link>https://www.cloudpods.org/zh/docs/onpremise/lb/tutorial/lbagent/show/</link><pubDate>Wed, 22 Dec 2021 14:57:46 +0800</pubDate><guid>https://www.cloudpods.org/zh/docs/onpremise/lb/tutorial/lbagent/show/</guid><description>
&lt;ol>
&lt;li>在负载均衡节点页面，单击节点名称项，进入节点详情页面。&lt;/li>
&lt;li>详情页面顶部菜单项支持对节点进行管理操作。&lt;/li>
&lt;li>查看以下信息。
&lt;ul>
&lt;li>基础信息：查看节点的云上ID、ID、名称、状态、域、项目、集群、主备、上一次心跳、可用区、心跳超时时间、部署机器、创建时间、更新时间、备注。&lt;/li>
&lt;li>同步时间戳：表示数据库中负载均衡实例、监听、后端服务器组、后端服务器、转发策略、访问控制、证书等参数在某个特定时间之前已经存在、完整的、可验证的数据写入部署机器。&lt;/li>
&lt;li>VRRP转发实例配置信息：包括通告间隔、网口、密码、抢占模式、优先级以及路由ID信息。&lt;/li>
&lt;li>HAProxy配置信息：查看HAProxy配置信息，包括线程数、开启日志、开启HTTP日志、开启Normal日志、开启TCP日志、以及配置模板信息。&lt;/li>
&lt;li>Telegraf（数据采集工具）配置信息：查看Telegraf配置信息，包括HAProxy上报间隔、数据库名称、地址、以及配置模板信息。&lt;/li>
&lt;li>KeepAlived配置信息：查看KeepAlived配置模板信息。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol></description></item><item><title>Docs: 查看部署详情</title><link>https://www.cloudpods.org/zh/docs/onpremise/lb/tutorial/lbagent/details/</link><pubDate>Wed, 22 Dec 2021 14:57:56 +0800</pubDate><guid>https://www.cloudpods.org/zh/docs/onpremise/lb/tutorial/lbagent/details/</guid><description>
&lt;p>该功能用于查看节点的上次部署输出的日志信息，用于部署失败时通过输出日志进行排错等。部署详情仅在部署节点后才会出现。&lt;/p>
&lt;h3 id="前提条件">前提条件&lt;/h3>
&lt;p>已&lt;a href="https://www.cloudpods.org/zh/docs/onpremise/lb/tutorial/lbagent/deploy/">部署节点&lt;/a>&lt;/p>
&lt;h3 id="操作步骤">操作步骤&lt;/h3>
&lt;ol>
&lt;li>在负载均衡节点页面，单击节点名称项，进入节点详情页面。&lt;/li>
&lt;li>单击“部署详情”页签，进入部署详情页面。&lt;/li>
&lt;li>查看节点的部署详情以及输出日志等。&lt;/li>
&lt;li>支持重新执行或终止执行操作等。&lt;/li>
&lt;/ol></description></item><item><title>Docs: 查看节点操作日志</title><link>https://www.cloudpods.org/zh/docs/onpremise/lb/tutorial/lbagent/log/</link><pubDate>Wed, 22 Dec 2021 14:58:00 +0800</pubDate><guid>https://www.cloudpods.org/zh/docs/onpremise/lb/tutorial/lbagent/log/</guid><description>
&lt;ol>
&lt;li>在负载均衡节点页面，单击节点名称项，进入节点详情页面。&lt;/li>
&lt;li>单击“操作日志”页签，进入操作日志页面。
&lt;ul>
&lt;li>加载更多日志：在操作日志页面，列表默认显示20条操作日志信息，如需查看更多操作日志，请单击 &lt;strong>&lt;em>&amp;ldquo;加载更多&amp;rdquo;&lt;/em>&lt;/strong> 按钮，获取更多日志信息。&lt;/li>
&lt;li>查看日志详情：单击操作日志右侧操作列 &lt;strong>&lt;em>&amp;ldquo;查看&amp;rdquo;&lt;/em>&lt;/strong> 按钮，查看日志的详情信息。支持复制详情内容。&lt;/li>
&lt;li>查看指定时间段的日志：如需查看某个时间段的操作日志，在列表右上方的开始日期和结束日期中设置具体的日期，查询指定时间段的日志信息。&lt;/li>
&lt;li>导出日志：目前仅支持导出本页显示的日志。单击右上角&lt;img src="../../../../images/download.png" alt="">图标，在弹出的导出数据对话框中，设置导出数据列，单击 &lt;strong>&lt;em>&amp;ldquo;确定&amp;rdquo;&lt;/em>&lt;/strong> 按钮，导出日志。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol></description></item></channel></rss>
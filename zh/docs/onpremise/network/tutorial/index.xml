<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Cloudpods –
操作指南</title><link>https://www.cloudpods.org/zh/docs/onpremise/network/tutorial/</link><description>Recent content in 操作指南 on Cloudpods</description><generator>Hugo -- gohugo.io</generator><lastBuildDate>Mon, 10 Jan 2022 15:33:35 +0800</lastBuildDate><atom:link href="https://www.cloudpods.org/zh/docs/onpremise/network/tutorial/index.xml" rel="self" type="application/rss+xml"/><item><title>Docs: 地域</title><link>https://www.cloudpods.org/zh/docs/onpremise/network/tutorial/area/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.cloudpods.org/zh/docs/onpremise/network/tutorial/area/</guid><description>
&lt;p>&lt;strong>区域入口&lt;/strong>：在云管平台单击左上角&lt;img src="../../../images/intro/nav.png" alt="">导航菜单，在弹出的左侧菜单栏中单击 &lt;strong>&lt;em>&amp;ldquo;网络/地域/区域&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，进入区域列表。&lt;/p>
&lt;p>&lt;img src="../../images/region.png" alt="">&lt;/p>
&lt;p>&lt;strong>可用区入口&lt;/strong>：在云管平台单击左上角&lt;img src="../../../images/intro/nav.png" alt="">导航菜单，在弹出的左侧菜单栏中单击 &lt;strong>&lt;em>&amp;ldquo;网络/地域/可用区&amp;rdquo;&lt;/em>&lt;/strong> 菜单项，进入可用区列表。&lt;/p>
&lt;p>&lt;img src="../../images/zone.png" alt="">&lt;/p></description></item><item><title>Docs: 经典网络</title><link>https://www.cloudpods.org/zh/docs/onpremise/network/tutorial/default/</link><pubDate>Mon, 10 Jan 2022 15:33:35 +0800</pubDate><guid>https://www.cloudpods.org/zh/docs/onpremise/network/tutorial/default/</guid><description>
&lt;p>平台内置私有云默认将自动生成的Default VPC作为经典网络，在Default VPC下创建的二层网络或IP子网都与实际环境相关，&lt;/p></description></item><item><title>Docs: VPC网络</title><link>https://www.cloudpods.org/zh/docs/onpremise/network/tutorial/vpc/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.cloudpods.org/zh/docs/onpremise/network/tutorial/vpc/</guid><description>
&lt;p>平台内置私有云提供VPC网络功能，并支持将经典网络的IP子网网段作为弹性公网IP池使用，供VPC内的虚拟机与外界访问等。&lt;/p></description></item><item><title>Docs: 网络配置</title><link>https://www.cloudpods.org/zh/docs/onpremise/network/tutorial/configuration/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.cloudpods.org/zh/docs/onpremise/network/tutorial/configuration/</guid><description>
&lt;p>本节介绍私有云虚拟机的网络设置，包括DHCP，DNS，NTP等设置。&lt;/p>
&lt;h2 id="dhcp">DHCP&lt;/h2>
&lt;p>虚拟机默认开启DHCP，通过DHCP获取IP地址，静态路由，域名，NTP等设置。物理机则默认是通过静态写入配置文件方式获取这些配置。&lt;/p>
&lt;h2 id="dns配置">DNS配置&lt;/h2>
&lt;h3 id="全局配置">全局配置&lt;/h3>
&lt;p>全局主机DNS server需要在两个地方配置：&lt;/p>
&lt;ol>
&lt;li>region配置&lt;/li>
&lt;/ol>
&lt;p>climc service-config-edit region2&lt;/p>
&lt;p>修改配置：dns_server&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#204a87;font-weight:bold">default&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">...&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">dns_domain&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">office.yunion.io&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">dns_server&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">172.16.22.11&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">...&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>endpoint配置&lt;/li>
&lt;/ol>
&lt;p>首先注册dns服务&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">climc service-create dns dns
&lt;/code>&lt;/pre>&lt;/div>&lt;p>其次注册DNS服务的地址，可以注册多个。每个对应一条endpoint记录。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">climc endpoint-create dns region0 public &amp;lt;dns_ip&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ip子网配置">IP子网配置&lt;/h3>
&lt;p>针对每个IP子网，可以修改这个IP子网的guest_dns配置，可以设置多个，以逗号分隔。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">climc network-update --dns &lt;span style="color:#4e9a06">&amp;#39;172.16.22.11,172.16.22.12&amp;#39;&lt;/span> &amp;lt;network&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;p>如果同时配置了全局的DNS配置和IP子网的DNS配置，以IP子网的DNS配置优先生效。&lt;/p>
&lt;h2 id="ntp配置">NTP配置&lt;/h2>
&lt;p>从v3.8开始，支持通过平台配置虚拟机的NTP服务器，并通过DHCP自动下发到虚拟机。&lt;/p>
&lt;h3 id="全局配置-1">全局配置&lt;/h3>
&lt;p>同DNS配置，通过注册ntp的endpoint来配置平台的NTP服务器信息。&lt;/p>
&lt;p>首先注册ntp服务&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">climc service-create ntp ntp
&lt;/code>&lt;/pre>&lt;/div>&lt;p>其次注册NTP服务的地址，可以注册多个。每个对应一条endpoint记录。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">climc endpoint-create ntp region0 public &amp;lt;dns_ip&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ip子网配置-1">IP子网配置&lt;/h3>
&lt;p>针对每个IP子网，可以修改这个IP子网的guest_ntp配置，可以设置多个，以逗号分隔。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">climc network-update --ntp &lt;span style="color:#4e9a06">&amp;#39;172.16.22.11,172.16.22.12&amp;#39;&lt;/span> &amp;lt;network&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;p>如果同时配置了全局的NTP配置和IP子网的NTP配置，以IP子网的NTP配置优先生效。&lt;/p>
&lt;p>另外，和DNS配置不同，DNS服务器地址必须使用IP，而NTP服务器的地址可以使用域名。&lt;/p></description></item><item><title>Docs: 流量镜像</title><link>https://www.cloudpods.org/zh/docs/onpremise/network/tutorial/mirror/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.cloudpods.org/zh/docs/onpremise/network/tutorial/mirror/</guid><description>
&lt;p>本节介绍流量镜像的概念和操作。流量镜像是用来抓取任意虚拟机的网络流量送到指定的虚拟机的虚拟网卡或者物理机的物理网卡，无论该虚拟机在哪台宿主机，在哪个VPC，以及虚拟机的操作系统。可以采用第三方流量抓取软件从该虚拟或物理网卡获取流量，进行流量分析，流量回放测试等。&lt;/p>
&lt;h2 id="功能组件">功能组件&lt;/h2>
&lt;p>流量镜像功能包含两个资源：&lt;/p>
&lt;ul>
&lt;li>
&lt;p>镜像目的(tap_service)：用于定义收集流量的虚拟网卡。如果镜像目的是一台虚拟机，则平台会为这台虚拟机增加一个虚拟网卡，专门用于采集流量。如果镜像目的是一台物理机，则需要指定采集流量的物理网卡的mac地址，平台将把该物理网卡加入网桥，将采集到的流量输出到该物理网卡。(在镜像目的为物理机的场景，该物理网卡必须为未使用的物理网卡。)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>镜像源(tap_flow)：用于定义流量的来源。流量的来源可以是指定虚拟机的指定网卡。也可以是指定宿主机的某个虚拟交换机（通过二层网络指定）的全部或部分流量。&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="工作原理">工作原理&lt;/h2>
&lt;p>每台宿主机有一个专门用于流量镜像采集的虚拟网桥brtap。&lt;/p>
&lt;p>如果虚拟机作为镜像目的，则该虚拟机增加一个虚拟网卡，并且该网卡自动加入所在宿主机的brtap。如果该宿主机作为镜像目的，则该宿主机用于流量采集的网卡自动加入宿主机的网桥brtap。&lt;/p>
&lt;p>如果镜像源和镜像目的在同一台宿主机，则会通过patch port，将源虚拟机的流量送到brtap。如果镜像源和镜像目的不在同一台宿主机，则会通过GRE隧道将流量送到镜像目的所在宿主机的brtap。&lt;/p>
&lt;p>宿主机上的sdnagent负责配置brtap的流表，将归属于镜像目的镜像源的流量发送到镜像目的网络端口。&lt;/p>
&lt;h2 id="操作方法">操作方法&lt;/h2>
&lt;h3 id="创建镜像目的">创建镜像目的&lt;/h3>
&lt;p>1、创建虚拟机镜像目的&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">climc tap-service-create --type guest --target-id &amp;lt;id_of_guest&amp;gt; &amp;lt;name_of_tap_service&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;p>2、创建物理机镜像目的&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">climc tap-service-create --type host --target-id &amp;lt;id_of_host&amp;gt; --mac-addr &amp;lt;mac_addr&amp;gt; &amp;lt;name_of_tap_service&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="创建镜像源">创建镜像源&lt;/h3>
&lt;p>1、创建虚拟机网卡镜像源&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">climc tap-flow-create --guest-id &amp;lt;guest_id&amp;gt; --mac-addr &amp;lt;mac_addr&amp;gt; --ip-addr &amp;lt;ip_addr&amp;gt; --direction &amp;lt;IN&lt;span style="color:#000;font-weight:bold">|&lt;/span>OUT&lt;span style="color:#000;font-weight:bold">|&lt;/span>BOTH&amp;gt; --tap-id &amp;lt;tap_service_id&amp;gt; --type vnic &amp;lt;name_of_tap_flow&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;p>2、创建虚拟交换机镜像源&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">climc tap-flow-create --host-id &amp;lt;host_id&amp;gt; --wire-id &amp;lt;wire_id&amp;gt; --vlan-id &amp;lt;vlan_id&amp;gt; --direction &amp;lt;IN&lt;span style="color:#000;font-weight:bold">|&lt;/span>OUT&lt;span style="color:#000;font-weight:bold">|&lt;/span>BOTH&amp;gt; --tap-id &amp;lt;tap_service_id&amp;gt; --type vswitch &amp;lt;name_of_tap_flow&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="启用镜像目的和源">启用镜像目的和源&lt;/h3>
&lt;ol>
&lt;li>镜像目的创建后默认是禁用状态，需要手动启用&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">climc tap-service-enable &amp;lt;tap_service_id&amp;gt;
climc tap-service-disable &amp;lt;tap_service_id&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;p>2、镜像源创建后默认启用状态&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">climc tap-flow-disable &amp;lt;tap_flow_id&amp;gt;
climc tap-flow-enable &amp;lt;tap_flow_id&amp;gt;
&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>
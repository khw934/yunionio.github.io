"use strict";(self.webpackChunkdocs_new=self.webpackChunkdocs_new||[]).push([[5120],{51041:(e,n,t)=>{t.d(n,{Ay:()=>a,RM:()=>i});var o=t(74848),s=t(28453);const i=[];function r(e){const n={a:"a",li:"li",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Operating System: Supported distributions vary depending on CPU architecture. The current situation of supported distributions is as follows:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"http://isoredirect.centos.org/centos/7/isos",children:"CentOS 7.6~7.9 Minimal"}),": Supports x86_64 and arm64"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://www.debian.org/distrib/",children:"Debian 10/11"}),": Supports x86_64 and arm64"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://releases.ubuntu.com/jammy/",children:"Ubuntu 22.04"}),": Supports only x86_64"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://www.kylinos.cn/scheme/server/1.html",children:"Kylin V10 SP2"}),": Supports x86_64 and arm64"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://www.chinauos.com/",children:"Deepin UOS kongzi"}),": Supports x86_64 and arm64"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.li,{children:"The operating system needs to be a clean version, as the deployment tool will build the specified version of Kubernetes cluster from scratch. Ensure that the system does not have container management tools such as Kubernetes and Docker installed, otherwise conflicts may occur and cause installation abnormalities."}),"\n",(0,o.jsx)(n.li,{children:"Minimum system requirements: CPU 4 cores, 8GiB memory, 100GiB storage."}),"\n",(0,o.jsxs)(n.li,{children:["The storage paths used by virtual machines and services are both under ",(0,o.jsx)(n.strong,{children:"/opt"})," directory. Thus, it is recommended to set up a separate mount point for the ",(0,o.jsx)(n.strong,{children:"/opt"})," directory in an ideal environment.","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"For example, create a separate partition for /dev/sdb1 and format it as ext4, then mount it to the /opt directory through /etc/fstab."}),"\n"]}),"\n"]}),"\n"]})}function a(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(r,{...e})}):r(e)}},11407:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>d,toc:()=>c});var o=t(74848),s=t(28453),i=t(51041);const r={sidebar_position:3,edition:"ce"},a="Adding Compute Nodes",d={id:"getting-started/onpremise/host",title:"Adding Compute Nodes",description:"To run private cloud virtual machines, you must first add the corresponding computing nodes (hosts). This section describes how to deploy the corresponding components.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/getting-started/onpremise/host.md",sourceDirName:"getting-started/onpremise",slug:"/getting-started/onpremise/host",permalink:"/en/getting-started/onpremise/host",draft:!1,unlisted:!1,editUrl:"https://github.com/yunionio/website/tree/master/docs/getting-started/onpremise/host.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,edition:"ce"},sidebar:"tutorialSidebar",previous:{title:"High Availability Installation",permalink:"/en/getting-started/onpremise/ha-ce"},next:{title:"\u542f\u7528\u7269\u7406\u673a\u7ba1\u7406\u670d\u52a1",permalink:"/en/getting-started/onpremise/baremetal"}},l={},c=[{value:"Environment",id:"environment",level:2},...i.RM,{value:"Use ocboot to add corresponding nodes",id:"use-ocboot-to-add-corresponding-nodes",level:2},{value:"Add nodes",id:"add-nodes",level:3},{value:"Enable Computing Nodes (Hosts)",id:"enable-computing-nodes-hosts",level:3},{value:"Create virtual machine to test",id:"create-virtual-machine-to-test",level:2},{value:"Upload cirros test image",id:"upload-cirros-test-image",level:3},{value:"Create test network",id:"create-test-network",level:3},{value:"Create virtual machine",id:"create-virtual-machine",level:3},{value:"Common Problem Solving",id:"common-problem-solving",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"adding-compute-nodes",children:"Adding Compute Nodes"}),"\n",(0,o.jsx)(n.p,{children:"To run private cloud virtual machines, you must first add the corresponding computing nodes (hosts). This section describes how to deploy the corresponding components."}),"\n",(0,o.jsx)(n.p,{children:"The computing node is mainly responsible for the management of virtual machines, networks, and storage. The components that need to be installed are as follows:"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{style:{textAlign:"center"},children:"Component"}),(0,o.jsx)(n.th,{style:{textAlign:"left"},children:"Purpose"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{style:{textAlign:"center"},children:"host"}),(0,o.jsx)(n.td,{style:{textAlign:"left"},children:"Manage KVM virtual machines and storage"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{style:{textAlign:"center"},children:"host-deployer"}),(0,o.jsx)(n.td,{style:{textAlign:"left"},children:"Virtual Machine Deployment Service"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{style:{textAlign:"center"},children:"sdnagent"}),(0,o.jsx)(n.td,{style:{textAlign:"left"},children:"Manage virtual machine networks and security groups"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{style:{textAlign:"center"},children:"openvswitch"}),(0,o.jsx)(n.td,{style:{textAlign:"left"},children:"Configure virtual machine network ports and flow tables"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{style:{textAlign:"center"},children:"qemu"}),(0,o.jsx)(n.td,{style:{textAlign:"left"},children:"Run virtual machines"})]})]})]}),"\n",(0,o.jsx)(n.h2,{id:"environment",children:"Environment"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Hardware requirements:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Virtualization: The CPU must support virtualization, which is used for virtual machine KVM acceleration."}),"\n",(0,o.jsx)(n.li,{children:"Enable IOMMU, VT-d: used for GPU pass-through (not required if no GPU)."}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Network:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Currently available subnet: Virtual machines can directly use the flat subnet where the computing node is located. You need to reserve the corresponding endpoint in advance for the cloud platform virtual machine to avoid being occupied by other devices. IP conflicts should also be avoided."}),"\n"]}),"\n"]}),"\n"]}),"\n","\n",(0,o.jsx)(i.Ay,{}),"\n",(0,o.jsx)(n.admonition,{title:"Note",type:"tip",children:(0,o.jsx)(n.p,{children:"If it is for testing purposes, you can deploy the compute node service on a virtual machine, but it may not be able to use KVM acceleration and GPU pass-through."})}),"\n",(0,o.jsx)(n.h2,{id:"use-ocboot-to-add-corresponding-nodes",children:"Use ocboot to add corresponding nodes"}),"\n",(0,o.jsxs)(n.p,{children:["The following operations are performed on the control node. Use the ",(0,o.jsx)(n.code,{children:"ocboot.py add-node"})," command on the control node to add the corresponding compute node."]}),"\n",(0,o.jsx)(n.p,{children:"Assuming that you want to add a compute node 10.168.222.140 to the control node 10.168.26.216, you need to ssh root free to log in to the corresponding compute node and the control node itself."}),"\n",(0,o.jsx)(n.admonition,{title:"Note",type:"tip",children:(0,o.jsx)(n.p,{children:"If it is a high-availability deployment environment, do not use the VIP of the control node for adding node IP here, and only use the actual IP of the first control node. This is because the VIP may drift to other nodes, but usually only the first node is configured with ssh free to log in to other nodes. Using other control nodes may cause ssh login failure."})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Set the control node itself as free login\n$ ssh-copy-id -i ~/.ssh/id_rsa.pub root@10.168.26.216\n\n# Try to log in to the control node without entering a password\n$ ssh root@10.168.26.216 "hostname"\n\n# Copy the generated ~/.ssh/id_rsa.pub public key to the computer to be deployed\n$ ssh-copy-id -i ~/.ssh/id_rsa.pub root@10.168.222.140\n\n# Try to log in to the deployed machine without entering a password, and you should be able to obtain the hostname of the deployed machine\n$ ssh root@10.168.222.140 "hostname"\n'})}),"\n",(0,o.jsx)(n.h3,{id:"add-nodes",children:"Add nodes"}),"\n",(0,o.jsxs)(n.p,{children:["The following commands are all executed on the previously deployed control node, and the ",(0,o.jsx)(n.a,{href:"https://github.com/yunionio/ocboot",children:"ocboot"})," deployment tool should already be installed."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Assuming that the ocboot deployment tool is in the /root/ocboot directory\n$ cd /root/ocboot\n\n# Add nodes using ocboot\n$ ./ocboot.py add-node 10.168.26.216 10.168.222.140\n\n# Other options, refer to help with \'--help\'\n$ ./ocboot.py add-node --help\nusage: ocboot.py add-node [-h] [--user SSH_USER] [--key-file SSH_PRIVATE_FILE] [--port SSH_PORT] [--node-port SSH_NODE_PORT]\n                          FIRST_MASTER_HOST TARGET_NODE_HOSTS [TARGET_NODE_HOSTS ...]\n\npositional arguments:\n  FIRST_MASTER_HOST     onecloud cluster primary master host, e.g., 10.1.2.56\n  TARGET_NODE_HOSTS     target nodes ip added into cluster\n\noptional arguments:\n# This command will use ansible-playbook to add the corresponding compute nodes.\n$ ansible-playbook -i inventory/hosts playbooks/add_nodes.yml --extra-vars "host_key=lzx-allinone-standalone" --tags addnodes  -e "node_ips=192.168.0.1,192.168.0.2,192.168.0.3"\n'})}),"\n",(0,o.jsx)(n.h3,{id:"enable-computing-nodes-hosts",children:"Enable Computing Nodes (Hosts)"}),"\n",(0,o.jsx)(n.p,{children:"After adding computing nodes, you need to enable the newly reported computing nodes. Only enabled hosts can run virtual machines."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Use climc to view the registered list of hosts.\n$ climc host-list\n+--------------------------------------+-------------------------+-------------------+----------------+----------------------------+---------+---------+-------------+----------+-----------+------------+---------------+--------------+------------+-------------------------+--------------+\n|\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0ID\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0|\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Name\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0|\xa0\xa0\xa0\xa0\xa0Access_mac\xa0\xa0\xa0\xa0\xa0\xa0|\xa0\xa0\xa0Access_ip\xa0\xa0\xa0\xa0|\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Manager_URI\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0|\xa0Status\xa0\xa0|\xa0enabled\xa0|\xa0host_status\xa0|\xa0mem_size\xa0|\xa0cpu_count\xa0|\xa0node_count\xa0|\xa0\xa0\xa0\xa0\xa0\xa0sn\xa0\xa0\xa0\xa0\xa0\xa0\xa0|\xa0storage_type\xa0|\xa0host_type\xa0\xa0|\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0version\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0|\xa0storage_size\xa0|\n+--------------------------------------+-------------------------+-------------------+----------------+----------------------------+---------+---------+-------------+----------+-----------+------------+---------------+--------------+------------+-------------------------+--------------+\n| 3830870e-a499-459d-89df-bb6979b5e1ff | lzx-allinone-standalone | 00:22:39:4c:6c:e9 | 10.168.222.140 | http://10.168.222.140:8885 | running | false   | online      | 8192     | 4         | 1          | Not Specified | rotate       | hypervisor | master(7ab047419092301) | 50141        |\n+--------------------------------------+-------------------------+-------------------+----------------+----------------------------+---------+---------+-------------+----------+-----------+------------+---------------+--------------+------------+-------------------------+--------------+\n*** Total: 0 Pages: 0 Limit: 20 Offset: 0 Page: 1 ***\n\n# Start host\n$ climc host-enable lzx-allinone-standalone\n"})}),"\n",(0,o.jsx)(n.h2,{id:"create-virtual-machine-to-test",children:"Create virtual machine to test"}),"\n",(0,o.jsx)(n.h3,{id:"upload-cirros-test-image",children:"Upload cirros test image"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Download cirros test image\n$ wget https://iso.yunion.cn/yumrepo-2.10/images/cirros-0.4.0-x86_64-disk.qcow2\n\n# Upload image to glance\n$ climc image-upload --format qcow2 --os-type Linux --min-disk 10240 cirros-0.4.0-x86_64-disk.qcow2 ./cirros-0.4.0-x86_64-disk.qcow2\n\n# See uploaded image\n$ climc image-list\n+--------------------------------------+--------------------------------+-------------+----------+-----------+----------+---------+--------+----------------------------------+\n|                  ID                  |              Name              | Disk_format |   Size   | Is_public | Min_disk | Min_ram | Status |             Checksum             |\n+--------------------------------------+--------------------------------+-------------+----------+-----------+----------+---------+--------+----------------------------------+\n| 63f6f2af-4db2-4e30-85f5-0ad3baa27bd9 | cirros-0.4.0-x86_64-disk.qcow2 | qcow2       | 22806528 | false     | 30720    | 0       | active | 76dc07d1a730a92d0db7fb2d3c305ecd |\n+--------------------------------------+--------------------------------+-------------+----------+-----------+----------+---------+--------+----------------------------------+\n\n# If the VM is used as a computing node, the storage may not be large, and the default size of the image can be adjusted from 30g to 10g.\n$ climc image-update --min-disk 10240 cirros-0.4.0-x86_64-disk.qcow2\n"})}),"\n",(0,o.jsx)(n.h3,{id:"create-test-network",children:"Create test network"}),"\n",(0,o.jsx)(n.p,{children:"The following is a randomly created network that is not reachable between hosts for testing purposes. If there is a pre-configured flat layer 2 available network, it can be directly used for VMs."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"$ climc network-create --gateway 10.20.30.1 --server-type guest bcast0 vnet0 10.20.30.2 10.20.30.254 24\n$ climc network-public vnet0\n"})}),"\n",(0,o.jsx)(n.h3,{id:"create-virtual-machine",children:"Create virtual machine"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Create a virtual machine testvm01 with 512M memory, 1 CPU, 10g system disk, and a second 5g disk formatted as ext4 and mounted on /opt.\n$ climc server-create  --auto-start --allow-delete \\\n\t\t--disk cirros-0.4.0-x86_64-disk.qcow2:10g --disk 5g:ext4:/opt \\\n\t\t--net vnet0 --ncpu 1 --mem-spec 512M testvm01\n\n# Check the created virtual machine, it should become running after 1 minute\n$ climc server-list --details\n+--------------------------------------+----------+--------------+--------------+-------+---------+------------+-----------+----------+-----------------------------+------------+---------+-------------------------+--------+-----------+\n|                  ID                  |   Name   | Billing_type |     IPs      | Disk  | Status  | vcpu_count | vmem_size | Secgroup |         Created_at          | Hypervisor | os_type |          Host           | Tenant | is_system |\n+--------------------------------------+----------+--------------+--------------+-------+---------+------------+-----------+----------+-----------------------------+------------+---------+-------------------------+--------+-----------+\n| bcda7d18-decc-4b5f-8654-2d201a84d1fb | testvm01 | postpaid     | 10.20.30.254 | 35840 | running | 1          | 512       | Default  | 2019-09-23T05:08:49.000000Z | kvm        | Linux   | lzx-allinone-standalone | system | false     |\n+--------------------------------------+----------+--------------+--------------+-------+---------+------------+-----------+----------+-----------------------------+------------+---------+-------------------------+--------+-----------+\n***  Total: 0 Pages: 0 Limit: 20 Offset: 0 Page: 1  ***\n\n# Get virtual machine login information\n$ climc server-logininfo testvm01\n+-----------+------------------------------------------+\n|   Field   |                  Value                   |\n+-----------+------------------------------------------+\n| login_key | 49wqh5OWGW3jSr1A8RfrMoH69iRRECzaMZITBA== |\n| password  | zS27FwwUFr96                             |\n| updated   | 2019-09-23T05:11:29.306403Z              |\n| username  | root                                     |\n+-----------+------------------------------------------+\n\n# Test network connectivity on the compute node (if you are using a layer 2 network, you should be able to ping the virtual machine's IP directly and you don't need this step)\n$ ip address add 10.20.30.1/24 dev br0\n\n$ ping 10.20.30.254\nPING 10.20.30.254 (10.20.30.254) 56(84) bytes of data.\n64 bytes from 10.20.30.254: icmp_seq=1 ttl=64 time=1.31 ms\n\n# Use the username and password obtained from the \"server-logininfo\" command to log in directly to the virtual machine.\n$ ssh root@10.20.30.254\n\n# If the network is not connected, you can also log in to the virtual machine's TTY login interface through VNC on the front end.\n"})}),"\n",(0,o.jsx)(n.h2,{id:"common-problem-solving",children:"Common Problem Solving"}),"\n",(0,o.jsxs)(n.p,{children:["Please refer to ",(0,o.jsx)(n.a,{href:"../../guides/onpremise/host/troubleshooting",children:"Host Service Issues"})," for common problem solving on compute nodes."]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var o=t(96540);const s={},i=o.createContext(s);function r(e){const n=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);
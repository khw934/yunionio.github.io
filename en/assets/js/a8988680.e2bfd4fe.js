"use strict";(self.webpackChunkdocs_new=self.webpackChunkdocs_new||[]).push([[4185],{40853:(n,e,o)=>{o.d(e,{Ay:()=>s,RM:()=>r});var i=o(74848),t=o(28453),a=o(14902),l=o(28541);function d(){const n=(0,l.c)("ocboot_release_version");return(0,i.jsx)(a.A,{language:"bash",children:`$ wget https://github.com/yunionio/ocboot/archive/refs/tags/${n}.tar.gz\n$ tar xf ${n}.tar.gz\n$ cd ocboot-${n}`})}const r=[{value:"\u4e0b\u8f7d\u90e8\u7f72\u5de5\u5177",id:"\u4e0b\u8f7d\u90e8\u7f72\u5de5\u5177",level:3}];function c(n){const e={a:"a",h3:"h3",p:"p",...(0,t.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h3,{id:"\u4e0b\u8f7d\u90e8\u7f72\u5de5\u5177",children:"\u4e0b\u8f7d\u90e8\u7f72\u5de5\u5177"}),"\n",(0,i.jsxs)(e.p,{children:["\u90e8\u7f72\u7684\u5de5\u5177\u4ee3\u7801\u5728 ",(0,i.jsx)(e.a,{href:"https://github.com/yunionio/ocboot/releases",children:"https://github.com/yunionio/ocboot/release"}),"\uff0c\u9009\u62e9\u5bf9\u5e94\u7684\u7248\u672c\uff0c\u628a\u4ee3\u7801\u7684 tar.gz \u5305\u4e0b\u8f7d\u4e0b\u6765\u3002"]}),"\n","\n",(0,i.jsx)(d,{})]})}function s(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(c,{...n})}):c(n)}},69390:(n,e,o)=>{o.r(e),o.d(e,{assets:()=>c,contentTitle:()=>d,default:()=>m,frontMatter:()=>l,metadata:()=>r,toc:()=>s});var i=o(74848),t=o(28453),a=o(40853);const l={edition:"ce",sidebar_position:3},d="K3s \u63a7\u5236\u8282\u70b9\u66ff\u6362\u6d41\u7a0b",r={id:"operations/ha/replace/k3s",title:"K3s \u63a7\u5236\u8282\u70b9\u66ff\u6362\u6d41\u7a0b",description:"\u4ece v3.11.8 \u5f00\u59cb\uff0c\u4f7f\u7528 ocboot \u90e8\u7f72\u7684\u96c6\u7fa4\u9ed8\u8ba4\u4f1a\u90e8\u7f72\u5230 K3s \u96c6\u7fa4\u4e0a\uff0c\u672c\u6587\u6863\u9002\u7528\u4e8e K3s \u90e8\u7f72\u7684\u73af\u5883\u3002\u4f7f\u7528 K8s \u90e8\u7f72\u7684\u7528\u6237\u8bf7\u53c2\u8003\u6587\u6863\uff1aK8s \u63a7\u5236\u8282\u70b9\u66ff\u6362\u6d41\u7a0b\u3002",source:"@site/docs/operations/ha/replace/k3s.md",sourceDirName:"operations/ha/replace",slug:"/operations/ha/replace/k3s",permalink:"/en/docs/operations/ha/replace/k3s",draft:!1,unlisted:!1,editUrl:"https://github.com/yunionio/website/tree/master/docs/operations/ha/replace/k3s.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{edition:"ce",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"\u63a7\u5236\u8282\u70b9\u66ff\u6362\u6d41\u7a0b",permalink:"/en/docs/operations/ha/replace/"},next:{title:"K8s \u63a7\u5236\u8282\u70b9\u66ff\u6362\u6d41\u7a0b",permalink:"/en/docs/operations/ha/replace/k8s"}},c={},s=[{value:"\u6d4b\u8bd5\u73af\u5883",id:"\u6d4b\u8bd5\u73af\u5883",level:2},{value:"\u6d4b\u8bd5",id:"\u6d4b\u8bd5",level:2},{value:"\u76ee\u6807",id:"\u76ee\u6807",level:3},{value:"\u6b65\u9aa4",id:"\u6b65\u9aa4",level:3},{value:"1. \u9700\u8981\u786e\u8ba4\u6709\u54ea\u4e9b\u6709\u72b6\u6001\u7684 pod \u548c pvc \u8fd0\u884c\u5728\u8be5\u8282\u70b9",id:"1-\u9700\u8981\u786e\u8ba4\u6709\u54ea\u4e9b\u6709\u72b6\u6001\u7684-pod-\u548c-pvc-\u8fd0\u884c\u5728\u8be5\u8282\u70b9",level:4},{value:"2. \u63a5\u4e0b\u6765\u5c06 primary_master_node \u5173\u673a\u8e22\u51fa\u96c6\u7fa4",id:"2-\u63a5\u4e0b\u6765\u5c06-primary_master_node-\u5173\u673a\u8e22\u51fa\u96c6\u7fa4",level:4},{value:"3. \u5220\u9664\u65e7\u7684 primary_master_node \u7684 etcd endpoint",id:"3-\u5220\u9664\u65e7\u7684-primary_master_node-\u7684-etcd-endpoint",level:4},{value:"4. \u66ff\u6362\u65e7\u7684 primary_master_node \u8282\u70b9\uff0c\u52a0\u5165\u65b0\u7684 master_node",id:"4-\u66ff\u6362\u65e7\u7684-primary_master_node-\u8282\u70b9\u52a0\u5165\u65b0\u7684-master_node",level:4},...a.RM,{value:"5. \u6062\u590d\u6709\u72b6\u6001\u7684 pod",id:"5-\u6062\u590d\u6709\u72b6\u6001\u7684-pod",level:4}];function p(n){const e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h1,{id:"k3s-\u63a7\u5236\u8282\u70b9\u66ff\u6362\u6d41\u7a0b",children:"K3s \u63a7\u5236\u8282\u70b9\u66ff\u6362\u6d41\u7a0b"}),"\n",(0,i.jsx)(e.admonition,{type:"tip",children:(0,i.jsxs)(e.p,{children:["\u4ece v3.11.8 \u5f00\u59cb\uff0c\u4f7f\u7528 ocboot \u90e8\u7f72\u7684\u96c6\u7fa4\u9ed8\u8ba4\u4f1a\u90e8\u7f72\u5230 K3s \u96c6\u7fa4\u4e0a\uff0c\u672c\u6587\u6863\u9002\u7528\u4e8e K3s \u90e8\u7f72\u7684\u73af\u5883\u3002\u4f7f\u7528 K8s \u90e8\u7f72\u7684\u7528\u6237\u8bf7\u53c2\u8003\u6587\u6863\uff1a",(0,i.jsx)(e.a,{href:"./k8s",children:"K8s \u63a7\u5236\u8282\u70b9\u66ff\u6362\u6d41\u7a0b"}),"\u3002"]})}),"\n",(0,i.jsx)(e.p,{children:"\u5373\u4f7f\u662f\u9ad8\u53ef\u7528\u90e8\u7f72\u7684 3 \u8282\u70b9 cloudpods over K3s \u96c6\u7fa4\uff0c\u5728\u751f\u4ea7\u73af\u5883\u53ef\u80fd\u4f1a\u51fa\u73b0\u4efb\u610f 1 \u4e2a\u8282\u70b9\u6302\u6389\u7684\u60c5\u51b5\u3002\n\u4e00\u4e9b\u666e\u901a\u7684\u6545\u969c\uff0c\u6bd4\u5982\u66f4\u6362\u5185\u5b58\uff0cCPU \u4e4b\u7c7b\u53ef\u4ee5\u89e3\u51b3\u7684\u95ee\u9898\uff0c\u53ef\u4ee5\u4e34\u65f6\u5173\u673a\uff0c\u6062\u590d\u540e\u518d\u91cd\u542f\u8282\u70b9\u89e3\u51b3\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u4f46\u5982\u679c\u53d1\u751f\u786c\u76d8\u4e4b\u7c7b\u7684\u6545\u969c\uff0c\u6bd4\u5982\u6570\u636e\u65e0\u6cd5\u6062\u590d\u7684\u60c5\u51b5\uff0c\u9700\u8981\u628a\u8be5\u8282\u70b9\u5220\u9664\u518d\u91cd\u65b0\u52a0\u5165\u65b0\u7684\u8282\u70b9\uff0c\u63a5\u4e0b\u6765\u63cf\u8ff0\u8be5\u6b65\u9aa4\u4ee5\u53ca\u6ce8\u610f\u4e8b\u9879\u3002"}),"\n",(0,i.jsx)(e.h2,{id:"\u6d4b\u8bd5\u73af\u5883",children:"\u6d4b\u8bd5\u73af\u5883"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["k3s_vip: 192.168.0.66","\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4f7f\u7528 staticpods keepalived \u8fd0\u884c\u5728 3 \u4e2a master \u8282\u70b9\u4e0a"}),"\n",(0,i.jsx)(e.li,{children:"\u7531 k3s \u76f4\u63a5\u542f\u52a8\uff0c\u8def\u5f84\u5728\uff1a/var/lib/rancher/k3s/agent/pod-manifests/keepalived.yaml"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:"primary_master_node \u7b2c1\u4e2a\u521d\u59cb\u5316\u7684\u63a7\u5236\u8282\u70b9:\nip: 192.168.0.254"}),"\n",(0,i.jsx)(e.li,{children:"master_node_1 \u7b2c2\u4e2a\u52a0\u5165\u63a7\u5236\u8282\u70b9:\nip: 192.168.0.244"}),"\n",(0,i.jsx)(e.li,{children:"master_node_2 \u7b2c3\u4e2a\u52a0\u5165\u7684\u63a7\u5236\u8282\u70b9:\nip: 192.168.0.243"}),"\n",(0,i.jsx)(e.li,{children:"\u6570\u636e\u5e93: \u6570\u636e\u5e93\u90e8\u7f72\u5728\u96c6\u7fa4\u4e4b\u5916\uff0c\u4e0d\u5728 3 \u4e2a\u8282\u70b9\u4e4b\u4e0a"}),"\n",(0,i.jsxs)(e.li,{children:["CSI: \u4f7f\u7528 local-path","\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"local-path \u7684 CSI \u4f1a\u5f3a\u7ed1\u5b9a pod \u5230\u6307\u5b9a\u7684 node\uff0c\u8fd9\u91cc\u9700\u8981\u7279\u522b\u6ce8\u610f"}),"\n",(0,i.jsxs)(e.li,{children:["\u5982\u679c\u6302\u6389\u7684\u8282\u70b9\u6709\u5bf9\u5e94 local-path \u7684 pvc \u7ed1\u5b9a\u5728\u4e0a\u9762\uff0c\u4f7f\u7528\u8be5 pvc \u7684 pod \u5c31\u6ca1\u529e\u6cd5\u6f02\u79fb\u5230\u5176\u5b83 Ready \u7684 node \uff0c\u8fd9\u79cd pod \u53eb\u6709\u72b6\u6001\u7684 pod\uff0c\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4 ",(0,i.jsx)(e.code,{children:"kubectl get pvc -A | grep local-path"})," \u5c31\u53ef\u4ee5\u770b\u5230\u6240\u6709\u7684 local-path pvc"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"$ kubectl get nodes -o wide\nNAME           STATUS   ROLES                       AGE    VERSION        INTERNAL-IP     EXTERNAL-IP   OS-IMAGE                KERNEL-VERSION                    CONTAINER-RUNTIME\nlzx-ha-env     Ready    control-plane,etcd,master   7d5h   v1.28.5+k3s1   192.168.0.254   <none>        CentOS Linux 7 (Core)   5.4.130-1.yn20230805.el7.x86_64   containerd://1.7.11-k3s2\nlzx-ha-env-2   Ready    control-plane,etcd,master   7d5h   v1.28.5+k3s1   192.168.0.244   <none>        CentOS Linux 7 (Core)   5.4.130-1.yn20230805.el7.x86_64   containerd://1.7.11-k3s2\nlzx-ha-env-3   Ready    control-plane,etcd,master   7d5h   v1.28.5+k3s1   192.168.0.243   <none>        CentOS Linux 7 (Core)   5.4.130-1.yn20230805.el7.x86_64   containerd://1.7.11-k3s2\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["minio:","\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u9ad8\u53ef\u7528\u90e8\u7f72\u4e0b\u4f7f\u7528 minio \u4f5c\u4e3a glance \u7684\u540e\u7aef\u5b58\u50a8"}),"\n",(0,i.jsx)(e.li,{children:"statefulset"}),"\n",(0,i.jsx)(e.li,{children:"\u4f7f\u7528 local-path CSI \u4f5c\u4e3a\u540e\u7aef\u5b58\u50a8"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"$ kubectl get pods -n onecloud-minio -o wide\nNAME      READY   STATUS    RESTARTS   AGE     IP              NODE           NOMINATED NODE   READINESS GATES\nminio-0   1/1     Running   0          5d22h   10.40.47.23     lzx-ha-env-2   <none>           <none>\nminio-1   1/1     Running   0          14h     10.40.139.221   lzx-ha-env     <none>           <none>\nminio-2   1/1     Running   0          2d20h   10.40.147.34    lzx-ha-env-3   <none>           <none>\nminio-3   1/1     Running   0          2d20h   10.40.147.35    lzx-ha-env-3   <none>           <none>\n\n$ kubectl get pvc -n onecloud-minio\nNAME             STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE\nexport-minio-0   Bound    pvc-9c052647-73c2-4eb8-a5f0-69abf6cfc898   1Ti        RWO            local-path     7d3h\nexport-minio-1   Bound    pvc-aaded012-d6ca-42b9-bc3a-c03da7c66ec8   1Ti        RWO            local-path     7d3h\nexport-minio-2   Bound    pvc-aae12617-3e12-4a27-9cd8-fef84e609b12   1Ti        RWO            local-path     7d3h\nexport-minio-3   Bound    pvc-721329f0-c961-43f4-a7cc-ccd0f650dbd0   1Ti        RWO            local-path     7d3h\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u6d4b\u8bd5",children:"\u6d4b\u8bd5"}),"\n",(0,i.jsx)(e.h3,{id:"\u76ee\u6807",children:"\u76ee\u6807"}),"\n",(0,i.jsx)(e.p,{children:"\u4e0b\u7ebf primary_master_node 192.168.0.254 \u8282\u70b9\uff0c\u52a0\u5165\u65b0\u7684\u8282\u70b9\u66ff\u6362\u8be5\u8282\u70b9\u3002"}),"\n",(0,i.jsx)(e.h3,{id:"\u6b65\u9aa4",children:"\u6b65\u9aa4"}),"\n",(0,i.jsx)(e.h4,{id:"1-\u9700\u8981\u786e\u8ba4\u6709\u54ea\u4e9b\u6709\u72b6\u6001\u7684-pod-\u548c-pvc-\u8fd0\u884c\u5728\u8be5\u8282\u70b9",children:"1. \u9700\u8981\u786e\u8ba4\u6709\u54ea\u4e9b\u6709\u72b6\u6001\u7684 pod \u548c pvc \u8fd0\u884c\u5728\u8be5\u8282\u70b9"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u6839\u636e IP \u627e\u5230\u8282\u70b9\u5728 k8s \u96c6\u7fa4\u4e2d\u7684\u540d\u79f0\n$ kubectl get nodes -o wide | grep 192.168.0.254\nlzx-ha-env     Ready    control-plane,etcd,master   7d5h   v1.28.5+k3s1   192.168.0.254   <none>        CentOS Linux 7 (Core)   5.4.130-1.yn20230805.el7.x86_64   containerd://1.7.11-k3s2\n\n# \u67e5\u770b\u6240\u6709\u4e3a local-path \u7684 pvc\n$ kubectl get pvc -A | grep local-path\n# onecloud-minio namespace \u7684 export-minio-x \u8d1f\u8d23\u5b58\u50a8 glance \u7684\u955c\u50cf\uff0c\u662f\u5173\u952e\u7ec4\u4ef6\nonecloud-minio        export-minio-0             Bound     pvc-9c052647-73c2-4eb8-a5f0-69abf6cfc898   1Ti        RWO            local-path     7d3h\nonecloud-minio        export-minio-1             Bound     pvc-aaded012-d6ca-42b9-bc3a-c03da7c66ec8   1Ti        RWO            local-path     7d3h\nonecloud-minio        export-minio-2             Bound     pvc-aae12617-3e12-4a27-9cd8-fef84e609b12   1Ti        RWO            local-path     7d3h\nonecloud-minio        export-minio-3             Bound     pvc-721329f0-c961-43f4-a7cc-ccd0f650dbd0   1Ti        RWO            local-path     7d3h\n\n# onecloud-monitoring namespace \u7684 export-monitor-minio-x \u8d1f\u8d23\u5b58\u50a8\u670d\u52a1\u7684\u65e5\u5fd7\uff0c\u4e0d\u662f\u5173\u952e\u7ec4\u4ef6\nonecloud-monitoring   export-monitor-minio-0     Bound     pvc-9b2c4065-ea17-415c-bbec-840db89cf88e   1Ti        RWO            local-path     7d3h\nonecloud-monitoring   export-monitor-minio-1     Bound     pvc-9cd740c2-0044-49df-8cfb-1ead09127b4a   1Ti        RWO            local-path     7d3h\nonecloud-monitoring   export-monitor-minio-2     Bound     pvc-e5fc90f7-8457-43a6-9b50-b4244e53eff2   1Ti        RWO            local-path     7d3h\nonecloud-monitoring   export-monitor-minio-3     Bound     pvc-7b2563db-7904-4297-9bed-bf6e0cb8f626   1Ti        RWO            local-path     7d3h\n\n# onecloud namespace \u4e0b\u9762\u7684\u8fd9\u4e9b pvc \u90fd\u662f\u7cfb\u7edf\u670d\u52a1\u4f9d\u8d56\u7684\n# default-baremetal-agent \u662f\u5b58\u50a8\u7269\u7406\u673a\u7ba1\u7406\u7684\u5b58\u50a8\uff0c\u4e0d\u5f00\u542f baremetal-agent \u53ef\u4ee5\u4e0d\u7528\u7ba1\uff0c\u9ed8\u8ba4\u4e5f\u662f Pending \u5f85\u7ed1\u5b9a\u72b6\u6001\nonecloud              default-baremetal-agent   Pending                                                                        local-path     3h35m\n# default-glance \u8d1f\u8d23\u5b58 glance \u670d\u52a1\u7684\u955c\u50cf\uff0c\u5728\u9ad8\u53ef\u7528\u90e8\u7f72\u73af\u5883\u4e0b\uff0cdeployment default-glance \u4e0d\u4f1a\u6302\u8f7d\u8fd9\u4e2a pvc \uff0c\u4f1a\u4f7f\u7528 onecloud-minio \u91cc\u9762\u7684 minio s3 \u5b58\u50a8\u955c\u50cf\uff0c\u53ef\u4ee5\u4e0d\u7528\u7ba1\nonecloud              default-glance            Pending\n# default-victoria-metrics \u8d1f\u8d23\u5b58\u5e73\u53f0\u7684\u76d1\u63a7\u6570\u636e\uff0c\u76d1\u63a7\u6570\u636e\u53ef\u4ee5\u5bb9\u5fcd\u4e22\u5931\uff0c\u5982\u679c\u6240\u5728\u8282\u70b9\u6302\u4e86\uff0c\u53ef\u4ee5\u5220\u6389\u91cd\u5efa\nonecloud              default-victoria-metrics   Bound     pvc-b0d78630-b4fd-4521-898d-e76b4b1f8e1b   20G        RWO            local-path     7d5h\n\n# \u67e5\u770b\u8be5\u8282\u70b9\u4e0a\u6709\u54ea\u4e9b pod\n$ kubectl get pods -A -o wide | grep onecloud | grep 'lzx-ha-env '\nonecloud-minio        minio-1                                     1/1     Running     0               14h     10.40.139.221   lzx-ha-env     <none>           <none>\nonecloud-monitoring   monitor-minio-1                             1/1     Running     0               14h     10.40.139.218   lzx-ha-env     <none>           <none>\nonecloud              default-etcd-2lnzlkt4fc                     1/1     Running     0               14h     10.40.139.227   lzx-ha-env     <none>           <none>\nonecloud              default-host-deployer-9fcck                 1/1     Running     0               31h     192.168.0.254   lzx-ha-env     <none>           <none>\nonecloud              default-host-health-bxgbk                   1/1     Running     0               7d5h    192.168.0.254   lzx-ha-env     <none>           <none>\nonecloud              default-host-image-h4m8v                    1/1     Running     0               7d5h    192.168.0.254   lzx-ha-env     <none>           <none>\nonecloud              default-host-ntjrv                          3/3     Running     1 (14h ago)     31h     192.168.0.254   lzx-ha-env     <none>           <none>\nonecloud              default-region-dns-8sdhs                    1/1     Running     0               31h     192.168.0.254   lzx-ha-env     <none>           <none>\nonecloud              default-telegraf-p7zc4                      1/1     Running     0               7d5h    192.168.0.254   lzx-ha-env     <none>           <none>\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u901a\u8fc7\u4e0a\u9762\u547d\u4ee4\u7684\u7ed3\u679c\uff0c\u53ef\u4ee5\u7b5b\u9009\u51fa onecloud-minio/minio-1 onecloud-minio/minio-1 \u8fd9\u4e9b\u6709\u72b6\u6001\u7684 pod \u5728 primary_master_node \u4e0a\u3002"}),"\n",(0,i.jsx)(e.h4,{id:"2-\u63a5\u4e0b\u6765\u5c06-primary_master_node-\u5173\u673a\u8e22\u51fa\u96c6\u7fa4",children:"2. \u63a5\u4e0b\u6765\u5c06 primary_master_node \u5173\u673a\u8e22\u51fa\u96c6\u7fa4"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u767b\u5f55\u5176\u5b83\u4e24\u4e2a master_node \u8282\u70b9\uff0c\u6bd4\u5982\uff1a192.168.0.244\n$ ssh root@192.168.0.244\n\n# \u67e5\u770b\u8282\u70b9\u72b6\u6001\uff0c\u53d1\u73b0 primary_master_node \u5df2\u7ecf\u53d8\u6210 NotReady\n[root@lzx-ha-env-2 ~]# kubectl get nodes -o wide\nNAME           STATUS     ROLES                       AGE    VERSION     \nlzx-ha-env     NotReady   control-plane,etcd,master   7d6h   v1.28.5+k3s1\nlzx-ha-env-2   Ready      control-plane,etcd,master   7d6h   v1.28.5+k3s1\nlzx-ha-env-3   Ready      control-plane,etcd,master   7d6h   v1.28.5+k3s1\n\n# \u5220\u9664 primary_master_node \u8282\u70b9\uff1alzx-ha-env\n[root@lzx-ha-env-2 ~]$ kubectl drain --delete-local-data --ignore-daemonsets lzx-ha-env\nWarning: ignoring DaemonSet-managed Pods: kube-system/calico-node-dmcnq, kube-system/traefik-sj9gw, onecloud/default-host-deployer-9fcck, onecloud/default-host-health-bxgbk, onecloud/default-host-image-h4m8v, onecloud/default-host-ntjrv, onecloud/default-region-dns-8sdhs, onecloud/default-telegraf-p7zc4\nevicting pod onecloud/default-etcd-2lnzlkt4fc\nevicting pod onecloud-minio/minio-1\nevicting pod onecloud-monitoring/monitor-minio-1\n# \u8be5\u547d\u4ee4\u4f1a\u5361\u505c\u4f4f\uff0c\u56e0\u4e3a primary_master_node \u5df2\u7ecf\u5173\u673a\u4e86\uff0c\u65e0\u6cd5\u5220\u9664 pod \uff0c\u8fd9\u4e2a\u65f6\u5019 'Ctrl-c' \u53d6\u6d88\u547d\u4ee4\n^C\n\n# \u4f7f\u7528 kubectl delete node \u76f4\u63a5\u5220\u9664 primary_master_node \u8282\u70b9\n$ kubectl delete node lzx-ha-env\n\n# \u7136\u540e\u518d\u67e5\u770b\u5904\u4e8e Pending \u72b6\u6001\u7684 pod \u5168\u90e8\u90fd\u662f\u4e4b\u524d primary_master_node \u4e0a\u9762\u6709\u72b6\u6001\u7684 pod\n# \u56e0\u4e3a\u8fd9\u4e9b pod \u4f7f\u7528\u4e86 local-path \u7684 pvc \uff0c\u8fd9\u4e9b pvc \u662f\u548c\u8282\u70b9\u5f3a\u7ed1\u5b9a\u7684\uff0c\u8fd8\u5b58\u5728\u96c6\u7fa4\u4e2d\n[root@lzx-ha-env-2 ~]$ kubectl get pods -A | grep Pending\nonecloud-minio        minio-1                                     0/1     Pending   0               11s\nonecloud-monitoring   monitor-minio-1                             0/1     Pending   0               12s\nonecloud              default-etcd-4pvj4fxc8g                     0/1     Pending   0               18m\n"})}),"\n",(0,i.jsx)(e.h4,{id:"3-\u5220\u9664\u65e7\u7684-primary_master_node-\u7684-etcd-endpoint",children:"3. \u5220\u9664\u65e7\u7684 primary_master_node \u7684 etcd endpoint"}),"\n",(0,i.jsx)(e.p,{children:"\u4e0b\u8f7d etcdctl\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"$ wget https://github.com/etcd-io/etcd/releases/download/v3.5.5/etcd-v3.5.5-linux-amd64.tar.gz\n$ tar xf etcd-v3.5.5-linux-amd64.tar.gz\n$ cp etcd-v3.5.5-linux-amd64/etcdctl /usr/local/bin/\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u67e5\u770b etcd member"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u4f7f\u7528 etcdctl \u67e5\u770b member list\n$ etcdctl member list \\\n    --endpoints https://127.0.0.1:2379 \\\n    --cacert /var/lib/rancher/k3s/server/tls/etcd/server-ca.crt \\\n    --cert /var/lib/rancher/k3s/server/tls/etcd/client.crt \\\n    --key /var/lib/rancher/k3s/server/tls/etcd/client.key\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u4f1a\u53d1\u73b0\u65e7\u7684 primary_master_node member lzx-ha-env \u5df2\u7ecf\u4e0d\u5728 etcd \u96c6\u7fa4\u4e86\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"ce0d368c9b2596df, started, lzx-ha-env-3-f8946fea, https://192.168.0.243:2380, https://192.168.0.243:2379, false\need2e0188ca5085c, started, lzx-ha-env-2-110bc617, https://192.168.0.244:2380, https://192.168.0.244:2379, false\n"})}),"\n",(0,i.jsxs)(e.admonition,{type:"tip",children:[(0,i.jsx)(e.p,{children:"\u5982\u679c lzx-ha-env \u8282\u70b9\u8fd8\u5728 etcd \u96c6\u7fa4\uff0c\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u628a\u8fd9\u4e2a member \u5220\u6389\uff0c\u6b63\u5e38\u60c5\u51b5\u662f k3s \u81ea\u52a8\u628a\u8fd9\u4e2a member \u5254\u9664\u6389\u4e86\u3002"}),(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"$ etcdctl member remove xxxxx-id \\\n    --endpoints https://127.0.0.1:2379 \\\n    --cacert /var/lib/rancher/k3s/server/tls/etcd/server-ca.crt \\\n    --cert /var/lib/rancher/k3s/server/tls/etcd/client.crt \\\n    --key /var/lib/rancher/k3s/server/tls/etcd/client.key\n"})})]}),"\n",(0,i.jsx)(e.h4,{id:"4-\u66ff\u6362\u65e7\u7684-primary_master_node-\u8282\u70b9\u52a0\u5165\u65b0\u7684-master_node",children:"4. \u66ff\u6362\u65e7\u7684 primary_master_node \u8282\u70b9\uff0c\u52a0\u5165\u65b0\u7684 master_node"}),"\n",(0,i.jsx)(e.p,{children:"\u65e7\u7684 primary_master_node \u8282\u70b9\u5df2\u7ecf\u88ab\u5220\u6389\uff0c\u4f1a\u53d1\u73b0 keepalived \u7684 vip \u6f02\u79fb\u5230\u4e86 lzx-ha-env-2 \u8282\u70b9\u4e0a(vip\u53ef\u80fd\u6f02\u79fb\u5230\u4efb\u610f\u63a7\u5236\u8282\u70b9\uff0c\u9700\u8981\u624b\u52a8\u67e5\u770b)\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'# \u67e5\u770b vip \u4e3a 192.168.0.66\n# \u5982\u679c\u8be5\u8282\u70b9\u8fd0\u884c\u4e86\u4e91\u5e73\u53f0 host \u670d\u52a1\uff0cip \u4f1a\u7ed1\u5b9a\u5230 br0 \u4e0a\n[root@lzx-ha-env-2 ~]$ ip addr show br0\n18: br0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/ether 00:22:5f:cf:fa:66 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.0.244/24 brd 192.168.0.255 scope global br0\n       valid_lft forever preferred_lft forever\n    inet 192.168.0.66/32 scope global br0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::222:5fff:fecf:fa66/64 scope link\n       valid_lft forever preferred_lft forever\n\n# \u67e5\u770b /var/lib/rancher/k3s/agent/pod-manifests/keepalived.yaml env \u914d\u7f6e\n[root@lzx-ha-env-2 ~]$ cat /var/lib/rancher/k3s/agent/pod-manifests/keepalived.yaml | grep -A 17 env\n    env:\n    # \u5bf9\u5e94 keepalived \u7684\u6743\u91cd\uff0c\u9664\u4e86 primary_master_node \u7684 keepalived \u4f1a\u8bbe\u7f6e 100\uff0c\u5176\u4f59 master_node \u4e0a\u9762\u7684\u90fd\u662f 90\n    - name: KEEPALIVED_PRIORITY\n      value: "90"\n    # \u8bbe\u7f6e\u7684 VIP\n    - name: KEEPALIVED_VIRTUAL_IPS\n      value: "#PYTHON2BASH:[\'192.168.0.66\']"\n    # \u662f BACKUP \u89d2\u8272\n    - name: KEEPALIVED_STATE\n      value: BACKUP\n    # \u5bc6\u7801\n    - name: KEEPALIVED_PASSWORD\n      value: "MTkyLjE2"\n    # router id\n    - name: KEEPALIVED_ROUTER_ID\n      value: "66"\n    # \u6539\u8282\u70b9\u7f51\u5361\u5b9e\u9645 ip\n    - name: KEEPALIVED_NODE_IP\n      value: "192.168.0.244"\n    # keepalived \u7ed1\u5b9a\u7684\u7f51\u5361\n    - name: KEEPALIVED_INTERFACE\n      value: "eth0"\n    # keepalived \u63a2\u6d3b\u547d\u4ee4\n    - name: CHECK_KUBE_CMD\n      value: "curl -k -XGET https://192.168.0.244:6443/healthz --cert /var/lib/rancher/k3s/server/tls/client-kube-apiserver.crt --key /var/lib/rancher/k3s/server/tls/client-kube-apiserver.key --cacert /var/lib/rancher/k3s/server/tls/client-ca.crt"\n\n# \u67e5\u770b\u96c6\u7fa4\u5f53\u524d\u53ea\u6709 2 \u4e2a\u8282\u70b9\n[root@lzx-ha-env-2 ocboot]$ kubectl get nodes -o wide\nNAME           STATUS   ROLES                       AGE    VERSION        INTERNAL-IP     EXTERNAL-IP   OS-IMAGE                KERNEL-VERSION                    CONTAINER-RUNTIME\nlzx-ha-env-2   Ready    control-plane,etcd,master   7d6h   v1.28.5+k3s1   192.168.0.244   <none>        CentOS Linux 7 (Core)   5.4.130-1.yn20230805.el7.x86_64   containerd://1.7.11-k3s2\nlzx-ha-env-3   Ready    control-plane,etcd,master   7d6h   v1.28.5+k3s1   192.168.0.243   <none>        CentOS Linux 7 (Core)   5.4.130-1.yn20230805.el7.x86_64   containerd://1.7.11-k3s2\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u4e0b\u8f7d ocboot \u90e8\u7f72\u5de5\u5177\u4ee3\u7801\u3002"}),"\n","\n",(0,i.jsx)(a.Ay,{}),"\n",(0,i.jsx)(e.p,{children:"\u73b0\u5728\u4f7f\u7528 ocboot \u52a0\u5165\u65b0\u7684\u8282\u70b9\uff0c\u7f16\u8f91 ocboot yaml \u914d\u7f6e\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u628a\u5f53\u524d\u7684 lzx-ha-env-2 \u8fd9\u4e2a\u8282\u70b9\u5f53\u505a primary_master_node"}),"\n",(0,i.jsxs)(e.li,{children:["\u9700\u8981\u65b0\u52a0\u5165 master_node \u8282\u70b9\u4fe1\u606f\uff1a","\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"IP: 192.168.0.239"}),"\n",(0,i.jsx)(e.li,{children:"Name: lzx-test-add-node"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u56e0\u4e3a\u65e7\u7684 primary_master_node \u5df2\u7ecf\u88ab\u5220\u9664\u4e86\uff0c\u53c8\u628a\u5f53\u524d\u7684 master_node_1 \u5f53\u505a\u65b0\u96c6\u7fa4\u7684 primary_master_node\uff0c\u73b0\u5728\u7684\u914d\u7f6e\u53d8\u6210\u4e0b\u9762\u8fd9\u6837:"}),"\n",(0,i.jsxs)(e.admonition,{type:"tip",children:[(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u52a0\u5165\u65b0\u8282\u70b9\u4e4b\u524d\uff0c\u9700\u8981\u786e\u4fdd master_node_1 \u80fd\u591fssh\u514d\u5bc6\u767b\u5f55\u65b0\u52a0\u7684\u8282\u70b9"}),"\n",(0,i.jsx)(e.li,{children:"\u5176\u4e2d mysql \u5bc6\u7801\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u67e5\u8be2\uff1a"}),"\n"]}),(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"[root@lzx-ha-env-2 ~]$ kubectl get oc -n onecloud -o yaml | grep mysql: -A 5\n    mysql:\n      host: 192.168.0.252\n      password: 0neC1oudDB#\n      port: 3306\n      username: root\n"})})]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:'$ vim config-new-k8s-ha.yaml\nprimary_master_node:\n  # \u8fd9\u91cc\u628a\u4e4b\u524d\u7684 master_node_1 192.168.0.244 \u5f53\u505a primary_master_node\n  hostname: 192.168.0.244\n  use_local: false\n  user: root\n  onecloud_version: "v3.11.9"\n  # \u6570\u636e\u5e93\u8fde\u63a5\u4fe1\u606f\uff0c\u6839\u636e\u81ea\u5df1\u7684\u73af\u5883\u586b\u5199\n  db_host: 192.168.0.252\n  db_user: "root"\n  db_password: "0neC1oudDB#"\n  db_port: "3306"\n  image_repository: registry.cn-beijing.aliyuncs.com/yunionio\n  ha_using_local_registry: false\n  node_ip: "192.168.0.244"\n  # keepalived \u66b4\u9732\u51fa\u53bb\u7684 vip\n  controlplane_host: 192.168.0.66\n  controlplane_port: "6443"\n  as_host: true\n  # \u542f\u7528 ha \uff0c\u9ed8\u8ba4\u90e8\u7f72 keepavlied\n  high_availability: true\n  use_ee: false\n  # \u9ad8\u53ef\u7528\u4f7f\u7528 minio\n  enable_minio: true\n  host_networks: "eth0/br0/192.168.0.244"\n\nmaster_nodes:\n  # \u52a0\u5165\u5230 192.168.0.66 vip \u7684 k8s \u96c6\u7fa4\n  controlplane_host: 192.168.0.66\n  controlplane_port: "6443"\n  # \u8fd0\u884c\u4e91\u5e73\u53f0\u63a7\u5236\u76f8\u5173\u7ec4\u4ef6\n  as_controller: true\n  # \u4f5c\u4e3a\u4e91\u5e73\u53f0\u79c1\u6709\u4e91\u5bbf\u4e3b\u673a\u8ba1\u7b97\u8282\u70b9\n  as_host: true\n  # \u542f\u7528 keepavlied\n  high_availability: true\n  hosts:\n  - user: root\n    hostname: "192.168.0.239"\n    host_networks: "eth0/br0/192.168.0.239"\n  - user: root\n    hostname: "192.168.0.243"\n    host_networks: "eth0/br0/192.168.0.243"\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u5199\u597d\u914d\u7f6e\u540e\uff0c\u4f7f\u7528 ocboot \u52a0\u5165\u65b0\u8282\u70b9\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"$ ./ocboot.sh run.py virt config-new-k8s-ha.yaml\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u7b49\u5230 ocboot \u7684 ./run.py \u8fd0\u884c\u5b8c\u6210\u540e\uff0c\u518d\u67e5\u770b node \u4fe1\u606f\uff0c\u53d1\u73b0\u65b0\u7684\u8282\u70b9 lzx-test-add-node(192.168.0.239) \u5df2\u7ecf\u52a0\u5165\u8fdb\u6765\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"$ kubectl get nodes -o wide\nNAME                STATUS   ROLES                       AGE   VERSION        INTERNAL-IP     EXTERNAL-IP   OS-IMAGE                    KERNEL-VERSION                       CONTAINER-RUNTIME\nlzx-ha-env-2        Ready    control-plane,etcd,master   8d    v1.28.5+k3s1   192.168.0.244   <none>        CentOS Linux 7 (Core)       5.4.130-1.yn20230805.el7.x86_64      containerd://1.7.11-k3s2\nlzx-ha-env-3        Ready    control-plane,etcd,master   8d    v1.28.5+k3s1   192.168.0.243   <none>        CentOS Linux 7 (Core)       5.4.130-1.yn20230805.el7.x86_64      containerd://1.7.11-k3s2\nlzx-test-add-node   Ready    control-plane,etcd,master   69m   v1.28.5+k3s1   192.168.0.239   <none>        openEuler 22.03 (LTS-SP3)   5.10.0-182.0.0.95.oe2203sp3.x86_64   containerd://1.7.11-k3s2\n"})}),"\n",(0,i.jsx)(e.h4,{id:"5-\u6062\u590d\u6709\u72b6\u6001\u7684-pod",children:"5. \u6062\u590d\u6709\u72b6\u6001\u7684 pod"}),"\n",(0,i.jsx)(e.p,{children:"\u65b0\u7684 master \u8282\u70b9\u52a0\u5165\u540e\uff0c\u4f1a\u53d1\u73b0\u539f\u6765\u7684\u6709\u72b6\u6001 pod \u8fd8\u662f Pending\uff0c\u63a5\u4e0b\u6765\u5c31\u9700\u8981\u5220\u9664\u65e7\u7684 pvc \uff0c\u628a\u5b83\u4eec\u542f\u52a8\u5230\u65b0\u7684 master \u8282\u70b9\u4e0a\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u67e5\u770b Pending \u72b6\u6001\u7684 pod\n[root@lzx-ha-env-2 ~]$ kubectl get pods -A | grep Pending\nonecloud-minio        minio-1                                     0/1     Pending             0             39m\nonecloud-monitoring   monitor-minio-1                             0/1     Pending             0             35m\n\n# \u628a\u73b0\u5728\u7684 primary_master_node \u548c\u65e7\u7684 master_node \u5148\u7981\u6b62\u8c03\u5ea6\uff0c\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u540e\u9762\u7684\u6709\u72b6\u6001 pod \u521b\u5efa\u5230\u65b0\u7684 master \u8282\u70b9\u4e0a\n# \u4fdd\u8bc1 minio \u591a\u526f\u672c\u6253\u6563\u5230\u4e0d\u540c\u7684 master \u8282\u70b9\n[root@lzx-ha-env-2 ~]$ kubectl cordon lzx-ha-env-2 lzx-ha-env-3\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u9996\u5148\u6062\u590d onecloud-minio \u91cc\u9762\u7684 minio statefulset \u7ec4\u4ef6\uff0c\u56e0\u4e3a\u91cc\u9762\u5b58\u50a8\u4e86 glance \u4f9d\u8d56\u7684\u955c\u50cf\uff0c\u901a\u8fc7\u4e4b\u524d\u7684\u547d\u4ee4\u53d1\u73b0 onecloud-minio namespace \u91cc\u9762\u7684 minio-0 \u548c minio-3 \u662f Pending \u72b6\u6001\uff0c\u63a5\u4e0b\u6765\u5220\u9664\u5b83\u4eec\u4f9d\u8d56\u7684 pvc \uff0c\u7136\u540e pod \u5c31\u4f1a\u91cd\u542f\u5230\u65b0\u7684 master_node \u8282\u70b9\u4e0a\uff0c\u64cd\u4f5c\u5982\u4e0b\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'# \u627e\u5230\u5bf9\u5e94\u7684 pvc\n$ kubectl get pvc -n onecloud-minio  | egrep \'minio-1\'\nexport-minio-1   Bound    pvc-aaded012-d6ca-42b9-bc3a-c03da7c66ec8   1Ti        RWO            local-path     8d\n\n# \u5220\u9664 pvc\n$ kubectl delete pvc -n onecloud-minio export-minio-1\n\n# \u5220\u9664 pod\n$ kubectl delete pods -n onecloud-minio minio-1\n\n# \u67e5\u770b\u65b0\u521b\u5efa\u542f\u52a8 minio-1 \uff0c\u5df2\u7ecf\u542f\u52a8\u5230\u65b0\u7684 node \u4e0a\n$ kubectl get pods -n onecloud-minio  -o wide\nkubectl get pods -n onecloud-minio  -o wide\nNAME      READY   STATUS              RESTARTS   AGE     IP             NODE                NOMINATED NODE   READINESS GATES\nminio-0   1/1     Running             0          6d19h   10.40.47.23    lzx-ha-env-2        <none>           <none>\nminio-1   0/1     ContainerCreating   0          34s     <none>         lzx-test-add-node   <none>           <none>\nminio-2   1/1     Running             0          43m     10.40.147.13   lzx-ha-env-3        <none>           <none>\nminio-3   1/1     Running             0          43m     10.40.147.23   lzx-ha-env-3        <none>           <none>\n\n# \u67e5\u770b minio-1 \u7684\u65e5\u5fd7\uff0c\u53d1\u73b0\u5df2\u7ecf\u81ea\u6108\u5b8c\u6bd5\n$ kubectl logs  -n onecloud-minio minio-1\n....\nHealing disk \'/export\' on 1st pool\nHealing disk \'/export\' on 1st pool complete\nSummary:\n{\n  "ID": "ab42567e-de12-4b4c-b8d1-9c0d85fa2196",\n  "PoolIndex": 0,\n  "SetIndex": 0,\n  "DiskIndex": 1,\n  "Path": "/export",\n  "Endpoint": "http://minio-1.minio-svc.onecloud-minio.svc.cluster.local:9000/export",\n  "Started": "2024-12-27T06:45:21.563513912Z",\n  "LastUpdate": "2024-12-27T06:45:49.066891239Z",\n  "ObjectsHealed": 10,\n  "ObjectsFailed": 0,\n  "BytesDone": 612353850,\n  "BytesFailed": 0,\n  "QueuedBuckets": [],\n  "HealedBuckets": [\n    ".minio.sys/config",\n    ".minio.sys/buckets",\n    "onecloud-images"\n  ]\n}\n...\n\n# \u4e5f\u53ef\u4ee5\u767b\u5f55\u5230 lzx-test-add-node \u4e0a\uff0c\u67e5\u770b local-path csi \u91cc\u9762\u7684 minio onecloud-images bucket \u91cc\u9762\u6709\u6ca1\u6709\u5bf9\u5e94\u7684\u955c\u50cf parts\n$ ssh root@10.127.100.224\n\n# \u8fdb\u5165\u5bf9\u5e94\u7684 pvc \u76ee\u5f55\uff0c\u76ee\u5f55\u540d\u53ef\u4ee5\u4f7f\u7528 kubectl get pvc -n onecloud-minio | grep minio-1 \u83b7\u5f97\n[root@lzx-test-add-node ~]$ cd /opt/k3s/storage/pvc-42778b3d-aa41-4d9e-a6b6-443ca0b09b3a_onecloud-minio_export-minio-1/\n[root@lzx-test-add-node pvc-42778b3d-aa41-4d9e-a6b6-443ca0b09b3a_onecloud-minio_export-minio-1]$ du -smh onecloud-images/\n293M    onecloud-images/\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u7136\u540e\u4f7f\u7528\u6062\u590d onecloud-minio \u76f8\u540c\u7684\u65b9\u6cd5\uff0c\u6062\u590d monitor-minio \u5c31\u53ef\u4ee5\uff0c\u53c2\u8003\u547d\u4ee4\u5982\u4e0b\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'$ kubectl  delete pvc -n onecloud-monitoring export-monitor-minio-1\npersistentvolumeclaim "export-monitor-minio-1" deleted\n\n$ kubectl  delete pods -n onecloud-monitoring monitor-minio-1\npod "monitor-minio-1" deleted\n\n$ kubectl get pods -n onecloud-monitoring  | grep minio\nmonitor-minio-0                                   1/1     Running   0          5h17m\nmonitor-minio-1                                   1/1     Running   0          24s\nmonitor-minio-2                                   1/1     Running   0          5h17m\nmonitor-minio-3                                   1/1     Running   0          5h17m\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u6062\u590d victoria-metrics deployment\uff0cinfluxdb \u548c minio \u4e0d\u592a\u4e00\u6837\uff0cminio \u4f7f\u7528\u7684 statefulset \u7ba1\u7406\uff0c\u5220\u6389 pod \u548c pvc \u540e\uff0ck8s \u4f1a\u81ea\u52a8\u521b\u5efa\u5bf9\u5e94\u5e8f\u53f7\u7684 pod \u548c pvc \uff0c\u4f46\u662f deployment \u4e0d\u4f1a\uff0c\u6240\u4ee5\u6062\u590d victoria-metrics \u7684\u6b65\u9aa4\u662f\u5220\u6389 pvc\uff0c\u7136\u540e\u540c\u65f6\u5220\u6389 default-victoria-metrics \u8fd9\u4e2a deployment \uff0c\u6211\u4eec\u7684 onecloud-operator \u7ec4\u4ef6\u5c31\u4f1a\u65b0\u5efa\u5bf9\u5e94\u7684\u8d44\u6e90\uff0c\u6b65\u9aa4\u5982\u4e0b\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u6062\u590d victoria-metrics\n$ kubectl delete  pvc -n onecloud default-victoria-metrics\n$ kubectl delete  deployment -n onecloud default-victoria-metrics\n$ kubectl get pods -n onecloud -o wide | grep victoria-metrics\ndefault-victoria-metrics-774fc8499b-4rjzx   0/1     ContainerCreating   0             7s      <none>          lzx-test-add-node   <none>           <none>\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u73b0\u5728\u6240\u6709\u5728\u65e7\u7684 primary_master_node \u4e0a\u7684\u7ec4\u4ef6\u90fd\u6062\u590d\uff0c\u63a5\u4e0b\u6765\u628a\u7981\u6b62\u8c03\u5ea6\u7684\u8282\u70b9\u542f\u7528\u8c03\u5ea6\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"$ kubectl uncordon lzx-ha-env-2 lzx-ha-env-3\n"})})]})}function m(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(p,{...n})}):p(n)}},28541:(n,e,o)=>{o.d(e,{c:()=>t});var i=o(44586);function t(n){const{siteConfig:e}=(0,i.A)();return e.customFields[n]}},67332:(n,e,o)=>{o.d(e,{A:()=>a});o(96540);var i=o(52830),t=o(74848);function a(n){const e={...n};return e?.code?.length>2&&(e.code=e.code.split("\n").map((n=>n.length>2&&"$ "===n.substring(0,2)?n.substring(2):n)).join("\n")),(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(i.A,{...e})})}}}]);